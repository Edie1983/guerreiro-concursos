var sf=i=>{throw TypeError(i)};var cl=(i,t,e)=>t.has(i)||sf("Cannot "+e);var Mt=(i,t,e)=>(cl(i,t,"read from private field"),e?e.call(i):t.get(i)),ds=(i,t,e)=>t.has(i)?sf("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),De=(i,t,e,s)=>(cl(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e),fs=(i,t,e)=>(cl(i,t,"access private method"),e);var nf=(i,t,e,s)=>({set _(n){De(i,t,n,e)},get _(){return Mt(i,t,s)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();var lo,ht,tm,Oi,rf,em,sm,im,zh,Hl,ql,nm,jr={},rm=[],Nb=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ho=Array.isArray;function bs(i,t){for(var e in t)i[e]=t[e];return i}function jh(i){i&&i.parentNode&&i.parentNode.removeChild(i)}function F(i,t,e){var s,n,r,o={};for(r in t)r=="key"?s=t[r]:r=="ref"?n=t[r]:o[r]=t[r];if(arguments.length>2&&(o.children=arguments.length>3?lo.call(arguments,2):e),typeof i=="function"&&i.defaultProps!=null)for(r in i.defaultProps)o[r]===void 0&&(o[r]=i.defaultProps[r]);return Nr(i,o,s,n,null)}function Nr(i,t,e,s,n){var r={type:i,props:t,key:e,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:n??++tm,__i:-1,__u:0};return n==null&&ht.vnode!=null&&ht.vnode(r),r}function Lb(){return{current:null}}function we(i){return i.children}function rs(i,t){this.props=i,this.context=t}function On(i,t){if(t==null)return i.__?On(i.__,i.__i+1):null;for(var e;t<i.__k.length;t++)if((e=i.__k[t])!=null&&e.__e!=null)return e.__e;return typeof i.type=="function"?On(i):null}function om(i){var t,e;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,t=0;t<i.__k.length;t++)if((e=i.__k[t])!=null&&e.__e!=null){i.__e=i.__c.base=e.__e;break}return om(i)}}function Gl(i){(!i.__d&&(i.__d=!0)&&Oi.push(i)&&!Da.__r++||rf!=ht.debounceRendering)&&((rf=ht.debounceRendering)||em)(Da)}function Da(){for(var i,t,e,s,n,r,o,a=1;Oi.length;)Oi.length>a&&Oi.sort(sm),i=Oi.shift(),a=Oi.length,i.__d&&(e=void 0,s=void 0,n=(s=(t=i).__v).__e,r=[],o=[],t.__P&&((e=bs({},s)).__v=s.__v+1,ht.vnode&&ht.vnode(e),Hh(t.__P,e,s,t.__n,t.__P.namespaceURI,32&s.__u?[n]:null,r,n??On(s),!!(32&s.__u),o),e.__v=s.__v,e.__.__k[e.__i]=e,lm(r,e,o),s.__e=s.__=null,e.__e!=n&&om(e)));Da.__r=0}function am(i,t,e,s,n,r,o,a,c,l,h){var u,p,g,y,m,v,w,E=s&&s.__k||rm,A=t.length;for(c=Ob(e,t,E,c,A),u=0;u<A;u++)(g=e.__k[u])!=null&&(p=g.__i==-1?jr:E[g.__i]||jr,g.__i=u,v=Hh(i,g,p,n,r,o,a,c,l,h),y=g.__e,g.ref&&p.ref!=g.ref&&(p.ref&&qh(p.ref,null,g),h.push(g.ref,g.__c||y,g)),m==null&&y!=null&&(m=y),(w=!!(4&g.__u))||p.__k===g.__k?c=cm(g,c,i,w):typeof g.type=="function"&&v!==void 0?c=v:y&&(c=y.nextSibling),g.__u&=-7);return e.__e=m,c}function Ob(i,t,e,s,n){var r,o,a,c,l,h=e.length,u=h,p=0;for(i.__k=new Array(n),r=0;r<n;r++)(o=t[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=i.__k[r]=Nr(null,o,null,null,null):ho(o)?o=i.__k[r]=Nr(we,{children:o},null,null,null):o.constructor==null&&o.__b>0?o=i.__k[r]=Nr(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):i.__k[r]=o,c=r+p,o.__=i,o.__b=i.__b+1,a=null,(l=o.__i=Fb(o,e,c,u))!=-1&&(u--,(a=e[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(n>h?p--:n<h&&p++),typeof o.type!="function"&&(o.__u|=4)):l!=c&&(l==c-1?p--:l==c+1?p++:(l>c?p--:p++,o.__u|=4))):i.__k[r]=null;if(u)for(r=0;r<h;r++)(a=e[r])!=null&&(2&a.__u)==0&&(a.__e==s&&(s=On(a)),um(a,a));return s}function cm(i,t,e,s){var n,r;if(typeof i.type=="function"){for(n=i.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=i,t=cm(n[r],t,e,s));return t}i.__e!=t&&(s&&(t&&i.type&&!t.parentNode&&(t=On(i)),e.insertBefore(i.__e,t||null)),t=i.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function os(i,t){return t=t||[],i==null||typeof i=="boolean"||(ho(i)?i.some(function(e){os(e,t)}):t.push(i)),t}function Fb(i,t,e,s){var n,r,o,a=i.key,c=i.type,l=t[e],h=l!=null&&(2&l.__u)==0;if(l===null&&a==null||h&&a==l.key&&c==l.type)return e;if(s>(h?1:0)){for(n=e-1,r=e+1;n>=0||r<t.length;)if((l=t[o=n>=0?n--:r++])!=null&&(2&l.__u)==0&&a==l.key&&c==l.type)return o}return-1}function of(i,t,e){t[0]=="-"?i.setProperty(t,e??""):i[t]=e==null?"":typeof e!="number"||Nb.test(t)?e:e+"px"}function Wo(i,t,e,s,n){var r,o;t:if(t=="style")if(typeof e=="string")i.style.cssText=e;else{if(typeof s=="string"&&(i.style.cssText=s=""),s)for(t in s)e&&t in e||of(i.style,t,"");if(e)for(t in e)s&&e[t]==s[t]||of(i.style,t,e[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(im,"$1")),o=t.toLowerCase(),t=o in i||t=="onFocusOut"||t=="onFocusIn"?o.slice(2):t.slice(2),i.l||(i.l={}),i.l[t+r]=e,e?s?e.u=s.u:(e.u=zh,i.addEventListener(t,r?ql:Hl,r)):i.removeEventListener(t,r?ql:Hl,r);else{if(n=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in i)try{i[t]=e??"";break t}catch{}typeof e=="function"||(e==null||e===!1&&t[4]!="-"?i.removeAttribute(t):i.setAttribute(t,t=="popover"&&e==1?"":e))}}function af(i){return function(t){if(this.l){var e=this.l[t.type+i];if(t.t==null)t.t=zh++;else if(t.t<e.u)return;return e(ht.event?ht.event(t):t)}}}function Hh(i,t,e,s,n,r,o,a,c,l){var h,u,p,g,y,m,v,w,E,A,P,x,M,S,T,I,k,R=t.type;if(t.constructor!=null)return null;128&e.__u&&(c=!!(32&e.__u),r=[a=t.__e=e.__e]),(h=ht.__b)&&h(t);t:if(typeof R=="function")try{if(w=t.props,E="prototype"in R&&R.prototype.render,A=(h=R.contextType)&&s[h.__c],P=h?A?A.props.value:h.__:s,e.__c?v=(u=t.__c=e.__c).__=u.__E:(E?t.__c=u=new R(w,P):(t.__c=u=new rs(w,P),u.constructor=R,u.render=Bb),A&&A.sub(u),u.state||(u.state={}),u.__n=s,p=u.__d=!0,u.__h=[],u._sb=[]),E&&u.__s==null&&(u.__s=u.state),E&&R.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=bs({},u.__s)),bs(u.__s,R.getDerivedStateFromProps(w,u.__s))),g=u.props,y=u.state,u.__v=t,p)E&&R.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),E&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(E&&R.getDerivedStateFromProps==null&&w!==g&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(w,P),t.__v==e.__v||!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(w,u.__s,P)===!1){for(t.__v!=e.__v&&(u.props=w,u.state=u.__s,u.__d=!1),t.__e=e.__e,t.__k=e.__k,t.__k.some(function(N){N&&(N.__=t)}),x=0;x<u._sb.length;x++)u.__h.push(u._sb[x]);u._sb=[],u.__h.length&&o.push(u);break t}u.componentWillUpdate!=null&&u.componentWillUpdate(w,u.__s,P),E&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(g,y,m)})}if(u.context=P,u.props=w,u.__P=i,u.__e=!1,M=ht.__r,S=0,E){for(u.state=u.__s,u.__d=!1,M&&M(t),h=u.render(u.props,u.state,u.context),T=0;T<u._sb.length;T++)u.__h.push(u._sb[T]);u._sb=[]}else do u.__d=!1,M&&M(t),h=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++S<25);u.state=u.__s,u.getChildContext!=null&&(s=bs(bs({},s),u.getChildContext())),E&&!p&&u.getSnapshotBeforeUpdate!=null&&(m=u.getSnapshotBeforeUpdate(g,y)),I=h,h!=null&&h.type===we&&h.key==null&&(I=hm(h.props.children)),a=am(i,ho(I)?I:[I],t,e,s,n,r,o,a,c,l),u.base=t.__e,t.__u&=-161,u.__h.length&&o.push(u),v&&(u.__E=u.__=null)}catch(N){if(t.__v=null,c||r!=null)if(N.then){for(t.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,t.__e=a}else{for(k=r.length;k--;)jh(r[k]);Wl(t)}else t.__e=e.__e,t.__k=e.__k,N.then||Wl(t);ht.__e(N,t,e)}else r==null&&t.__v==e.__v?(t.__k=e.__k,t.__e=e.__e):a=t.__e=Vb(e.__e,t,e,s,n,r,o,c,l);return(h=ht.diffed)&&h(t),128&t.__u?void 0:a}function Wl(i){i&&i.__c&&(i.__c.__e=!0),i&&i.__k&&i.__k.forEach(Wl)}function lm(i,t,e){for(var s=0;s<e.length;s++)qh(e[s],e[++s],e[++s]);ht.__c&&ht.__c(t,i),i.some(function(n){try{i=n.__h,n.__h=[],i.some(function(r){r.call(n)})}catch(r){ht.__e(r,n.__v)}})}function hm(i){return typeof i!="object"||i==null||i.__b&&i.__b>0?i:ho(i)?i.map(hm):bs({},i)}function Vb(i,t,e,s,n,r,o,a,c){var l,h,u,p,g,y,m,v=e.props||jr,w=t.props,E=t.type;if(E=="svg"?n="http://www.w3.org/2000/svg":E=="math"?n="http://www.w3.org/1998/Math/MathML":n||(n="http://www.w3.org/1999/xhtml"),r!=null){for(l=0;l<r.length;l++)if((g=r[l])&&"setAttribute"in g==!!E&&(E?g.localName==E:g.nodeType==3)){i=g,r[l]=null;break}}if(i==null){if(E==null)return document.createTextNode(w);i=document.createElementNS(n,E,w.is&&w),a&&(ht.__m&&ht.__m(t,r),a=!1),r=null}if(E==null)v===w||a&&i.data==w||(i.data=w);else{if(r=r&&lo.call(i.childNodes),!a&&r!=null)for(v={},l=0;l<i.attributes.length;l++)v[(g=i.attributes[l]).name]=g.value;for(l in v)if(g=v[l],l!="children"){if(l=="dangerouslySetInnerHTML")u=g;else if(!(l in w)){if(l=="value"&&"defaultValue"in w||l=="checked"&&"defaultChecked"in w)continue;Wo(i,l,null,g,n)}}for(l in w)g=w[l],l=="children"?p=g:l=="dangerouslySetInnerHTML"?h=g:l=="value"?y=g:l=="checked"?m=g:a&&typeof g!="function"||v[l]===g||Wo(i,l,g,v[l],n);if(h)a||u&&(h.__html==u.__html||h.__html==i.innerHTML)||(i.innerHTML=h.__html),t.__k=[];else if(u&&(i.innerHTML=""),am(t.type=="template"?i.content:i,ho(p)?p:[p],t,e,s,E=="foreignObject"?"http://www.w3.org/1999/xhtml":n,r,o,r?r[0]:e.__k&&On(e,0),a,c),r!=null)for(l=r.length;l--;)jh(r[l]);a||(l="value",E=="progress"&&y==null?i.removeAttribute("value"):y!=null&&(y!==i[l]||E=="progress"&&!y||E=="option"&&y!=v[l])&&Wo(i,l,y,v[l],n),l="checked",m!=null&&m!=i[l]&&Wo(i,l,m,v[l],n))}return i}function qh(i,t,e){try{if(typeof i=="function"){var s=typeof i.__u=="function";s&&i.__u(),s&&t==null||(i.__u=i(t))}else i.current=t}catch(n){ht.__e(n,e)}}function um(i,t,e){var s,n;if(ht.unmount&&ht.unmount(i),(s=i.ref)&&(s.current&&s.current!=i.__e||qh(s,null,t)),(s=i.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(r){ht.__e(r,t)}s.base=s.__P=null}if(s=i.__k)for(n=0;n<s.length;n++)s[n]&&um(s[n],t,e||typeof i.type!="function");e||jh(i.__e),i.__c=i.__=i.__e=void 0}function Bb(i,t,e){return this.constructor(i,e)}function Fn(i,t,e){var s,n,r,o;t==document&&(t=document.documentElement),ht.__&&ht.__(i,t),n=(s=typeof e=="function")?null:e&&e.__k||t.__k,r=[],o=[],Hh(t,i=(!s&&e||t).__k=F(we,null,[i]),n||jr,jr,t.namespaceURI,!s&&e?[e]:n?null:t.firstChild?lo.call(t.childNodes):null,r,!s&&e?e:n?n.__e:t.firstChild,s,o),lm(r,i,o)}function dm(i,t){Fn(i,t,dm)}function fm(i,t,e){var s,n,r,o,a=bs({},i.props);for(r in i.type&&i.type.defaultProps&&(o=i.type.defaultProps),t)r=="key"?s=t[r]:r=="ref"?n=t[r]:a[r]=t[r]===void 0&&o!=null?o[r]:t[r];return arguments.length>2&&(a.children=arguments.length>3?lo.call(arguments,2):e),Nr(i.type,a,s||i.key,n||i.ref,null)}function Gh(i){function t(e){var s,n;return this.getChildContext||(s=new Set,(n={})[t.__c]=this,this.getChildContext=function(){return n},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(r){this.props.value!=r.value&&s.forEach(function(o){o.__e=!0,Gl(o)})},this.sub=function(r){s.add(r);var o=r.componentWillUnmount;r.componentWillUnmount=function(){s&&s.delete(r),o&&o.call(r)}}),e.children}return t.__c="__cC"+nm++,t.__=i,t.Provider=t.__l=(t.Consumer=function(e,s){return e.children(s)}).contextType=t,t}lo=rm.slice,ht={__e:function(i,t,e,s){for(var n,r,o;t=t.__;)if((n=t.__c)&&!n.__)try{if((r=n.constructor)&&r.getDerivedStateFromError!=null&&(n.setState(r.getDerivedStateFromError(i)),o=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(i,s||{}),o=n.__d),o)return n.__E=n}catch(a){i=a}throw i}},tm=0,rs.prototype.setState=function(i,t){var e;e=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=bs({},this.state),typeof i=="function"&&(i=i(bs({},e),this.props)),i&&bs(e,i),i!=null&&this.__v&&(t&&this._sb.push(t),Gl(this))},rs.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),Gl(this))},rs.prototype.render=we,Oi=[],em=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,sm=function(i,t){return i.__v.__b-t.__v.__b},Da.__r=0,im=/(PointerCapture)$|Capture$/i,zh=0,Hl=af(!1),ql=af(!0),nm=0;var Ub=0;function d(i,t,e,s,n,r){t||(t={});var o,a,c=t;if("ref"in c)for(a in c={},t)a=="ref"?o=t[a]:c[a]=t[a];var l={type:i,props:c,key:e,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ub,__i:-1,__u:0,__source:n,__self:r};if(typeof i=="function"&&(o=i.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return ht.vnode&&ht.vnode(l),l}var fi,kt,ll,cf,Vn=0,pm=[],Vt=ht,lf=Vt.__b,hf=Vt.__r,uf=Vt.diffed,df=Vt.__c,ff=Vt.unmount,pf=Vt.__;function Wn(i,t){Vt.__h&&Vt.__h(kt,i,Vn||t),Vn=0;var e=kt.__H||(kt.__H={__:[],__h:[]});return i>=e.__.length&&e.__.push({}),e.__[i]}function $(i){return Vn=1,Wh(ym,i)}function Wh(i,t,e){var s=Wn(fi++,2);if(s.t=i,!s.__c&&(s.__=[e?e(t):ym(void 0,t),function(a){var c=s.__N?s.__N[0]:s.__[0],l=s.t(c,a);c!==l&&(s.__N=[l,s.__[1]],s.__c.setState({}))}],s.__c=kt,!kt.__f)){var n=function(a,c,l){if(!s.__c.__H)return!0;var h=s.__c.__H.__.filter(function(p){return!!p.__c});if(h.every(function(p){return!p.__N}))return!r||r.call(this,a,c,l);var u=s.__c.props!==a;return h.forEach(function(p){if(p.__N){var g=p.__[0];p.__=p.__N,p.__N=void 0,g!==p.__[0]&&(u=!0)}}),r&&r.call(this,a,c,l)||u};kt.__f=!0;var r=kt.shouldComponentUpdate,o=kt.componentWillUpdate;kt.componentWillUpdate=function(a,c,l){if(this.__e){var h=r;r=void 0,n(a,c,l),r=h}o&&o.call(this,a,c,l)},kt.shouldComponentUpdate=n}return s.__N||s.__}function bt(i,t){var e=Wn(fi++,3);!Vt.__s&&Yh(e.__H,t)&&(e.__=i,e.u=t,kt.__H.__h.push(e))}function uo(i,t){var e=Wn(fi++,4);!Vt.__s&&Yh(e.__H,t)&&(e.__=i,e.u=t,kt.__h.push(e))}function Gi(i){return Vn=5,ie(function(){return{current:i}},[])}function gm(i,t,e){Vn=6,uo(function(){if(typeof i=="function"){var s=i(t());return function(){i(null),s&&typeof s=="function"&&s()}}if(i)return i.current=t(),function(){return i.current=null}},e==null?e:e.concat(i))}function ie(i,t){var e=Wn(fi++,7);return Yh(e.__H,t)&&(e.__=i(),e.__H=t,e.__h=i),e.__}function Kh(i,t){return Vn=8,ie(function(){return i},t)}function Xh(i){var t=kt.context[i.__c],e=Wn(fi++,9);return e.c=i,t?(e.__==null&&(e.__=!0,t.sub(kt)),t.props.value):i.__}function mm(i,t){Vt.useDebugValue&&Vt.useDebugValue(t?t(i):i)}function _m(){var i=Wn(fi++,11);if(!i.__){for(var t=kt.__v;t!==null&&!t.__m&&t.__!==null;)t=t.__;var e=t.__m||(t.__m=[0,0]);i.__="P"+e[0]+"-"+e[1]++}return i.__}function $b(){for(var i;i=pm.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(pa),i.__H.__h.forEach(Kl),i.__H.__h=[]}catch(t){i.__H.__h=[],Vt.__e(t,i.__v)}}Vt.__b=function(i){kt=null,lf&&lf(i)},Vt.__=function(i,t){i&&t.__k&&t.__k.__m&&(i.__m=t.__k.__m),pf&&pf(i,t)},Vt.__r=function(i){hf&&hf(i),fi=0;var t=(kt=i.__c).__H;t&&(ll===kt?(t.__h=[],kt.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0})):(t.__h.forEach(pa),t.__h.forEach(Kl),t.__h=[],fi=0)),ll=kt},Vt.diffed=function(i){uf&&uf(i);var t=i.__c;t&&t.__H&&(t.__H.__h.length&&(pm.push(t)!==1&&cf===Vt.requestAnimationFrame||((cf=Vt.requestAnimationFrame)||zb)($b)),t.__H.__.forEach(function(e){e.u&&(e.__H=e.u),e.u=void 0})),ll=kt=null},Vt.__c=function(i,t){t.some(function(e){try{e.__h.forEach(pa),e.__h=e.__h.filter(function(s){return!s.__||Kl(s)})}catch(s){t.some(function(n){n.__h&&(n.__h=[])}),t=[],Vt.__e(s,e.__v)}}),df&&df(i,t)},Vt.unmount=function(i){ff&&ff(i);var t,e=i.__c;e&&e.__H&&(e.__H.__.forEach(function(s){try{pa(s)}catch(n){t=n}}),e.__H=void 0,t&&Vt.__e(t,e.__v))};var gf=typeof requestAnimationFrame=="function";function zb(i){var t,e=function(){clearTimeout(s),gf&&cancelAnimationFrame(t),setTimeout(i)},s=setTimeout(e,35);gf&&(t=requestAnimationFrame(e))}function pa(i){var t=kt,e=i.__c;typeof e=="function"&&(i.__c=void 0,e()),kt=t}function Kl(i){var t=kt;i.__c=i.__(),kt=t}function Yh(i,t){return!i||i.length!==t.length||t.some(function(e,s){return e!==i[s]})}function ym(i,t){return typeof t=="function"?t(i):t}var jb={};function Ko(i,t){for(var e in t)i[e]=t[e];return i}function Hb(i,t,e){var s,n=/(?:\?([^#]*))?(#.*)?$/,r=i.match(n),o={};if(r&&r[1])for(var a=r[1].split("&"),c=0;c<a.length;c++){var l=a[c].split("=");o[decodeURIComponent(l[0])]=decodeURIComponent(l.slice(1).join("="))}i=Xl(i.replace(n,"")),t=Xl(t||"");for(var h=Math.max(i.length,t.length),u=0;u<h;u++)if(t[u]&&t[u].charAt(0)===":"){var p=t[u].replace(/(^:|[+*?]+$)/g,""),g=(t[u].match(/[+*?]+$/)||jb)[0]||"",y=~g.indexOf("+"),m=~g.indexOf("*"),v=i[u]||"";if(!v&&!m&&(g.indexOf("?")<0||y)){s=!1;break}if(o[p]=decodeURIComponent(v),y||m){o[p]=i.slice(u).map(decodeURIComponent).join("/");break}}else if(t[u]!==i[u]){s=!1;break}return(e.default===!0||s!==!1)&&o}function qb(i,t){return i.rank<t.rank?1:i.rank>t.rank?-1:i.index-t.index}function Gb(i,t){return i.index=t,i.rank=(function(e){return e.props.default?0:Xl(e.props.path).map(Wb).join("")})(i),i.props}function Xl(i){return i.replace(/(^\/+|\/+$)/g,"").split("/")}function Wb(i){return i.charAt(0)==":"?1+"*+?".indexOf(i.charAt(i.length-1))||4:5}var Kb={},ji=[],mf=[],ze=null,vm={url:Qh()},Xb=Gh(vm);function Qh(){var i;return""+((i=ze&&ze.location?ze.location:ze&&ze.getCurrentLocation?ze.getCurrentLocation():typeof location<"u"?location:Kb).pathname||"")+(i.search||"")}function Y(i,t){return t===void 0&&(t=!1),typeof i!="string"&&i.url&&(t=i.replace,i=i.url),(function(e){for(var s=ji.length;s--;)if(ji[s].canRoute(e))return!0;return!1})(i)&&(function(e,s){s===void 0&&(s="push"),ze&&ze[s]?ze[s](e):typeof history<"u"&&history[s+"State"]&&history[s+"State"](null,null,e)})(i,t?"replace":"push"),bm(i)}function bm(i){for(var t=!1,e=0;e<ji.length;e++)ji[e].routeTo(i)&&(t=!0);return t}function Yb(i){if(i&&i.getAttribute){var t=i.getAttribute("href"),e=i.getAttribute("target");if(t&&t.match(/^\//g)&&(!e||e.match(/^_?self$/i)))return Y(t)}}function Qb(i){return i.stopImmediatePropagation&&i.stopImmediatePropagation(),i.stopPropagation&&i.stopPropagation(),i.preventDefault(),!1}function Jb(i){if(!(i.ctrlKey||i.metaKey||i.altKey||i.shiftKey||i.button)){var t=i.target;do if(t.localName==="a"&&t.getAttribute("href")){if(t.hasAttribute("data-native")||t.hasAttribute("native"))return;if(Yb(t))return Qb(i)}while(t=t.parentNode)}}var _f=!1;function wm(i){i.history&&(ze=i.history),this.state={url:i.url||Qh()}}Ko(wm.prototype=new rs,{shouldComponentUpdate:function(i){return i.static!==!0||i.url!==this.props.url||i.onChange!==this.props.onChange},canRoute:function(i){var t=os(this.props.children);return this.g(t,i)!==void 0},routeTo:function(i){this.setState({url:i});var t=this.canRoute(i);return this.p||this.forceUpdate(),t},componentWillMount:function(){this.p=!0},componentDidMount:function(){var i=this;_f||(_f=!0,ze||addEventListener("popstate",function(){bm(Qh())}),addEventListener("click",Jb)),ji.push(this),ze&&(this.u=ze.listen(function(t){var e=t.location||t;i.routeTo(""+(e.pathname||"")+(e.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),ji.splice(ji.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(i,t){i=i.filter(Gb).sort(qb);for(var e=0;e<i.length;e++){var s=i[e],n=Hb(t,s.props.path,s.props);if(n)return[s,n]}},render:function(i,t){var e,s,n=i.onChange,r=t.url,o=this.c,a=this.g(os(i.children),r);if(a&&(s=fm(a[0],Ko(Ko({url:r,matches:e=a[1]},e),{key:void 0,ref:void 0}))),r!==(o&&o.url)){Ko(vm,o=this.c={url:r,previous:o&&o.url,current:s,path:s?s.props.path:null,matches:e}),o.router=this,o.active=s?[s]:[];for(var c=mf.length;c--;)mf[c]({});typeof n=="function"&&n(o)}return F(Xb.Provider,{value:o},s)}});var Ot=function(i){return F(i.component,i)};const Zb=()=>{};var yf={};const Am=function(i){const t=[];let e=0;for(let s=0;s<i.length;s++){let n=i.charCodeAt(s);n<128?t[e++]=n:n<2048?(t[e++]=n>>6|192,t[e++]=n&63|128):(n&64512)===55296&&s+1<i.length&&(i.charCodeAt(s+1)&64512)===56320?(n=65536+((n&1023)<<10)+(i.charCodeAt(++s)&1023),t[e++]=n>>18|240,t[e++]=n>>12&63|128,t[e++]=n>>6&63|128,t[e++]=n&63|128):(t[e++]=n>>12|224,t[e++]=n>>6&63|128,t[e++]=n&63|128)}return t},tw=function(i){const t=[];let e=0,s=0;for(;e<i.length;){const n=i[e++];if(n<128)t[s++]=String.fromCharCode(n);else if(n>191&&n<224){const r=i[e++];t[s++]=String.fromCharCode((n&31)<<6|r&63)}else if(n>239&&n<365){const r=i[e++],o=i[e++],a=i[e++],c=((n&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;t[s++]=String.fromCharCode(55296+(c>>10)),t[s++]=String.fromCharCode(56320+(c&1023))}else{const r=i[e++],o=i[e++];t[s++]=String.fromCharCode((n&15)<<12|(r&63)<<6|o&63)}}return t.join("")},Em={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,t){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let n=0;n<i.length;n+=3){const r=i[n],o=n+1<i.length,a=o?i[n+1]:0,c=n+2<i.length,l=c?i[n+2]:0,h=r>>2,u=(r&3)<<4|a>>4;let p=(a&15)<<2|l>>6,g=l&63;c||(g=64,o||(p=64)),s.push(e[h],e[u],e[p],e[g])}return s.join("")},encodeString(i,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(i):this.encodeByteArray(Am(i),t)},decodeString(i,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(i):tw(this.decodeStringToByteArray(i,t))},decodeStringToByteArray(i,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let n=0;n<i.length;){const r=e[i.charAt(n++)],a=n<i.length?e[i.charAt(n)]:0;++n;const l=n<i.length?e[i.charAt(n)]:64;++n;const u=n<i.length?e[i.charAt(n)]:64;if(++n,r==null||a==null||l==null||u==null)throw new ew;const p=r<<2|a>>4;if(s.push(p),l!==64){const g=a<<4&240|l>>2;if(s.push(g),u!==64){const y=l<<6&192|u;s.push(y)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class ew extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const sw=function(i){const t=Am(i);return Em.encodeByteArray(t,!0)},Ma=function(i){return sw(i).replace(/\./g,"")},Tm=function(i){try{return Em.decodeString(i,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function iw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const nw=()=>iw().__FIREBASE_DEFAULTS__,rw=()=>{if(typeof process>"u"||typeof yf>"u")return;const i=yf.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},ow=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=i&&Tm(i[1]);return t&&JSON.parse(t)},nc=()=>{try{return Zb()||nw()||rw()||ow()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},Sm=i=>nc()?.emulatorHosts?.[i],Jh=i=>{const t=Sm(i);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),s]:[t.substring(0,e),s]},Im=()=>nc()?.config,Cm=i=>nc()?.[`_${i}`];class aw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,s)=>{e?this.reject(e):this.resolve(s),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,s))}}}function Ti(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function rc(i){return(await fetch(i,{credentials:"include"})).ok}function Pm(i,t){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},s=t||"demo-project",n=i.iat||0,r=i.sub||i.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...i};return[Ma(JSON.stringify(e)),Ma(JSON.stringify(o)),""].join(".")}const Lr={};function cw(){const i={prod:[],emulator:[]};for(const t of Object.keys(Lr))Lr[t]?i.emulator.push(t):i.prod.push(t);return i}function lw(i){let t=document.getElementById(i),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",i),e=!0),{created:e,element:t}}let vf=!1;function oc(i,t){if(typeof window>"u"||typeof document>"u"||!Ti(window.location.host)||Lr[i]===t||Lr[i]||vf)return;Lr[i]=t;function e(p){return`__firebase__banner__${p}`}const s="__firebase__banner",r=cw().prod.length>0;function o(){const p=document.getElementById(s);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function c(p,g){p.setAttribute("width","24"),p.setAttribute("id",g),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function l(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{vf=!0,o()},p}function h(p,g){p.setAttribute("id",g),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function u(){const p=lw(s),g=e("text"),y=document.getElementById(g)||document.createElement("span"),m=e("learnmore"),v=document.getElementById(m)||document.createElement("a"),w=e("preprendIcon"),E=document.getElementById(w)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const A=p.element;a(A),h(v,m);const P=l();c(E,w),A.append(E,y,v,P),document.body.appendChild(A)}r?(y.innerText="Preview backend disconnected.",E.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(E.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,y.innerText="Preview backend running in this workspace."),y.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",u):u()}function Ae(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function hw(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ae())}function uw(){const i=nc()?.forceEnvironment;if(i==="node")return!0;if(i==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function dw(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function fw(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function pw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function gw(){const i=Ae();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function mw(){return!uw()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _w(){try{return typeof indexedDB=="object"}catch{return!1}}function yw(){return new Promise((i,t)=>{try{let e=!0;const s="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(s);n.onsuccess=()=>{n.result.close(),e||self.indexedDB.deleteDatabase(s),i(!0)},n.onupgradeneeded=()=>{e=!1},n.onerror=()=>{t(n.error?.message||"")}}catch(e){t(e)}})}const vw="FirebaseError";class Rs extends Error{constructor(t,e,s){super(e),this.code=t,this.customData=s,this.name=vw,Object.setPrototypeOf(this,Rs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,fo.prototype.create)}}class fo{constructor(t,e,s){this.service=t,this.serviceName=e,this.errors=s}create(t,...e){const s=e[0]||{},n=`${this.service}/${t}`,r=this.errors[t],o=r?bw(r,s):"Error",a=`${this.serviceName}: ${o} (${n}).`;return new Rs(n,a,s)}}function bw(i,t){return i.replace(ww,(e,s)=>{const n=t[s];return n!=null?String(n):`<${s}?>`})}const ww=/\{\$([^}]+)}/g;function Aw(i){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t))return!1;return!0}function Wi(i,t){if(i===t)return!0;const e=Object.keys(i),s=Object.keys(t);for(const n of e){if(!s.includes(n))return!1;const r=i[n],o=t[n];if(bf(r)&&bf(o)){if(!Wi(r,o))return!1}else if(r!==o)return!1}for(const n of s)if(!e.includes(n))return!1;return!0}function bf(i){return i!==null&&typeof i=="object"}function po(i){const t=[];for(const[e,s]of Object.entries(i))Array.isArray(s)?s.forEach(n=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function Tr(i){const t={};return i.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[n,r]=s.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function Sr(i){const t=i.indexOf("?");if(!t)return"";const e=i.indexOf("#",t);return i.substring(t,e>0?e:void 0)}function Ew(i,t){const e=new Tw(i,t);return e.subscribe.bind(e)}class Tw{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(s=>{this.error(s)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,s){let n;if(t===void 0&&e===void 0&&s===void 0)throw new Error("Missing Observer.");Sw(t,["next","error","complete"])?n=t:n={next:t,error:e,complete:s},n.next===void 0&&(n.next=hl),n.error===void 0&&(n.error=hl),n.complete===void 0&&(n.complete=hl);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch{}}),this.observers.push(n),r}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Sw(i,t){if(typeof i!="object"||i===null)return!1;for(const e of t)if(e in i&&typeof i[e]=="function")return!0;return!1}function hl(){}function Kt(i){return i&&i._delegate?i._delegate:i}class zs{constructor(t,e,s){this.name=t,this.instanceFactory=e,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Li="[DEFAULT]";class Iw{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const s=new aw;if(this.instancesDeferred.set(e,s),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&s.resolve(n)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),s=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(n){if(s)return null;throw n}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Pw(t))try{this.getOrInitializeService({instanceIdentifier:Li})}catch{}for(const[e,s]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const r=this.getOrInitializeService({instanceIdentifier:n});s.resolve(r)}catch{}}}}clearInstance(t=Li){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Li){return this.instances.has(t)}getOptions(t=Li){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:s,options:e});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(n)}return n}onInit(t,e){const s=this.normalizeInstanceIdentifier(e),n=this.onInitCallbacks.get(s)??new Set;n.add(t),this.onInitCallbacks.set(s,n);const r=this.instances.get(s);return r&&t(r,s),()=>{n.delete(t)}}invokeOnInitCallbacks(t,e){const s=this.onInitCallbacks.get(e);if(s)for(const n of s)try{n(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Cw(t),options:e}),this.instances.set(t,s),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch{}return s||null}normalizeInstanceIdentifier(t=Li){return this.component?this.component.multipleInstances?t:Li:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Cw(i){return i===Li?void 0:i}function Pw(i){return i.instantiationMode==="EAGER"}class Rw{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Iw(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var pt;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(pt||(pt={}));const xw={debug:pt.DEBUG,verbose:pt.VERBOSE,info:pt.INFO,warn:pt.WARN,error:pt.ERROR,silent:pt.SILENT},kw=pt.INFO,Dw={[pt.DEBUG]:"log",[pt.VERBOSE]:"log",[pt.INFO]:"info",[pt.WARN]:"warn",[pt.ERROR]:"error"},Mw=(i,t,...e)=>{if(t<i.logLevel)return;const s=new Date().toISOString(),n=Dw[t];if(n)console[n](`[${s}]  ${i.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Zh{constructor(t){this.name=t,this._logLevel=kw,this._logHandler=Mw,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in pt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?xw[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,pt.DEBUG,...t),this._logHandler(this,pt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,pt.VERBOSE,...t),this._logHandler(this,pt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,pt.INFO,...t),this._logHandler(this,pt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,pt.WARN,...t),this._logHandler(this,pt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,pt.ERROR,...t),this._logHandler(this,pt.ERROR,...t)}}const Nw=(i,t)=>t.some(e=>i instanceof e);let wf,Af;function Lw(){return wf||(wf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ow(){return Af||(Af=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Rm=new WeakMap,Yl=new WeakMap,xm=new WeakMap,ul=new WeakMap,tu=new WeakMap;function Fw(i){const t=new Promise((e,s)=>{const n=()=>{i.removeEventListener("success",r),i.removeEventListener("error",o)},r=()=>{e(li(i.result)),n()},o=()=>{s(i.error),n()};i.addEventListener("success",r),i.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&Rm.set(e,i)}).catch(()=>{}),tu.set(t,i),t}function Vw(i){if(Yl.has(i))return;const t=new Promise((e,s)=>{const n=()=>{i.removeEventListener("complete",r),i.removeEventListener("error",o),i.removeEventListener("abort",o)},r=()=>{e(),n()},o=()=>{s(i.error||new DOMException("AbortError","AbortError")),n()};i.addEventListener("complete",r),i.addEventListener("error",o),i.addEventListener("abort",o)});Yl.set(i,t)}let Ql={get(i,t,e){if(i instanceof IDBTransaction){if(t==="done")return Yl.get(i);if(t==="objectStoreNames")return i.objectStoreNames||xm.get(i);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return li(i[t])},set(i,t,e){return i[t]=e,!0},has(i,t){return i instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in i}};function Bw(i){Ql=i(Ql)}function Uw(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const s=i.call(dl(this),t,...e);return xm.set(s,t.sort?t.sort():[t]),li(s)}:Ow().includes(i)?function(...t){return i.apply(dl(this),t),li(Rm.get(this))}:function(...t){return li(i.apply(dl(this),t))}}function $w(i){return typeof i=="function"?Uw(i):(i instanceof IDBTransaction&&Vw(i),Nw(i,Lw())?new Proxy(i,Ql):i)}function li(i){if(i instanceof IDBRequest)return Fw(i);if(ul.has(i))return ul.get(i);const t=$w(i);return t!==i&&(ul.set(i,t),tu.set(t,i)),t}const dl=i=>tu.get(i);function zw(i,t,{blocked:e,upgrade:s,blocking:n,terminated:r}={}){const o=indexedDB.open(i,t),a=li(o);return s&&o.addEventListener("upgradeneeded",c=>{s(li(o.result),c.oldVersion,c.newVersion,li(o.transaction),c)}),e&&o.addEventListener("blocked",c=>e(c.oldVersion,c.newVersion,c)),a.then(c=>{r&&c.addEventListener("close",()=>r()),n&&c.addEventListener("versionchange",l=>n(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const jw=["get","getKey","getAll","getAllKeys","count"],Hw=["put","add","delete","clear"],fl=new Map;function Ef(i,t){if(!(i instanceof IDBDatabase&&!(t in i)&&typeof t=="string"))return;if(fl.get(t))return fl.get(t);const e=t.replace(/FromIndex$/,""),s=t!==e,n=Hw.includes(e);if(!(e in(s?IDBIndex:IDBObjectStore).prototype)||!(n||jw.includes(e)))return;const r=async function(o,...a){const c=this.transaction(o,n?"readwrite":"readonly");let l=c.store;return s&&(l=l.index(a.shift())),(await Promise.all([l[e](...a),n&&c.done]))[0]};return fl.set(t,r),r}Bw(i=>({...i,get:(t,e,s)=>Ef(t,e)||i.get(t,e,s),has:(t,e)=>!!Ef(t,e)||i.has(t,e)}));class qw{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Gw(e)){const s=e.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(e=>e).join(" ")}}function Gw(i){return i.getComponent()?.type==="VERSION"}const Jl="@firebase/app",Tf="0.14.6";const js=new Zh("@firebase/app"),Ww="@firebase/app-compat",Kw="@firebase/analytics-compat",Xw="@firebase/analytics",Yw="@firebase/app-check-compat",Qw="@firebase/app-check",Jw="@firebase/auth",Zw="@firebase/auth-compat",tA="@firebase/database",eA="@firebase/data-connect",sA="@firebase/database-compat",iA="@firebase/functions",nA="@firebase/functions-compat",rA="@firebase/installations",oA="@firebase/installations-compat",aA="@firebase/messaging",cA="@firebase/messaging-compat",lA="@firebase/performance",hA="@firebase/performance-compat",uA="@firebase/remote-config",dA="@firebase/remote-config-compat",fA="@firebase/storage",pA="@firebase/storage-compat",gA="@firebase/firestore",mA="@firebase/ai",_A="@firebase/firestore-compat",yA="firebase",vA="12.6.0";const Zl="[DEFAULT]",bA={[Jl]:"fire-core",[Ww]:"fire-core-compat",[Xw]:"fire-analytics",[Kw]:"fire-analytics-compat",[Qw]:"fire-app-check",[Yw]:"fire-app-check-compat",[Jw]:"fire-auth",[Zw]:"fire-auth-compat",[tA]:"fire-rtdb",[eA]:"fire-data-connect",[sA]:"fire-rtdb-compat",[iA]:"fire-fn",[nA]:"fire-fn-compat",[rA]:"fire-iid",[oA]:"fire-iid-compat",[aA]:"fire-fcm",[cA]:"fire-fcm-compat",[lA]:"fire-perf",[hA]:"fire-perf-compat",[uA]:"fire-rc",[dA]:"fire-rc-compat",[fA]:"fire-gcs",[pA]:"fire-gcs-compat",[gA]:"fire-fst",[_A]:"fire-fst-compat",[mA]:"fire-vertex","fire-js":"fire-js",[yA]:"fire-js-all"};const Na=new Map,wA=new Map,th=new Map;function Sf(i,t){try{i.container.addComponent(t)}catch(e){js.debug(`Component ${t.name} failed to register with FirebaseApp ${i.name}`,e)}}function pi(i){const t=i.name;if(th.has(t))return js.debug(`There were multiple attempts to register component ${t}.`),!1;th.set(t,i);for(const e of Na.values())Sf(e,i);for(const e of wA.values())Sf(e,i);return!0}function go(i,t){const e=i.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),i.container.getProvider(t)}function xe(i){return i==null?!1:i.settings!==void 0}const AA={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hi=new fo("app","Firebase",AA);class EA{constructor(t,e,s){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new zs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw hi.create("app-deleted",{appName:this._name})}}const sn=vA;function km(i,t={}){let e=i;typeof t!="object"&&(t={name:t});const s={name:Zl,automaticDataCollectionEnabled:!0,...t},n=s.name;if(typeof n!="string"||!n)throw hi.create("bad-app-name",{appName:String(n)});if(e||(e=Im()),!e)throw hi.create("no-options");const r=Na.get(n);if(r){if(Wi(e,r.options)&&Wi(s,r.config))return r;throw hi.create("duplicate-app",{appName:n})}const o=new Rw(n);for(const c of th.values())o.addComponent(c);const a=new EA(e,s,o);return Na.set(n,a),a}function ac(i=Zl){const t=Na.get(i);if(!t&&i===Zl&&Im())return km();if(!t)throw hi.create("no-app",{appName:i});return t}function Ye(i,t,e){let s=bA[i]??i;e&&(s+=`-${e}`);const n=s.match(/\s|\//),r=t.match(/\s|\//);if(n||r){const o=[`Unable to register library "${s}" with version "${t}":`];n&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),n&&r&&o.push("and"),r&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),js.warn(o.join(" "));return}pi(new zs(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const TA="firebase-heartbeat-database",SA=1,Hr="firebase-heartbeat-store";let pl=null;function Dm(){return pl||(pl=zw(TA,SA,{upgrade:(i,t)=>{switch(t){case 0:try{i.createObjectStore(Hr)}catch(e){console.warn(e)}}}}).catch(i=>{throw hi.create("idb-open",{originalErrorMessage:i.message})})),pl}async function IA(i){try{const e=(await Dm()).transaction(Hr),s=await e.objectStore(Hr).get(Mm(i));return await e.done,s}catch(t){if(t instanceof Rs)js.warn(t.message);else{const e=hi.create("idb-get",{originalErrorMessage:t?.message});js.warn(e.message)}}}async function If(i,t){try{const s=(await Dm()).transaction(Hr,"readwrite");await s.objectStore(Hr).put(t,Mm(i)),await s.done}catch(e){if(e instanceof Rs)js.warn(e.message);else{const s=hi.create("idb-set",{originalErrorMessage:e?.message});js.warn(s.message)}}}function Mm(i){return`${i.name}!${i.options.appId}`}const CA=1024,PA=30;class RA{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new kA(e),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Cf();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(n=>n.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:e}),this._heartbeatsCache.heartbeats.length>PA){const n=DA(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(n,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){js.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Cf(),{heartbeatsToSend:e,unsentEntries:s}=xA(this._heartbeatsCache.heartbeats),n=Ma(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(t){return js.warn(t),""}}}function Cf(){return new Date().toISOString().substring(0,10)}function xA(i,t=CA){const e=[];let s=i.slice();for(const n of i){const r=e.find(o=>o.agent===n.agent);if(r){if(r.dates.push(n.date),Pf(e)>t){r.dates.pop();break}}else if(e.push({agent:n.agent,dates:[n.date]}),Pf(e)>t){e.pop();break}s=s.slice(1)}return{heartbeatsToSend:e,unsentEntries:s}}class kA{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _w()?yw().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await IA(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const s=await this.read();return If(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const s=await this.read();return If(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function Pf(i){return Ma(JSON.stringify({version:2,heartbeats:i})).length}function DA(i){if(i.length===0)return-1;let t=0,e=i[0].date;for(let s=1;s<i.length;s++)i[s].date<e&&(e=i[s].date,t=s);return t}function MA(i){pi(new zs("platform-logger",t=>new qw(t),"PRIVATE")),pi(new zs("heartbeat",t=>new RA(t),"PRIVATE")),Ye(Jl,Tf,i),Ye(Jl,Tf,"esm2020"),Ye("fire-js","")}MA("");var NA="firebase",LA="12.7.0";Ye(NA,LA,"app");function Nm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const OA=Nm,Lm=new fo("auth","Firebase",Nm());const La=new Zh("@firebase/auth");function FA(i,...t){La.logLevel<=pt.WARN&&La.warn(`Auth (${sn}): ${i}`,...t)}function ga(i,...t){La.logLevel<=pt.ERROR&&La.error(`Auth (${sn}): ${i}`,...t)}function Je(i,...t){throw su(i,...t)}function as(i,...t){return su(i,...t)}function eu(i,t,e){const s={...OA(),[t]:e};return new fo("auth","Firebase",s).create(t,{appName:i.name})}function Us(i){return eu(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function VA(i,t,e){const s=e;if(!(t instanceof s))throw s.name!==t.constructor.name&&Je(i,"argument-error"),eu(i,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function su(i,...t){if(typeof i!="string"){const e=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=i.name),i._errorFactory.create(e,...s)}return Lm.create(i,...t)}function tt(i,t,...e){if(!i)throw su(t,...e)}function Fs(i){const t="INTERNAL ASSERTION FAILED: "+i;throw ga(t),new Error(t)}function Hs(i,t){i||Fs(t)}function eh(){return typeof self<"u"&&self.location?.href||""}function BA(){return Rf()==="http:"||Rf()==="https:"}function Rf(){return typeof self<"u"&&self.location?.protocol||null}function UA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(BA()||fw()||"connection"in navigator)?navigator.onLine:!0}function $A(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}class mo{constructor(t,e){this.shortDelay=t,this.longDelay=e,Hs(e>t,"Short delay should be less than long delay!"),this.isMobile=hw()||pw()}get(){return UA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function iu(i,t){Hs(i.emulator,"Emulator should always be set here");const{url:e}=i.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}class Om{static initialize(t,e,s){this.fetchImpl=t,e&&(this.headersImpl=e),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Fs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Fs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Fs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const zA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const jA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],HA=new mo(3e4,6e4);function Si(i,t){return i.tenantId&&!t.tenantId?{...t,tenantId:i.tenantId}:t}async function Ii(i,t,e,s,n={}){return Fm(i,n,async()=>{let r={},o={};s&&(t==="GET"?o=s:r={body:JSON.stringify(s)});const a=po({key:i.config.apiKey,...o}).slice(1),c=await i._getAdditionalHeaders();c["Content-Type"]="application/json",i.languageCode&&(c["X-Firebase-Locale"]=i.languageCode);const l={method:t,headers:c,...r};return dw()||(l.referrerPolicy="no-referrer"),i.emulatorConfig&&Ti(i.emulatorConfig.host)&&(l.credentials="include"),Om.fetch()(await Vm(i,i.config.apiHost,e,a),l)})}async function Fm(i,t,e){i._canInitEmulator=!1;const s={...zA,...t};try{const n=new GA(i),r=await Promise.race([e(),n.promise]);n.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw Xo(i,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xo(i,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Xo(i,"email-already-in-use",o);if(c==="USER_DISABLED")throw Xo(i,"user-disabled",o);const h=s[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw eu(i,h,l);Je(i,h)}}catch(n){if(n instanceof Rs)throw n;Je(i,"network-request-failed",{message:String(n)})}}async function _o(i,t,e,s,n={}){const r=await Ii(i,t,e,s,n);return"mfaPendingCredential"in r&&Je(i,"multi-factor-auth-required",{_serverResponse:r}),r}async function Vm(i,t,e,s){const n=`${t}${e}?${s}`,r=i,o=r.config.emulator?iu(i.config,n):`${i.config.apiScheme}://${n}`;return jA.includes(e)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(o).toString():o}function qA(i){switch(i){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class GA{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,s)=>{this.timer=setTimeout(()=>s(as(this.auth,"network-request-failed")),HA.get())})}}function Xo(i,t,e){const s={appName:i.name};e.email&&(s.email=e.email),e.phoneNumber&&(s.phoneNumber=e.phoneNumber);const n=as(i,t,s);return n.customData._tokenResponse=e,n}function xf(i){return i!==void 0&&i.enterprise!==void 0}class WA{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return qA(e.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function KA(i,t){return Ii(i,"GET","/v2/recaptchaConfig",Si(i,t))}async function XA(i,t){return Ii(i,"POST","/v1/accounts:delete",t)}async function Oa(i,t){return Ii(i,"POST","/v1/accounts:lookup",t)}function Or(i){if(i)try{const t=new Date(Number(i));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function YA(i,t=!1){const e=Kt(i),s=await e.getIdToken(t),n=nu(s);tt(n&&n.exp&&n.auth_time&&n.iat,e.auth,"internal-error");const r=typeof n.firebase=="object"?n.firebase:void 0,o=r?.sign_in_provider;return{claims:n,token:s,authTime:Or(gl(n.auth_time)),issuedAtTime:Or(gl(n.iat)),expirationTime:Or(gl(n.exp)),signInProvider:o||null,signInSecondFactor:r?.sign_in_second_factor||null}}function gl(i){return Number(i)*1e3}function nu(i){const[t,e,s]=i.split(".");if(t===void 0||e===void 0||s===void 0)return ga("JWT malformed, contained fewer than 3 sections"),null;try{const n=Tm(e);return n?JSON.parse(n):(ga("Failed to decode base64 JWT payload"),null)}catch(n){return ga("Caught error parsing JWT payload as JSON",n?.toString()),null}}function kf(i){const t=nu(i);return tt(t,"internal-error"),tt(typeof t.exp<"u","internal-error"),tt(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}async function qr(i,t,e=!1){if(e)return t;try{return await t}catch(s){throw s instanceof Rs&&QA(s)&&i.auth.currentUser===i&&await i.auth.signOut(),s}}function QA({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}class JA{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const e=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),e}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class sh{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Or(this.lastLoginAt),this.creationTime=Or(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Fa(i){const t=i.auth,e=await i.getIdToken(),s=await qr(i,Oa(t,{idToken:e}));tt(s?.users.length,t,"internal-error");const n=s.users[0];i._notifyReloadListener(n);const r=n.providerUserInfo?.length?Bm(n.providerUserInfo):[],o=t0(i.providerData,r),a=i.isAnonymous,c=!(i.email&&n.passwordHash)&&!o?.length,l=a?c:!1,h={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:o,metadata:new sh(n.createdAt,n.lastLoginAt),isAnonymous:l};Object.assign(i,h)}async function ZA(i){const t=Kt(i);await Fa(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function t0(i,t){return[...i.filter(s=>!t.some(n=>n.providerId===s.providerId)),...t]}function Bm(i){return i.map(({providerId:t,...e})=>({providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}))}async function e0(i,t){const e=await Fm(i,{},async()=>{const s=po({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:r}=i.config,o=await Vm(i,n,"/v1/token",`key=${r}`),a=await i._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:s};return i.emulatorConfig&&Ti(i.emulatorConfig.host)&&(c.credentials="include"),Om.fetch()(o,c)});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function s0(i,t){return Ii(i,"POST","/v2/accounts:revokeToken",Si(i,t))}class Cn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){tt(t.idToken,"internal-error"),tt(typeof t.idToken<"u","internal-error"),tt(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):kf(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){tt(t.length!==0,"internal-error");const e=kf(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(tt(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:s,refreshToken:n,expiresIn:r}=await e0(t,e);this.updateTokensAndExpiration(s,n,Number(r))}updateTokensAndExpiration(t,e,s){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(t,e){const{refreshToken:s,accessToken:n,expirationTime:r}=e,o=new Cn;return s&&(tt(typeof s=="string","internal-error",{appName:t}),o.refreshToken=s),n&&(tt(typeof n=="string","internal-error",{appName:t}),o.accessToken=n),r&&(tt(typeof r=="number","internal-error",{appName:t}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Cn,this.toJSON())}_performRefresh(){return Fs("not implemented")}}function ti(i,t){tt(typeof i=="string"||typeof i>"u","internal-error",{appName:t})}class es{constructor({uid:t,auth:e,stsTokenManager:s,...n}){this.providerId="firebase",this.proactiveRefresh=new JA(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=e,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new sh(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(t){const e=await qr(this,this.stsTokenManager.getToken(this.auth,t));return tt(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return YA(this,t)}reload(){return ZA(this)}_assign(t){this!==t&&(tt(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>({...e})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new es({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return e.metadata._copy(this.metadata),e}_onReload(t){tt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let s=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),s=!0),e&&await Fa(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(xe(this.auth.app))return Promise.reject(Us(this.auth));const t=await this.getIdToken();return await qr(this,XA(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){const s=e.displayName??void 0,n=e.email??void 0,r=e.phoneNumber??void 0,o=e.photoURL??void 0,a=e.tenantId??void 0,c=e._redirectEventId??void 0,l=e.createdAt??void 0,h=e.lastLoginAt??void 0,{uid:u,emailVerified:p,isAnonymous:g,providerData:y,stsTokenManager:m}=e;tt(u&&m,t,"internal-error");const v=Cn.fromJSON(this.name,m);tt(typeof u=="string",t,"internal-error"),ti(s,t.name),ti(n,t.name),tt(typeof p=="boolean",t,"internal-error"),tt(typeof g=="boolean",t,"internal-error"),ti(r,t.name),ti(o,t.name),ti(a,t.name),ti(c,t.name),ti(l,t.name),ti(h,t.name);const w=new es({uid:u,auth:t,email:n,emailVerified:p,displayName:s,isAnonymous:g,photoURL:o,phoneNumber:r,tenantId:a,stsTokenManager:v,createdAt:l,lastLoginAt:h});return y&&Array.isArray(y)&&(w.providerData=y.map(E=>({...E}))),c&&(w._redirectEventId=c),w}static async _fromIdTokenResponse(t,e,s=!1){const n=new Cn;n.updateFromServerResponse(e);const r=new es({uid:e.localId,auth:t,stsTokenManager:n,isAnonymous:s});return await Fa(r),r}static async _fromGetAccountInfoResponse(t,e,s){const n=e.users[0];tt(n.localId!==void 0,"internal-error");const r=n.providerUserInfo!==void 0?Bm(n.providerUserInfo):[],o=!(n.email&&n.passwordHash)&&!r?.length,a=new Cn;a.updateFromIdToken(s);const c=new es({uid:n.localId,auth:t,stsTokenManager:a,isAnonymous:o}),l={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:r,metadata:new sh(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!r?.length};return Object.assign(c,l),c}}const Df=new Map;function Vs(i){Hs(i instanceof Function,"Expected a class definition");let t=Df.get(i);return t?(Hs(t instanceof i,"Instance stored in cache mismatched with class"),t):(t=new i,Df.set(i,t),t)}class Um{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}Um.type="NONE";const Mf=Um;function ma(i,t,e){return`firebase:${i}:${t}:${e}`}class Pn{constructor(t,e,s){this.persistence=t,this.auth=e,this.userKey=s;const{config:n,name:r}=this.auth;this.fullUserKey=ma(this.userKey,n.apiKey,r),this.fullPersistenceKey=ma("persistence",n.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const e=await Oa(this.auth,{idToken:t}).catch(()=>{});return e?es._fromGetAccountInfoResponse(this.auth,e,t):null}return es._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,s="authUser"){if(!e.length)return new Pn(Vs(Mf),t,s);const n=(await Promise.all(e.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let r=n[0]||Vs(Mf);const o=ma(s,t.config.apiKey,t.name);let a=null;for(const l of e)try{const h=await l._get(o);if(h){let u;if(typeof h=="string"){const p=await Oa(t,{idToken:h}).catch(()=>{});if(!p)break;u=await es._fromGetAccountInfoResponse(t,p,h)}else u=es._fromJSON(t,h);l!==r&&(a=u),r=l;break}}catch{}const c=n.filter(l=>l._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new Pn(r,t,s):(r=c[0],a&&await r._set(o,a.toJSON()),await Promise.all(e.map(async l=>{if(l!==r)try{await l._remove(o)}catch{}})),new Pn(r,t,s))}}function Nf(i){const t=i.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Hm(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if($m(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Gm(t))return"Blackberry";if(Wm(t))return"Webos";if(zm(t))return"Safari";if((t.includes("chrome/")||jm(t))&&!t.includes("edge/"))return"Chrome";if(qm(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=i.match(e);if(s?.length===2)return s[1]}return"Other"}function $m(i=Ae()){return/firefox\//i.test(i)}function zm(i=Ae()){const t=i.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function jm(i=Ae()){return/crios\//i.test(i)}function Hm(i=Ae()){return/iemobile/i.test(i)}function qm(i=Ae()){return/android/i.test(i)}function Gm(i=Ae()){return/blackberry/i.test(i)}function Wm(i=Ae()){return/webos/i.test(i)}function ru(i=Ae()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function i0(i=Ae()){return ru(i)&&!!window.navigator?.standalone}function n0(){return gw()&&document.documentMode===10}function Km(i=Ae()){return ru(i)||qm(i)||Wm(i)||Gm(i)||/windows phone/i.test(i)||Hm(i)}function Xm(i,t=[]){let e;switch(i){case"Browser":e=Nf(Ae());break;case"Worker":e=`${Nf(Ae())}-${i}`;break;default:e=i}const s=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${sn}/${s}`}class r0{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const s=r=>new Promise((o,a)=>{try{const c=t(r);o(c)}catch(c){a(c)}});s.onAbort=e,this.queue.push(s);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const s of this.queue)await s(t),s.onAbort&&e.push(s.onAbort)}catch(s){e.reverse();for(const n of e)try{n()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function o0(i,t={}){return Ii(i,"GET","/v2/passwordPolicy",Si(i,t))}const a0=6;class c0{constructor(t){const e=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=e.minPasswordLength??a0,e.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=e.maxPasswordLength),e.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=e.containsLowercaseCharacter),e.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=e.containsUppercaseCharacter),e.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=e.containsNumericCharacter),e.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=e.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const e={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,e),this.validatePasswordCharacterOptions(t,e),e.isValid&&(e.isValid=e.meetsMinPasswordLength??!0),e.isValid&&(e.isValid=e.meetsMaxPasswordLength??!0),e.isValid&&(e.isValid=e.containsLowercaseLetter??!0),e.isValid&&(e.isValid=e.containsUppercaseLetter??!0),e.isValid&&(e.isValid=e.containsNumericCharacter??!0),e.isValid&&(e.isValid=e.containsNonAlphanumericCharacter??!0),e}validatePasswordLengthOptions(t,e){const s=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;s&&(e.meetsMinPasswordLength=t.length>=s),n&&(e.meetsMaxPasswordLength=t.length<=n)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let s;for(let n=0;n<t.length;n++)s=t.charAt(n),this.updatePasswordCharacterOptionsStatuses(e,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(t,e,s,n,r){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=r))}}class l0{constructor(t,e,s,n){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=s,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Lf(this),this.idTokenSubscription=new Lf(this),this.beforeStateQueue=new r0(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Lm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=Vs(e)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Pn.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await Oa(this,{idToken:t}),s=await es._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(s)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){if(xe(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(o,o))}):this.directlySetCurrentUser(null)}const e=await this.assertedPersistence.getCurrentUser();let s=e,n=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=this.redirectUser?._redirectEventId,o=s?._redirectEventId,a=await this.tryRedirectSignIn(t);(!r||r===o)&&a?.user&&(s=a.user,n=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(s)}catch(r){s=e,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return tt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await Fa(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=$A()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(xe(this.app))return Promise.reject(Us(this));const e=t?Kt(t):null;return e&&tt(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&tt(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return xe(this.app)?Promise.reject(Us(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return xe(this.app)?Promise.reject(Us(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Vs(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await o0(this),e=new c0(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new fo("auth","Firebase",t())}onAuthStateChanged(t,e,s){return this.registerStateListener(this.authStateSubscription,t,e,s)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,s){return this.registerStateListener(this.idTokenSubscription,t,e,s)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const s=this.onAuthStateChanged(()=>{s(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(s.tenantId=this.tenantId),await s0(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(t,e){const s=await this.getOrInitRedirectPersistenceManager(e);return t===null?s.removeCurrentUser():s.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&Vs(t)||this._popupRedirectResolver;tt(e,this,"argument-error"),this.redirectPersistenceManager=await Pn.create(this,[Vs(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,s,n){if(this._deleted)return()=>{};const r=typeof e=="function"?e:e.next.bind(e);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(tt(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof e=="function"){const c=t.addObserver(e,s,n);return()=>{o=!0,c()}}else{const c=t.addObserver(e);return()=>{o=!0,c()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return tt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Xm(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const e=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();e&&(t["X-Firebase-Client"]=e);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){if(xe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return t?.error&&FA(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Ci(i){return Kt(i)}class Lf{constructor(t){this.auth=t,this.observer=null,this.addObserver=Ew(e=>this.observer=e)}get next(){return tt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let cc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function h0(i){cc=i}function Ym(i){return cc.loadJS(i)}function u0(){return cc.recaptchaEnterpriseScript}function d0(){return cc.gapiScript}function f0(i){return`__${i}${Math.floor(Math.random()*1e6)}`}class p0{constructor(){this.enterprise=new g0}ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}class g0{ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}const m0="recaptcha-enterprise",Qm="NO_RECAPTCHA";class _0{constructor(t){this.type=m0,this.auth=Ci(t)}async verify(t="verify",e=!1){async function s(r){if(!e){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,a)=>{KA(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const l=new WA(c);return r.tenantId==null?r._agentRecaptchaConfig=l:r._tenantRecaptchaConfigs[r.tenantId]=l,o(l.siteKey)}}).catch(c=>{a(c)})})}function n(r,o,a){const c=window.grecaptcha;xf(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:t}).then(l=>{o(l)}).catch(()=>{o(Qm)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new p0().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(a=>{if(!e&&xf(window.grecaptcha))n(a,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=u0();c.length!==0&&(c+=a),Ym(c).then(()=>{n(a,r,o)}).catch(l=>{o(l)})}}).catch(a=>{o(a)})})}}async function Of(i,t,e,s=!1,n=!1){const r=new _0(i);let o;if(n)o=Qm;else try{o=await r.verify(e)}catch{o=await r.verify(e,!0)}const a={...t};if(e==="mfaSmsEnrollment"||e==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const c=a.phoneEnrollmentInfo.phoneNumber,l=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function ih(i,t,e,s,n){if(i._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await Of(i,t,e,e==="getOobCode");return s(i,r)}else return s(i,t).catch(async r=>{if(r.code==="auth/missing-recaptcha-token"){console.log(`${e} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Of(i,t,e,e==="getOobCode");return s(i,o)}else return Promise.reject(r)})}function y0(i,t){const e=go(i,"auth");if(e.isInitialized()){const n=e.getImmediate(),r=e.getOptions();if(Wi(r,t??{}))return n;Je(n,"already-initialized")}return e.initialize({options:t})}function v0(i,t){const e=t?.persistence||[],s=(Array.isArray(e)?e:[e]).map(Vs);t?.errorMap&&i._updateErrorMap(t.errorMap),i._initializeWithPersistence(s,t?.popupRedirectResolver)}function b0(i,t,e){const s=Ci(i);tt(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const n=!1,r=Jm(t),{host:o,port:a}=w0(t),c=a===null?"":`:${a}`,l={url:`${r}//${o}${c}/`},h=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:n})});if(!s._canInitEmulator){tt(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),tt(Wi(l,s.config.emulator)&&Wi(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=l,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,Ti(o)?(rc(`${r}//${o}${c}`),oc("Auth",!0)):A0()}function Jm(i){const t=i.indexOf(":");return t<0?"":i.substr(0,t+1)}function w0(i){const t=Jm(i),e=/(\/\/)?([^?#/]+)/.exec(i.substr(t.length));if(!e)return{host:"",port:null};const s=e[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(s);if(n){const r=n[1];return{host:r,port:Ff(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:Ff(o)}}}function Ff(i){if(!i)return null;const t=Number(i);return isNaN(t)?null:t}function A0(){function i(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}class ou{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Fs("not implemented")}_getIdTokenResponse(t){return Fs("not implemented")}_linkToIdToken(t,e){return Fs("not implemented")}_getReauthenticationResolver(t){return Fs("not implemented")}}async function E0(i,t){return Ii(i,"POST","/v1/accounts:signUp",t)}async function T0(i,t){return _o(i,"POST","/v1/accounts:signInWithPassword",Si(i,t))}async function S0(i,t){return _o(i,"POST","/v1/accounts:signInWithEmailLink",Si(i,t))}async function I0(i,t){return _o(i,"POST","/v1/accounts:signInWithEmailLink",Si(i,t))}class Gr extends ou{constructor(t,e,s,n=null){super("password",s),this._email=t,this._password=e,this._tenantId=n}static _fromEmailAndPassword(t,e){return new Gr(t,e,"password")}static _fromEmailAndCode(t,e,s=null){return new Gr(t,e,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t;if(e?.email&&e?.password){if(e.signInMethod==="password")return this._fromEmailAndPassword(e.email,e.password);if(e.signInMethod==="emailLink")return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const e={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ih(t,e,"signInWithPassword",T0);case"emailLink":return S0(t,{email:this._email,oobCode:this._password});default:Je(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":const s={idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ih(t,s,"signUpPassword",E0);case"emailLink":return I0(t,{idToken:e,email:this._email,oobCode:this._password});default:Je(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function Rn(i,t){return _o(i,"POST","/v1/accounts:signInWithIdp",Si(i,t))}const C0="http://localhost";class Ki extends ou{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Ki(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):Je("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t,{providerId:s,signInMethod:n,...r}=e;if(!s||!n)return null;const o=new Ki(s,n);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(t){const e=this.buildRequest();return Rn(t,e)}_linkToIdToken(t,e){const s=this.buildRequest();return s.idToken=e,Rn(t,s)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,Rn(t,e)}buildRequest(){const t={requestUri:C0,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=po(e)}return t}}function P0(i){switch(i){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function R0(i){const t=Tr(Sr(i)).link,e=t?Tr(Sr(t)).deep_link_id:null,s=Tr(Sr(i)).deep_link_id;return(s?Tr(Sr(s)).link:null)||s||e||t||i}class au{constructor(t){const e=Tr(Sr(t)),s=e.apiKey??null,n=e.oobCode??null,r=P0(e.mode??null);tt(s&&n&&r,"argument-error"),this.apiKey=s,this.operation=r,this.code=n,this.continueUrl=e.continueUrl??null,this.languageCode=e.lang??null,this.tenantId=e.tenantId??null}static parseLink(t){const e=R0(t);try{return new au(e)}catch{return null}}}class Kn{constructor(){this.providerId=Kn.PROVIDER_ID}static credential(t,e){return Gr._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const s=au.parseLink(e);return tt(s,"argument-error"),Gr._fromEmailAndCode(t,s.code,s.tenantId)}}Kn.PROVIDER_ID="password";Kn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Kn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class cu{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class yo extends cu{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class ei extends yo{constructor(){super("facebook.com")}static credential(t){return Ki._fromParams({providerId:ei.PROVIDER_ID,signInMethod:ei.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ei.credentialFromTaggedObject(t)}static credentialFromError(t){return ei.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ei.credential(t.oauthAccessToken)}catch{return null}}}ei.FACEBOOK_SIGN_IN_METHOD="facebook.com";ei.PROVIDER_ID="facebook.com";class Os extends yo{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Ki._fromParams({providerId:Os.PROVIDER_ID,signInMethod:Os.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Os.credentialFromTaggedObject(t)}static credentialFromError(t){return Os.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:s}=t;if(!e&&!s)return null;try{return Os.credential(e,s)}catch{return null}}}Os.GOOGLE_SIGN_IN_METHOD="google.com";Os.PROVIDER_ID="google.com";class si extends yo{constructor(){super("github.com")}static credential(t){return Ki._fromParams({providerId:si.PROVIDER_ID,signInMethod:si.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return si.credentialFromTaggedObject(t)}static credentialFromError(t){return si.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return si.credential(t.oauthAccessToken)}catch{return null}}}si.GITHUB_SIGN_IN_METHOD="github.com";si.PROVIDER_ID="github.com";class ii extends yo{constructor(){super("twitter.com")}static credential(t,e){return Ki._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return ii.credentialFromTaggedObject(t)}static credentialFromError(t){return ii.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:s}=t;if(!e||!s)return null;try{return ii.credential(e,s)}catch{return null}}}ii.TWITTER_SIGN_IN_METHOD="twitter.com";ii.PROVIDER_ID="twitter.com";async function x0(i,t){return _o(i,"POST","/v1/accounts:signUp",Si(i,t))}class Xi{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,s,n=!1){const r=await es._fromIdTokenResponse(t,s,n),o=Vf(s);return new Xi({user:r,providerId:o,_tokenResponse:s,operationType:e})}static async _forOperation(t,e,s){await t._updateTokensIfNecessary(s,!0);const n=Vf(s);return new Xi({user:t,providerId:n,_tokenResponse:s,operationType:e})}}function Vf(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}class Va extends Rs{constructor(t,e,s,n){super(e.code,e.message),this.operationType=s,this.user=n,Object.setPrototypeOf(this,Va.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:e.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(t,e,s,n){return new Va(t,e,s,n)}}function Zm(i,t,e,s){return(t==="reauthenticate"?e._getReauthenticationResolver(i):e._getIdTokenResponse(i)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Va._fromErrorAndOperation(i,r,t,s):r})}async function k0(i,t,e=!1){const s=await qr(i,t._linkToIdToken(i.auth,await i.getIdToken()),e);return Xi._forOperation(i,"link",s)}async function D0(i,t,e=!1){const{auth:s}=i;if(xe(s.app))return Promise.reject(Us(s));const n="reauthenticate";try{const r=await qr(i,Zm(s,n,t,i),e);tt(r.idToken,s,"internal-error");const o=nu(r.idToken);tt(o,s,"internal-error");const{sub:a}=o;return tt(i.uid===a,s,"user-mismatch"),Xi._forOperation(i,n,r)}catch(r){throw r?.code==="auth/user-not-found"&&Je(s,"user-mismatch"),r}}async function t_(i,t,e=!1){if(xe(i.app))return Promise.reject(Us(i));const s="signIn",n=await Zm(i,s,t),r=await Xi._fromIdTokenResponse(i,s,n);return e||await i._updateCurrentUser(r.user),r}async function M0(i,t){return t_(Ci(i),t)}async function e_(i){const t=Ci(i);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function N0(i,t,e){if(xe(i.app))return Promise.reject(Us(i));const s=Ci(i),o=await ih(s,{returnSecureToken:!0,email:t,password:e,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",x0).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&e_(i),c}),a=await Xi._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function L0(i,t,e){return xe(i.app)?Promise.reject(Us(i)):M0(Kt(i),Kn.credential(t,e)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&e_(i),s})}function O0(i,t,e,s){return Kt(i).onIdTokenChanged(t,e,s)}function F0(i,t,e){return Kt(i).beforeAuthStateChanged(t,e)}function V0(i,t,e,s){return Kt(i).onAuthStateChanged(t,e,s)}function B0(i){return Kt(i).signOut()}const Ba="__sak";class s_{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Ba,"1"),this.storage.removeItem(Ba),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}const U0=1e3,$0=10;class i_ extends s_{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Km(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const s=this.storage.getItem(e),n=this.localCache[e];s!==n&&t(e,n,s)}}onStorageEvent(t,e=!1){if(!t.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const s=t.key;e?this.detachListener():this.stopPolling();const n=()=>{const o=this.storage.getItem(s);!e&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);n0()&&r!==t.newValue&&t.newValue!==t.oldValue?setTimeout(n,$0):n()}notifyListeners(t,e){this.localCache[t]=e;const s=this.listeners[t];if(s)for(const n of Array.from(s))n(e&&JSON.parse(e))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:s}),!0)})},U0)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}i_.type="LOCAL";const z0=i_;class n_ extends s_{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}n_.type="SESSION";const r_=n_;function j0(i){return Promise.all(i.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}}))}class lc{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(n=>n.isListeningto(t));if(e)return e;const s=new lc(t);return this.receivers.push(s),s}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:s,eventType:n,data:r}=e.data,o=this.handlersMap[n];if(!o?.size)return;e.ports[0].postMessage({status:"ack",eventId:s,eventType:n});const a=Array.from(o).map(async l=>l(e.origin,r)),c=await j0(a);e.ports[0].postMessage({status:"done",eventId:s,eventType:n,response:c})}_subscribe(t,e){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),(!e||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}lc.receivers=[];function lu(i="",t=10){let e="";for(let s=0;s<t;s++)e+=Math.floor(Math.random()*10);return i+e}class H0{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,s=50){const n=typeof MessageChannel<"u"?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let r,o;return new Promise((a,c)=>{const l=lu("",20);n.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},s);o={messageChannel:n,onMessage(u){const p=u;if(p.data.eventId===l)switch(p.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(p.data.response);break;default:clearTimeout(h),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),n.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:l,data:e},[n.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function ws(){return window}function q0(i){ws().location.href=i}function o_(){return typeof ws().WorkerGlobalScope<"u"&&typeof ws().importScripts=="function"}async function G0(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function W0(){return navigator?.serviceWorker?.controller||null}function K0(){return o_()?self:null}const a_="firebaseLocalStorageDb",X0=1,Ua="firebaseLocalStorage",c_="fbase_key";class vo{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function hc(i,t){return i.transaction([Ua],t?"readwrite":"readonly").objectStore(Ua)}function Y0(){const i=indexedDB.deleteDatabase(a_);return new vo(i).toPromise()}function nh(){const i=indexedDB.open(a_,X0);return new Promise((t,e)=>{i.addEventListener("error",()=>{e(i.error)}),i.addEventListener("upgradeneeded",()=>{const s=i.result;try{s.createObjectStore(Ua,{keyPath:c_})}catch(n){e(n)}}),i.addEventListener("success",async()=>{const s=i.result;s.objectStoreNames.contains(Ua)?t(s):(s.close(),await Y0(),t(await nh()))})})}async function Bf(i,t,e){const s=hc(i,!0).put({[c_]:t,value:e});return new vo(s).toPromise()}async function Q0(i,t){const e=hc(i,!1).get(t),s=await new vo(e).toPromise();return s===void 0?null:s.value}function Uf(i,t){const e=hc(i,!0).delete(t);return new vo(e).toPromise()}const J0=800,Z0=3;class l_{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await nh(),this.db)}async _withRetries(t){let e=0;for(;;)try{const s=await this._openDb();return await t(s)}catch(s){if(e++>Z0)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return o_()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=lc._getInstance(K0()),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await G0(),!this.activeServiceWorker)return;this.sender=new H0(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||W0()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await nh();return await Bf(t,Ba,"1"),await Uf(t,Ba),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(s=>Bf(s,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(s=>Q0(s,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Uf(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(n=>{const r=hc(n,!1).getAll();return new vo(r).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const e=[],s=new Set;if(t.length!==0)for(const{fbase_key:n,value:r}of t)s.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(r)&&(this.notifyListeners(n,r),e.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!s.has(n)&&(this.notifyListeners(n,null),e.push(n));return e}notifyListeners(t,e){this.localCache[t]=e;const s=this.listeners[t];if(s)for(const n of Array.from(s))n(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),J0)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}l_.type="LOCAL";const tE=l_;new mo(3e4,6e4);function h_(i,t){return t?Vs(t):(tt(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}class hu extends ou{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Rn(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Rn(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Rn(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function eE(i){return t_(i.auth,new hu(i),i.bypassAuthState)}function sE(i){const{auth:t,user:e}=i;return tt(e,t,"internal-error"),D0(e,new hu(i),i.bypassAuthState)}async function iE(i){const{auth:t,user:e}=i;return tt(e,t,"internal-error"),k0(e,new hu(i),i.bypassAuthState)}class u_{constructor(t,e,s,n,r=!1){this.auth=t,this.resolver=s,this.user=n,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:s,postBody:n,tenantId:r,error:o,type:a}=t;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:e,sessionId:s,tenantId:r||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(l){this.reject(l)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return eE;case"linkViaPopup":case"linkViaRedirect":return iE;case"reauthViaPopup":case"reauthViaRedirect":return sE;default:Je(this.auth,"internal-error")}}resolve(t){Hs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Hs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const nE=new mo(2e3,1e4);async function rE(i,t,e){if(xe(i.app))return Promise.reject(as(i,"operation-not-supported-in-this-environment"));const s=Ci(i);VA(i,t,cu);const n=h_(s,e);return new Fi(s,"signInViaPopup",t,n).executeNotNull()}class Fi extends u_{constructor(t,e,s,n,r){super(t,e,n,r),this.provider=s,this.authWindow=null,this.pollId=null,Fi.currentPopupAction&&Fi.currentPopupAction.cancel(),Fi.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return tt(t,this.auth,"internal-error"),t}async onExecution(){Hs(this.filter.length===1,"Popup operations only handle one event");const t=lu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(as(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(as(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Fi.currentPopupAction=null}pollUserCancellation(){const t=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(as(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,nE.get())};t()}}Fi.currentPopupAction=null;const oE="pendingRedirect",_a=new Map;class aE extends u_{constructor(t,e,s=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,s),this.eventId=null}async execute(){let t=_a.get(this.auth._key());if(!t){try{const s=await cE(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(s)}catch(e){t=()=>Promise.reject(e)}_a.set(this.auth._key(),t)}return this.bypassAuthState||_a.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function cE(i,t){const e=uE(t),s=hE(i);if(!await s._isAvailable())return!1;const n=await s._get(e)==="true";return await s._remove(e),n}function lE(i,t){_a.set(i._key(),t)}function hE(i){return Vs(i._redirectPersistence)}function uE(i){return ma(oE,i.config.apiKey,i.name)}async function dE(i,t,e=!1){if(xe(i.app))return Promise.reject(Us(i));const s=Ci(i),n=h_(s,t),o=await new aE(s,n,e).execute();return o&&!e&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,t)),o}const fE=600*1e3;class pE{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(t,s)&&(e=!0,this.sendToConsumer(t,s),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!gE(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){if(t.error&&!d_(t)){const s=t.error.code?.split("auth/")[1]||"internal-error";e.onError(as(this.auth,s))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const s=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&s}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=fE&&this.cachedEventUids.clear(),this.cachedEventUids.has($f(t))}saveEventToCache(t){this.cachedEventUids.add($f(t)),this.lastProcessedEventTime=Date.now()}}function $f(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(t=>t).join("-")}function d_({type:i,error:t}){return i==="unknown"&&t?.code==="auth/no-auth-event"}function gE(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return d_(i);default:return!1}}async function mE(i,t={}){return Ii(i,"GET","/v1/projects",t)}const _E=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yE=/^https?/;async function vE(i){if(i.config.emulator)return;const{authorizedDomains:t}=await mE(i);for(const e of t)try{if(bE(e))return}catch{}Je(i,"unauthorized-domain")}function bE(i){const t=eh(),{protocol:e,hostname:s}=new URL(t);if(i.startsWith("chrome-extension://")){const o=new URL(i);return o.hostname===""&&s===""?e==="chrome-extension:"&&i.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&o.hostname===s}if(!yE.test(e))return!1;if(_E.test(i))return s===i;const n=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(s)}const wE=new mo(3e4,6e4);function zf(){const i=ws().___jsl;if(i?.H){for(const t of Object.keys(i.H))if(i.H[t].r=i.H[t].r||[],i.H[t].L=i.H[t].L||[],i.H[t].r=[...i.H[t].L],i.CP)for(let e=0;e<i.CP.length;e++)i.CP[e]=null}}function AE(i){return new Promise((t,e)=>{function s(){zf(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{zf(),e(as(i,"network-request-failed"))},timeout:wE.get()})}if(ws().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(ws().gapi?.load)s();else{const n=f0("iframefcb");return ws()[n]=()=>{gapi.load?s():e(as(i,"network-request-failed"))},Ym(`${d0()}?onload=${n}`).catch(r=>e(r))}}).catch(t=>{throw ya=null,t})}let ya=null;function EE(i){return ya=ya||AE(i),ya}const TE=new mo(5e3,15e3),SE="__/auth/iframe",IE="emulator/auth/iframe",CE={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},PE=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function RE(i){const t=i.config;tt(t.authDomain,i,"auth-domain-config-required");const e=t.emulator?iu(t,IE):`https://${i.config.authDomain}/${SE}`,s={apiKey:t.apiKey,appName:i.name,v:sn},n=PE.get(i.config.apiHost);n&&(s.eid=n);const r=i._getFrameworks();return r.length&&(s.fw=r.join(",")),`${e}?${po(s).slice(1)}`}async function xE(i){const t=await EE(i),e=ws().gapi;return tt(e,i,"internal-error"),t.open({where:document.body,url:RE(i),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:CE,dontclear:!0},s=>new Promise(async(n,r)=>{await s.restyle({setHideOnLeave:!1});const o=as(i,"network-request-failed"),a=ws().setTimeout(()=>{r(o)},TE.get());function c(){ws().clearTimeout(a),n(s)}s.ping(c).then(c,()=>{r(o)})}))}const kE={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DE=500,ME=600,NE="_blank",LE="http://localhost";class jf{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function OE(i,t,e,s=DE,n=ME){const r=Math.max((window.screen.availHeight-n)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const c={...kE,width:s.toString(),height:n.toString(),top:r,left:o},l=Ae().toLowerCase();e&&(a=jm(l)?NE:e),$m(l)&&(t=t||LE,c.scrollbars="yes");const h=Object.entries(c).reduce((p,[g,y])=>`${p}${g}=${y},`,"");if(i0(l)&&a!=="_self")return FE(t||"",a),new jf(null);const u=window.open(t||"",a,h);tt(u,i,"popup-blocked");try{u.focus()}catch{}return new jf(u)}function FE(i,t){const e=document.createElement("a");e.href=i,e.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(s)}const VE="__/auth/handler",BE="emulator/auth/handler",UE=encodeURIComponent("fac");async function Hf(i,t,e,s,n,r){tt(i.config.authDomain,i,"auth-domain-config-required"),tt(i.config.apiKey,i,"invalid-api-key");const o={apiKey:i.config.apiKey,appName:i.name,authType:e,redirectUrl:s,v:sn,eventId:n};if(t instanceof cu){t.setDefaultLanguage(i.languageCode),o.providerId=t.providerId||"",Aw(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[h,u]of Object.entries({}))o[h]=u}if(t instanceof yo){const h=t.getScopes().filter(u=>u!=="");h.length>0&&(o.scopes=h.join(","))}i.tenantId&&(o.tid=i.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const c=await i._getAppCheckToken(),l=c?`#${UE}=${encodeURIComponent(c)}`:"";return`${$E(i)}?${po(a).slice(1)}${l}`}function $E({config:i}){return i.emulator?iu(i,BE):`https://${i.authDomain}/${VE}`}const ml="webStorageSupport";class zE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=r_,this._completeRedirectFn=dE,this._overrideRedirectResult=lE}async _openPopup(t,e,s,n){Hs(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()");const r=await Hf(t,e,s,eh(),n);return OE(t,r,lu())}async _openRedirect(t,e,s,n){await this._originValidation(t);const r=await Hf(t,e,s,eh(),n);return q0(r),new Promise(()=>{})}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:n,promise:r}=this.eventManagers[e];return n?Promise.resolve(n):(Hs(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(t);return this.eventManagers[e]={promise:s},s.catch(()=>{delete this.eventManagers[e]}),s}async initAndGetManager(t){const e=await xE(t),s=new pE(t);return e.register("authEvent",n=>(tt(n?.authEvent,t,"invalid-auth-event"),{status:s.onEvent(n.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:s},this.iframes[t._key()]=e,s}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(ml,{type:ml},n=>{const r=n?.[0]?.[ml];r!==void 0&&e(!!r),Je(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=vE(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return Km()||zm()||ru()}}const jE=zE;var qf="@firebase/auth",Gf="1.12.0";class HE{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(s=>{t(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){tt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function qE(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function GE(i){pi(new zs("auth",(t,{options:e})=>{const s=t.getProvider("app").getImmediate(),n=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;tt(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:o,authDomain:a,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Xm(i)},l=new l0(s,n,r,c);return v0(l,e),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,s)=>{t.getProvider("auth-internal").initialize()})),pi(new zs("auth-internal",t=>{const e=Ci(t.getProvider("auth").getImmediate());return(s=>new HE(s))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ye(qf,Gf,qE(i)),Ye(qf,Gf,"esm2020")}const WE=300,KE=Cm("authIdTokenMaxAge")||WE;let Wf=null;const XE=i=>async t=>{const e=t&&await t.getIdTokenResult(),s=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(s&&s>KE)return;const n=e?.token;Wf!==n&&(Wf=n,await fetch(i,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))};function YE(i=ac()){const t=go(i,"auth");if(t.isInitialized())return t.getImmediate();const e=y0(i,{popupRedirectResolver:jE,persistence:[tE,z0,r_]}),s=Cm("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=XE(r.toString());F0(e,o,()=>o(e.currentUser)),O0(e,a=>o(a))}}const n=Sm("auth");return n&&b0(e,`http://${n}`),e}function QE(){return document.getElementsByTagName("head")?.[0]??document}h0({loadJS(i){return new Promise((t,e)=>{const s=document.createElement("script");s.setAttribute("src",i),s.onload=t,s.onerror=n=>{const r=as("internal-error");r.customData=n,e(r)},s.type="text/javascript",s.charset="UTF-8",QE().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});GE("Browser");var Kf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ui,f_;(function(){var i;function t(S,T){function I(){}I.prototype=T.prototype,S.F=T.prototype,S.prototype=new I,S.prototype.constructor=S,S.D=function(k,R,N){for(var D=Array(arguments.length-2),J=2;J<arguments.length;J++)D[J-2]=arguments[J];return T.prototype[R].apply(k,D)}}function e(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(s,e),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function n(S,T,I){I||(I=0);const k=Array(16);if(typeof T=="string")for(var R=0;R<16;++R)k[R]=T.charCodeAt(I++)|T.charCodeAt(I++)<<8|T.charCodeAt(I++)<<16|T.charCodeAt(I++)<<24;else for(R=0;R<16;++R)k[R]=T[I++]|T[I++]<<8|T[I++]<<16|T[I++]<<24;T=S.g[0],I=S.g[1],R=S.g[2];let N=S.g[3],D;D=T+(N^I&(R^N))+k[0]+3614090360&4294967295,T=I+(D<<7&4294967295|D>>>25),D=N+(R^T&(I^R))+k[1]+3905402710&4294967295,N=T+(D<<12&4294967295|D>>>20),D=R+(I^N&(T^I))+k[2]+606105819&4294967295,R=N+(D<<17&4294967295|D>>>15),D=I+(T^R&(N^T))+k[3]+3250441966&4294967295,I=R+(D<<22&4294967295|D>>>10),D=T+(N^I&(R^N))+k[4]+4118548399&4294967295,T=I+(D<<7&4294967295|D>>>25),D=N+(R^T&(I^R))+k[5]+1200080426&4294967295,N=T+(D<<12&4294967295|D>>>20),D=R+(I^N&(T^I))+k[6]+2821735955&4294967295,R=N+(D<<17&4294967295|D>>>15),D=I+(T^R&(N^T))+k[7]+4249261313&4294967295,I=R+(D<<22&4294967295|D>>>10),D=T+(N^I&(R^N))+k[8]+1770035416&4294967295,T=I+(D<<7&4294967295|D>>>25),D=N+(R^T&(I^R))+k[9]+2336552879&4294967295,N=T+(D<<12&4294967295|D>>>20),D=R+(I^N&(T^I))+k[10]+4294925233&4294967295,R=N+(D<<17&4294967295|D>>>15),D=I+(T^R&(N^T))+k[11]+2304563134&4294967295,I=R+(D<<22&4294967295|D>>>10),D=T+(N^I&(R^N))+k[12]+1804603682&4294967295,T=I+(D<<7&4294967295|D>>>25),D=N+(R^T&(I^R))+k[13]+4254626195&4294967295,N=T+(D<<12&4294967295|D>>>20),D=R+(I^N&(T^I))+k[14]+2792965006&4294967295,R=N+(D<<17&4294967295|D>>>15),D=I+(T^R&(N^T))+k[15]+1236535329&4294967295,I=R+(D<<22&4294967295|D>>>10),D=T+(R^N&(I^R))+k[1]+4129170786&4294967295,T=I+(D<<5&4294967295|D>>>27),D=N+(I^R&(T^I))+k[6]+3225465664&4294967295,N=T+(D<<9&4294967295|D>>>23),D=R+(T^I&(N^T))+k[11]+643717713&4294967295,R=N+(D<<14&4294967295|D>>>18),D=I+(N^T&(R^N))+k[0]+3921069994&4294967295,I=R+(D<<20&4294967295|D>>>12),D=T+(R^N&(I^R))+k[5]+3593408605&4294967295,T=I+(D<<5&4294967295|D>>>27),D=N+(I^R&(T^I))+k[10]+38016083&4294967295,N=T+(D<<9&4294967295|D>>>23),D=R+(T^I&(N^T))+k[15]+3634488961&4294967295,R=N+(D<<14&4294967295|D>>>18),D=I+(N^T&(R^N))+k[4]+3889429448&4294967295,I=R+(D<<20&4294967295|D>>>12),D=T+(R^N&(I^R))+k[9]+568446438&4294967295,T=I+(D<<5&4294967295|D>>>27),D=N+(I^R&(T^I))+k[14]+3275163606&4294967295,N=T+(D<<9&4294967295|D>>>23),D=R+(T^I&(N^T))+k[3]+4107603335&4294967295,R=N+(D<<14&4294967295|D>>>18),D=I+(N^T&(R^N))+k[8]+1163531501&4294967295,I=R+(D<<20&4294967295|D>>>12),D=T+(R^N&(I^R))+k[13]+2850285829&4294967295,T=I+(D<<5&4294967295|D>>>27),D=N+(I^R&(T^I))+k[2]+4243563512&4294967295,N=T+(D<<9&4294967295|D>>>23),D=R+(T^I&(N^T))+k[7]+1735328473&4294967295,R=N+(D<<14&4294967295|D>>>18),D=I+(N^T&(R^N))+k[12]+2368359562&4294967295,I=R+(D<<20&4294967295|D>>>12),D=T+(I^R^N)+k[5]+4294588738&4294967295,T=I+(D<<4&4294967295|D>>>28),D=N+(T^I^R)+k[8]+2272392833&4294967295,N=T+(D<<11&4294967295|D>>>21),D=R+(N^T^I)+k[11]+1839030562&4294967295,R=N+(D<<16&4294967295|D>>>16),D=I+(R^N^T)+k[14]+4259657740&4294967295,I=R+(D<<23&4294967295|D>>>9),D=T+(I^R^N)+k[1]+2763975236&4294967295,T=I+(D<<4&4294967295|D>>>28),D=N+(T^I^R)+k[4]+1272893353&4294967295,N=T+(D<<11&4294967295|D>>>21),D=R+(N^T^I)+k[7]+4139469664&4294967295,R=N+(D<<16&4294967295|D>>>16),D=I+(R^N^T)+k[10]+3200236656&4294967295,I=R+(D<<23&4294967295|D>>>9),D=T+(I^R^N)+k[13]+681279174&4294967295,T=I+(D<<4&4294967295|D>>>28),D=N+(T^I^R)+k[0]+3936430074&4294967295,N=T+(D<<11&4294967295|D>>>21),D=R+(N^T^I)+k[3]+3572445317&4294967295,R=N+(D<<16&4294967295|D>>>16),D=I+(R^N^T)+k[6]+76029189&4294967295,I=R+(D<<23&4294967295|D>>>9),D=T+(I^R^N)+k[9]+3654602809&4294967295,T=I+(D<<4&4294967295|D>>>28),D=N+(T^I^R)+k[12]+3873151461&4294967295,N=T+(D<<11&4294967295|D>>>21),D=R+(N^T^I)+k[15]+530742520&4294967295,R=N+(D<<16&4294967295|D>>>16),D=I+(R^N^T)+k[2]+3299628645&4294967295,I=R+(D<<23&4294967295|D>>>9),D=T+(R^(I|~N))+k[0]+4096336452&4294967295,T=I+(D<<6&4294967295|D>>>26),D=N+(I^(T|~R))+k[7]+1126891415&4294967295,N=T+(D<<10&4294967295|D>>>22),D=R+(T^(N|~I))+k[14]+2878612391&4294967295,R=N+(D<<15&4294967295|D>>>17),D=I+(N^(R|~T))+k[5]+4237533241&4294967295,I=R+(D<<21&4294967295|D>>>11),D=T+(R^(I|~N))+k[12]+1700485571&4294967295,T=I+(D<<6&4294967295|D>>>26),D=N+(I^(T|~R))+k[3]+2399980690&4294967295,N=T+(D<<10&4294967295|D>>>22),D=R+(T^(N|~I))+k[10]+4293915773&4294967295,R=N+(D<<15&4294967295|D>>>17),D=I+(N^(R|~T))+k[1]+2240044497&4294967295,I=R+(D<<21&4294967295|D>>>11),D=T+(R^(I|~N))+k[8]+1873313359&4294967295,T=I+(D<<6&4294967295|D>>>26),D=N+(I^(T|~R))+k[15]+4264355552&4294967295,N=T+(D<<10&4294967295|D>>>22),D=R+(T^(N|~I))+k[6]+2734768916&4294967295,R=N+(D<<15&4294967295|D>>>17),D=I+(N^(R|~T))+k[13]+1309151649&4294967295,I=R+(D<<21&4294967295|D>>>11),D=T+(R^(I|~N))+k[4]+4149444226&4294967295,T=I+(D<<6&4294967295|D>>>26),D=N+(I^(T|~R))+k[11]+3174756917&4294967295,N=T+(D<<10&4294967295|D>>>22),D=R+(T^(N|~I))+k[2]+718787259&4294967295,R=N+(D<<15&4294967295|D>>>17),D=I+(N^(R|~T))+k[9]+3951481745&4294967295,S.g[0]=S.g[0]+T&4294967295,S.g[1]=S.g[1]+(R+(D<<21&4294967295|D>>>11))&4294967295,S.g[2]=S.g[2]+R&4294967295,S.g[3]=S.g[3]+N&4294967295}s.prototype.v=function(S,T){T===void 0&&(T=S.length);const I=T-this.blockSize,k=this.C;let R=this.h,N=0;for(;N<T;){if(R==0)for(;N<=I;)n(this,S,N),N+=this.blockSize;if(typeof S=="string"){for(;N<T;)if(k[R++]=S.charCodeAt(N++),R==this.blockSize){n(this,k),R=0;break}}else for(;N<T;)if(k[R++]=S[N++],R==this.blockSize){n(this,k),R=0;break}}this.h=R,this.o+=T},s.prototype.A=function(){var S=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);S[0]=128;for(var T=1;T<S.length-8;++T)S[T]=0;T=this.o*8;for(var I=S.length-8;I<S.length;++I)S[I]=T&255,T/=256;for(this.v(S),S=Array(16),T=0,I=0;I<4;++I)for(let k=0;k<32;k+=8)S[T++]=this.g[I]>>>k&255;return S};function r(S,T){var I=a;return Object.prototype.hasOwnProperty.call(I,S)?I[S]:I[S]=T(S)}function o(S,T){this.h=T;const I=[];let k=!0;for(let R=S.length-1;R>=0;R--){const N=S[R]|0;k&&N==T||(I[R]=N,k=!1)}this.g=I}var a={};function c(S){return-128<=S&&S<128?r(S,function(T){return new o([T|0],T<0?-1:0)}):new o([S|0],S<0?-1:0)}function l(S){if(isNaN(S)||!isFinite(S))return u;if(S<0)return v(l(-S));const T=[];let I=1;for(let k=0;S>=I;k++)T[k]=S/I|0,I*=4294967296;return new o(T,0)}function h(S,T){if(S.length==0)throw Error("number format error: empty string");if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(S.charAt(0)=="-")return v(h(S.substring(1),T));if(S.indexOf("-")>=0)throw Error('number format error: interior "-" character');const I=l(Math.pow(T,8));let k=u;for(let N=0;N<S.length;N+=8){var R=Math.min(8,S.length-N);const D=parseInt(S.substring(N,N+R),T);R<8?(R=l(Math.pow(T,R)),k=k.j(R).add(l(D))):(k=k.j(I),k=k.add(l(D)))}return k}var u=c(0),p=c(1),g=c(16777216);i=o.prototype,i.m=function(){if(m(this))return-v(this).m();let S=0,T=1;for(let I=0;I<this.g.length;I++){const k=this.i(I);S+=(k>=0?k:4294967296+k)*T,T*=4294967296}return S},i.toString=function(S){if(S=S||10,S<2||36<S)throw Error("radix out of range: "+S);if(y(this))return"0";if(m(this))return"-"+v(this).toString(S);const T=l(Math.pow(S,6));var I=this;let k="";for(;;){const R=P(I,T).g;I=w(I,R.j(T));let N=((I.g.length>0?I.g[0]:I.h)>>>0).toString(S);if(I=R,y(I))return N+k;for(;N.length<6;)N="0"+N;k=N+k}},i.i=function(S){return S<0?0:S<this.g.length?this.g[S]:this.h};function y(S){if(S.h!=0)return!1;for(let T=0;T<S.g.length;T++)if(S.g[T]!=0)return!1;return!0}function m(S){return S.h==-1}i.l=function(S){return S=w(this,S),m(S)?-1:y(S)?0:1};function v(S){const T=S.g.length,I=[];for(let k=0;k<T;k++)I[k]=~S.g[k];return new o(I,~S.h).add(p)}i.abs=function(){return m(this)?v(this):this},i.add=function(S){const T=Math.max(this.g.length,S.g.length),I=[];let k=0;for(let R=0;R<=T;R++){let N=k+(this.i(R)&65535)+(S.i(R)&65535),D=(N>>>16)+(this.i(R)>>>16)+(S.i(R)>>>16);k=D>>>16,N&=65535,D&=65535,I[R]=D<<16|N}return new o(I,I[I.length-1]&-2147483648?-1:0)};function w(S,T){return S.add(v(T))}i.j=function(S){if(y(this)||y(S))return u;if(m(this))return m(S)?v(this).j(v(S)):v(v(this).j(S));if(m(S))return v(this.j(v(S)));if(this.l(g)<0&&S.l(g)<0)return l(this.m()*S.m());const T=this.g.length+S.g.length,I=[];for(var k=0;k<2*T;k++)I[k]=0;for(k=0;k<this.g.length;k++)for(let R=0;R<S.g.length;R++){const N=this.i(k)>>>16,D=this.i(k)&65535,J=S.i(R)>>>16,wt=S.i(R)&65535;I[2*k+2*R]+=D*wt,E(I,2*k+2*R),I[2*k+2*R+1]+=N*wt,E(I,2*k+2*R+1),I[2*k+2*R+1]+=D*J,E(I,2*k+2*R+1),I[2*k+2*R+2]+=N*J,E(I,2*k+2*R+2)}for(S=0;S<T;S++)I[S]=I[2*S+1]<<16|I[2*S];for(S=T;S<2*T;S++)I[S]=0;return new o(I,0)};function E(S,T){for(;(S[T]&65535)!=S[T];)S[T+1]+=S[T]>>>16,S[T]&=65535,T++}function A(S,T){this.g=S,this.h=T}function P(S,T){if(y(T))throw Error("division by zero");if(y(S))return new A(u,u);if(m(S))return T=P(v(S),T),new A(v(T.g),v(T.h));if(m(T))return T=P(S,v(T)),new A(v(T.g),T.h);if(S.g.length>30){if(m(S)||m(T))throw Error("slowDivide_ only works with positive integers.");for(var I=p,k=T;k.l(S)<=0;)I=x(I),k=x(k);var R=M(I,1),N=M(k,1);for(k=M(k,2),I=M(I,2);!y(k);){var D=N.add(k);D.l(S)<=0&&(R=R.add(I),N=D),k=M(k,1),I=M(I,1)}return T=w(S,R.j(T)),new A(R,T)}for(R=u;S.l(T)>=0;){for(I=Math.max(1,Math.floor(S.m()/T.m())),k=Math.ceil(Math.log(I)/Math.LN2),k=k<=48?1:Math.pow(2,k-48),N=l(I),D=N.j(T);m(D)||D.l(S)>0;)I-=k,N=l(I),D=N.j(T);y(N)&&(N=p),R=R.add(N),S=w(S,D)}return new A(R,S)}i.B=function(S){return P(this,S).h},i.and=function(S){const T=Math.max(this.g.length,S.g.length),I=[];for(let k=0;k<T;k++)I[k]=this.i(k)&S.i(k);return new o(I,this.h&S.h)},i.or=function(S){const T=Math.max(this.g.length,S.g.length),I=[];for(let k=0;k<T;k++)I[k]=this.i(k)|S.i(k);return new o(I,this.h|S.h)},i.xor=function(S){const T=Math.max(this.g.length,S.g.length),I=[];for(let k=0;k<T;k++)I[k]=this.i(k)^S.i(k);return new o(I,this.h^S.h)};function x(S){const T=S.g.length+1,I=[];for(let k=0;k<T;k++)I[k]=S.i(k)<<1|S.i(k-1)>>>31;return new o(I,S.h)}function M(S,T){const I=T>>5;T%=32;const k=S.g.length-I,R=[];for(let N=0;N<k;N++)R[N]=T>0?S.i(N+I)>>>T|S.i(N+I+1)<<32-T:S.i(N+I);return new o(R,S.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,f_=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=h,ui=o}).apply(typeof Kf<"u"?Kf:typeof self<"u"?self:typeof window<"u"?window:{});var Yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var p_,Ir,g_,va,rh,m_,__,y_;(function(){var i,t=Object.defineProperty;function e(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yo=="object"&&Yo];for(var _=0;_<f.length;++_){var b=f[_];if(b&&b.Math==Math)return b}throw Error("Cannot find global object")}var s=e(this);function n(f,_){if(_)t:{var b=s;f=f.split(".");for(var C=0;C<f.length-1;C++){var L=f[C];if(!(L in b))break t;b=b[L]}f=f[f.length-1],C=b[f],_=_(C),_!=C&&_!=null&&t(b,f,{configurable:!0,writable:!0,value:_})}}n("Symbol.dispose",function(f){return f||Symbol("Symbol.dispose")}),n("Array.prototype.values",function(f){return f||function(){return this[Symbol.iterator]()}}),n("Object.entries",function(f){return f||function(_){var b=[],C;for(C in _)Object.prototype.hasOwnProperty.call(_,C)&&b.push([C,_[C]]);return b}});var r=r||{},o=this||self;function a(f){var _=typeof f;return _=="object"&&f!=null||_=="function"}function c(f,_,b){return f.call.apply(f.bind,arguments)}function l(f,_,b){return l=c,l.apply(null,arguments)}function h(f,_){var b=Array.prototype.slice.call(arguments,1);return function(){var C=b.slice();return C.push.apply(C,arguments),f.apply(this,C)}}function u(f,_){function b(){}b.prototype=_.prototype,f.Z=_.prototype,f.prototype=new b,f.prototype.constructor=f,f.Ob=function(C,L,O){for(var U=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)U[ut-2]=arguments[ut];return _.prototype[L].apply(C,U)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?f=>f&&AsyncContext.Snapshot.wrap(f):f=>f;function g(f){const _=f.length;if(_>0){const b=Array(_);for(let C=0;C<_;C++)b[C]=f[C];return b}return[]}function y(f,_){for(let C=1;C<arguments.length;C++){const L=arguments[C];var b=typeof L;if(b=b!="object"?b:L?Array.isArray(L)?"array":b:"null",b=="array"||b=="object"&&typeof L.length=="number"){b=f.length||0;const O=L.length||0;f.length=b+O;for(let U=0;U<O;U++)f[b+U]=L[U]}else f.push(L)}}class m{constructor(_,b){this.i=_,this.j=b,this.h=0,this.g=null}get(){let _;return this.h>0?(this.h--,_=this.g,this.g=_.next,_.next=null):_=this.i(),_}}function v(f){o.setTimeout(()=>{throw f},0)}function w(){var f=S;let _=null;return f.g&&(_=f.g,f.g=f.g.next,f.g||(f.h=null),_.next=null),_}class E{constructor(){this.h=this.g=null}add(_,b){const C=A.get();C.set(_,b),this.h?this.h.next=C:this.g=C,this.h=C}}var A=new m(()=>new P,f=>f.reset());class P{constructor(){this.next=this.g=this.h=null}set(_,b){this.h=_,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let x,M=!1,S=new E,T=()=>{const f=Promise.resolve(void 0);x=()=>{f.then(I)}};function I(){for(var f;f=w();){try{f.h.call(f.g)}catch(b){v(b)}var _=A;_.j(f),_.h<100&&(_.h++,f.next=_.g,_.g=f)}M=!1}function k(){this.u=this.u,this.C=this.C}k.prototype.u=!1,k.prototype.dispose=function(){this.u||(this.u=!0,this.N())},k.prototype[Symbol.dispose]=function(){this.dispose()},k.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function R(f,_){this.type=f,this.g=this.target=_,this.defaultPrevented=!1}R.prototype.h=function(){this.defaultPrevented=!0};var N=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var f=!1,_=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const b=()=>{};o.addEventListener("test",b,_),o.removeEventListener("test",b,_)}catch{}return f})();function D(f){return/^[\s\xa0]*$/.test(f)}function J(f,_){R.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f&&this.init(f,_)}u(J,R),J.prototype.init=function(f,_){const b=this.type=f.type,C=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;this.target=f.target||f.srcElement,this.g=_,_=f.relatedTarget,_||(b=="mouseover"?_=f.fromElement:b=="mouseout"&&(_=f.toElement)),this.relatedTarget=_,C?(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=f.pointerType,this.state=f.state,this.i=f,f.defaultPrevented&&J.Z.h.call(this)},J.prototype.h=function(){J.Z.h.call(this);const f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var wt="closure_listenable_"+(Math.random()*1e6|0),G=0;function K(f,_,b,C,L){this.listener=f,this.proxy=null,this.src=_,this.type=b,this.capture=!!C,this.ha=L,this.key=++G,this.da=this.fa=!1}function ft(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Xt(f,_,b){for(const C in f)_.call(b,f[C],C,f)}function dt(f,_){for(const b in f)_.call(void 0,f[b],b,f)}function at(f){const _={};for(const b in f)_[b]=f[b];return _}const z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(f,_){let b,C;for(let L=1;L<arguments.length;L++){C=arguments[L];for(b in C)f[b]=C[b];for(let O=0;O<z.length;O++)b=z[O],Object.prototype.hasOwnProperty.call(C,b)&&(f[b]=C[b])}}function Se(f){this.src=f,this.g={},this.h=0}Se.prototype.add=function(f,_,b,C,L){const O=f.toString();f=this.g[O],f||(f=this.g[O]=[],this.h++);const U=qe(f,_,C,L);return U>-1?(_=f[U],b||(_.fa=!1)):(_=new K(_,this.src,O,!!C,L),_.fa=b,f.push(_)),_};function He(f,_){const b=_.type;if(b in f.g){var C=f.g[b],L=Array.prototype.indexOf.call(C,_,void 0),O;(O=L>=0)&&Array.prototype.splice.call(C,L,1),O&&(ft(_),f.g[b].length==0&&(delete f.g[b],f.h--))}}function qe(f,_,b,C){for(let L=0;L<f.length;++L){const O=f[L];if(!O.da&&O.listener==_&&O.capture==!!b&&O.ha==C)return L}return-1}var Dt="closure_lm_"+(Math.random()*1e6|0),ks={};function Ws(f,_,b,C,L){if(Array.isArray(_)){for(let O=0;O<_.length;O++)Ws(f,_[O],b,C,L);return null}return b=ad(b),f&&f[wt]?f.J(_,b,a(C)?!!C.capture:!1,L):zc(f,_,b,!1,C,L)}function zc(f,_,b,C,L,O){if(!_)throw Error("Invalid event type");const U=a(L)?!!L.capture:!!L;let ut=jc(f);if(ut||(f[Dt]=ut=new Se(f)),b=ut.add(_,b,C,U,O),b.proxy)return b;if(C=er(),b.proxy=C,C.src=f,C.listener=b,f.addEventListener)N||(L=U),L===void 0&&(L=!1),f.addEventListener(_.toString(),C,L);else if(f.attachEvent)f.attachEvent(No(_.toString()),C);else if(f.addListener&&f.removeListener)f.addListener(C);else throw Error("addEventListener and attachEvent are unavailable.");return b}function er(){function f(b){return _.call(f.src,f.listener,b)}const _=ab;return f}function un(f,_,b,C,L){if(Array.isArray(_))for(var O=0;O<_.length;O++)un(f,_[O],b,C,L);else C=a(C)?!!C.capture:!!C,b=ad(b),f&&f[wt]?(f=f.i,O=String(_).toString(),O in f.g&&(_=f.g[O],b=qe(_,b,C,L),b>-1&&(ft(_[b]),Array.prototype.splice.call(_,b,1),_.length==0&&(delete f.g[O],f.h--)))):f&&(f=jc(f))&&(_=f.g[_.toString()],f=-1,_&&(f=qe(_,b,C,L)),(b=f>-1?_[f]:null)&&dn(b))}function dn(f){if(typeof f!="number"&&f&&!f.da){var _=f.src;if(_&&_[wt])He(_.i,f);else{var b=f.type,C=f.proxy;_.removeEventListener?_.removeEventListener(b,C,f.capture):_.detachEvent?_.detachEvent(No(b),C):_.addListener&&_.removeListener&&_.removeListener(C),(b=jc(_))?(He(b,f),b.h==0&&(b.src=null,_[Dt]=null)):ft(f)}}}function No(f){return f in ks?ks[f]:ks[f]="on"+f}function ab(f,_){if(f.da)f=!0;else{_=new J(_,this);const b=f.listener,C=f.ha||f.src;f.fa&&dn(f),f=b.call(C,_)}return f}function jc(f){return f=f[Dt],f instanceof Se?f:null}var Hc="__closure_events_fn_"+(Math.random()*1e9>>>0);function ad(f){return typeof f=="function"?f:(f[Hc]||(f[Hc]=function(_){return f.handleEvent(_)}),f[Hc])}function _e(){k.call(this),this.i=new Se(this),this.M=this,this.G=null}u(_e,k),_e.prototype[wt]=!0,_e.prototype.removeEventListener=function(f,_,b,C){un(this,f,_,b,C)};function Ie(f,_){var b,C=f.G;if(C)for(b=[];C;C=C.G)b.push(C);if(f=f.M,C=_.type||_,typeof _=="string")_=new R(_,f);else if(_ instanceof R)_.target=_.target||f;else{var L=_;_=new R(C,f),Z(_,L)}L=!0;let O,U;if(b)for(U=b.length-1;U>=0;U--)O=_.g=b[U],L=Lo(O,C,!0,_)&&L;if(O=_.g=f,L=Lo(O,C,!0,_)&&L,L=Lo(O,C,!1,_)&&L,b)for(U=0;U<b.length;U++)O=_.g=b[U],L=Lo(O,C,!1,_)&&L}_e.prototype.N=function(){if(_e.Z.N.call(this),this.i){var f=this.i;for(const _ in f.g){const b=f.g[_];for(let C=0;C<b.length;C++)ft(b[C]);delete f.g[_],f.h--}}this.G=null},_e.prototype.J=function(f,_,b,C){return this.i.add(String(f),_,!1,b,C)},_e.prototype.K=function(f,_,b,C){return this.i.add(String(f),_,!0,b,C)};function Lo(f,_,b,C){if(_=f.i.g[String(_)],!_)return!0;_=_.concat();let L=!0;for(let O=0;O<_.length;++O){const U=_[O];if(U&&!U.da&&U.capture==b){const ut=U.listener,ee=U.ha||U.src;U.fa&&He(f.i,U),L=ut.call(ee,C)!==!1&&L}}return L&&!C.defaultPrevented}function cb(f,_){if(typeof f!="function")if(f&&typeof f.handleEvent=="function")f=l(f.handleEvent,f);else throw Error("Invalid listener argument");return Number(_)>2147483647?-1:o.setTimeout(f,_||0)}function cd(f){f.g=cb(()=>{f.g=null,f.i&&(f.i=!1,cd(f))},f.l);const _=f.h;f.h=null,f.m.apply(null,_)}class lb extends k{constructor(_,b){super(),this.m=_,this.l=b,this.h=null,this.i=!1,this.g=null}j(_){this.h=arguments,this.g?this.i=!0:cd(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function sr(f){k.call(this),this.h=f,this.g={}}u(sr,k);var ld=[];function hd(f){Xt(f.g,function(_,b){this.g.hasOwnProperty(b)&&dn(_)},f),f.g={}}sr.prototype.N=function(){sr.Z.N.call(this),hd(this)},sr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var qc=o.JSON.stringify,hb=o.JSON.parse,ub=class{stringify(f){return o.JSON.stringify(f,void 0)}parse(f){return o.JSON.parse(f,void 0)}};function ud(){}function dd(){}var ir={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Gc(){R.call(this,"d")}u(Gc,R);function Wc(){R.call(this,"c")}u(Wc,R);var xi={},fd=null;function Oo(){return fd=fd||new _e}xi.Ia="serverreachability";function pd(f){R.call(this,xi.Ia,f)}u(pd,R);function nr(f){const _=Oo();Ie(_,new pd(_))}xi.STAT_EVENT="statevent";function gd(f,_){R.call(this,xi.STAT_EVENT,f),this.stat=_}u(gd,R);function Ce(f){const _=Oo();Ie(_,new gd(_,f))}xi.Ja="timingevent";function md(f,_){R.call(this,xi.Ja,f),this.size=_}u(md,R);function rr(f,_){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){f()},_)}function or(){this.g=!0}or.prototype.ua=function(){this.g=!1};function db(f,_,b,C,L,O){f.info(function(){if(f.g)if(O){var U="",ut=O.split("&");for(let Ct=0;Ct<ut.length;Ct++){var ee=ut[Ct].split("=");if(ee.length>1){const oe=ee[0];ee=ee[1];const us=oe.split("_");U=us.length>=2&&us[1]=="type"?U+(oe+"="+ee+"&"):U+(oe+"=redacted&")}}}else U=null;else U=O;return"XMLHTTP REQ ("+C+") [attempt "+L+"]: "+_+`
`+b+`
`+U})}function fb(f,_,b,C,L,O,U){f.info(function(){return"XMLHTTP RESP ("+C+") [ attempt "+L+"]: "+_+`
`+b+`
`+O+" "+U})}function fn(f,_,b,C){f.info(function(){return"XMLHTTP TEXT ("+_+"): "+gb(f,b)+(C?" "+C:"")})}function pb(f,_){f.info(function(){return"TIMEOUT: "+_})}or.prototype.info=function(){};function gb(f,_){if(!f.g)return _;if(!_)return null;try{const O=JSON.parse(_);if(O){for(f=0;f<O.length;f++)if(Array.isArray(O[f])){var b=O[f];if(!(b.length<2)){var C=b[1];if(Array.isArray(C)&&!(C.length<1)){var L=C[0];if(L!="noop"&&L!="stop"&&L!="close")for(let U=1;U<C.length;U++)C[U]=""}}}}return qc(O)}catch{return _}}var Fo={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},_d={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},yd;function Kc(){}u(Kc,ud),Kc.prototype.g=function(){return new XMLHttpRequest},yd=new Kc;function ar(f){return encodeURIComponent(String(f))}function mb(f){var _=1;f=f.split(":");const b=[];for(;_>0&&f.length;)b.push(f.shift()),_--;return f.length&&b.push(f.join(":")),b}function Ks(f,_,b,C){this.j=f,this.i=_,this.l=b,this.S=C||1,this.V=new sr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new vd}function vd(){this.i=null,this.g="",this.h=!1}var bd={},Xc={};function Yc(f,_,b){f.M=1,f.A=Bo(hs(_)),f.u=b,f.R=!0,wd(f,null)}function wd(f,_){f.F=Date.now(),Vo(f),f.B=hs(f.A);var b=f.B,C=f.S;Array.isArray(C)||(C=[String(C)]),Nd(b.i,"t",C),f.C=0,b=f.j.L,f.h=new vd,f.g=Jd(f.j,b?_:null,!f.u),f.P>0&&(f.O=new lb(l(f.Y,f,f.g),f.P)),_=f.V,b=f.g,C=f.ba;var L="readystatechange";Array.isArray(L)||(L&&(ld[0]=L.toString()),L=ld);for(let O=0;O<L.length;O++){const U=Ws(b,L[O],C||_.handleEvent,!1,_.h||_);if(!U)break;_.g[U.key]=U}_=f.J?at(f.J):{},f.u?(f.v||(f.v="POST"),_["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.B,f.v,f.u,_)):(f.v="GET",f.g.ea(f.B,f.v,null,_)),nr(),db(f.i,f.v,f.B,f.l,f.S,f.u)}Ks.prototype.ba=function(f){f=f.target;const _=this.O;_&&Qs(f)==3?_.j():this.Y(f)},Ks.prototype.Y=function(f){try{if(f==this.g)t:{const ut=Qs(this.g),ee=this.g.ya(),Ct=this.g.ca();if(!(ut<3)&&(ut!=3||this.g&&(this.h.h||this.g.la()||$d(this.g)))){this.K||ut!=4||ee==7||(ee==8||Ct<=0?nr(3):nr(2)),Qc(this);var _=this.g.ca();this.X=_;var b=_b(this);if(this.o=_==200,fb(this.i,this.v,this.B,this.l,this.S,ut,_),this.o){if(this.U&&!this.L){e:{if(this.g){var C,L=this.g;if((C=L.g?L.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(C)){var O=C;break e}}O=null}if(f=O)fn(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Jc(this,f);else{this.o=!1,this.m=3,Ce(12),ki(this),cr(this);break t}}if(this.R){f=!0;let oe;for(;!this.K&&this.C<b.length;)if(oe=yb(this,b),oe==Xc){ut==4&&(this.m=4,Ce(14),f=!1),fn(this.i,this.l,null,"[Incomplete Response]");break}else if(oe==bd){this.m=4,Ce(15),fn(this.i,this.l,b,"[Invalid Chunk]"),f=!1;break}else fn(this.i,this.l,oe,null),Jc(this,oe);if(Ad(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ut!=4||b.length!=0||this.h.h||(this.m=1,Ce(16),f=!1),this.o=this.o&&f,!f)fn(this.i,this.l,b,"[Invalid Chunked Response]"),ki(this),cr(this);else if(b.length>0&&!this.W){this.W=!0;var U=this.j;U.g==this&&U.aa&&!U.P&&(U.j.info("Great, no buffering proxy detected. Bytes received: "+b.length),ol(U),U.P=!0,Ce(11))}}else fn(this.i,this.l,b,null),Jc(this,b);ut==4&&ki(this),this.o&&!this.K&&(ut==4?Kd(this.j,this):(this.o=!1,Vo(this)))}else Db(this.g),_==400&&b.indexOf("Unknown SID")>0?(this.m=3,Ce(12)):(this.m=0,Ce(13)),ki(this),cr(this)}}}catch{}};function _b(f){if(!Ad(f))return f.g.la();const _=$d(f.g);if(_==="")return"";let b="";const C=_.length,L=Qs(f.g)==4;if(!f.h.i){if(typeof TextDecoder>"u")return ki(f),cr(f),"";f.h.i=new o.TextDecoder}for(let O=0;O<C;O++)f.h.h=!0,b+=f.h.i.decode(_[O],{stream:!(L&&O==C-1)});return _.length=0,f.h.g+=b,f.C=0,f.h.g}function Ad(f){return f.g?f.v=="GET"&&f.M!=2&&f.j.Aa:!1}function yb(f,_){var b=f.C,C=_.indexOf(`
`,b);return C==-1?Xc:(b=Number(_.substring(b,C)),isNaN(b)?bd:(C+=1,C+b>_.length?Xc:(_=_.slice(C,C+b),f.C=C+b,_)))}Ks.prototype.cancel=function(){this.K=!0,ki(this)};function Vo(f){f.T=Date.now()+f.H,Ed(f,f.H)}function Ed(f,_){if(f.D!=null)throw Error("WatchDog timer not null");f.D=rr(l(f.aa,f),_)}function Qc(f){f.D&&(o.clearTimeout(f.D),f.D=null)}Ks.prototype.aa=function(){this.D=null;const f=Date.now();f-this.T>=0?(pb(this.i,this.B),this.M!=2&&(nr(),Ce(17)),ki(this),this.m=2,cr(this)):Ed(this,this.T-f)};function cr(f){f.j.I==0||f.K||Kd(f.j,f)}function ki(f){Qc(f);var _=f.O;_&&typeof _.dispose=="function"&&_.dispose(),f.O=null,hd(f.V),f.g&&(_=f.g,f.g=null,_.abort(),_.dispose())}function Jc(f,_){try{var b=f.j;if(b.I!=0&&(b.g==f||Zc(b.h,f))){if(!f.L&&Zc(b.h,f)&&b.I==3){try{var C=b.Ba.g.parse(_)}catch{C=null}if(Array.isArray(C)&&C.length==3){var L=C;if(L[0]==0){t:if(!b.v){if(b.g)if(b.g.F+3e3<f.F)Ho(b),zo(b);else break t;rl(b),Ce(18)}}else b.xa=L[1],0<b.xa-b.K&&L[2]<37500&&b.F&&b.A==0&&!b.C&&(b.C=rr(l(b.Va,b),6e3));Id(b.h)<=1&&b.ta&&(b.ta=void 0)}else Mi(b,11)}else if((f.L||b.g==f)&&Ho(b),!D(_))for(L=b.Ba.g.parse(_),_=0;_<L.length;_++){let Ct=L[_];const oe=Ct[0];if(!(oe<=b.K))if(b.K=oe,Ct=Ct[1],b.I==2)if(Ct[0]=="c"){b.M=Ct[1],b.ba=Ct[2];const us=Ct[3];us!=null&&(b.ka=us,b.j.info("VER="+b.ka));const Ni=Ct[4];Ni!=null&&(b.za=Ni,b.j.info("SVER="+b.za));const Js=Ct[5];Js!=null&&typeof Js=="number"&&Js>0&&(C=1.5*Js,b.O=C,b.j.info("backChannelRequestTimeoutMs_="+C)),C=b;const Zs=f.g;if(Zs){const Go=Zs.g?Zs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Go){var O=C.h;O.g||Go.indexOf("spdy")==-1&&Go.indexOf("quic")==-1&&Go.indexOf("h2")==-1||(O.j=O.l,O.g=new Set,O.h&&(tl(O,O.h),O.h=null))}if(C.G){const al=Zs.g?Zs.g.getResponseHeader("X-HTTP-Session-Id"):null;al&&(C.wa=al,xt(C.J,C.G,al))}}b.I=3,b.l&&b.l.ra(),b.aa&&(b.T=Date.now()-f.F,b.j.info("Handshake RTT: "+b.T+"ms")),C=b;var U=f;if(C.na=Qd(C,C.L?C.ba:null,C.W),U.L){Cd(C.h,U);var ut=U,ee=C.O;ee&&(ut.H=ee),ut.D&&(Qc(ut),Vo(ut)),C.g=U}else Gd(C);b.i.length>0&&jo(b)}else Ct[0]!="stop"&&Ct[0]!="close"||Mi(b,7);else b.I==3&&(Ct[0]=="stop"||Ct[0]=="close"?Ct[0]=="stop"?Mi(b,7):nl(b):Ct[0]!="noop"&&b.l&&b.l.qa(Ct),b.A=0)}}nr(4)}catch{}}var vb=class{constructor(f,_){this.g=f,this.map=_}};function Td(f){this.l=f||10,o.PerformanceNavigationTiming?(f=o.performance.getEntriesByType("navigation"),f=f.length>0&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Sd(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function Id(f){return f.h?1:f.g?f.g.size:0}function Zc(f,_){return f.h?f.h==_:f.g?f.g.has(_):!1}function tl(f,_){f.g?f.g.add(_):f.h=_}function Cd(f,_){f.h&&f.h==_?f.h=null:f.g&&f.g.has(_)&&f.g.delete(_)}Td.prototype.cancel=function(){if(this.i=Pd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function Pd(f){if(f.h!=null)return f.i.concat(f.h.G);if(f.g!=null&&f.g.size!==0){let _=f.i;for(const b of f.g.values())_=_.concat(b.G);return _}return g(f.i)}var Rd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bb(f,_){if(f){f=f.split("&");for(let b=0;b<f.length;b++){const C=f[b].indexOf("=");let L,O=null;C>=0?(L=f[b].substring(0,C),O=f[b].substring(C+1)):L=f[b],_(L,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function Xs(f){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let _;f instanceof Xs?(this.l=f.l,lr(this,f.j),this.o=f.o,this.g=f.g,hr(this,f.u),this.h=f.h,el(this,Ld(f.i)),this.m=f.m):f&&(_=String(f).match(Rd))?(this.l=!1,lr(this,_[1]||"",!0),this.o=ur(_[2]||""),this.g=ur(_[3]||"",!0),hr(this,_[4]),this.h=ur(_[5]||"",!0),el(this,_[6]||"",!0),this.m=ur(_[7]||"")):(this.l=!1,this.i=new fr(null,this.l))}Xs.prototype.toString=function(){const f=[];var _=this.j;_&&f.push(dr(_,xd,!0),":");var b=this.g;return(b||_=="file")&&(f.push("//"),(_=this.o)&&f.push(dr(_,xd,!0),"@"),f.push(ar(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b=this.u,b!=null&&f.push(":",String(b))),(b=this.h)&&(this.g&&b.charAt(0)!="/"&&f.push("/"),f.push(dr(b,b.charAt(0)=="/"?Eb:Ab,!0))),(b=this.i.toString())&&f.push("?",b),(b=this.m)&&f.push("#",dr(b,Sb)),f.join("")},Xs.prototype.resolve=function(f){const _=hs(this);let b=!!f.j;b?lr(_,f.j):b=!!f.o,b?_.o=f.o:b=!!f.g,b?_.g=f.g:b=f.u!=null;var C=f.h;if(b)hr(_,f.u);else if(b=!!f.h){if(C.charAt(0)!="/")if(this.g&&!this.h)C="/"+C;else{var L=_.h.lastIndexOf("/");L!=-1&&(C=_.h.slice(0,L+1)+C)}if(L=C,L==".."||L==".")C="";else if(L.indexOf("./")!=-1||L.indexOf("/.")!=-1){C=L.lastIndexOf("/",0)==0,L=L.split("/");const O=[];for(let U=0;U<L.length;){const ut=L[U++];ut=="."?C&&U==L.length&&O.push(""):ut==".."?((O.length>1||O.length==1&&O[0]!="")&&O.pop(),C&&U==L.length&&O.push("")):(O.push(ut),C=!0)}C=O.join("/")}else C=L}return b?_.h=C:b=f.i.toString()!=="",b?el(_,Ld(f.i)):b=!!f.m,b&&(_.m=f.m),_};function hs(f){return new Xs(f)}function lr(f,_,b){f.j=b?ur(_,!0):_,f.j&&(f.j=f.j.replace(/:$/,""))}function hr(f,_){if(_){if(_=Number(_),isNaN(_)||_<0)throw Error("Bad port number "+_);f.u=_}else f.u=null}function el(f,_,b){_ instanceof fr?(f.i=_,Ib(f.i,f.l)):(b||(_=dr(_,Tb)),f.i=new fr(_,f.l))}function xt(f,_,b){f.i.set(_,b)}function Bo(f){return xt(f,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),f}function ur(f,_){return f?_?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function dr(f,_,b){return typeof f=="string"?(f=encodeURI(f).replace(_,wb),b&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function wb(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var xd=/[#\/\?@]/g,Ab=/[#\?:]/g,Eb=/[#\?]/g,Tb=/[#\?@]/g,Sb=/#/g;function fr(f,_){this.h=this.g=null,this.i=f||null,this.j=!!_}function Di(f){f.g||(f.g=new Map,f.h=0,f.i&&bb(f.i,function(_,b){f.add(decodeURIComponent(_.replace(/\+/g," ")),b)}))}i=fr.prototype,i.add=function(f,_){Di(this),this.i=null,f=pn(this,f);let b=this.g.get(f);return b||this.g.set(f,b=[]),b.push(_),this.h+=1,this};function kd(f,_){Di(f),_=pn(f,_),f.g.has(_)&&(f.i=null,f.h-=f.g.get(_).length,f.g.delete(_))}function Dd(f,_){return Di(f),_=pn(f,_),f.g.has(_)}i.forEach=function(f,_){Di(this),this.g.forEach(function(b,C){b.forEach(function(L){f.call(_,L,C,this)},this)},this)};function Md(f,_){Di(f);let b=[];if(typeof _=="string")Dd(f,_)&&(b=b.concat(f.g.get(pn(f,_))));else for(f=Array.from(f.g.values()),_=0;_<f.length;_++)b=b.concat(f[_]);return b}i.set=function(f,_){return Di(this),this.i=null,f=pn(this,f),Dd(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[_]),this.h+=1,this},i.get=function(f,_){return f?(f=Md(this,f),f.length>0?String(f[0]):_):_};function Nd(f,_,b){kd(f,_),b.length>0&&(f.i=null,f.g.set(pn(f,_),g(b)),f.h+=b.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],_=Array.from(this.g.keys());for(let C=0;C<_.length;C++){var b=_[C];const L=ar(b);b=Md(this,b);for(let O=0;O<b.length;O++){let U=L;b[O]!==""&&(U+="="+ar(b[O])),f.push(U)}}return this.i=f.join("&")};function Ld(f){const _=new fr;return _.i=f.i,f.g&&(_.g=new Map(f.g),_.h=f.h),_}function pn(f,_){return _=String(_),f.j&&(_=_.toLowerCase()),_}function Ib(f,_){_&&!f.j&&(Di(f),f.i=null,f.g.forEach(function(b,C){const L=C.toLowerCase();C!=L&&(kd(this,C),Nd(this,L,b))},f)),f.j=_}function Cb(f,_){const b=new or;if(o.Image){const C=new Image;C.onload=h(Ys,b,"TestLoadImage: loaded",!0,_,C),C.onerror=h(Ys,b,"TestLoadImage: error",!1,_,C),C.onabort=h(Ys,b,"TestLoadImage: abort",!1,_,C),C.ontimeout=h(Ys,b,"TestLoadImage: timeout",!1,_,C),o.setTimeout(function(){C.ontimeout&&C.ontimeout()},1e4),C.src=f}else _(!1)}function Pb(f,_){const b=new or,C=new AbortController,L=setTimeout(()=>{C.abort(),Ys(b,"TestPingServer: timeout",!1,_)},1e4);fetch(f,{signal:C.signal}).then(O=>{clearTimeout(L),O.ok?Ys(b,"TestPingServer: ok",!0,_):Ys(b,"TestPingServer: server error",!1,_)}).catch(()=>{clearTimeout(L),Ys(b,"TestPingServer: error",!1,_)})}function Ys(f,_,b,C,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),C(b)}catch{}}function Rb(){this.g=new ub}function sl(f){this.i=f.Sb||null,this.h=f.ab||!1}u(sl,ud),sl.prototype.g=function(){return new Uo(this.i,this.h)};function Uo(f,_){_e.call(this),this.H=f,this.o=_,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}u(Uo,_e),i=Uo.prototype,i.open=function(f,_){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=f,this.D=_,this.readyState=1,gr(this)},i.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const _={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};f&&(_.body=f),(this.H||o).fetch(new Request(this.D,_)).then(this.Pa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,pr(this)),this.readyState=0},i.Pa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,gr(this)),this.g&&(this.readyState=3,gr(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Od(this)}else f.text().then(this.Oa.bind(this),this.ga.bind(this))};function Od(f){f.j.read().then(f.Ma.bind(f)).catch(f.ga.bind(f))}i.Ma=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var _=f.value?f.value:new Uint8Array(0);(_=this.B.decode(_,{stream:!f.done}))&&(this.response=this.responseText+=_)}f.done?pr(this):gr(this),this.readyState==3&&Od(this)}},i.Oa=function(f){this.g&&(this.response=this.responseText=f,pr(this))},i.Na=function(f){this.g&&(this.response=f,pr(this))},i.ga=function(){this.g&&pr(this)};function pr(f){f.readyState=4,f.l=null,f.j=null,f.B=null,gr(f)}i.setRequestHeader=function(f,_){this.A.append(f,_)},i.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],_=this.h.entries();for(var b=_.next();!b.done;)b=b.value,f.push(b[0]+": "+b[1]),b=_.next();return f.join(`\r
`)};function gr(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(Uo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Fd(f){let _="";return Xt(f,function(b,C){_+=C,_+=":",_+=b,_+=`\r
`}),_}function il(f,_,b){t:{for(C in b){var C=!1;break t}C=!0}C||(b=Fd(b),typeof f=="string"?b!=null&&ar(b):xt(f,_,b))}function zt(f){_e.call(this),this.headers=new Map,this.L=f||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}u(zt,_e);var xb=/^https?$/i,kb=["POST","PUT"];i=zt.prototype,i.Fa=function(f){this.H=f},i.ea=function(f,_,b,C){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);_=_?_.toUpperCase():"GET",this.D=f,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():yd.g(),this.g.onreadystatechange=p(l(this.Ca,this));try{this.B=!0,this.g.open(_,String(f),!0),this.B=!1}catch(O){Vd(this,O);return}if(f=b||"",b=new Map(this.headers),C)if(Object.getPrototypeOf(C)===Object.prototype)for(var L in C)b.set(L,C[L]);else if(typeof C.keys=="function"&&typeof C.get=="function")for(const O of C.keys())b.set(O,C.get(O));else throw Error("Unknown input type for opt_headers: "+String(C));C=Array.from(b.keys()).find(O=>O.toLowerCase()=="content-type"),L=o.FormData&&f instanceof o.FormData,!(Array.prototype.indexOf.call(kb,_,void 0)>=0)||C||L||b.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[O,U]of b)this.g.setRequestHeader(O,U);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(f),this.v=!1}catch(O){Vd(this,O)}};function Vd(f,_){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=_,f.o=5,Bd(f),$o(f)}function Bd(f){f.A||(f.A=!0,Ie(f,"complete"),Ie(f,"error"))}i.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=f||7,Ie(this,"complete"),Ie(this,"abort"),$o(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$o(this,!0)),zt.Z.N.call(this)},i.Ca=function(){this.u||(this.B||this.v||this.j?Ud(this):this.Xa())},i.Xa=function(){Ud(this)};function Ud(f){if(f.h&&typeof r<"u"){if(f.v&&Qs(f)==4)setTimeout(f.Ca.bind(f),0);else if(Ie(f,"readystatechange"),Qs(f)==4){f.h=!1;try{const O=f.ca();t:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var _=!0;break t;default:_=!1}var b;if(!(b=_)){var C;if(C=O===0){let U=String(f.D).match(Rd)[1]||null;!U&&o.self&&o.self.location&&(U=o.self.location.protocol.slice(0,-1)),C=!xb.test(U?U.toLowerCase():"")}b=C}if(b)Ie(f,"complete"),Ie(f,"success");else{f.o=6;try{var L=Qs(f)>2?f.g.statusText:""}catch{L=""}f.l=L+" ["+f.ca()+"]",Bd(f)}}finally{$o(f)}}}}function $o(f,_){if(f.g){f.m&&(clearTimeout(f.m),f.m=null);const b=f.g;f.g=null,_||Ie(f,"ready");try{b.onreadystatechange=null}catch{}}}i.isActive=function(){return!!this.g};function Qs(f){return f.g?f.g.readyState:0}i.ca=function(){try{return Qs(this)>2?this.g.status:-1}catch{return-1}},i.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.La=function(f){if(this.g){var _=this.g.responseText;return f&&_.indexOf(f)==0&&(_=_.substring(f.length)),hb(_)}};function $d(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.F){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function Db(f){const _={};f=(f.g&&Qs(f)>=2&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let C=0;C<f.length;C++){if(D(f[C]))continue;var b=mb(f[C]);const L=b[0];if(b=b[1],typeof b!="string")continue;b=b.trim();const O=_[L]||[];_[L]=O,O.push(b)}dt(_,function(C){return C.join(", ")})}i.ya=function(){return this.o},i.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function mr(f,_,b){return b&&b.internalChannelParams&&b.internalChannelParams[f]||_}function zd(f){this.za=0,this.i=[],this.j=new or,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=mr("failFast",!1,f),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=mr("baseRetryDelayMs",5e3,f),this.Za=mr("retryDelaySeedMs",1e4,f),this.Ta=mr("forwardChannelMaxRetries",2,f),this.va=mr("forwardChannelRequestTimeoutMs",2e4,f),this.ma=f&&f.xmlHttpFactory||void 0,this.Ua=f&&f.Rb||void 0,this.Aa=f&&f.useFetchStreams||!1,this.O=void 0,this.L=f&&f.supportsCrossDomainXhr||!1,this.M="",this.h=new Td(f&&f.concurrentRequestLimit),this.Ba=new Rb,this.S=f&&f.fastHandshake||!1,this.R=f&&f.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=f&&f.Pb||!1,f&&f.ua&&this.j.ua(),f&&f.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&f&&f.detectBufferingProxy||!1,this.ia=void 0,f&&f.longPollingTimeout&&f.longPollingTimeout>0&&(this.ia=f.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}i=zd.prototype,i.ka=8,i.I=1,i.connect=function(f,_,b,C){Ce(0),this.W=f,this.H=_||{},b&&C!==void 0&&(this.H.OSID=b,this.H.OAID=C),this.F=this.X,this.J=Qd(this,null,this.W),jo(this)};function nl(f){if(jd(f),f.I==3){var _=f.V++,b=hs(f.J);if(xt(b,"SID",f.M),xt(b,"RID",_),xt(b,"TYPE","terminate"),_r(f,b),_=new Ks(f,f.j,_),_.M=2,_.A=Bo(hs(b)),b=!1,o.navigator&&o.navigator.sendBeacon)try{b=o.navigator.sendBeacon(_.A.toString(),"")}catch{}!b&&o.Image&&(new Image().src=_.A,b=!0),b||(_.g=Jd(_.j,null),_.g.ea(_.A)),_.F=Date.now(),Vo(_)}Yd(f)}function zo(f){f.g&&(ol(f),f.g.cancel(),f.g=null)}function jd(f){zo(f),f.v&&(o.clearTimeout(f.v),f.v=null),Ho(f),f.h.cancel(),f.m&&(typeof f.m=="number"&&o.clearTimeout(f.m),f.m=null)}function jo(f){if(!Sd(f.h)&&!f.m){f.m=!0;var _=f.Ea;x||T(),M||(x(),M=!0),S.add(_,f),f.D=0}}function Mb(f,_){return Id(f.h)>=f.h.j-(f.m?1:0)?!1:f.m?(f.i=_.G.concat(f.i),!0):f.I==1||f.I==2||f.D>=(f.Sa?0:f.Ta)?!1:(f.m=rr(l(f.Ea,f,_),Xd(f,f.D)),f.D++,!0)}i.Ea=function(f){if(this.m)if(this.m=null,this.I==1){if(!f){this.V=Math.floor(Math.random()*1e5),f=this.V++;const L=new Ks(this,this.j,f);let O=this.o;if(this.U&&(O?(O=at(O),Z(O,this.U)):O=this.U),this.u!==null||this.R||(L.J=O,O=null),this.S)t:{for(var _=0,b=0;b<this.i.length;b++){e:{var C=this.i[b];if("__data__"in C.map&&(C=C.map.__data__,typeof C=="string")){C=C.length;break e}C=void 0}if(C===void 0)break;if(_+=C,_>4096){_=b;break t}if(_===4096||b===this.i.length-1){_=b+1;break t}}_=1e3}else _=1e3;_=qd(this,L,_),b=hs(this.J),xt(b,"RID",f),xt(b,"CVER",22),this.G&&xt(b,"X-HTTP-Session-Id",this.G),_r(this,b),O&&(this.R?_="headers="+ar(Fd(O))+"&"+_:this.u&&il(b,this.u,O)),tl(this.h,L),this.Ra&&xt(b,"TYPE","init"),this.S?(xt(b,"$req",_),xt(b,"SID","null"),L.U=!0,Yc(L,b,null)):Yc(L,b,_),this.I=2}}else this.I==3&&(f?Hd(this,f):this.i.length==0||Sd(this.h)||Hd(this))};function Hd(f,_){var b;_?b=_.l:b=f.V++;const C=hs(f.J);xt(C,"SID",f.M),xt(C,"RID",b),xt(C,"AID",f.K),_r(f,C),f.u&&f.o&&il(C,f.u,f.o),b=new Ks(f,f.j,b,f.D+1),f.u===null&&(b.J=f.o),_&&(f.i=_.G.concat(f.i)),_=qd(f,b,1e3),b.H=Math.round(f.va*.5)+Math.round(f.va*.5*Math.random()),tl(f.h,b),Yc(b,C,_)}function _r(f,_){f.H&&Xt(f.H,function(b,C){xt(_,C,b)}),f.l&&Xt({},function(b,C){xt(_,C,b)})}function qd(f,_,b){b=Math.min(f.i.length,b);const C=f.l?l(f.l.Ka,f.l,f):null;t:{var L=f.i;let ut=-1;for(;;){const ee=["count="+b];ut==-1?b>0?(ut=L[0].g,ee.push("ofs="+ut)):ut=0:ee.push("ofs="+ut);let Ct=!0;for(let oe=0;oe<b;oe++){var O=L[oe].g;const us=L[oe].map;if(O-=ut,O<0)ut=Math.max(0,L[oe].g-100),Ct=!1;else try{O="req"+O+"_"||"";try{var U=us instanceof Map?us:Object.entries(us);for(const[Ni,Js]of U){let Zs=Js;a(Js)&&(Zs=qc(Js)),ee.push(O+Ni+"="+encodeURIComponent(Zs))}}catch(Ni){throw ee.push(O+"type="+encodeURIComponent("_badmap")),Ni}}catch{C&&C(us)}}if(Ct){U=ee.join("&");break t}}U=void 0}return f=f.i.splice(0,b),_.G=f,U}function Gd(f){if(!f.g&&!f.v){f.Y=1;var _=f.Da;x||T(),M||(x(),M=!0),S.add(_,f),f.A=0}}function rl(f){return f.g||f.v||f.A>=3?!1:(f.Y++,f.v=rr(l(f.Da,f),Xd(f,f.A)),f.A++,!0)}i.Da=function(){if(this.v=null,Wd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var f=4*this.T;this.j.info("BP detection timer enabled: "+f),this.B=rr(l(this.Wa,this),f)}},i.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ce(10),zo(this),Wd(this))};function ol(f){f.B!=null&&(o.clearTimeout(f.B),f.B=null)}function Wd(f){f.g=new Ks(f,f.j,"rpc",f.Y),f.u===null&&(f.g.J=f.o),f.g.P=0;var _=hs(f.na);xt(_,"RID","rpc"),xt(_,"SID",f.M),xt(_,"AID",f.K),xt(_,"CI",f.F?"0":"1"),!f.F&&f.ia&&xt(_,"TO",f.ia),xt(_,"TYPE","xmlhttp"),_r(f,_),f.u&&f.o&&il(_,f.u,f.o),f.O&&(f.g.H=f.O);var b=f.g;f=f.ba,b.M=1,b.A=Bo(hs(_)),b.u=null,b.R=!0,wd(b,f)}i.Va=function(){this.C!=null&&(this.C=null,zo(this),rl(this),Ce(19))};function Ho(f){f.C!=null&&(o.clearTimeout(f.C),f.C=null)}function Kd(f,_){var b=null;if(f.g==_){Ho(f),ol(f),f.g=null;var C=2}else if(Zc(f.h,_))b=_.G,Cd(f.h,_),C=1;else return;if(f.I!=0){if(_.o)if(C==1){b=_.u?_.u.length:0,_=Date.now()-_.F;var L=f.D;C=Oo(),Ie(C,new md(C,b)),jo(f)}else Gd(f);else if(L=_.m,L==3||L==0&&_.X>0||!(C==1&&Mb(f,_)||C==2&&rl(f)))switch(b&&b.length>0&&(_=f.h,_.i=_.i.concat(b)),L){case 1:Mi(f,5);break;case 4:Mi(f,10);break;case 3:Mi(f,6);break;default:Mi(f,2)}}}function Xd(f,_){let b=f.Qa+Math.floor(Math.random()*f.Za);return f.isActive()||(b*=2),b*_}function Mi(f,_){if(f.j.info("Error code "+_),_==2){var b=l(f.bb,f),C=f.Ua;const L=!C;C=new Xs(C||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||lr(C,"https"),Bo(C),L?Cb(C.toString(),b):Pb(C.toString(),b)}else Ce(2);f.I=0,f.l&&f.l.pa(_),Yd(f),jd(f)}i.bb=function(f){f?(this.j.info("Successfully pinged google.com"),Ce(2)):(this.j.info("Failed to ping google.com"),Ce(1))};function Yd(f){if(f.I=0,f.ja=[],f.l){const _=Pd(f.h);(_.length!=0||f.i.length!=0)&&(y(f.ja,_),y(f.ja,f.i),f.h.i.length=0,g(f.i),f.i.length=0),f.l.oa()}}function Qd(f,_,b){var C=b instanceof Xs?hs(b):new Xs(b);if(C.g!="")_&&(C.g=_+"."+C.g),hr(C,C.u);else{var L=o.location;C=L.protocol,_=_?_+"."+L.hostname:L.hostname,L=+L.port;const O=new Xs(null);C&&lr(O,C),_&&(O.g=_),L&&hr(O,L),b&&(O.h=b),C=O}return b=f.G,_=f.wa,b&&_&&xt(C,b,_),xt(C,"VER",f.ka),_r(f,C),C}function Jd(f,_,b){if(_&&!f.L)throw Error("Can't create secondary domain capable XhrIo object.");return _=f.Aa&&!f.ma?new zt(new sl({ab:b})):new zt(f.ma),_.Fa(f.L),_}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Zd(){}i=Zd.prototype,i.ra=function(){},i.qa=function(){},i.pa=function(){},i.oa=function(){},i.isActive=function(){return!0},i.Ka=function(){};function qo(){}qo.prototype.g=function(f,_){return new Ve(f,_)};function Ve(f,_){_e.call(this),this.g=new zd(_),this.l=f,this.h=_&&_.messageUrlParams||null,f=_&&_.messageHeaders||null,_&&_.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=_&&_.initMessageHeaders||null,_&&_.messageContentType&&(f?f["X-WebChannel-Content-Type"]=_.messageContentType:f={"X-WebChannel-Content-Type":_.messageContentType}),_&&_.sa&&(f?f["X-WebChannel-Client-Profile"]=_.sa:f={"X-WebChannel-Client-Profile":_.sa}),this.g.U=f,(f=_&&_.Qb)&&!D(f)&&(this.g.u=f),this.A=_&&_.supportsCrossDomainXhr||!1,this.v=_&&_.sendRawJson||!1,(_=_&&_.httpSessionIdParam)&&!D(_)&&(this.g.G=_,f=this.h,f!==null&&_ in f&&(f=this.h,_ in f&&delete f[_])),this.j=new gn(this)}u(Ve,_e),Ve.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ve.prototype.close=function(){nl(this.g)},Ve.prototype.o=function(f){var _=this.g;if(typeof f=="string"){var b={};b.__data__=f,f=b}else this.v&&(b={},b.__data__=qc(f),f=b);_.i.push(new vb(_.Ya++,f)),_.I==3&&jo(_)},Ve.prototype.N=function(){this.g.l=null,delete this.j,nl(this.g),delete this.g,Ve.Z.N.call(this)};function tf(f){Gc.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var _=f.__sm__;if(_){t:{for(const b in _){f=b;break t}f=void 0}(this.i=f)&&(f=this.i,_=_!==null&&f in _?_[f]:void 0),this.data=_}else this.data=f}u(tf,Gc);function ef(){Wc.call(this),this.status=1}u(ef,Wc);function gn(f){this.g=f}u(gn,Zd),gn.prototype.ra=function(){Ie(this.g,"a")},gn.prototype.qa=function(f){Ie(this.g,new tf(f))},gn.prototype.pa=function(f){Ie(this.g,new ef)},gn.prototype.oa=function(){Ie(this.g,"b")},qo.prototype.createWebChannel=qo.prototype.g,Ve.prototype.send=Ve.prototype.o,Ve.prototype.open=Ve.prototype.m,Ve.prototype.close=Ve.prototype.close,y_=function(){return new qo},__=function(){return Oo()},m_=xi,rh={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Fo.NO_ERROR=0,Fo.TIMEOUT=8,Fo.HTTP_ERROR=6,va=Fo,_d.COMPLETE="complete",g_=_d,dd.EventType=ir,ir.OPEN="a",ir.CLOSE="b",ir.ERROR="c",ir.MESSAGE="d",_e.prototype.listen=_e.prototype.J,Ir=dd,zt.prototype.listenOnce=zt.prototype.K,zt.prototype.getLastError=zt.prototype.Ha,zt.prototype.getLastErrorCode=zt.prototype.ya,zt.prototype.getStatus=zt.prototype.ca,zt.prototype.getResponseJson=zt.prototype.La,zt.prototype.getResponseText=zt.prototype.la,zt.prototype.send=zt.prototype.ea,zt.prototype.setWithCredentials=zt.prototype.Fa,p_=zt}).apply(typeof Yo<"u"?Yo:typeof self<"u"?self:typeof window<"u"?window:{});const Xf="@firebase/firestore",Yf="4.9.3";class ve{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");let Xn="12.7.0";const Yi=new Zh("@firebase/firestore");function _n(){return Yi.logLevel}function q(i,...t){if(Yi.logLevel<=pt.DEBUG){const e=t.map(uu);Yi.debug(`Firestore (${Xn}): ${i}`,...e)}}function qs(i,...t){if(Yi.logLevel<=pt.ERROR){const e=t.map(uu);Yi.error(`Firestore (${Xn}): ${i}`,...e)}}function Bn(i,...t){if(Yi.logLevel<=pt.WARN){const e=t.map(uu);Yi.warn(`Firestore (${Xn}): ${i}`,...e)}}function uu(i){if(typeof i=="string")return i;try{return(function(e){return JSON.stringify(e)})(i)}catch{return i}}function et(i,t,e){let s="Unexpected state";typeof t=="string"?s=t:e=t,v_(i,s,e)}function v_(i,t,e){let s=`FIRESTORE (${Xn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${i.toString(16)})`;if(e!==void 0)try{s+=" CONTEXT: "+JSON.stringify(e)}catch{s+=" CONTEXT: "+e}throw qs(s),new Error(s)}function Tt(i,t,e,s){let n="Unexpected state";typeof e=="string"?n=e:s=e,i||v_(t,n,s)}function rt(i,t){return i}const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class j extends Rs{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class $s{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class b_{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class JE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(ve.UNAUTHENTICATED)))}shutdown(){}}class ZE{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class tT{constructor(t){this.t=t,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Tt(this.o===void 0,42304);let s=this.i;const n=c=>this.i!==s?(s=this.i,e(c)):Promise.resolve();let r=new $s;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new $s,t.enqueueRetryable((()=>n(this.currentUser)))};const o=()=>{const c=r;t.enqueueRetryable((async()=>{await c.promise,await n(this.currentUser)}))},a=c=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((c=>a(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new $s)}}),0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((s=>this.i!==t?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Tt(typeof s.accessToken=="string",31837,{l:s}),new b_(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Tt(t===null||typeof t=="string",2055,{h:t}),new ve(t)}}class eT{constructor(t,e,s){this.P=t,this.T=e,this.I=s,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class sT{constructor(t,e,s){this.P=t,this.T=e,this.I=s}getToken(){return Promise.resolve(new eT(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(ve.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Qf{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class iT{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,xe(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Tt(this.o===void 0,3512);const s=r=>{r.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.m;return this.m=r.token,q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(r.token):Promise.resolve()};this.o=r=>{t.enqueueRetryable((()=>s(r)))};const n=r=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((r=>n(r))),setTimeout((()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?n(r):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Qf(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(Tt(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Qf(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function nT(i){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(i);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let s=0;s<i;s++)e[s]=Math.floor(256*Math.random());return e}class du{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const n=nT(40);for(let r=0;r<n.length;++r)s.length<20&&n[r]<e&&(s+=t.charAt(n[r]%62))}return s}}function gt(i,t){return i<t?-1:i>t?1:0}function oh(i,t){const e=Math.min(i.length,t.length);for(let s=0;s<e;s++){const n=i.charAt(s),r=t.charAt(s);if(n!==r)return _l(n)===_l(r)?gt(n,r):_l(n)?1:-1}return gt(i.length,t.length)}const rT=55296,oT=57343;function _l(i){const t=i.charCodeAt(0);return t>=rT&&t<=oT}function Un(i,t,e){return i.length===t.length&&i.every(((s,n)=>e(s,t[n])))}const Jf="__name__";class _s{constructor(t,e,s){e===void 0?e=0:e>t.length&&et(637,{offset:e,range:t.length}),s===void 0?s=t.length-e:s>t.length-e&&et(1746,{length:s,range:t.length-e}),this.segments=t,this.offset=e,this.len=s}get length(){return this.len}isEqual(t){return _s.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof _s?t.forEach((s=>{e.push(s)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,s=this.limit();e<s;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const s=Math.min(t.length,e.length);for(let n=0;n<s;n++){const r=_s.compareSegments(t.get(n),e.get(n));if(r!==0)return r}return gt(t.length,e.length)}static compareSegments(t,e){const s=_s.isNumericId(t),n=_s.isNumericId(e);return s&&!n?-1:!s&&n?1:s&&n?_s.extractNumericId(t).compare(_s.extractNumericId(e)):oh(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ui.fromString(t.substring(4,t.length-2))}}class Rt extends _s{construct(t,e,s){return new Rt(t,e,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const s of t){if(s.indexOf("//")>=0)throw new j(V.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);e.push(...s.split("/").filter((n=>n.length>0)))}return new Rt(e)}static emptyPath(){return new Rt([])}}const aT=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class pe extends _s{construct(t,e,s){return new pe(t,e,s)}static isValidIdentifier(t){return aT.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),pe.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Jf}static keyField(){return new pe([Jf])}static fromServerFormat(t){const e=[];let s="",n=0;const r=()=>{if(s.length===0)throw new j(V.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(s),s=""};let o=!1;for(;n<t.length;){const a=t[n];if(a==="\\"){if(n+1===t.length)throw new j(V.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const c=t[n+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new j(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);s+=c,n+=2}else a==="`"?(o=!o,n++):a!=="."||o?(s+=a,n++):(r(),n++)}if(r(),o)throw new j(V.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new pe(e)}static emptyPath(){return new pe([])}}class Q{constructor(t){this.path=t}static fromPath(t){return new Q(Rt.fromString(t))}static fromName(t){return new Q(Rt.fromString(t).popFirst(5))}static empty(){return new Q(Rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Rt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Rt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Q(new Rt(t.slice()))}}function w_(i,t,e){if(!e)throw new j(V.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${t}.`)}function cT(i,t,e,s){if(t===!0&&s===!0)throw new j(V.INVALID_ARGUMENT,`${i} and ${e} cannot be used together.`)}function Zf(i){if(!Q.isDocumentKey(i))throw new j(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function tp(i){if(Q.isDocumentKey(i))throw new j(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function A_(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function uc(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const t=(function(s){return s.constructor?s.constructor.name:null})(i);return t?`a custom ${t} object`:"an object"}}return typeof i=="function"?"a function":et(12329,{type:typeof i})}function cs(i,t){if("_delegate"in i&&(i=i._delegate),!(i instanceof t)){if(t.name===i.constructor.name)throw new j(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=uc(i);throw new j(V.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return i}function te(i,t){const e={typeString:i};return t&&(e.value=t),e}function bo(i,t){if(!A_(i))throw new j(V.INVALID_ARGUMENT,"JSON must be an object");let e;for(const s in t)if(t[s]){const n=t[s].typeString,r="value"in t[s]?{value:t[s].value}:void 0;if(!(s in i)){e=`JSON missing required field: '${s}'`;break}const o=i[s];if(n&&typeof o!==n){e=`JSON field '${s}' must be a ${n}.`;break}if(r!==void 0&&o!==r.value){e=`Expected '${s}' field to equal '${r.value}'`;break}}if(e)throw new j(V.INVALID_ARGUMENT,e);return!0}const ep=-62135596800,sp=1e6;class ct{static now(){return ct.fromMillis(Date.now())}static fromDate(t){return ct.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),s=Math.floor((t-1e3*e)*sp);return new ct(e,s)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new j(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new j(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<ep)throw new j(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new j(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/sp}_compareTo(t){return this.seconds===t.seconds?gt(this.nanoseconds,t.nanoseconds):gt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ct._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(bo(t,ct._jsonSchema))return new ct(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-ep;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ct._jsonSchemaVersion="firestore/timestamp/1.0",ct._jsonSchema={type:te("string",ct._jsonSchemaVersion),seconds:te("number"),nanoseconds:te("number")};class st{static fromTimestamp(t){return new st(t)}static min(){return new st(new ct(0,0))}static max(){return new st(new ct(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Wr=-1;function lT(i,t){const e=i.toTimestamp().seconds,s=i.toTimestamp().nanoseconds+1,n=st.fromTimestamp(s===1e9?new ct(e+1,0):new ct(e,s));return new gi(n,Q.empty(),t)}function hT(i){return new gi(i.readTime,i.key,Wr)}class gi{constructor(t,e,s){this.readTime=t,this.documentKey=e,this.largestBatchId=s}static min(){return new gi(st.min(),Q.empty(),Wr)}static max(){return new gi(st.max(),Q.empty(),Wr)}}function uT(i,t){let e=i.readTime.compareTo(t.readTime);return e!==0?e:(e=Q.comparator(i.documentKey,t.documentKey),e!==0?e:gt(i.largestBatchId,t.largestBatchId))}const dT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Yn(i){if(i.code!==V.FAILED_PRECONDITION||i.message!==dT)throw i;q("LocalStore","Unexpectedly lost primary lease")}class B{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&et(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new B(((s,n)=>{this.nextCallback=r=>{this.wrapSuccess(t,r).next(s,n)},this.catchCallback=r=>{this.wrapFailure(e,r).next(s,n)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof B?e:B.resolve(e)}catch(e){return B.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):B.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):B.reject(e)}static resolve(t){return new B(((e,s)=>{e(t)}))}static reject(t){return new B(((e,s)=>{s(t)}))}static waitFor(t){return new B(((e,s)=>{let n=0,r=0,o=!1;t.forEach((a=>{++n,a.next((()=>{++r,o&&r===n&&e()}),(c=>s(c)))})),o=!0,r===n&&e()}))}static or(t){let e=B.resolve(!1);for(const s of t)e=e.next((n=>n?B.resolve(n):s()));return e}static forEach(t,e){const s=[];return t.forEach(((n,r)=>{s.push(e.call(this,n,r))})),this.waitFor(s)}static mapArray(t,e){return new B(((s,n)=>{const r=t.length,o=new Array(r);let a=0;for(let c=0;c<r;c++){const l=c;e(t[l]).next((h=>{o[l]=h,++a,a===r&&s(o)}),(h=>n(h)))}}))}static doWhile(t,e){return new B(((s,n)=>{const r=()=>{t()===!0?e().next((()=>{r()}),n):s()};r()}))}}function pT(i){const t=i.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Qn(i){return i.name==="IndexedDbTransactionError"}class dc{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>e.writeSequenceNumber(s))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}dc.ce=-1;const fu=-1;function fc(i){return i==null}function $a(i){return i===0&&1/i==-1/0}function gT(i){return typeof i=="number"&&Number.isInteger(i)&&!$a(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}const E_="";function mT(i){let t="";for(let e=0;e<i.length;e++)t.length>0&&(t=ip(t)),t=_T(i.get(e),t);return ip(t)}function _T(i,t){let e=t;const s=i.length;for(let n=0;n<s;n++){const r=i.charAt(n);switch(r){case"\0":e+="";break;case E_:e+="";break;default:e+=r}}return e}function ip(i){return i+E_+""}function np(i){let t=0;for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&t++;return t}function Pi(i,t){for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&t(e,i[e])}function T_(i){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t))return!1;return!0}class Ut{constructor(t,e){this.comparator=t,this.root=e||de.EMPTY}insert(t,e){return new Ut(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,de.BLACK,null,null))}remove(t){return new Ut(this.comparator,this.root.remove(t,this.comparator).copy(null,null,de.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const s=this.comparator(t,e.key);if(s===0)return e.value;s<0?e=e.left:s>0&&(e=e.right)}return null}indexOf(t){let e=0,s=this.root;for(;!s.isEmpty();){const n=this.comparator(t,s.key);if(n===0)return e+s.left.size;n<0?s=s.left:(e+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,s)=>(t(e,s),!1)))}toString(){const t=[];return this.inorderTraversal(((e,s)=>(t.push(`${e}:${s}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Qo(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Qo(this.root,t,this.comparator,!1)}getReverseIterator(){return new Qo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Qo(this.root,t,this.comparator,!0)}}class Qo{constructor(t,e,s,n){this.isReverse=n,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?s(t.key,e):1,e&&n&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(r===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class de{constructor(t,e,s,n,r){this.key=t,this.value=e,this.color=s??de.RED,this.left=n??de.EMPTY,this.right=r??de.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,s,n,r){return new de(t??this.key,e??this.value,s??this.color,n??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,s){let n=this;const r=s(t,n.key);return n=r<0?n.copy(null,null,null,n.left.insert(t,e,s),null):r===0?n.copy(null,e,null,null,null):n.copy(null,null,null,null,n.right.insert(t,e,s)),n.fixUp()}removeMin(){if(this.left.isEmpty())return de.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let s,n=this;if(e(t,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),e(t,n.key)===0){if(n.right.isEmpty())return de.EMPTY;s=n.right.min(),n=n.copy(s.key,s.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,de.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,de.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw et(43730,{key:this.key,value:this.value});if(this.right.isRed())throw et(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw et(27949);return t+(this.isRed()?0:1)}}de.EMPTY=null,de.RED=!0,de.BLACK=!1;de.EMPTY=new class{constructor(){this.size=0}get key(){throw et(57766)}get value(){throw et(16141)}get color(){throw et(16727)}get left(){throw et(29726)}get right(){throw et(36894)}copy(t,e,s,n,r){return this}insert(t,e,s){return new de(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ne{constructor(t){this.comparator=t,this.data=new Ut(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,s)=>(t(e),!1)))}forEachInRange(t,e){const s=this.data.getIteratorFrom(t[0]);for(;s.hasNext();){const n=s.getNext();if(this.comparator(n.key,t[1])>=0)return;e(n.key)}}forEachWhile(t,e){let s;for(s=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();s.hasNext();)if(!t(s.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new rp(this.data.getIterator())}getIteratorFrom(t){return new rp(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((s=>{e=e.add(s)})),e}isEqual(t){if(!(t instanceof ne)||this.size!==t.size)return!1;const e=this.data.getIterator(),s=t.data.getIterator();for(;e.hasNext();){const n=e.getNext().key,r=s.getNext().key;if(this.comparator(n,r)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ne(this.comparator);return e.data=t,e}}class rp{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class je{constructor(t){this.fields=t,t.sort(pe.comparator)}static empty(){return new je([])}unionWith(t){let e=new ne(pe.comparator);for(const s of this.fields)e=e.add(s);for(const s of t)e=e.add(s);return new je(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Un(this.fields,t.fields,((e,s)=>e.isEqual(s)))}}class S_ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class me{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(n){try{return atob(n)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new S_("Invalid base64 string: "+r):r}})(t);return new me(e)}static fromUint8Array(t){const e=(function(n){let r="";for(let o=0;o<n.length;++o)r+=String.fromCharCode(n[o]);return r})(t);return new me(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const s=new Uint8Array(e.length);for(let n=0;n<e.length;n++)s[n]=e.charCodeAt(n);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return gt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}me.EMPTY_BYTE_STRING=new me("");const yT=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mi(i){if(Tt(!!i,39018),typeof i=="string"){let t=0;const e=yT.exec(i);if(Tt(!!e,46558,{timestamp:i}),e[1]){let n=e[1];n=(n+"000000000").substr(0,9),t=Number(n)}const s=new Date(i);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Gt(i.seconds),nanos:Gt(i.nanos)}}function Gt(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function _i(i){return typeof i=="string"?me.fromBase64String(i):me.fromUint8Array(i)}const I_="server_timestamp",C_="__type__",P_="__previous_value__",R_="__local_write_time__";function pu(i){return(i?.mapValue?.fields||{})[C_]?.stringValue===I_}function pc(i){const t=i.mapValue.fields[P_];return pu(t)?pc(t):t}function Kr(i){const t=mi(i.mapValue.fields[R_].timestampValue);return new ct(t.seconds,t.nanos)}class vT{constructor(t,e,s,n,r,o,a,c,l,h){this.databaseId=t,this.appId=e,this.persistenceKey=s,this.host=n,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l,this.isUsingEmulator=h}}const za="(default)";class Xr{constructor(t,e){this.projectId=t,this.database=e||za}static empty(){return new Xr("","")}get isDefaultDatabase(){return this.database===za}isEqual(t){return t instanceof Xr&&t.projectId===this.projectId&&t.database===this.database}}const x_="__type__",bT="__max__",Jo={mapValue:{}},k_="__vector__",ja="value";function yi(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?pu(i)?4:AT(i)?9007199254740991:wT(i)?10:11:et(28295,{value:i})}function Is(i,t){if(i===t)return!0;const e=yi(i);if(e!==yi(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===t.booleanValue;case 4:return Kr(i).isEqual(Kr(t));case 3:return(function(n,r){if(typeof n.timestampValue=="string"&&typeof r.timestampValue=="string"&&n.timestampValue.length===r.timestampValue.length)return n.timestampValue===r.timestampValue;const o=mi(n.timestampValue),a=mi(r.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(i,t);case 5:return i.stringValue===t.stringValue;case 6:return(function(n,r){return _i(n.bytesValue).isEqual(_i(r.bytesValue))})(i,t);case 7:return i.referenceValue===t.referenceValue;case 8:return(function(n,r){return Gt(n.geoPointValue.latitude)===Gt(r.geoPointValue.latitude)&&Gt(n.geoPointValue.longitude)===Gt(r.geoPointValue.longitude)})(i,t);case 2:return(function(n,r){if("integerValue"in n&&"integerValue"in r)return Gt(n.integerValue)===Gt(r.integerValue);if("doubleValue"in n&&"doubleValue"in r){const o=Gt(n.doubleValue),a=Gt(r.doubleValue);return o===a?$a(o)===$a(a):isNaN(o)&&isNaN(a)}return!1})(i,t);case 9:return Un(i.arrayValue.values||[],t.arrayValue.values||[],Is);case 10:case 11:return(function(n,r){const o=n.mapValue.fields||{},a=r.mapValue.fields||{};if(np(o)!==np(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Is(o[c],a[c])))return!1;return!0})(i,t);default:return et(52216,{left:i})}}function Yr(i,t){return(i.values||[]).find((e=>Is(e,t)))!==void 0}function $n(i,t){if(i===t)return 0;const e=yi(i),s=yi(t);if(e!==s)return gt(e,s);switch(e){case 0:case 9007199254740991:return 0;case 1:return gt(i.booleanValue,t.booleanValue);case 2:return(function(r,o){const a=Gt(r.integerValue||r.doubleValue),c=Gt(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1})(i,t);case 3:return op(i.timestampValue,t.timestampValue);case 4:return op(Kr(i),Kr(t));case 5:return oh(i.stringValue,t.stringValue);case 6:return(function(r,o){const a=_i(r),c=_i(o);return a.compareTo(c)})(i.bytesValue,t.bytesValue);case 7:return(function(r,o){const a=r.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){const h=gt(a[l],c[l]);if(h!==0)return h}return gt(a.length,c.length)})(i.referenceValue,t.referenceValue);case 8:return(function(r,o){const a=gt(Gt(r.latitude),Gt(o.latitude));return a!==0?a:gt(Gt(r.longitude),Gt(o.longitude))})(i.geoPointValue,t.geoPointValue);case 9:return ap(i.arrayValue,t.arrayValue);case 10:return(function(r,o){const a=r.fields||{},c=o.fields||{},l=a[ja]?.arrayValue,h=c[ja]?.arrayValue,u=gt(l?.values?.length||0,h?.values?.length||0);return u!==0?u:ap(l,h)})(i.mapValue,t.mapValue);case 11:return(function(r,o){if(r===Jo.mapValue&&o===Jo.mapValue)return 0;if(r===Jo.mapValue)return 1;if(o===Jo.mapValue)return-1;const a=r.fields||{},c=Object.keys(a),l=o.fields||{},h=Object.keys(l);c.sort(),h.sort();for(let u=0;u<c.length&&u<h.length;++u){const p=oh(c[u],h[u]);if(p!==0)return p;const g=$n(a[c[u]],l[h[u]]);if(g!==0)return g}return gt(c.length,h.length)})(i.mapValue,t.mapValue);default:throw et(23264,{he:e})}}function op(i,t){if(typeof i=="string"&&typeof t=="string"&&i.length===t.length)return gt(i,t);const e=mi(i),s=mi(t),n=gt(e.seconds,s.seconds);return n!==0?n:gt(e.nanos,s.nanos)}function ap(i,t){const e=i.values||[],s=t.values||[];for(let n=0;n<e.length&&n<s.length;++n){const r=$n(e[n],s[n]);if(r)return r}return gt(e.length,s.length)}function zn(i){return ah(i)}function ah(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(function(e){const s=mi(e);return`time(${s.seconds},${s.nanos})`})(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?(function(e){return _i(e).toBase64()})(i.bytesValue):"referenceValue"in i?(function(e){return Q.fromName(e).toString()})(i.referenceValue):"geoPointValue"in i?(function(e){return`geo(${e.latitude},${e.longitude})`})(i.geoPointValue):"arrayValue"in i?(function(e){let s="[",n=!0;for(const r of e.values||[])n?n=!1:s+=",",s+=ah(r);return s+"]"})(i.arrayValue):"mapValue"in i?(function(e){const s=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const o of s)r?r=!1:n+=",",n+=`${o}:${ah(e.fields[o])}`;return n+"}"})(i.mapValue):et(61005,{value:i})}function ba(i){switch(yi(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=pc(i);return t?16+ba(t):16;case 5:return 2*i.stringValue.length;case 6:return _i(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((n,r)=>n+ba(r)),0)})(i.arrayValue);case 10:case 11:return(function(s){let n=0;return Pi(s.fields,((r,o)=>{n+=r.length+ba(o)})),n})(i.mapValue);default:throw et(13486,{value:i})}}function cp(i,t){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${t.path.canonicalString()}`}}function ch(i){return!!i&&"integerValue"in i}function gu(i){return!!i&&"arrayValue"in i}function lp(i){return!!i&&"nullValue"in i}function hp(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function wa(i){return!!i&&"mapValue"in i}function wT(i){return(i?.mapValue?.fields||{})[x_]?.stringValue===k_}function Fr(i){if(i.geoPointValue)return{geoPointValue:{...i.geoPointValue}};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:{...i.timestampValue}};if(i.mapValue){const t={mapValue:{fields:{}}};return Pi(i.mapValue.fields,((e,s)=>t.mapValue.fields[e]=Fr(s))),t}if(i.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(i.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Fr(i.arrayValue.values[e]);return t}return{...i}}function AT(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===bT}class Oe{constructor(t){this.value=t}static empty(){return new Oe({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let s=0;s<t.length-1;++s)if(e=(e.mapValue.fields||{})[t.get(s)],!wa(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Fr(e)}setAll(t){let e=pe.emptyPath(),s={},n=[];t.forEach(((o,a)=>{if(!e.isImmediateParentOf(a)){const c=this.getFieldsMap(e);this.applyChanges(c,s,n),s={},n=[],e=a.popLast()}o?s[a.lastSegment()]=Fr(o):n.push(a.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,s,n)}delete(t){const e=this.field(t.popLast());wa(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Is(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let s=0;s<t.length;++s){let n=e.mapValue.fields[t.get(s)];wa(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},e.mapValue.fields[t.get(s)]=n),e=n}return e.mapValue.fields}applyChanges(t,e,s){Pi(e,((n,r)=>t[n]=r));for(const n of s)delete t[n]}clone(){return new Oe(Fr(this.value))}}function D_(i){const t=[];return Pi(i.fields,((e,s)=>{const n=new pe([e]);if(wa(s)){const r=D_(s.mapValue).fields;if(r.length===0)t.push(n);else for(const o of r)t.push(n.child(o))}else t.push(n)})),new je(t)}class be{constructor(t,e,s,n,r,o,a){this.key=t,this.documentType=e,this.version=s,this.readTime=n,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(t){return new be(t,0,st.min(),st.min(),st.min(),Oe.empty(),0)}static newFoundDocument(t,e,s,n){return new be(t,1,e,st.min(),s,n,0)}static newNoDocument(t,e){return new be(t,2,e,st.min(),st.min(),Oe.empty(),0)}static newUnknownDocument(t,e){return new be(t,3,e,st.min(),st.min(),Oe.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(st.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=st.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof be&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new be(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ha{constructor(t,e){this.position=t,this.inclusive=e}}function up(i,t,e){let s=0;for(let n=0;n<i.position.length;n++){const r=t[n],o=i.position[n];if(r.field.isKeyField()?s=Q.comparator(Q.fromName(o.referenceValue),e.key):s=$n(o,e.data.field(r.field)),r.dir==="desc"&&(s*=-1),s!==0)break}return s}function dp(i,t){if(i===null)return t===null;if(t===null||i.inclusive!==t.inclusive||i.position.length!==t.position.length)return!1;for(let e=0;e<i.position.length;e++)if(!Is(i.position[e],t.position[e]))return!1;return!0}class Qr{constructor(t,e="asc"){this.field=t,this.dir=e}}function ET(i,t){return i.dir===t.dir&&i.field.isEqual(t.field)}class M_{}class Zt extends M_{constructor(t,e,s){super(),this.field=t,this.op=e,this.value=s}static create(t,e,s){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,s):new ST(t,e,s):e==="array-contains"?new PT(t,s):e==="in"?new RT(t,s):e==="not-in"?new xT(t,s):e==="array-contains-any"?new kT(t,s):new Zt(t,e,s)}static createKeyFieldInFilter(t,e,s){return e==="in"?new IT(t,s):new CT(t,s)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison($n(e,this.value)):e!==null&&yi(this.value)===yi(e)&&this.matchesComparison($n(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return et(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ls extends M_{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new ls(t,e)}matches(t){return N_(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function N_(i){return i.op==="and"}function L_(i){return TT(i)&&N_(i)}function TT(i){for(const t of i.filters)if(t instanceof ls)return!1;return!0}function lh(i){if(i instanceof Zt)return i.field.canonicalString()+i.op.toString()+zn(i.value);if(L_(i))return i.filters.map((t=>lh(t))).join(",");{const t=i.filters.map((e=>lh(e))).join(",");return`${i.op}(${t})`}}function O_(i,t){return i instanceof Zt?(function(s,n){return n instanceof Zt&&s.op===n.op&&s.field.isEqual(n.field)&&Is(s.value,n.value)})(i,t):i instanceof ls?(function(s,n){return n instanceof ls&&s.op===n.op&&s.filters.length===n.filters.length?s.filters.reduce(((r,o,a)=>r&&O_(o,n.filters[a])),!0):!1})(i,t):void et(19439)}function F_(i){return i instanceof Zt?(function(e){return`${e.field.canonicalString()} ${e.op} ${zn(e.value)}`})(i):i instanceof ls?(function(e){return e.op.toString()+" {"+e.getFilters().map(F_).join(" ,")+"}"})(i):"Filter"}class ST extends Zt{constructor(t,e,s){super(t,e,s),this.key=Q.fromName(s.referenceValue)}matches(t){const e=Q.comparator(t.key,this.key);return this.matchesComparison(e)}}class IT extends Zt{constructor(t,e){super(t,"in",e),this.keys=V_("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class CT extends Zt{constructor(t,e){super(t,"not-in",e),this.keys=V_("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function V_(i,t){return(t.arrayValue?.values||[]).map((e=>Q.fromName(e.referenceValue)))}class PT extends Zt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return gu(e)&&Yr(e.arrayValue,this.value)}}class RT extends Zt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Yr(this.value.arrayValue,e)}}class xT extends Zt{constructor(t,e){super(t,"not-in",e)}matches(t){if(Yr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Yr(this.value.arrayValue,e)}}class kT extends Zt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!gu(e)||!e.arrayValue.values)&&e.arrayValue.values.some((s=>Yr(this.value.arrayValue,s)))}}class DT{constructor(t,e=null,s=[],n=[],r=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=s,this.filters=n,this.limit=r,this.startAt=o,this.endAt=a,this.Te=null}}function fp(i,t=null,e=[],s=[],n=null,r=null,o=null){return new DT(i,t,e,s,n,r,o)}function mu(i){const t=rt(i);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((s=>lh(s))).join(","),e+="|ob:",e+=t.orderBy.map((s=>(function(r){return r.field.canonicalString()+r.dir})(s))).join(","),fc(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((s=>zn(s))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((s=>zn(s))).join(",")),t.Te=e}return t.Te}function _u(i,t){if(i.limit!==t.limit||i.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<i.orderBy.length;e++)if(!ET(i.orderBy[e],t.orderBy[e]))return!1;if(i.filters.length!==t.filters.length)return!1;for(let e=0;e<i.filters.length;e++)if(!O_(i.filters[e],t.filters[e]))return!1;return i.collectionGroup===t.collectionGroup&&!!i.path.isEqual(t.path)&&!!dp(i.startAt,t.startAt)&&dp(i.endAt,t.endAt)}function hh(i){return Q.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}class Jn{constructor(t,e=null,s=[],n=[],r=null,o="F",a=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=s,this.filters=n,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function MT(i,t,e,s,n,r,o,a){return new Jn(i,t,e,s,n,r,o,a)}function yu(i){return new Jn(i)}function pp(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function B_(i){return i.collectionGroup!==null}function Vr(i){const t=rt(i);if(t.Ie===null){t.Ie=[];const e=new Set;for(const r of t.explicitOrderBy)t.Ie.push(r),e.add(r.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ne(pe.comparator);return o.filters.forEach((c=>{c.getFlattenedFilters().forEach((l=>{l.isInequality()&&(a=a.add(l.field))}))})),a})(t).forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new Qr(r,s))})),e.has(pe.keyField().canonicalString())||t.Ie.push(new Qr(pe.keyField(),s))}return t.Ie}function As(i){const t=rt(i);return t.Ee||(t.Ee=NT(t,Vr(i))),t.Ee}function NT(i,t){if(i.limitType==="F")return fp(i.path,i.collectionGroup,t,i.filters,i.limit,i.startAt,i.endAt);{t=t.map((n=>{const r=n.dir==="desc"?"asc":"desc";return new Qr(n.field,r)}));const e=i.endAt?new Ha(i.endAt.position,i.endAt.inclusive):null,s=i.startAt?new Ha(i.startAt.position,i.startAt.inclusive):null;return fp(i.path,i.collectionGroup,t,i.filters,i.limit,e,s)}}function uh(i,t){const e=i.filters.concat([t]);return new Jn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),e,i.limit,i.limitType,i.startAt,i.endAt)}function dh(i,t,e){return new Jn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),t,e,i.startAt,i.endAt)}function gc(i,t){return _u(As(i),As(t))&&i.limitType===t.limitType}function U_(i){return`${mu(As(i))}|lt:${i.limitType}`}function yn(i){return`Query(target=${(function(e){let s=e.path.canonicalString();return e.collectionGroup!==null&&(s+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(s+=`, filters: [${e.filters.map((n=>F_(n))).join(", ")}]`),fc(e.limit)||(s+=", limit: "+e.limit),e.orderBy.length>0&&(s+=`, orderBy: [${e.orderBy.map((n=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(n))).join(", ")}]`),e.startAt&&(s+=", startAt: ",s+=e.startAt.inclusive?"b:":"a:",s+=e.startAt.position.map((n=>zn(n))).join(",")),e.endAt&&(s+=", endAt: ",s+=e.endAt.inclusive?"a:":"b:",s+=e.endAt.position.map((n=>zn(n))).join(",")),`Target(${s})`})(As(i))}; limitType=${i.limitType})`}function mc(i,t){return t.isFoundDocument()&&(function(s,n){const r=n.key.path;return s.collectionGroup!==null?n.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(r):Q.isDocumentKey(s.path)?s.path.isEqual(r):s.path.isImmediateParentOf(r)})(i,t)&&(function(s,n){for(const r of Vr(s))if(!r.field.isKeyField()&&n.data.field(r.field)===null)return!1;return!0})(i,t)&&(function(s,n){for(const r of s.filters)if(!r.matches(n))return!1;return!0})(i,t)&&(function(s,n){return!(s.startAt&&!(function(o,a,c){const l=up(o,a,c);return o.inclusive?l<=0:l<0})(s.startAt,Vr(s),n)||s.endAt&&!(function(o,a,c){const l=up(o,a,c);return o.inclusive?l>=0:l>0})(s.endAt,Vr(s),n))})(i,t)}function LT(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function $_(i){return(t,e)=>{let s=!1;for(const n of Vr(i)){const r=OT(n,t,e);if(r!==0)return r;s=s||n.field.isKeyField()}return 0}}function OT(i,t,e){const s=i.field.isKeyField()?Q.comparator(t.key,e.key):(function(r,o,a){const c=o.data.field(r),l=a.data.field(r);return c!==null&&l!==null?$n(c,l):et(42886)})(i.field,t,e);switch(i.dir){case"asc":return s;case"desc":return-1*s;default:return et(19790,{direction:i.dir})}}class nn{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),s=this.inner[e];if(s!==void 0){for(const[n,r]of s)if(this.equalsFn(n,t))return r}}has(t){return this.get(t)!==void 0}set(t,e){const s=this.mapKeyFn(t),n=this.inner[s];if(n===void 0)return this.inner[s]=[[t,e]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return void(n[r]=[t,e]);n.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),s=this.inner[e];if(s===void 0)return!1;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return s.length===1?delete this.inner[e]:s.splice(n,1),this.innerSize--,!0;return!1}forEach(t){Pi(this.inner,((e,s)=>{for(const[n,r]of s)t(n,r)}))}isEmpty(){return T_(this.inner)}size(){return this.innerSize}}const FT=new Ut(Q.comparator);function Gs(){return FT}const z_=new Ut(Q.comparator);function Cr(...i){let t=z_;for(const e of i)t=t.insert(e.key,e);return t}function j_(i){let t=z_;return i.forEach(((e,s)=>t=t.insert(e,s.overlayedDocument))),t}function Vi(){return Br()}function H_(){return Br()}function Br(){return new nn((i=>i.toString()),((i,t)=>i.isEqual(t)))}const VT=new Ut(Q.comparator),BT=new ne(Q.comparator);function mt(...i){let t=BT;for(const e of i)t=t.add(e);return t}const UT=new ne(gt);function $T(){return UT}function vu(i,t){if(i.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$a(t)?"-0":t}}function q_(i){return{integerValue:""+i}}function zT(i,t){return gT(t)?q_(t):vu(i,t)}class _c{constructor(){this._=void 0}}function jT(i,t,e){return i instanceof Jr?(function(n,r){const o={fields:{[C_]:{stringValue:I_},[R_]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return r&&pu(r)&&(r=pc(r)),r&&(o.fields[P_]=r),{mapValue:o}})(e,t):i instanceof Zr?W_(i,t):i instanceof to?K_(i,t):(function(n,r){const o=G_(n,r),a=gp(o)+gp(n.Ae);return ch(o)&&ch(n.Ae)?q_(a):vu(n.serializer,a)})(i,t)}function HT(i,t,e){return i instanceof Zr?W_(i,t):i instanceof to?K_(i,t):e}function G_(i,t){return i instanceof qa?(function(s){return ch(s)||(function(r){return!!r&&"doubleValue"in r})(s)})(t)?t:{integerValue:0}:null}class Jr extends _c{}class Zr extends _c{constructor(t){super(),this.elements=t}}function W_(i,t){const e=X_(t);for(const s of i.elements)e.some((n=>Is(n,s)))||e.push(s);return{arrayValue:{values:e}}}class to extends _c{constructor(t){super(),this.elements=t}}function K_(i,t){let e=X_(t);for(const s of i.elements)e=e.filter((n=>!Is(n,s)));return{arrayValue:{values:e}}}class qa extends _c{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function gp(i){return Gt(i.integerValue||i.doubleValue)}function X_(i){return gu(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}class qT{constructor(t,e){this.field=t,this.transform=e}}function GT(i,t){return i.field.isEqual(t.field)&&(function(s,n){return s instanceof Zr&&n instanceof Zr||s instanceof to&&n instanceof to?Un(s.elements,n.elements,Is):s instanceof qa&&n instanceof qa?Is(s.Ae,n.Ae):s instanceof Jr&&n instanceof Jr})(i.transform,t.transform)}class WT{constructor(t,e){this.version=t,this.transformResults=e}}class Qe{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Qe}static exists(t){return new Qe(void 0,t)}static updateTime(t){return new Qe(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Aa(i,t){return i.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(i.updateTime):i.exists===void 0||i.exists===t.isFoundDocument()}class yc{}function Y_(i,t){if(!i.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return i.isNoDocument()?new bu(i.key,Qe.none()):new wo(i.key,i.data,Qe.none());{const e=i.data,s=Oe.empty();let n=new ne(pe.comparator);for(let r of t.fields)if(!n.has(r)){let o=e.field(r);o===null&&r.length>1&&(r=r.popLast(),o=e.field(r)),o===null?s.delete(r):s.set(r,o),n=n.add(r)}return new Ri(i.key,s,new je(n.toArray()),Qe.none())}}function KT(i,t,e){i instanceof wo?(function(n,r,o){const a=n.value.clone(),c=_p(n.fieldTransforms,r,o.transformResults);a.setAll(c),r.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(i,t,e):i instanceof Ri?(function(n,r,o){if(!Aa(n.precondition,r))return void r.convertToUnknownDocument(o.version);const a=_p(n.fieldTransforms,r,o.transformResults),c=r.data;c.setAll(Q_(n)),c.setAll(a),r.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(i,t,e):(function(n,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()})(0,t,e)}function Ur(i,t,e,s){return i instanceof wo?(function(r,o,a,c){if(!Aa(r.precondition,o))return a;const l=r.value.clone(),h=yp(r.fieldTransforms,c,o);return l.setAll(h),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null})(i,t,e,s):i instanceof Ri?(function(r,o,a,c){if(!Aa(r.precondition,o))return a;const l=yp(r.fieldTransforms,c,o),h=o.data;return h.setAll(Q_(r)),h.setAll(l),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map((u=>u.field)))})(i,t,e,s):(function(r,o,a){return Aa(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(i,t,e)}function XT(i,t){let e=null;for(const s of i.fieldTransforms){const n=t.data.field(s.field),r=G_(s.transform,n||null);r!=null&&(e===null&&(e=Oe.empty()),e.set(s.field,r))}return e||null}function mp(i,t){return i.type===t.type&&!!i.key.isEqual(t.key)&&!!i.precondition.isEqual(t.precondition)&&!!(function(s,n){return s===void 0&&n===void 0||!(!s||!n)&&Un(s,n,((r,o)=>GT(r,o)))})(i.fieldTransforms,t.fieldTransforms)&&(i.type===0?i.value.isEqual(t.value):i.type!==1||i.data.isEqual(t.data)&&i.fieldMask.isEqual(t.fieldMask))}class wo extends yc{constructor(t,e,s,n=[]){super(),this.key=t,this.value=e,this.precondition=s,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Ri extends yc{constructor(t,e,s,n,r=[]){super(),this.key=t,this.data=e,this.fieldMask=s,this.precondition=n,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Q_(i){const t=new Map;return i.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const s=i.data.field(e);t.set(e,s)}})),t}function _p(i,t,e){const s=new Map;Tt(i.length===e.length,32656,{Re:e.length,Ve:i.length});for(let n=0;n<e.length;n++){const r=i[n],o=r.transform,a=t.data.field(r.field);s.set(r.field,HT(o,a,e[n]))}return s}function yp(i,t,e){const s=new Map;for(const n of i){const r=n.transform,o=e.data.field(n.field);s.set(n.field,jT(r,o,t))}return s}class bu extends yc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class YT extends yc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class QT{constructor(t,e,s,n){this.batchId=t,this.localWriteTime=e,this.baseMutations=s,this.mutations=n}applyToRemoteDocument(t,e){const s=e.mutationResults;for(let n=0;n<this.mutations.length;n++){const r=this.mutations[n];r.key.isEqual(t.key)&&KT(r,t,s[n])}}applyToLocalView(t,e){for(const s of this.baseMutations)s.key.isEqual(t.key)&&(e=Ur(s,t,e,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(t.key)&&(e=Ur(s,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const s=H_();return this.mutations.forEach((n=>{const r=t.get(n.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=e.has(n.key)?null:a;const c=Y_(o,a);c!==null&&s.set(n.key,c),o.isValidDocument()||o.convertToNoDocument(st.min())})),s}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),mt())}isEqual(t){return this.batchId===t.batchId&&Un(this.mutations,t.mutations,((e,s)=>mp(e,s)))&&Un(this.baseMutations,t.baseMutations,((e,s)=>mp(e,s)))}}class wu{constructor(t,e,s,n){this.batch=t,this.commitVersion=e,this.mutationResults=s,this.docVersions=n}static from(t,e,s){Tt(t.mutations.length===s.length,58842,{me:t.mutations.length,fe:s.length});let n=(function(){return VT})();const r=t.mutations;for(let o=0;o<r.length;o++)n=n.insert(r[o].key,s[o].version);return new wu(t,e,s,n)}}class JT{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ZT{constructor(t,e){this.count=t,this.unchangedNames=e}}var Jt,vt;function tS(i){switch(i){case V.OK:return et(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return et(15467,{code:i})}}function J_(i){if(i===void 0)return qs("GRPC error has no .code"),V.UNKNOWN;switch(i){case Jt.OK:return V.OK;case Jt.CANCELLED:return V.CANCELLED;case Jt.UNKNOWN:return V.UNKNOWN;case Jt.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Jt.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Jt.INTERNAL:return V.INTERNAL;case Jt.UNAVAILABLE:return V.UNAVAILABLE;case Jt.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Jt.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Jt.NOT_FOUND:return V.NOT_FOUND;case Jt.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Jt.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Jt.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Jt.ABORTED:return V.ABORTED;case Jt.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Jt.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Jt.DATA_LOSS:return V.DATA_LOSS;default:return et(39323,{code:i})}}(vt=Jt||(Jt={}))[vt.OK=0]="OK",vt[vt.CANCELLED=1]="CANCELLED",vt[vt.UNKNOWN=2]="UNKNOWN",vt[vt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vt[vt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vt[vt.NOT_FOUND=5]="NOT_FOUND",vt[vt.ALREADY_EXISTS=6]="ALREADY_EXISTS",vt[vt.PERMISSION_DENIED=7]="PERMISSION_DENIED",vt[vt.UNAUTHENTICATED=16]="UNAUTHENTICATED",vt[vt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vt[vt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vt[vt.ABORTED=10]="ABORTED",vt[vt.OUT_OF_RANGE=11]="OUT_OF_RANGE",vt[vt.UNIMPLEMENTED=12]="UNIMPLEMENTED",vt[vt.INTERNAL=13]="INTERNAL",vt[vt.UNAVAILABLE=14]="UNAVAILABLE",vt[vt.DATA_LOSS=15]="DATA_LOSS";function eS(){return new TextEncoder}const sS=new ui([4294967295,4294967295],0);function vp(i){const t=eS().encode(i),e=new f_;return e.update(t),new Uint8Array(e.digest())}function bp(i){const t=new DataView(i.buffer),e=t.getUint32(0,!0),s=t.getUint32(4,!0),n=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new ui([e,s],0),new ui([n,r],0)]}class Au{constructor(t,e,s){if(this.bitmap=t,this.padding=e,this.hashCount=s,e<0||e>=8)throw new Pr(`Invalid padding: ${e}`);if(s<0)throw new Pr(`Invalid hash count: ${s}`);if(t.length>0&&this.hashCount===0)throw new Pr(`Invalid hash count: ${s}`);if(t.length===0&&e!==0)throw new Pr(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=ui.fromNumber(this.ge)}ye(t,e,s){let n=t.add(e.multiply(ui.fromNumber(s)));return n.compare(sS)===1&&(n=new ui([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=vp(t),[s,n]=bp(e);for(let r=0;r<this.hashCount;r++){const o=this.ye(s,n,r);if(!this.we(o))return!1}return!0}static create(t,e,s){const n=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),o=new Au(r,n,e);return s.forEach((a=>o.insert(a))),o}insert(t){if(this.ge===0)return;const e=vp(t),[s,n]=bp(e);for(let r=0;r<this.hashCount;r++){const o=this.ye(s,n,r);this.Se(o)}}Se(t){const e=Math.floor(t/8),s=t%8;this.bitmap[e]|=1<<s}}class Pr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class vc{constructor(t,e,s,n,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=s,this.documentUpdates=n,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,s){const n=new Map;return n.set(t,Ao.createSynthesizedTargetChangeForCurrentChange(t,e,s)),new vc(st.min(),n,new Ut(gt),Gs(),mt())}}class Ao{constructor(t,e,s,n,r){this.resumeToken=t,this.current=e,this.addedDocuments=s,this.modifiedDocuments=n,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,s){return new Ao(s,e,mt(),mt(),mt())}}class Ea{constructor(t,e,s,n){this.be=t,this.removedTargetIds=e,this.key=s,this.De=n}}class Z_{constructor(t,e){this.targetId=t,this.Ce=e}}class ty{constructor(t,e,s=me.EMPTY_BYTE_STRING,n=null){this.state=t,this.targetIds=e,this.resumeToken=s,this.cause=n}}class wp{constructor(){this.ve=0,this.Fe=Ap(),this.Me=me.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=mt(),e=mt(),s=mt();return this.Fe.forEach(((n,r)=>{switch(r){case 0:t=t.add(n);break;case 2:e=e.add(n);break;case 1:s=s.add(n);break;default:et(38017,{changeType:r})}})),new Ao(this.Me,this.xe,t,e,s)}qe(){this.Oe=!1,this.Fe=Ap()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,Tt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class iS{constructor(t){this.Ge=t,this.ze=new Map,this.je=Gs(),this.Je=Zo(),this.He=Zo(),this.Ye=new Ut(gt)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const s=this.nt(e);switch(t.state){case 0:this.rt(e)&&s.Le(t.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(t.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(s.We(),s.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),s.Le(t.resumeToken));break;default:et(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((s,n)=>{this.rt(n)&&e(n)}))}st(t){const e=t.targetId,s=t.Ce.count,n=this.ot(e);if(n){const r=n.target;if(hh(r))if(s===0){const o=new Q(r.path);this.et(e,o,be.newNoDocument(o,st.min()))}else Tt(s===1,20013,{expectedCount:s});else{const o=this._t(e);if(o!==s){const a=this.ut(t),c=a?this.ct(a,t,o):1;if(c!==0){this.it(e);const l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,l)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:s="",padding:n=0},hashCount:r=0}=e;let o,a;try{o=_i(s).toUint8Array()}catch(c){if(c instanceof S_)return Bn("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Au(o,n,r)}catch(c){return Bn(c instanceof Pr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.ge===0?null:a}ct(t,e,s){return e.Ce.count===s-this.Pt(t,e.targetId)?0:2}Pt(t,e){const s=this.Ge.getRemoteKeysForTarget(e);let n=0;return s.forEach((r=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;t.mightContain(a)||(this.et(e,r,null),n++)})),n}Tt(t){const e=new Map;this.ze.forEach(((r,o)=>{const a=this.ot(o);if(a){if(r.current&&hh(a.target)){const c=new Q(a.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,be.newNoDocument(c,t))}r.Be&&(e.set(o,r.ke()),r.qe())}}));let s=mt();this.He.forEach(((r,o)=>{let a=!0;o.forEachWhile((c=>{const l=this.ot(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(s=s.add(r))})),this.je.forEach(((r,o)=>o.setReadTime(t)));const n=new vc(t,e,this.Ye,this.je,s);return this.je=Gs(),this.Je=Zo(),this.He=Zo(),this.Ye=new Ut(gt),n}Xe(t,e){if(!this.rt(t))return;const s=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,s),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,s){if(!this.rt(t))return;const n=this.nt(t);this.Et(t,e)?n.Qe(e,1):n.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),s&&(this.je=this.je.insert(e,s))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new wp,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new ne(gt),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new ne(gt),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||q("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new wp),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Zo(){return new Ut(Q.comparator)}function Ap(){return new Ut(Q.comparator)}const nS={asc:"ASCENDING",desc:"DESCENDING"},rS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oS={and:"AND",or:"OR"};class aS{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function fh(i,t){return i.useProto3Json||fc(t)?t:{value:t}}function Ga(i,t){return i.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ey(i,t){return i.useProto3Json?t.toBase64():t.toUint8Array()}function cS(i,t){return Ga(i,t.toTimestamp())}function Es(i){return Tt(!!i,49232),st.fromTimestamp((function(e){const s=mi(e);return new ct(s.seconds,s.nanos)})(i))}function Eu(i,t){return ph(i,t).canonicalString()}function ph(i,t){const e=(function(n){return new Rt(["projects",n.projectId,"databases",n.database])})(i).child("documents");return t===void 0?e:e.child(t)}function sy(i){const t=Rt.fromString(i);return Tt(ay(t),10190,{key:t.toString()}),t}function gh(i,t){return Eu(i.databaseId,t.path)}function yl(i,t){const e=sy(t);if(e.get(1)!==i.databaseId.projectId)throw new j(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+i.databaseId.projectId);if(e.get(3)!==i.databaseId.database)throw new j(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+i.databaseId.database);return new Q(ny(e))}function iy(i,t){return Eu(i.databaseId,t)}function lS(i){const t=sy(i);return t.length===4?Rt.emptyPath():ny(t)}function mh(i){return new Rt(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function ny(i){return Tt(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)}function Ep(i,t,e){return{name:gh(i,t),fields:e.value.mapValue.fields}}function hS(i,t){let e;if("targetChange"in t){t.targetChange;const s=(function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:et(39313,{state:l})})(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],r=(function(l,h){return l.useProto3Json?(Tt(h===void 0||typeof h=="string",58123),me.fromBase64String(h||"")):(Tt(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),me.fromUint8Array(h||new Uint8Array))})(i,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&(function(l){const h=l.code===void 0?V.UNKNOWN:J_(l.code);return new j(h,l.message||"")})(o);e=new ty(s,n,r,a||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const n=yl(i,s.document.name),r=Es(s.document.updateTime),o=s.document.createTime?Es(s.document.createTime):st.min(),a=new Oe({mapValue:{fields:s.document.fields}}),c=be.newFoundDocument(n,r,o,a),l=s.targetIds||[],h=s.removedTargetIds||[];e=new Ea(l,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const n=yl(i,s.document),r=s.readTime?Es(s.readTime):st.min(),o=be.newNoDocument(n,r),a=s.removedTargetIds||[];e=new Ea([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const n=yl(i,s.document),r=s.removedTargetIds||[];e=new Ea([],r,n,null)}else{if(!("filter"in t))return et(11601,{Rt:t});{t.filter;const s=t.filter;s.targetId;const{count:n=0,unchangedNames:r}=s,o=new ZT(n,r),a=s.targetId;e=new Z_(a,o)}}return e}function uS(i,t){let e;if(t instanceof wo)e={update:Ep(i,t.key,t.value)};else if(t instanceof bu)e={delete:gh(i,t.key)};else if(t instanceof Ri)e={update:Ep(i,t.key,t.data),updateMask:bS(t.fieldMask)};else{if(!(t instanceof YT))return et(16599,{Vt:t.type});e={verify:gh(i,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((s=>(function(r,o){const a=o.transform;if(a instanceof Jr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Zr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof to)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof qa)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw et(20930,{transform:o.transform})})(0,s)))),t.precondition.isNone||(e.currentDocument=(function(n,r){return r.updateTime!==void 0?{updateTime:cS(n,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:et(27497)})(i,t.precondition)),e}function dS(i,t){return i&&i.length>0?(Tt(t!==void 0,14353),i.map((e=>(function(n,r){let o=n.updateTime?Es(n.updateTime):Es(r);return o.isEqual(st.min())&&(o=Es(r)),new WT(o,n.transformResults||[])})(e,t)))):[]}function fS(i,t){return{documents:[iy(i,t.path)]}}function pS(i,t){const e={structuredQuery:{}},s=t.path;let n;t.collectionGroup!==null?(n=s,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=s.popLast(),e.structuredQuery.from=[{collectionId:s.lastSegment()}]),e.parent=iy(i,n);const r=(function(l){if(l.length!==0)return oy(ls.create(l,"and"))})(t.filters);r&&(e.structuredQuery.where=r);const o=(function(l){if(l.length!==0)return l.map((h=>(function(p){return{field:vn(p.field),direction:_S(p.dir)}})(h)))})(t.orderBy);o&&(e.structuredQuery.orderBy=o);const a=fh(i,t.limit);return a!==null&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt=(function(l){return{before:l.inclusive,values:l.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(l){return{before:!l.inclusive,values:l.position}})(t.endAt)),{ft:e,parent:n}}function gS(i){let t=lS(i.parent);const e=i.structuredQuery,s=e.from?e.from.length:0;let n=null;if(s>0){Tt(s===1,65062);const h=e.from[0];h.allDescendants?n=h.collectionId:t=t.child(h.collectionId)}let r=[];e.where&&(r=(function(u){const p=ry(u);return p instanceof ls&&L_(p)?p.getFilters():[p]})(e.where));let o=[];e.orderBy&&(o=(function(u){return u.map((p=>(function(y){return new Qr(bn(y.field),(function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(y.direction))})(p)))})(e.orderBy));let a=null;e.limit&&(a=(function(u){let p;return p=typeof u=="object"?u.value:u,fc(p)?null:p})(e.limit));let c=null;e.startAt&&(c=(function(u){const p=!!u.before,g=u.values||[];return new Ha(g,p)})(e.startAt));let l=null;return e.endAt&&(l=(function(u){const p=!u.before,g=u.values||[];return new Ha(g,p)})(e.endAt)),MT(t,n,o,r,a,"F",c,l)}function mS(i,t){const e=(function(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return et(28987,{purpose:n})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function ry(i){return i.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const s=bn(e.unaryFilter.field);return Zt.create(s,"==",{doubleValue:NaN});case"IS_NULL":const n=bn(e.unaryFilter.field);return Zt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=bn(e.unaryFilter.field);return Zt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=bn(e.unaryFilter.field);return Zt.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return et(61313);default:return et(60726)}})(i):i.fieldFilter!==void 0?(function(e){return Zt.create(bn(e.fieldFilter.field),(function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return et(58110);default:return et(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(i):i.compositeFilter!==void 0?(function(e){return ls.create(e.compositeFilter.filters.map((s=>ry(s))),(function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return et(1026)}})(e.compositeFilter.op))})(i):et(30097,{filter:i})}function _S(i){return nS[i]}function yS(i){return rS[i]}function vS(i){return oS[i]}function vn(i){return{fieldPath:i.canonicalString()}}function bn(i){return pe.fromServerFormat(i.fieldPath)}function oy(i){return i instanceof Zt?(function(e){if(e.op==="=="){if(hp(e.value))return{unaryFilter:{field:vn(e.field),op:"IS_NAN"}};if(lp(e.value))return{unaryFilter:{field:vn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(hp(e.value))return{unaryFilter:{field:vn(e.field),op:"IS_NOT_NAN"}};if(lp(e.value))return{unaryFilter:{field:vn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vn(e.field),op:yS(e.op),value:e.value}}})(i):i instanceof ls?(function(e){const s=e.getFilters().map((n=>oy(n)));return s.length===1?s[0]:{compositeFilter:{op:vS(e.op),filters:s}}})(i):et(54877,{filter:i})}function bS(i){const t=[];return i.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function ay(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}class ci{constructor(t,e,s,n,r=st.min(),o=st.min(),a=me.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=s,this.sequenceNumber=n,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(t){return new ci(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new ci(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ci(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ci(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class wS{constructor(t){this.yt=t}}function AS(i){const t=gS({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?dh(t,t.limit,"L"):t}class ES{constructor(){this.Cn=new TS}addToCollectionParentIndex(t,e){return this.Cn.add(e),B.resolve()}getCollectionParents(t,e){return B.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return B.resolve()}deleteFieldIndex(t,e){return B.resolve()}deleteAllFieldIndexes(t){return B.resolve()}createTargetIndexes(t,e){return B.resolve()}getDocumentsMatchingTarget(t,e){return B.resolve(null)}getIndexType(t,e){return B.resolve(0)}getFieldIndexes(t,e){return B.resolve([])}getNextCollectionGroupToUpdate(t){return B.resolve(null)}getMinOffset(t,e){return B.resolve(gi.min())}getMinOffsetFromCollectionGroup(t,e){return B.resolve(gi.min())}updateCollectionGroup(t,e,s){return B.resolve()}updateIndexEntries(t,e){return B.resolve()}}class TS{constructor(){this.index={}}add(t){const e=t.lastSegment(),s=t.popLast(),n=this.index[e]||new ne(Rt.comparator),r=!n.has(s);return this.index[e]=n.add(s),r}has(t){const e=t.lastSegment(),s=t.popLast(),n=this.index[e];return n&&n.has(s)}getEntries(t){return(this.index[t]||new ne(Rt.comparator)).toArray()}}const Tp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},cy=41943040;class Le{static withCacheSize(t){return new Le(t,Le.DEFAULT_COLLECTION_PERCENTILE,Le.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,s){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=s}}Le.DEFAULT_COLLECTION_PERCENTILE=10,Le.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Le.DEFAULT=new Le(cy,Le.DEFAULT_COLLECTION_PERCENTILE,Le.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Le.DISABLED=new Le(-1,0,0);class jn{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new jn(0)}static cr(){return new jn(-1)}}const Sp="LruGarbageCollector",SS=1048576;function Ip([i,t],[e,s]){const n=gt(i,e);return n===0?gt(t,s):n}class IS{constructor(t){this.Ir=t,this.buffer=new ne(Ip),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const s=this.buffer.last();Ip(e,s)<0&&(this.buffer=this.buffer.delete(s).add(e))}}get maxValue(){return this.buffer.last()[0]}}class CS{constructor(t,e,s){this.garbageCollector=t,this.asyncQueue=e,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){q(Sp,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Qn(e)?q(Sp,"Ignoring IndexedDB error during garbage collection: ",e):await Yn(e)}await this.Vr(3e5)}))}}class PS{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((s=>Math.floor(e/100*s)))}nthSequenceNumber(t,e){if(e===0)return B.resolve(dc.ce);const s=new IS(e);return this.mr.forEachTarget(t,(n=>s.Ar(n.sequenceNumber))).next((()=>this.mr.pr(t,(n=>s.Ar(n))))).next((()=>s.maxValue))}removeTargets(t,e,s){return this.mr.removeTargets(t,e,s)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(q("LruGarbageCollector","Garbage collection skipped; disabled"),B.resolve(Tp)):this.getCacheSize(t).next((s=>s<this.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Tp):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let s,n,r,o,a,c,l;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((u=>(u>this.params.maximumSequenceNumbersToCollect?(q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${u}`),n=this.params.maximumSequenceNumbersToCollect):n=u,o=Date.now(),this.nthSequenceNumber(t,n)))).next((u=>(s=u,a=Date.now(),this.removeTargets(t,s,e)))).next((u=>(r=u,c=Date.now(),this.removeOrphanedDocuments(t,s)))).next((u=>(l=Date.now(),_n()<=pt.DEBUG&&q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${n} in `+(a-o)+`ms
	Removed ${r} targets in `+(c-a)+`ms
	Removed ${u} documents in `+(l-c)+`ms
Total Duration: ${l-h}ms`),B.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:r,documentsRemoved:u}))))}}function RS(i,t){return new PS(i,t)}class xS{constructor(){this.changes=new nn((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,be.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const s=this.changes.get(e);return s!==void 0?B.resolve(s):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class kS{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class DS{constructor(t,e,s,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=s,this.indexManager=n}getDocument(t,e){let s=null;return this.documentOverlayCache.getOverlay(t,e).next((n=>(s=n,this.remoteDocumentCache.getEntry(t,e)))).next((n=>(s!==null&&Ur(s.mutation,n,je.empty(),ct.now()),n)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((s=>this.getLocalViewOfDocuments(t,s,mt()).next((()=>s))))}getLocalViewOfDocuments(t,e,s=mt()){const n=Vi();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,s).next((r=>{let o=Cr();return r.forEach(((a,c)=>{o=o.insert(a,c.overlayedDocument)})),o}))))}getOverlayedDocuments(t,e){const s=Vi();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,mt())))}populateOverlays(t,e,s){const n=[];return s.forEach((r=>{e.has(r)||n.push(r)})),this.documentOverlayCache.getOverlays(t,n).next((r=>{r.forEach(((o,a)=>{e.set(o,a)}))}))}computeViews(t,e,s,n){let r=Gs();const o=Br(),a=(function(){return Br()})();return e.forEach(((c,l)=>{const h=s.get(l.key);n.has(l.key)&&(h===void 0||h.mutation instanceof Ri)?r=r.insert(l.key,l):h!==void 0?(o.set(l.key,h.mutation.getFieldMask()),Ur(h.mutation,l,h.mutation.getFieldMask(),ct.now())):o.set(l.key,je.empty())})),this.recalculateAndSaveOverlays(t,r).next((c=>(c.forEach(((l,h)=>o.set(l,h))),e.forEach(((l,h)=>a.set(l,new kS(h,o.get(l)??null)))),a)))}recalculateAndSaveOverlays(t,e){const s=Br();let n=new Ut(((o,a)=>o-a)),r=mt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((o=>{for(const a of o)a.keys().forEach((c=>{const l=e.get(c);if(l===null)return;let h=s.get(c)||je.empty();h=a.applyToLocalView(l,h),s.set(c,h);const u=(n.get(a.batchId)||mt()).add(c);n=n.insert(a.batchId,u)}))})).next((()=>{const o=[],a=n.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,h=c.value,u=H_();h.forEach((p=>{if(!r.has(p)){const g=Y_(e.get(p),s.get(p));g!==null&&u.set(p,g),r=r.add(p)}})),o.push(this.documentOverlayCache.saveOverlays(t,l,u))}return B.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((s=>this.recalculateAndSaveOverlays(t,s)))}getDocumentsMatchingQuery(t,e,s,n){return(function(o){return Q.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):B_(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,s,n):this.getDocumentsMatchingCollectionQuery(t,e,s,n)}getNextDocuments(t,e,s,n){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,s,n).next((r=>{const o=n-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,s.largestBatchId,n-r.size):B.resolve(Vi());let a=Wr,c=r;return o.next((l=>B.forEach(l,((h,u)=>(a<u.largestBatchId&&(a=u.largestBatchId),r.get(h)?B.resolve():this.remoteDocumentCache.getEntry(t,h).next((p=>{c=c.insert(h,p)}))))).next((()=>this.populateOverlays(t,l,r))).next((()=>this.computeViews(t,c,l,mt()))).next((h=>({batchId:a,changes:j_(h)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Q(e)).next((s=>{let n=Cr();return s.isFoundDocument()&&(n=n.insert(s.key,s)),n}))}getDocumentsMatchingCollectionGroupQuery(t,e,s,n){const r=e.collectionGroup;let o=Cr();return this.indexManager.getCollectionParents(t,r).next((a=>B.forEach(a,(c=>{const l=(function(u,p){return new Jn(p,null,u.explicitOrderBy.slice(),u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)})(e,c.child(r));return this.getDocumentsMatchingCollectionQuery(t,l,s,n).next((h=>{h.forEach(((u,p)=>{o=o.insert(u,p)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(t,e,s,n){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,s.largestBatchId).next((o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,s,r,n)))).next((o=>{r.forEach(((c,l)=>{const h=l.getKey();o.get(h)===null&&(o=o.insert(h,be.newInvalidDocument(h)))}));let a=Cr();return o.forEach(((c,l)=>{const h=r.get(c);h!==void 0&&Ur(h.mutation,l,je.empty(),ct.now()),mc(e,l)&&(a=a.insert(c,l))})),a}))}}class MS{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return B.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(n){return{id:n.id,version:n.version,createTime:Es(n.createTime)}})(e)),B.resolve()}getNamedQuery(t,e){return B.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(n){return{name:n.name,query:AS(n.bundledQuery),readTime:Es(n.readTime)}})(e)),B.resolve()}}class NS{constructor(){this.overlays=new Ut(Q.comparator),this.qr=new Map}getOverlay(t,e){return B.resolve(this.overlays.get(e))}getOverlays(t,e){const s=Vi();return B.forEach(e,(n=>this.getOverlay(t,n).next((r=>{r!==null&&s.set(n,r)})))).next((()=>s))}saveOverlays(t,e,s){return s.forEach(((n,r)=>{this.St(t,e,r)})),B.resolve()}removeOverlaysForBatchId(t,e,s){const n=this.qr.get(s);return n!==void 0&&(n.forEach((r=>this.overlays=this.overlays.remove(r))),this.qr.delete(s)),B.resolve()}getOverlaysForCollection(t,e,s){const n=Vi(),r=e.length+1,o=new Q(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!e.isPrefixOf(l.path))break;l.path.length===r&&c.largestBatchId>s&&n.set(c.getKey(),c)}return B.resolve(n)}getOverlaysForCollectionGroup(t,e,s,n){let r=new Ut(((l,h)=>l-h));const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===e&&l.largestBatchId>s){let h=r.get(l.largestBatchId);h===null&&(h=Vi(),r=r.insert(l.largestBatchId,h)),h.set(l.getKey(),l)}}const a=Vi(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((l,h)=>a.set(l,h))),!(a.size()>=n)););return B.resolve(a)}St(t,e,s){const n=this.overlays.get(s.key);if(n!==null){const o=this.qr.get(n.largestBatchId).delete(s.key);this.qr.set(n.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new JT(e,s));let r=this.qr.get(e);r===void 0&&(r=mt(),this.qr.set(e,r)),this.qr.set(e,r.add(s.key))}}class LS{constructor(){this.sessionToken=me.EMPTY_BYTE_STRING}getSessionToken(t){return B.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,B.resolve()}}class Tu{constructor(){this.Qr=new ne(le.$r),this.Ur=new ne(le.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const s=new le(t,e);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(t,e){t.forEach((s=>this.addReference(s,e)))}removeReference(t,e){this.Gr(new le(t,e))}zr(t,e){t.forEach((s=>this.removeReference(s,e)))}jr(t){const e=new Q(new Rt([])),s=new le(e,t),n=new le(e,t+1),r=[];return this.Ur.forEachInRange([s,n],(o=>{this.Gr(o),r.push(o.key)})),r}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new Q(new Rt([])),s=new le(e,t),n=new le(e,t+1);let r=mt();return this.Ur.forEachInRange([s,n],(o=>{r=r.add(o.key)})),r}containsKey(t){const e=new le(t,0),s=this.Qr.firstAfterOrEqual(e);return s!==null&&t.isEqual(s.key)}}class le{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return Q.comparator(t.key,e.key)||gt(t.Yr,e.Yr)}static Kr(t,e){return gt(t.Yr,e.Yr)||Q.comparator(t.key,e.key)}}class OS{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new ne(le.$r)}checkEmpty(t){return B.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,s,n){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new QT(r,e,s,n);this.mutationQueue.push(o);for(const a of n)this.Zr=this.Zr.add(new le(a.key,r)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return B.resolve(o)}lookupMutationBatch(t,e){return B.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const s=e+1,n=this.ei(s),r=n<0?0:n;return B.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return B.resolve(this.mutationQueue.length===0?fu:this.tr-1)}getAllMutationBatches(t){return B.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const s=new le(e,0),n=new le(e,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([s,n],(o=>{const a=this.Xr(o.Yr);r.push(a)})),B.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let s=new ne(gt);return e.forEach((n=>{const r=new le(n,0),o=new le(n,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([r,o],(a=>{s=s.add(a.Yr)}))})),B.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(t,e){const s=e.path,n=s.length+1;let r=s;Q.isDocumentKey(r)||(r=r.child(""));const o=new le(new Q(r),0);let a=new ne(gt);return this.Zr.forEachWhile((c=>{const l=c.key.path;return!!s.isPrefixOf(l)&&(l.length===n&&(a=a.add(c.Yr)),!0)}),o),B.resolve(this.ti(a))}ti(t){const e=[];return t.forEach((s=>{const n=this.Xr(s);n!==null&&e.push(n)})),e}removeMutationBatch(t,e){Tt(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return B.forEach(e.mutations,(n=>{const r=new le(n.key,e.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,n.key)})).next((()=>{this.Zr=s}))}ir(t){}containsKey(t,e){const s=new le(e,0),n=this.Zr.firstAfterOrEqual(s);return B.resolve(e.isEqual(n&&n.key))}performConsistencyCheck(t){return this.mutationQueue.length,B.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class FS{constructor(t){this.ri=t,this.docs=(function(){return new Ut(Q.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const s=e.key,n=this.docs.get(s),r=n?n.size:0,o=this.ri(e);return this.docs=this.docs.insert(s,{document:e.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const s=this.docs.get(e);return B.resolve(s?s.document.mutableCopy():be.newInvalidDocument(e))}getEntries(t,e){let s=Gs();return e.forEach((n=>{const r=this.docs.get(n);s=s.insert(n,r?r.document.mutableCopy():be.newInvalidDocument(n))})),B.resolve(s)}getDocumentsMatchingQuery(t,e,s,n){let r=Gs();const o=e.path,a=new Q(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:l,value:{document:h}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||uT(hT(h),s)<=0||(n.has(h.key)||mc(e,h))&&(r=r.insert(h.key,h.mutableCopy()))}return B.resolve(r)}getAllFromCollectionGroup(t,e,s,n){et(9500)}ii(t,e){return B.forEach(this.docs,(s=>e(s)))}newChangeBuffer(t){return new VS(this)}getSize(t){return B.resolve(this.size)}}class VS extends xS{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((s,n)=>{n.isValidDocument()?e.push(this.Nr.addEntry(t,n)):this.Nr.removeEntry(s)})),B.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class BS{constructor(t){this.persistence=t,this.si=new nn((e=>mu(e)),_u),this.lastRemoteSnapshotVersion=st.min(),this.highestTargetId=0,this.oi=0,this._i=new Tu,this.targetCount=0,this.ai=jn.ur()}forEachTarget(t,e){return this.si.forEach(((s,n)=>e(n))),B.resolve()}getLastRemoteSnapshotVersion(t){return B.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return B.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),B.resolve(this.highestTargetId)}setTargetsMetadata(t,e,s){return s&&(this.lastRemoteSnapshotVersion=s),e>this.oi&&(this.oi=e),B.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new jn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,B.resolve()}updateTargetData(t,e){return this.Pr(e),B.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,B.resolve()}removeTargets(t,e,s){let n=0;const r=[];return this.si.forEach(((o,a)=>{a.sequenceNumber<=e&&s.get(a.targetId)===null&&(this.si.delete(o),r.push(this.removeMatchingKeysForTargetId(t,a.targetId)),n++)})),B.waitFor(r).next((()=>n))}getTargetCount(t){return B.resolve(this.targetCount)}getTargetData(t,e){const s=this.si.get(e)||null;return B.resolve(s)}addMatchingKeys(t,e,s){return this._i.Wr(e,s),B.resolve()}removeMatchingKeys(t,e,s){this._i.zr(e,s);const n=this.persistence.referenceDelegate,r=[];return n&&e.forEach((o=>{r.push(n.markPotentiallyOrphaned(t,o))})),B.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),B.resolve()}getMatchingKeysForTargetId(t,e){const s=this._i.Hr(e);return B.resolve(s)}containsKey(t,e){return B.resolve(this._i.containsKey(e))}}class ly{constructor(t,e){this.ui={},this.overlays={},this.ci=new dc(0),this.li=!1,this.li=!0,this.hi=new LS,this.referenceDelegate=t(this),this.Pi=new BS(this),this.indexManager=new ES,this.remoteDocumentCache=(function(n){return new FS(n)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new wS(e),this.Ii=new MS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new NS,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let s=this.ui[t.toKey()];return s||(s=new OS(e,this.referenceDelegate),this.ui[t.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,s){q("MemoryPersistence","Starting transaction:",t);const n=new US(this.ci.next());return this.referenceDelegate.Ei(),s(n).next((r=>this.referenceDelegate.di(n).next((()=>r)))).toPromise().then((r=>(n.raiseOnCommittedEvent(),r)))}Ai(t,e){return B.or(Object.values(this.ui).map((s=>()=>s.containsKey(t,e))))}}class US extends fT{constructor(t){super(),this.currentSequenceNumber=t}}class Su{constructor(t){this.persistence=t,this.Ri=new Tu,this.Vi=null}static mi(t){return new Su(t)}get fi(){if(this.Vi)return this.Vi;throw et(60996)}addReference(t,e,s){return this.Ri.addReference(s,e),this.fi.delete(s.toString()),B.resolve()}removeReference(t,e,s){return this.Ri.removeReference(s,e),this.fi.add(s.toString()),B.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),B.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((n=>this.fi.add(n.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(t,e.targetId).next((n=>{n.forEach((r=>this.fi.add(r.toString())))})).next((()=>s.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return B.forEach(this.fi,(s=>{const n=Q.fromPath(s);return this.gi(t,n).next((r=>{r||e.removeEntry(n,st.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((s=>{s?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return B.or([()=>B.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Wa{constructor(t,e){this.persistence=t,this.pi=new nn((s=>mT(s.path)),((s,n)=>s.isEqual(n))),this.garbageCollector=RS(this,e)}static mi(t,e){return new Wa(t,e)}Ei(){}di(t){return B.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((s=>e.next((n=>s+n))))}wr(t){let e=0;return this.pr(t,(s=>{e++})).next((()=>e))}pr(t,e){return B.forEach(this.pi,((s,n)=>this.br(t,s,n).next((r=>r?B.resolve():e(n)))))}removeTargets(t,e,s){return this.persistence.getTargetCache().removeTargets(t,e,s)}removeOrphanedDocuments(t,e){let s=0;const n=this.persistence.getRemoteDocumentCache(),r=n.newChangeBuffer();return n.ii(t,(o=>this.br(t,o,e).next((a=>{a||(s++,r.removeEntry(o,st.min()))})))).next((()=>r.apply(t))).next((()=>s))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),B.resolve()}removeTarget(t,e){const s=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,s)}addReference(t,e,s){return this.pi.set(s,t.currentSequenceNumber),B.resolve()}removeReference(t,e,s){return this.pi.set(s,t.currentSequenceNumber),B.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),B.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ba(t.data.value)),e}br(t,e,s){return B.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const n=this.pi.get(e);return B.resolve(n!==void 0&&n>s)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Iu{constructor(t,e,s,n){this.targetId=t,this.fromCache=e,this.Es=s,this.ds=n}static As(t,e){let s=mt(),n=mt();for(const r of e.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:n=n.add(r.doc.key)}return new Iu(t,e.fromCache,s,n)}}class $S{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class zS{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return mw()?8:pT(Ae())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,s,n){const r={result:null};return this.ys(t,e).next((o=>{r.result=o})).next((()=>{if(!r.result)return this.ws(t,e,n,s).next((o=>{r.result=o}))})).next((()=>{if(r.result)return;const o=new $S;return this.Ss(t,e,o).next((a=>{if(r.result=a,this.Vs)return this.bs(t,e,o,a.size)}))})).next((()=>r.result))}bs(t,e,s,n){return s.documentReadCount<this.fs?(_n()<=pt.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",yn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),B.resolve()):(_n()<=pt.DEBUG&&q("QueryEngine","Query:",yn(e),"scans",s.documentReadCount,"local documents and returns",n,"documents as results."),s.documentReadCount>this.gs*n?(_n()<=pt.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",yn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,As(e))):B.resolve())}ys(t,e){if(pp(e))return B.resolve(null);let s=As(e);return this.indexManager.getIndexType(t,s).next((n=>n===0?null:(e.limit!==null&&n===1&&(e=dh(e,null,"F"),s=As(e)),this.indexManager.getDocumentsMatchingTarget(t,s).next((r=>{const o=mt(...r);return this.ps.getDocuments(t,o).next((a=>this.indexManager.getMinOffset(t,s).next((c=>{const l=this.Ds(e,a);return this.Cs(e,l,o,c.readTime)?this.ys(t,dh(e,null,"F")):this.vs(t,l,e,c)}))))})))))}ws(t,e,s,n){return pp(e)||n.isEqual(st.min())?B.resolve(null):this.ps.getDocuments(t,s).next((r=>{const o=this.Ds(e,r);return this.Cs(e,o,s,n)?B.resolve(null):(_n()<=pt.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),yn(e)),this.vs(t,o,e,lT(n,Wr)).next((a=>a)))}))}Ds(t,e){let s=new ne($_(t));return e.forEach(((n,r)=>{mc(t,r)&&(s=s.add(r))})),s}Cs(t,e,s,n){if(t.limit===null)return!1;if(s.size!==e.size)return!0;const r=t.limitType==="F"?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(n)>0)}Ss(t,e,s){return _n()<=pt.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",yn(e)),this.ps.getDocumentsMatchingQuery(t,e,gi.min(),s)}vs(t,e,s,n){return this.ps.getDocumentsMatchingQuery(t,s,n).next((r=>(e.forEach((o=>{r=r.insert(o.key,o)})),r)))}}const Cu="LocalStore",jS=3e8;class HS{constructor(t,e,s,n){this.persistence=t,this.Fs=e,this.serializer=n,this.Ms=new Ut(gt),this.xs=new nn((r=>mu(r)),_u),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(s)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new DS(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function qS(i,t,e,s){return new HS(i,t,e,s)}async function hy(i,t){const e=rt(i);return await e.persistence.runTransaction("Handle user change","readonly",(s=>{let n;return e.mutationQueue.getAllMutationBatches(s).next((r=>(n=r,e.Bs(t),e.mutationQueue.getAllMutationBatches(s)))).next((r=>{const o=[],a=[];let c=mt();for(const l of n){o.push(l.batchId);for(const h of l.mutations)c=c.add(h.key)}for(const l of r){a.push(l.batchId);for(const h of l.mutations)c=c.add(h.key)}return e.localDocuments.getDocuments(s,c).next((l=>({Ls:l,removedBatchIds:o,addedBatchIds:a})))}))}))}function GS(i,t){const e=rt(i);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const n=t.batch.keys(),r=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(a,c,l,h){const u=l.batch,p=u.keys();let g=B.resolve();return p.forEach((y=>{g=g.next((()=>h.getEntry(c,y))).next((m=>{const v=l.docVersions.get(y);Tt(v!==null,48541),m.version.compareTo(v)<0&&(u.applyToRemoteDocument(m,l),m.isValidDocument()&&(m.setReadTime(l.commitVersion),h.addEntry(m)))}))})),g.next((()=>a.mutationQueue.removeMutationBatch(c,u)))})(e,s,t,r).next((()=>r.apply(s))).next((()=>e.mutationQueue.performConsistencyCheck(s))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(s,n,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(a){let c=mt();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(c=c.add(a.batch.mutations[l].key));return c})(t)))).next((()=>e.localDocuments.getDocuments(s,n)))}))}function uy(i){const t=rt(i);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function WS(i,t){const e=rt(i),s=t.snapshotVersion;let n=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(r=>{const o=e.Ns.newChangeBuffer({trackRemovals:!0});n=e.Ms;const a=[];t.targetChanges.forEach(((h,u)=>{const p=n.get(u);if(!p)return;a.push(e.Pi.removeMatchingKeys(r,h.removedDocuments,u).next((()=>e.Pi.addMatchingKeys(r,h.addedDocuments,u))));let g=p.withSequenceNumber(r.currentSequenceNumber);t.targetMismatches.get(u)!==null?g=g.withResumeToken(me.EMPTY_BYTE_STRING,st.min()).withLastLimboFreeSnapshotVersion(st.min()):h.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(h.resumeToken,s)),n=n.insert(u,g),(function(m,v,w){return m.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-m.snapshotVersion.toMicroseconds()>=jS?!0:w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0})(p,g,h)&&a.push(e.Pi.updateTargetData(r,g))}));let c=Gs(),l=mt();if(t.documentUpdates.forEach((h=>{t.resolvedLimboDocuments.has(h)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(r,h))})),a.push(KS(r,o,t.documentUpdates).next((h=>{c=h.ks,l=h.qs}))),!s.isEqual(st.min())){const h=e.Pi.getLastRemoteSnapshotVersion(r).next((u=>e.Pi.setTargetsMetadata(r,r.currentSequenceNumber,s)));a.push(h)}return B.waitFor(a).next((()=>o.apply(r))).next((()=>e.localDocuments.getLocalViewOfDocuments(r,c,l))).next((()=>c))})).then((r=>(e.Ms=n,r)))}function KS(i,t,e){let s=mt(),n=mt();return e.forEach((r=>s=s.add(r))),t.getEntries(i,s).next((r=>{let o=Gs();return e.forEach(((a,c)=>{const l=r.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(n=n.add(a)),c.isNoDocument()&&c.version.isEqual(st.min())?(t.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(t.addEntry(c),o=o.insert(a,c)):q(Cu,"Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)})),{ks:o,qs:n}}))}function XS(i,t){const e=rt(i);return e.persistence.runTransaction("Get next mutation batch","readonly",(s=>(t===void 0&&(t=fu),e.mutationQueue.getNextMutationBatchAfterBatchId(s,t))))}function YS(i,t){const e=rt(i);return e.persistence.runTransaction("Allocate target","readwrite",(s=>{let n;return e.Pi.getTargetData(s,t).next((r=>r?(n=r,B.resolve(n)):e.Pi.allocateTargetId(s).next((o=>(n=new ci(t,o,"TargetPurposeListen",s.currentSequenceNumber),e.Pi.addTargetData(s,n).next((()=>n)))))))})).then((s=>{const n=e.Ms.get(s.targetId);return(n===null||s.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(s.targetId,s),e.xs.set(t,s.targetId)),s}))}async function _h(i,t,e){const s=rt(i),n=s.Ms.get(t),r=e?"readwrite":"readwrite-primary";try{e||await s.persistence.runTransaction("Release target",r,(o=>s.persistence.referenceDelegate.removeTarget(o,n)))}catch(o){if(!Qn(o))throw o;q(Cu,`Failed to update sequence numbers for target ${t}: ${o}`)}s.Ms=s.Ms.remove(t),s.xs.delete(n.target)}function Cp(i,t,e){const s=rt(i);let n=st.min(),r=mt();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(c,l,h){const u=rt(c),p=u.xs.get(h);return p!==void 0?B.resolve(u.Ms.get(p)):u.Pi.getTargetData(l,h)})(s,o,As(t)).next((a=>{if(a)return n=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next((c=>{r=c}))})).next((()=>s.Fs.getDocumentsMatchingQuery(o,t,e?n:st.min(),e?r:mt()))).next((a=>(QS(s,LT(t),a),{documents:a,Qs:r})))))}function QS(i,t,e){let s=i.Os.get(t)||st.min();e.forEach(((n,r)=>{r.readTime.compareTo(s)>0&&(s=r.readTime)})),i.Os.set(t,s)}class Pp{constructor(){this.activeTargetIds=$T()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class JS{constructor(){this.Mo=new Pp,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,s){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,s){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Pp,Promise.resolve()}handleUserChange(t,e,s){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class ZS{Oo(t){}shutdown(){}}const Rp="ConnectivityMonitor";class xp{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){q(Rp,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){q(Rp,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ta=null;function yh(){return ta===null?ta=(function(){return 268435456+Math.round(2147483648*Math.random())})():ta++,"0x"+ta.toString(16)}const vl="RestConnection",tI={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class eI{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${s}/databases/${n}`,this.Wo=this.databaseId.database===za?`project_id=${s}`:`project_id=${s}&database_id=${n}`}Go(t,e,s,n,r){const o=yh(),a=this.zo(t,e.toUriEncodedString());q(vl,`Sending RPC '${t}' ${o}:`,a,s);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,n,r);const{host:l}=new URL(a),h=Ti(l);return this.Jo(t,a,c,s,h).then((u=>(q(vl,`Received RPC '${t}' ${o}: `,u),u)),(u=>{throw Bn(vl,`RPC '${t}' ${o} failed with error: `,u,"url: ",a,"request:",s),u}))}Ho(t,e,s,n,r,o){return this.Go(t,e,s,n,r)}jo(t,e,s){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Xn})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((n,r)=>t[r]=n)),s&&s.headers.forEach(((n,r)=>t[r]=n))}zo(t,e){const s=tI[t];return`${this.Uo}/v1/${e}:${s}`}terminate(){}}class sI{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const ye="WebChannelConnection";class iI extends eI{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,s,n,r){const o=yh();return new Promise(((a,c)=>{const l=new p_;l.setWithCredentials(!0),l.listenOnce(g_.COMPLETE,(()=>{try{switch(l.getLastErrorCode()){case va.NO_ERROR:const u=l.getResponseJson();q(ye,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(u)),a(u);break;case va.TIMEOUT:q(ye,`RPC '${t}' ${o} timed out`),c(new j(V.DEADLINE_EXCEEDED,"Request time out"));break;case va.HTTP_ERROR:const p=l.getStatus();if(q(ye,`RPC '${t}' ${o} failed with status:`,p,"response text:",l.getResponseText()),p>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g?.error;if(y&&y.status&&y.message){const m=(function(w){const E=w.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(E)>=0?E:V.UNKNOWN})(y.status);c(new j(m,y.message))}else c(new j(V.UNKNOWN,"Server responded with status "+l.getStatus()))}else c(new j(V.UNAVAILABLE,"Connection failed."));break;default:et(9055,{l_:t,streamId:o,h_:l.getLastErrorCode(),P_:l.getLastError()})}}finally{q(ye,`RPC '${t}' ${o} completed.`)}}));const h=JSON.stringify(n);q(ye,`RPC '${t}' ${o} sending request:`,n),l.send(e,"POST",h,s,15)}))}T_(t,e,s){const n=yh(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=y_(),a=__(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,e,s),c.encodeInitMessageHeaders=!0;const h=r.join("");q(ye,`Creating RPC '${t}' stream ${n}: ${h}`,c);const u=o.createWebChannel(h,c);this.I_(u);let p=!1,g=!1;const y=new sI({Yo:v=>{g?q(ye,`Not sending because RPC '${t}' stream ${n} is closed:`,v):(p||(q(ye,`Opening RPC '${t}' stream ${n} transport.`),u.open(),p=!0),q(ye,`RPC '${t}' stream ${n} sending:`,v),u.send(v))},Zo:()=>u.close()}),m=(v,w,E)=>{v.listen(w,(A=>{try{E(A)}catch(P){setTimeout((()=>{throw P}),0)}}))};return m(u,Ir.EventType.OPEN,(()=>{g||(q(ye,`RPC '${t}' stream ${n} transport opened.`),y.o_())})),m(u,Ir.EventType.CLOSE,(()=>{g||(g=!0,q(ye,`RPC '${t}' stream ${n} transport closed`),y.a_(),this.E_(u))})),m(u,Ir.EventType.ERROR,(v=>{g||(g=!0,Bn(ye,`RPC '${t}' stream ${n} transport errored. Name:`,v.name,"Message:",v.message),y.a_(new j(V.UNAVAILABLE,"The operation could not be completed")))})),m(u,Ir.EventType.MESSAGE,(v=>{if(!g){const w=v.data[0];Tt(!!w,16349);const E=w,A=E?.error||E[0]?.error;if(A){q(ye,`RPC '${t}' stream ${n} received error:`,A);const P=A.status;let x=(function(T){const I=Jt[T];if(I!==void 0)return J_(I)})(P),M=A.message;x===void 0&&(x=V.INTERNAL,M="Unknown error status: "+P+" with message "+A.message),g=!0,y.a_(new j(x,M)),u.close()}else q(ye,`RPC '${t}' stream ${n} received:`,w),y.u_(w)}})),m(a,m_.STAT_EVENT,(v=>{v.stat===rh.PROXY?q(ye,`RPC '${t}' stream ${n} detected buffering proxy`):v.stat===rh.NOPROXY&&q(ye,`RPC '${t}' stream ${n} detected no buffering proxy`)})),setTimeout((()=>{y.__()}),0),y}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function bl(){return typeof document<"u"?document:null}function bc(i){return new aS(i,!0)}class dy{constructor(t,e,s=1e3,n=1.5,r=6e4){this.Mi=t,this.timerId=e,this.d_=s,this.A_=n,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),n=Math.max(0,e-s);n>0&&q("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,n,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const kp="PersistentStream";class fy{constructor(t,e,s,n,r,o,a,c){this.Mi=t,this.S_=s,this.b_=n,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new dy(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===V.RESOURCE_EXHAUSTED?(qs(e.toString()),qs("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,n])=>{this.D_===e&&this.G_(s,n)}),(s=>{t((()=>{const n=new j(V.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(n)}))}))}G_(t,e){const s=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((n=>{s((()=>this.z_(n)))})),this.stream.onMessage((n=>{s((()=>++this.F_==1?this.J_(n):this.onNext(n)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return q(kp,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(q(kp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class nI extends fy{constructor(t,e,s,n,r,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,s,n,o),this.serializer=r}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=hS(this.serializer,t),s=(function(r){if(!("targetChange"in r))return st.min();const o=r.targetChange;return o.targetIds&&o.targetIds.length?st.min():o.readTime?Es(o.readTime):st.min()})(t);return this.listener.H_(e,s)}Y_(t){const e={};e.database=mh(this.serializer),e.addTarget=(function(r,o){let a;const c=o.target;if(a=hh(c)?{documents:fS(r,c)}:{query:pS(r,c).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=ey(r,o.resumeToken);const l=fh(r,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(st.min())>0){a.readTime=Ga(r,o.snapshotVersion.toTimestamp());const l=fh(r,o.expectedCount);l!==null&&(a.expectedCount=l)}return a})(this.serializer,t);const s=mS(this.serializer,t);s&&(e.labels=s),this.q_(e)}Z_(t){const e={};e.database=mh(this.serializer),e.removeTarget=t,this.q_(e)}}class rI extends fy{constructor(t,e,s,n,r,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,s,n,o),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return Tt(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Tt(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){Tt(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=dS(t.writeResults,t.commitTime),s=Es(t.commitTime);return this.listener.na(s,e)}ra(){const t={};t.database=mh(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((s=>uS(this.serializer,s)))};this.q_(e)}}class oI{}class aI extends oI{constructor(t,e,s,n){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=s,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new j(V.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,s,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Go(t,ph(e,s),n,r,o))).catch((r=>{throw r.name==="FirebaseError"?(r.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new j(V.UNKNOWN,r.toString())}))}Ho(t,e,s,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Ho(t,ph(e,s),n,o,a,r))).catch((o=>{throw o.name==="FirebaseError"?(o.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new j(V.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class cI{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(qs(e),this.aa=!1):q("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Qi="RemoteStore";class lI{constructor(t,e,s,n,r){this.localStore=t,this.datastore=e,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo((o=>{s.enqueueAndForget((async()=>{rn(this)&&(q(Qi,"Restarting streams for network reachability change."),await(async function(c){const l=rt(c);l.Ea.add(4),await Eo(l),l.Ra.set("Unknown"),l.Ea.delete(4),await wc(l)})(this))}))})),this.Ra=new cI(s,n)}}async function wc(i){if(rn(i))for(const t of i.da)await t(!0)}async function Eo(i){for(const t of i.da)await t(!1)}function py(i,t){const e=rt(i);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),ku(e)?xu(e):Zn(e).O_()&&Ru(e,t))}function Pu(i,t){const e=rt(i),s=Zn(e);e.Ia.delete(t),s.O_()&&gy(e,t),e.Ia.size===0&&(s.O_()?s.L_():rn(e)&&e.Ra.set("Unknown"))}function Ru(i,t){if(i.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(st.min())>0){const e=i.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Zn(i).Y_(t)}function gy(i,t){i.Va.Ue(t),Zn(i).Z_(t)}function xu(i){i.Va=new iS({getRemoteKeysForTarget:t=>i.remoteSyncer.getRemoteKeysForTarget(t),At:t=>i.Ia.get(t)||null,ht:()=>i.datastore.serializer.databaseId}),Zn(i).start(),i.Ra.ua()}function ku(i){return rn(i)&&!Zn(i).x_()&&i.Ia.size>0}function rn(i){return rt(i).Ea.size===0}function my(i){i.Va=void 0}async function hI(i){i.Ra.set("Online")}async function uI(i){i.Ia.forEach(((t,e)=>{Ru(i,t)}))}async function dI(i,t){my(i),ku(i)?(i.Ra.ha(t),xu(i)):i.Ra.set("Unknown")}async function fI(i,t,e){if(i.Ra.set("Online"),t instanceof ty&&t.state===2&&t.cause)try{await(async function(n,r){const o=r.cause;for(const a of r.targetIds)n.Ia.has(a)&&(await n.remoteSyncer.rejectListen(a,o),n.Ia.delete(a),n.Va.removeTarget(a))})(i,t)}catch(s){q(Qi,"Failed to remove targets %s: %s ",t.targetIds.join(","),s),await Ka(i,s)}else if(t instanceof Ea?i.Va.Ze(t):t instanceof Z_?i.Va.st(t):i.Va.tt(t),!e.isEqual(st.min()))try{const s=await uy(i.localStore);e.compareTo(s)>=0&&await(function(r,o){const a=r.Va.Tt(o);return a.targetChanges.forEach(((c,l)=>{if(c.resumeToken.approximateByteSize()>0){const h=r.Ia.get(l);h&&r.Ia.set(l,h.withResumeToken(c.resumeToken,o))}})),a.targetMismatches.forEach(((c,l)=>{const h=r.Ia.get(c);if(!h)return;r.Ia.set(c,h.withResumeToken(me.EMPTY_BYTE_STRING,h.snapshotVersion)),gy(r,c);const u=new ci(h.target,c,l,h.sequenceNumber);Ru(r,u)})),r.remoteSyncer.applyRemoteEvent(a)})(i,e)}catch(s){q(Qi,"Failed to raise snapshot:",s),await Ka(i,s)}}async function Ka(i,t,e){if(!Qn(t))throw t;i.Ea.add(1),await Eo(i),i.Ra.set("Offline"),e||(e=()=>uy(i.localStore)),i.asyncQueue.enqueueRetryable((async()=>{q(Qi,"Retrying IndexedDB access"),await e(),i.Ea.delete(1),await wc(i)}))}function _y(i,t){return t().catch((e=>Ka(i,e,t)))}async function Ac(i){const t=rt(i),e=vi(t);let s=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:fu;for(;pI(t);)try{const n=await XS(t.localStore,s);if(n===null){t.Ta.length===0&&e.L_();break}s=n.batchId,gI(t,n)}catch(n){await Ka(t,n)}yy(t)&&vy(t)}function pI(i){return rn(i)&&i.Ta.length<10}function gI(i,t){i.Ta.push(t);const e=vi(i);e.O_()&&e.X_&&e.ea(t.mutations)}function yy(i){return rn(i)&&!vi(i).x_()&&i.Ta.length>0}function vy(i){vi(i).start()}async function mI(i){vi(i).ra()}async function _I(i){const t=vi(i);for(const e of i.Ta)t.ea(e.mutations)}async function yI(i,t,e){const s=i.Ta.shift(),n=wu.from(s,t,e);await _y(i,(()=>i.remoteSyncer.applySuccessfulWrite(n))),await Ac(i)}async function vI(i,t){t&&vi(i).X_&&await(async function(s,n){if((function(o){return tS(o)&&o!==V.ABORTED})(n.code)){const r=s.Ta.shift();vi(s).B_(),await _y(s,(()=>s.remoteSyncer.rejectFailedWrite(r.batchId,n))),await Ac(s)}})(i,t),yy(i)&&vy(i)}async function Dp(i,t){const e=rt(i);e.asyncQueue.verifyOperationInProgress(),q(Qi,"RemoteStore received new credentials");const s=rn(e);e.Ea.add(3),await Eo(e),s&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await wc(e)}async function bI(i,t){const e=rt(i);t?(e.Ea.delete(2),await wc(e)):t||(e.Ea.add(2),await Eo(e),e.Ra.set("Unknown"))}function Zn(i){return i.ma||(i.ma=(function(e,s,n){const r=rt(e);return r.sa(),new nI(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)})(i.datastore,i.asyncQueue,{Xo:hI.bind(null,i),t_:uI.bind(null,i),r_:dI.bind(null,i),H_:fI.bind(null,i)}),i.da.push((async t=>{t?(i.ma.B_(),ku(i)?xu(i):i.Ra.set("Unknown")):(await i.ma.stop(),my(i))}))),i.ma}function vi(i){return i.fa||(i.fa=(function(e,s,n){const r=rt(e);return r.sa(),new rI(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)})(i.datastore,i.asyncQueue,{Xo:()=>Promise.resolve(),t_:mI.bind(null,i),r_:vI.bind(null,i),ta:_I.bind(null,i),na:yI.bind(null,i)}),i.da.push((async t=>{t?(i.fa.B_(),await Ac(i)):(await i.fa.stop(),i.Ta.length>0&&(q(Qi,`Stopping write stream with ${i.Ta.length} pending writes`),i.Ta=[]))}))),i.fa}class Du{constructor(t,e,s,n,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=s,this.op=n,this.removalCallback=r,this.deferred=new $s,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,s,n,r){const o=Date.now()+s,a=new Du(t,e,o,n,r);return a.start(s),a}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new j(V.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mu(i,t){if(qs("AsyncQueue",`${t}: ${i}`),Qn(i))return new j(V.UNAVAILABLE,`${t}: ${i}`);throw i}class xn{static emptySet(t){return new xn(t.comparator)}constructor(t){this.comparator=t?(e,s)=>t(e,s)||Q.comparator(e.key,s.key):(e,s)=>Q.comparator(e.key,s.key),this.keyedMap=Cr(),this.sortedSet=new Ut(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,s)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof xn)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),s=t.sortedSet.getIterator();for(;e.hasNext();){const n=e.getNext().key,r=s.getNext().key;if(!n.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const s=new xn;return s.comparator=this.comparator,s.keyedMap=t,s.sortedSet=e,s}}class Mp{constructor(){this.ga=new Ut(Q.comparator)}track(t){const e=t.doc.key,s=this.ga.get(e);s?t.type!==0&&s.type===3?this.ga=this.ga.insert(e,t):t.type===3&&s.type!==1?this.ga=this.ga.insert(e,{type:s.type,doc:t.doc}):t.type===2&&s.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&s.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&s.type===0?this.ga=this.ga.remove(e):t.type===1&&s.type===2?this.ga=this.ga.insert(e,{type:1,doc:s.doc}):t.type===0&&s.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):et(63341,{Rt:t,pa:s}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,s)=>{t.push(s)})),t}}class Hn{constructor(t,e,s,n,r,o,a,c,l){this.query=t,this.docs=e,this.oldDocs=s,this.docChanges=n,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(t,e,s,n,r){const o=[];return e.forEach((a=>{o.push({type:0,doc:a})})),new Hn(t,e,xn.emptySet(e),o,s,n,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&gc(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,s=t.docChanges;if(e.length!==s.length)return!1;for(let n=0;n<e.length;n++)if(e[n].type!==s[n].type||!e[n].doc.isEqual(s[n].doc))return!1;return!0}}class wI{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class AI{constructor(){this.queries=Np(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,s){const n=rt(e),r=n.queries;n.queries=Np(),r.forEach(((o,a)=>{for(const c of a.Sa)c.onError(s)}))})(this,new j(V.ABORTED,"Firestore shutting down"))}}function Np(){return new nn((i=>U_(i)),gc)}async function by(i,t){const e=rt(i);let s=3;const n=t.query;let r=e.queries.get(n);r?!r.ba()&&t.Da()&&(s=2):(r=new wI,s=t.Da()?0:1);try{switch(s){case 0:r.wa=await e.onListen(n,!0);break;case 1:r.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(o){const a=Mu(o,`Initialization of query '${yn(t.query)}' failed`);return void t.onError(a)}e.queries.set(n,r),r.Sa.push(t),t.va(e.onlineState),r.wa&&t.Fa(r.wa)&&Nu(e)}async function wy(i,t){const e=rt(i),s=t.query;let n=3;const r=e.queries.get(s);if(r){const o=r.Sa.indexOf(t);o>=0&&(r.Sa.splice(o,1),r.Sa.length===0?n=t.Da()?0:1:!r.ba()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(s),e.onUnlisten(s,!0);case 1:return e.queries.delete(s),e.onUnlisten(s,!1);case 2:return e.onLastRemoteStoreUnlisten(s);default:return}}function EI(i,t){const e=rt(i);let s=!1;for(const n of t){const r=n.query,o=e.queries.get(r);if(o){for(const a of o.Sa)a.Fa(n)&&(s=!0);o.wa=n}}s&&Nu(e)}function TI(i,t,e){const s=rt(i),n=s.queries.get(t);if(n)for(const r of n.Sa)r.onError(e);s.queries.delete(t)}function Nu(i){i.Ca.forEach((t=>{t.next()}))}var vh,Lp;(Lp=vh||(vh={})).Ma="default",Lp.Cache="cache";class Ay{constructor(t,e,s){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(t){if(!this.options.includeMetadataChanges){const s=[];for(const n of t.docChanges)n.type!==3&&s.push(n);t=new Hn(t.query,t.docs,t.oldDocs,s,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const s=e!=="Offline";return(!this.options.qa||!s)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=Hn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==vh.Cache}}class Ey{constructor(t){this.key=t}}class Ty{constructor(t){this.key=t}}class SI{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=mt(),this.mutatedKeys=mt(),this.eu=$_(t),this.tu=new xn(this.eu)}get nu(){return this.Ya}ru(t,e){const s=e?e.iu:new Mp,n=e?e.tu:this.tu;let r=e?e.mutatedKeys:this.mutatedKeys,o=n,a=!1;const c=this.query.limitType==="F"&&n.size===this.query.limit?n.last():null,l=this.query.limitType==="L"&&n.size===this.query.limit?n.first():null;if(t.inorderTraversal(((h,u)=>{const p=n.get(h),g=mc(this.query,u)?u:null,y=!!p&&this.mutatedKeys.has(p.key),m=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let v=!1;p&&g?p.data.isEqual(g.data)?y!==m&&(s.track({type:3,doc:g}),v=!0):this.su(p,g)||(s.track({type:2,doc:g}),v=!0,(c&&this.eu(g,c)>0||l&&this.eu(g,l)<0)&&(a=!0)):!p&&g?(s.track({type:0,doc:g}),v=!0):p&&!g&&(s.track({type:1,doc:p}),v=!0,(c||l)&&(a=!0)),v&&(g?(o=o.add(g),r=m?r.add(h):r.delete(h)):(o=o.delete(h),r=r.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),r=r.delete(h.key),s.track({type:1,doc:h})}return{tu:o,iu:s,Cs:a,mutatedKeys:r}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,s,n){const r=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const o=t.iu.ya();o.sort(((h,u)=>(function(g,y){const m=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return et(20277,{Rt:v})}};return m(g)-m(y)})(h.type,u.type)||this.eu(h.doc,u.doc))),this.ou(s),n=n??!1;const a=e&&!n?this._u():[],c=this.Xa.size===0&&this.current&&!n?1:0,l=c!==this.Za;return this.Za=c,o.length!==0||l?{snapshot:new Hn(this.query,t.tu,r,o,t.mutatedKeys,c===0,l,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Mp,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=mt(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const e=[];return t.forEach((s=>{this.Xa.has(s)||e.push(new Ty(s))})),this.Xa.forEach((s=>{t.has(s)||e.push(new Ey(s))})),e}cu(t){this.Ya=t.Qs,this.Xa=mt();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Hn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Lu="SyncEngine";class II{constructor(t,e,s){this.query=t,this.targetId=e,this.view=s}}class CI{constructor(t){this.key=t,this.hu=!1}}class PI{constructor(t,e,s,n,r,o){this.localStore=t,this.remoteStore=e,this.eventManager=s,this.sharedClientState=n,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new nn((a=>U_(a)),gc),this.Iu=new Map,this.Eu=new Set,this.du=new Ut(Q.comparator),this.Au=new Map,this.Ru=new Tu,this.Vu={},this.mu=new Map,this.fu=jn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function RI(i,t,e=!0){const s=xy(i);let n;const r=s.Tu.get(t);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),n=r.view.lu()):n=await Sy(s,t,e,!0),n}async function xI(i,t){const e=xy(i);await Sy(e,t,!0,!1)}async function Sy(i,t,e,s){const n=await YS(i.localStore,As(t)),r=n.targetId,o=i.sharedClientState.addLocalQueryTarget(r,e);let a;return s&&(a=await kI(i,t,r,o==="current",n.resumeToken)),i.isPrimaryClient&&e&&py(i.remoteStore,n),a}async function kI(i,t,e,s,n){i.pu=(u,p,g)=>(async function(m,v,w,E){let A=v.view.ru(w);A.Cs&&(A=await Cp(m.localStore,v.query,!1).then((({documents:S})=>v.view.ru(S,A))));const P=E&&E.targetChanges.get(v.targetId),x=E&&E.targetMismatches.get(v.targetId)!=null,M=v.view.applyChanges(A,m.isPrimaryClient,P,x);return Fp(m,v.targetId,M.au),M.snapshot})(i,u,p,g);const r=await Cp(i.localStore,t,!0),o=new SI(t,r.Qs),a=o.ru(r.documents),c=Ao.createSynthesizedTargetChangeForCurrentChange(e,s&&i.onlineState!=="Offline",n),l=o.applyChanges(a,i.isPrimaryClient,c);Fp(i,e,l.au);const h=new II(t,e,o);return i.Tu.set(t,h),i.Iu.has(e)?i.Iu.get(e).push(t):i.Iu.set(e,[t]),l.snapshot}async function DI(i,t,e){const s=rt(i),n=s.Tu.get(t),r=s.Iu.get(n.targetId);if(r.length>1)return s.Iu.set(n.targetId,r.filter((o=>!gc(o,t)))),void s.Tu.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(n.targetId),s.sharedClientState.isActiveQueryTarget(n.targetId)||await _h(s.localStore,n.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(n.targetId),e&&Pu(s.remoteStore,n.targetId),bh(s,n.targetId)})).catch(Yn)):(bh(s,n.targetId),await _h(s.localStore,n.targetId,!0))}async function MI(i,t){const e=rt(i),s=e.Tu.get(t),n=e.Iu.get(s.targetId);e.isPrimaryClient&&n.length===1&&(e.sharedClientState.removeLocalQueryTarget(s.targetId),Pu(e.remoteStore,s.targetId))}async function NI(i,t,e){const s=$I(i);try{const n=await(function(o,a){const c=rt(o),l=ct.now(),h=a.reduce(((g,y)=>g.add(y.key)),mt());let u,p;return c.persistence.runTransaction("Locally write mutations","readwrite",(g=>{let y=Gs(),m=mt();return c.Ns.getEntries(g,h).next((v=>{y=v,y.forEach(((w,E)=>{E.isValidDocument()||(m=m.add(w))}))})).next((()=>c.localDocuments.getOverlayedDocuments(g,y))).next((v=>{u=v;const w=[];for(const E of a){const A=XT(E,u.get(E.key).overlayedDocument);A!=null&&w.push(new Ri(E.key,A,D_(A.value.mapValue),Qe.exists(!0)))}return c.mutationQueue.addMutationBatch(g,l,w,a)})).next((v=>{p=v;const w=v.applyToLocalDocumentSet(u,m);return c.documentOverlayCache.saveOverlays(g,v.batchId,w)}))})).then((()=>({batchId:p.batchId,changes:j_(u)})))})(s.localStore,t);s.sharedClientState.addPendingMutation(n.batchId),(function(o,a,c){let l=o.Vu[o.currentUser.toKey()];l||(l=new Ut(gt)),l=l.insert(a,c),o.Vu[o.currentUser.toKey()]=l})(s,n.batchId,e),await To(s,n.changes),await Ac(s.remoteStore)}catch(n){const r=Mu(n,"Failed to persist write");e.reject(r)}}async function Iy(i,t){const e=rt(i);try{const s=await WS(e.localStore,t);t.targetChanges.forEach(((n,r)=>{const o=e.Au.get(r);o&&(Tt(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1,22616),n.addedDocuments.size>0?o.hu=!0:n.modifiedDocuments.size>0?Tt(o.hu,14607):n.removedDocuments.size>0&&(Tt(o.hu,42227),o.hu=!1))})),await To(e,s,t)}catch(s){await Yn(s)}}function Op(i,t,e){const s=rt(i);if(s.isPrimaryClient&&e===0||!s.isPrimaryClient&&e===1){const n=[];s.Tu.forEach(((r,o)=>{const a=o.view.va(t);a.snapshot&&n.push(a.snapshot)})),(function(o,a){const c=rt(o);c.onlineState=a;let l=!1;c.queries.forEach(((h,u)=>{for(const p of u.Sa)p.va(a)&&(l=!0)})),l&&Nu(c)})(s.eventManager,t),n.length&&s.Pu.H_(n),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function LI(i,t,e){const s=rt(i);s.sharedClientState.updateQueryState(t,"rejected",e);const n=s.Au.get(t),r=n&&n.key;if(r){let o=new Ut(Q.comparator);o=o.insert(r,be.newNoDocument(r,st.min()));const a=mt().add(r),c=new vc(st.min(),new Map,new Ut(gt),o,a);await Iy(s,c),s.du=s.du.remove(r),s.Au.delete(t),Ou(s)}else await _h(s.localStore,t,!1).then((()=>bh(s,t,e))).catch(Yn)}async function OI(i,t){const e=rt(i),s=t.batch.batchId;try{const n=await GS(e.localStore,t);Py(e,s,null),Cy(e,s),e.sharedClientState.updateMutationState(s,"acknowledged"),await To(e,n)}catch(n){await Yn(n)}}async function FI(i,t,e){const s=rt(i);try{const n=await(function(o,a){const c=rt(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",(l=>{let h;return c.mutationQueue.lookupMutationBatch(l,a).next((u=>(Tt(u!==null,37113),h=u.keys(),c.mutationQueue.removeMutationBatch(l,u)))).next((()=>c.mutationQueue.performConsistencyCheck(l))).next((()=>c.documentOverlayCache.removeOverlaysForBatchId(l,h,a))).next((()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,h))).next((()=>c.localDocuments.getDocuments(l,h)))}))})(s.localStore,t);Py(s,t,e),Cy(s,t),s.sharedClientState.updateMutationState(t,"rejected",e),await To(s,n)}catch(n){await Yn(n)}}function Cy(i,t){(i.mu.get(t)||[]).forEach((e=>{e.resolve()})),i.mu.delete(t)}function Py(i,t,e){const s=rt(i);let n=s.Vu[s.currentUser.toKey()];if(n){const r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),s.Vu[s.currentUser.toKey()]=n}}function bh(i,t,e=null){i.sharedClientState.removeLocalQueryTarget(t);for(const s of i.Iu.get(t))i.Tu.delete(s),e&&i.Pu.yu(s,e);i.Iu.delete(t),i.isPrimaryClient&&i.Ru.jr(t).forEach((s=>{i.Ru.containsKey(s)||Ry(i,s)}))}function Ry(i,t){i.Eu.delete(t.path.canonicalString());const e=i.du.get(t);e!==null&&(Pu(i.remoteStore,e),i.du=i.du.remove(t),i.Au.delete(e),Ou(i))}function Fp(i,t,e){for(const s of e)s instanceof Ey?(i.Ru.addReference(s.key,t),VI(i,s)):s instanceof Ty?(q(Lu,"Document no longer in limbo: "+s.key),i.Ru.removeReference(s.key,t),i.Ru.containsKey(s.key)||Ry(i,s.key)):et(19791,{wu:s})}function VI(i,t){const e=t.key,s=e.path.canonicalString();i.du.get(e)||i.Eu.has(s)||(q(Lu,"New document in limbo: "+e),i.Eu.add(s),Ou(i))}function Ou(i){for(;i.Eu.size>0&&i.du.size<i.maxConcurrentLimboResolutions;){const t=i.Eu.values().next().value;i.Eu.delete(t);const e=new Q(Rt.fromString(t)),s=i.fu.next();i.Au.set(s,new CI(e)),i.du=i.du.insert(e,s),py(i.remoteStore,new ci(As(yu(e.path)),s,"TargetPurposeLimboResolution",dc.ce))}}async function To(i,t,e){const s=rt(i),n=[],r=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((a,c)=>{o.push(s.pu(c,t,e).then((l=>{if((l||e)&&s.isPrimaryClient){const h=l?!l.fromCache:e?.targetChanges.get(c.targetId)?.current;s.sharedClientState.updateQueryState(c.targetId,h?"current":"not-current")}if(l){n.push(l);const h=Iu.As(c.targetId,l);r.push(h)}})))})),await Promise.all(o),s.Pu.H_(n),await(async function(c,l){const h=rt(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(u=>B.forEach(l,(p=>B.forEach(p.Es,(g=>h.persistence.referenceDelegate.addReference(u,p.targetId,g))).next((()=>B.forEach(p.ds,(g=>h.persistence.referenceDelegate.removeReference(u,p.targetId,g)))))))))}catch(u){if(!Qn(u))throw u;q(Cu,"Failed to update sequence numbers: "+u)}for(const u of l){const p=u.targetId;if(!u.fromCache){const g=h.Ms.get(p),y=g.snapshotVersion,m=g.withLastLimboFreeSnapshotVersion(y);h.Ms=h.Ms.insert(p,m)}}})(s.localStore,r))}async function BI(i,t){const e=rt(i);if(!e.currentUser.isEqual(t)){q(Lu,"User change. New user:",t.toKey());const s=await hy(e.localStore,t);e.currentUser=t,(function(r,o){r.mu.forEach((a=>{a.forEach((c=>{c.reject(new j(V.CANCELLED,o))}))})),r.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,s.removedBatchIds,s.addedBatchIds),await To(e,s.Ls)}}function UI(i,t){const e=rt(i),s=e.Au.get(t);if(s&&s.hu)return mt().add(s.key);{let n=mt();const r=e.Iu.get(t);if(!r)return n;for(const o of r){const a=e.Tu.get(o);n=n.unionWith(a.view.nu)}return n}}function xy(i){const t=rt(i);return t.remoteStore.remoteSyncer.applyRemoteEvent=Iy.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=UI.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=LI.bind(null,t),t.Pu.H_=EI.bind(null,t.eventManager),t.Pu.yu=TI.bind(null,t.eventManager),t}function $I(i){const t=rt(i);return t.remoteStore.remoteSyncer.applySuccessfulWrite=OI.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=FI.bind(null,t),t}class Xa{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=bc(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return qS(this.persistence,new zS,t.initialUser,this.serializer)}Cu(t){return new ly(Su.mi,this.serializer)}Du(t){return new JS}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Xa.provider={build:()=>new Xa};class zI extends Xa{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){Tt(this.persistence.referenceDelegate instanceof Wa,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new CS(s,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Le.withCacheSize(this.cacheSizeBytes):Le.DEFAULT;return new ly((s=>Wa.mi(s,e)),this.serializer)}}class wh{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Op(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=BI.bind(null,this.syncEngine),await bI(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new AI})()}createDatastore(t){const e=bc(t.databaseInfo.databaseId),s=(function(r){return new iI(r)})(t.databaseInfo);return(function(r,o,a,c){return new aI(r,o,a,c)})(t.authCredentials,t.appCheckCredentials,s,e)}createRemoteStore(t){return(function(s,n,r,o,a){return new lI(s,n,r,o,a)})(this.localStore,this.datastore,t.asyncQueue,(e=>Op(this.syncEngine,e,0)),(function(){return xp.v()?new xp:new ZS})())}createSyncEngine(t,e){return(function(n,r,o,a,c,l,h){const u=new PI(n,r,o,a,c,l);return h&&(u.gu=!0),u})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const s=rt(e);q(Qi,"RemoteStore shutting down."),s.Ea.add(5),await Eo(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}wh.provider={build:()=>new wh};class ky{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):qs("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const bi="FirestoreClient";class jI{constructor(t,e,s,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=s,this.databaseInfo=n,this.user=ve.UNAUTHENTICATED,this.clientId=du.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(s,(async o=>{q(bi,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(q(bi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new $s;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const s=Mu(e,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}async function wl(i,t){i.asyncQueue.verifyOperationInProgress(),q(bi,"Initializing OfflineComponentProvider");const e=i.configuration;await t.initialize(e);let s=e.initialUser;i.setCredentialChangeListener((async n=>{s.isEqual(n)||(await hy(t.localStore,n),s=n)})),t.persistence.setDatabaseDeletedListener((()=>i.terminate())),i._offlineComponents=t}async function Vp(i,t){i.asyncQueue.verifyOperationInProgress();const e=await HI(i);q(bi,"Initializing OnlineComponentProvider"),await t.initialize(e,i.configuration),i.setCredentialChangeListener((s=>Dp(t.remoteStore,s))),i.setAppCheckTokenChangeListener(((s,n)=>Dp(t.remoteStore,n))),i._onlineComponents=t}async function HI(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){q(bi,"Using user provided OfflineComponentProvider");try{await wl(i,i._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(n){return n.name==="FirebaseError"?n.code===V.FAILED_PRECONDITION||n.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11})(e))throw e;Bn("Error using user provided cache. Falling back to memory cache: "+e),await wl(i,new Xa)}}else q(bi,"Using default OfflineComponentProvider"),await wl(i,new zI(void 0));return i._offlineComponents}async function Dy(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(q(bi,"Using user provided OnlineComponentProvider"),await Vp(i,i._uninitializedComponentsProvider._online)):(q(bi,"Using default OnlineComponentProvider"),await Vp(i,new wh))),i._onlineComponents}function qI(i){return Dy(i).then((t=>t.syncEngine))}async function My(i){const t=await Dy(i),e=t.eventManager;return e.onListen=RI.bind(null,t.syncEngine),e.onUnlisten=DI.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=xI.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=MI.bind(null,t.syncEngine),e}function GI(i,t,e={}){const s=new $s;return i.asyncQueue.enqueueAndForget((async()=>(function(r,o,a,c,l){const h=new ky({next:p=>{h.Nu(),o.enqueueAndForget((()=>wy(r,u)));const g=p.docs.has(a);!g&&p.fromCache?l.reject(new j(V.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&p.fromCache&&c&&c.source==="server"?l.reject(new j(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(p)},error:p=>l.reject(p)}),u=new Ay(yu(a.path),h,{includeMetadataChanges:!0,qa:!0});return by(r,u)})(await My(i),i.asyncQueue,t,e,s))),s.promise}function WI(i,t,e={}){const s=new $s;return i.asyncQueue.enqueueAndForget((async()=>(function(r,o,a,c,l){const h=new ky({next:p=>{h.Nu(),o.enqueueAndForget((()=>wy(r,u))),p.fromCache&&c.source==="server"?l.reject(new j(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(p)},error:p=>l.reject(p)}),u=new Ay(a,h,{includeMetadataChanges:!0,qa:!0});return by(r,u)})(await My(i),i.asyncQueue,t,e,s))),s.promise}function Ny(i){const t={};return i.timeoutSeconds!==void 0&&(t.timeoutSeconds=i.timeoutSeconds),t}const Bp=new Map;const Ly="firestore.googleapis.com",Up=!0;class $p{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new j(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ly,this.ssl=Up}else this.host=t.host,this.ssl=t.ssl??Up;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=cy;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<SS)throw new j(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}cT("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ny(t.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new j(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new j(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new j(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(s,n){return s.timeoutSeconds===n.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ec{constructor(t,e,s,n){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=s,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $p({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new j(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new j(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $p(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new JE;switch(s.type){case"firstParty":return new sT(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new j(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const s=Bp.get(e);s&&(q("ComponentProvider","Removing Datastore"),Bp.delete(e),s.terminate())})(this),Promise.resolve()}}function KI(i,t,e,s={}){i=cs(i,Ec);const n=Ti(t),r=i._getSettings(),o={...r,emulatorOptions:i._getEmulatorOptions()},a=`${t}:${e}`;n&&(rc(`https://${a}`),oc("Firestore",!0)),r.host!==Ly&&r.host!==a&&Bn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...r,host:a,ssl:n,emulatorOptions:s};if(!Wi(c,o)&&(i._setSettings(c),s.mockUserToken)){let l,h;if(typeof s.mockUserToken=="string")l=s.mockUserToken,h=ve.MOCK_USER;else{l=Pm(s.mockUserToken,i._app?.options.projectId);const u=s.mockUserToken.sub||s.mockUserToken.user_id;if(!u)throw new j(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new ve(u)}i._authCredentials=new ZE(new b_(l,h))}}class on{constructor(t,e,s){this.converter=e,this._query=s,this.type="query",this.firestore=t}withConverter(t){return new on(this.firestore,t,this._query)}}class Wt{constructor(t,e,s){this.converter=e,this._key=s,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new di(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Wt(this.firestore,t,this._key)}toJSON(){return{type:Wt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,s){if(bo(e,Wt._jsonSchema))return new Wt(t,s||null,new Q(Rt.fromString(e.referencePath)))}}Wt._jsonSchemaVersion="firestore/documentReference/1.0",Wt._jsonSchema={type:te("string",Wt._jsonSchemaVersion),referencePath:te("string")};class di extends on{constructor(t,e,s){super(t,e,yu(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Wt(this.firestore,null,new Q(t))}withConverter(t){return new di(this.firestore,t,this._path)}}function an(i,t,...e){if(i=Kt(i),w_("collection","path",t),i instanceof Ec){const s=Rt.fromString(t,...e);return tp(s),new di(i,null,s)}{if(!(i instanceof Wt||i instanceof di))throw new j(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=i._path.child(Rt.fromString(t,...e));return tp(s),new di(i.firestore,null,s)}}function he(i,t,...e){if(i=Kt(i),arguments.length===1&&(t=du.newId()),w_("doc","path",t),i instanceof Ec){const s=Rt.fromString(t,...e);return Zf(s),new Wt(i,null,new Q(s))}{if(!(i instanceof Wt||i instanceof di))throw new j(V.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=i._path.child(Rt.fromString(t,...e));return Zf(s),new Wt(i.firestore,i instanceof di?i.converter:null,new Q(s))}}const zp="AsyncQueue";class jp{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new dy(this,"async_queue_retry"),this._c=()=>{const s=bl();s&&q(zp,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=t;const e=bl();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=bl();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new $s;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Qn(t))throw t;q(zp,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((s=>{throw this.nc=s,this.rc=!1,qs("INTERNAL UNHANDLED ERROR: ",Hp(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=e,e}enqueueAfterDelay(t,e,s){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const n=Du.createAndSchedule(this,t,e,s,(r=>this.hc(r)));return this.tc.push(n),n}uc(){this.nc&&et(47125,{Pc:Hp(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,s)=>e.targetTimeMs-s.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Hp(i){let t=i.message||"";return i.stack&&(t=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),t}class cn extends Ec{constructor(t,e,s,n){super(t,e,s,n),this.type="firestore",this._queue=new jp,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new jp(t),this._firestoreClient=void 0,await t}}}function XI(i,t){const e=typeof i=="object"?i:ac(),s=typeof i=="string"?i:za,n=go(e,"firestore").getImmediate({identifier:s});if(!n._initialized){const r=Jh("firestore");r&&KI(n,...r)}return n}function Fu(i){if(i._terminated)throw new j(V.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||YI(i),i._firestoreClient}function YI(i){const t=i._freezeSettings(),e=(function(n,r,o,a){return new vT(n,r,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,Ny(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)})(i._databaseId,i._app?.options.appId||"",i._persistenceKey,t);i._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(i._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),i._firestoreClient=new jI(i._authCredentials,i._appCheckCredentials,i._queue,e,i._componentsProvider&&(function(n){const r=n?._online.build();return{_offline:n?._offline.build(r),_online:r}})(i._componentsProvider))}class Xe{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Xe(me.fromBase64String(t))}catch(e){throw new j(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Xe(me.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Xe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(bo(t,Xe._jsonSchema))return Xe.fromBase64String(t.bytes)}}Xe._jsonSchemaVersion="firestore/bytes/1.0",Xe._jsonSchema={type:te("string",Xe._jsonSchemaVersion),bytes:te("string")};class Tc{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new j(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pe(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Sc{constructor(t){this._methodName=t}}class Ts{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new j(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new j(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return gt(this._lat,t._lat)||gt(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ts._jsonSchemaVersion}}static fromJSON(t){if(bo(t,Ts._jsonSchema))return new Ts(t.latitude,t.longitude)}}Ts._jsonSchemaVersion="firestore/geoPoint/1.0",Ts._jsonSchema={type:te("string",Ts._jsonSchemaVersion),latitude:te("number"),longitude:te("number")};class Ss{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(s,n){if(s.length!==n.length)return!1;for(let r=0;r<s.length;++r)if(s[r]!==n[r])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Ss._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(bo(t,Ss._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Ss(t.vectorValues);throw new j(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ss._jsonSchemaVersion="firestore/vectorValue/1.0",Ss._jsonSchema={type:te("string",Ss._jsonSchemaVersion),vectorValues:te("object")};const QI=/^__.*__$/;class JI{constructor(t,e,s){this.data=t,this.fieldMask=e,this.fieldTransforms=s}toMutation(t,e){return this.fieldMask!==null?new Ri(t,this.data,this.fieldMask,e,this.fieldTransforms):new wo(t,this.data,e,this.fieldTransforms)}}class Oy{constructor(t,e,s){this.data=t,this.fieldMask=e,this.fieldTransforms=s}toMutation(t,e){return new Ri(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Fy(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw et(40011,{Ac:i})}}class Vu{constructor(t,e,s,n,r,o){this.settings=t,this.databaseId=e,this.serializer=s,this.ignoreUndefinedProperties=n,r===void 0&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new Vu({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),s=this.Vc({path:e,fc:!1});return s.gc(t),s}yc(t){const e=this.path?.child(t),s=this.Vc({path:e,fc:!1});return s.Rc(),s}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Ya(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(Fy(this.Ac)&&QI.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class ZI{constructor(t,e,s){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=s||bc(t)}Cc(t,e,s,n=!1){return new Vu({Ac:t,methodName:e,Dc:s,path:pe.emptyPath(),fc:!1,bc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ic(i){const t=i._freezeSettings(),e=bc(i._databaseId);return new ZI(i._databaseId,!!t.ignoreUndefinedProperties,e)}function Vy(i,t,e,s,n,r={}){const o=i.Cc(r.merge||r.mergeFields?2:0,t,e,n);Uu("Data must be an object, but it was:",o,s);const a=By(s,o);let c,l;if(r.merge)c=new je(o.fieldMask),l=o.fieldTransforms;else if(r.mergeFields){const h=[];for(const u of r.mergeFields){const p=Ah(t,u,e);if(!o.contains(p))throw new j(V.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);$y(h,p)||h.push(p)}c=new je(h),l=o.fieldTransforms.filter((u=>c.covers(u.field)))}else c=null,l=o.fieldTransforms;return new JI(new Oe(a),c,l)}class Cc extends Sc{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Cc}}class Bu extends Sc{_toFieldTransform(t){return new qT(t.path,new Jr)}isEqual(t){return t instanceof Bu}}function tC(i,t,e,s){const n=i.Cc(1,t,e);Uu("Data must be an object, but it was:",n,s);const r=[],o=Oe.empty();Pi(s,((c,l)=>{const h=$u(t,c,e);l=Kt(l);const u=n.yc(h);if(l instanceof Cc)r.push(h);else{const p=So(l,u);p!=null&&(r.push(h),o.set(h,p))}}));const a=new je(r);return new Oy(o,a,n.fieldTransforms)}function eC(i,t,e,s,n,r){const o=i.Cc(1,t,e),a=[Ah(t,s,e)],c=[n];if(r.length%2!=0)throw new j(V.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<r.length;p+=2)a.push(Ah(t,r[p])),c.push(r[p+1]);const l=[],h=Oe.empty();for(let p=a.length-1;p>=0;--p)if(!$y(l,a[p])){const g=a[p];let y=c[p];y=Kt(y);const m=o.yc(g);if(y instanceof Cc)l.push(g);else{const v=So(y,m);v!=null&&(l.push(g),h.set(g,v))}}const u=new je(l);return new Oy(h,u,o.fieldTransforms)}function sC(i,t,e,s=!1){return So(e,i.Cc(s?4:3,t))}function So(i,t){if(Uy(i=Kt(i)))return Uu("Unsupported field value:",t,i),By(i,t);if(i instanceof Sc)return(function(s,n){if(!Fy(n.Ac))throw n.Sc(`${s._methodName}() can only be used with update() and set()`);if(!n.path)throw n.Sc(`${s._methodName}() is not currently supported inside arrays`);const r=s._toFieldTransform(n);r&&n.fieldTransforms.push(r)})(i,t),null;if(i===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),i instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(s,n){const r=[];let o=0;for(const a of s){let c=So(a,n.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),r.push(c),o++}return{arrayValue:{values:r}}})(i,t)}return(function(s,n){if((s=Kt(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return zT(n.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const r=ct.fromDate(s);return{timestampValue:Ga(n.serializer,r)}}if(s instanceof ct){const r=new ct(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Ga(n.serializer,r)}}if(s instanceof Ts)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Xe)return{bytesValue:ey(n.serializer,s._byteString)};if(s instanceof Wt){const r=n.databaseId,o=s.firestore._databaseId;if(!o.isEqual(r))throw n.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Eu(s.firestore._databaseId||n.databaseId,s._key.path)}}if(s instanceof Ss)return(function(o,a){return{mapValue:{fields:{[x_]:{stringValue:k_},[ja]:{arrayValue:{values:o.toArray().map((l=>{if(typeof l!="number")throw a.Sc("VectorValues must only contain numeric values.");return vu(a.serializer,l)}))}}}}}})(s,n);throw n.Sc(`Unsupported field value: ${uc(s)}`)})(i,t)}function By(i,t){const e={};return T_(i)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Pi(i,((s,n)=>{const r=So(n,t.mc(s));r!=null&&(e[s]=r)})),{mapValue:{fields:e}}}function Uy(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof ct||i instanceof Ts||i instanceof Xe||i instanceof Wt||i instanceof Sc||i instanceof Ss)}function Uu(i,t,e){if(!Uy(e)||!A_(e)){const s=uc(e);throw s==="an object"?t.Sc(i+" a custom object"):t.Sc(i+" "+s)}}function Ah(i,t,e){if((t=Kt(t))instanceof Tc)return t._internalPath;if(typeof t=="string")return $u(i,t);throw Ya("Field path arguments must be of type string or ",i,!1,void 0,e)}const iC=new RegExp("[~\\*/\\[\\]]");function $u(i,t,e){if(t.search(iC)>=0)throw Ya(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,e);try{return new Tc(...t.split("."))._internalPath}catch{throw Ya(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,e)}}function Ya(i,t,e,s,n){const r=s&&!s.isEmpty(),o=n!==void 0;let a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${n}`),c+=")"),new j(V.INVALID_ARGUMENT,a+i+c)}function $y(i,t){return i.some((e=>e.isEqual(t)))}class zy{constructor(t,e,s,n,r){this._firestore=t,this._userDataWriter=e,this._key=s,this._document=n,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Wt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new nC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Pc("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class nC extends zy{data(){return super.data()}}function Pc(i,t){return typeof t=="string"?$u(i,t):t instanceof Tc?t._internalPath:t._delegate._internalPath}function rC(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new j(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class zu{}class jy extends zu{}function eo(i,t,...e){let s=[];t instanceof zu&&s.push(t),s=s.concat(e),(function(r){const o=r.filter((c=>c instanceof ju)).length,a=r.filter((c=>c instanceof Rc)).length;if(o>1||o>0&&a>0)throw new j(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const n of s)i=n._apply(i);return i}class Rc extends jy{constructor(t,e,s){super(),this._field=t,this._op=e,this._value=s,this.type="where"}static _create(t,e,s){return new Rc(t,e,s)}_apply(t){const e=this._parse(t);return Hy(t._query,e),new on(t.firestore,t.converter,uh(t._query,e))}_parse(t){const e=Ic(t.firestore);return(function(r,o,a,c,l,h,u){let p;if(l.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new j(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Gp(u,h);const y=[];for(const m of u)y.push(qp(c,r,m));p={arrayValue:{values:y}}}else p=qp(c,r,u)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Gp(u,h),p=sC(a,o,u,h==="in"||h==="not-in");return Zt.create(l,h,p)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}function $r(i,t,e){const s=t,n=Pc("where",i);return Rc._create(n,s,e)}class ju extends zu{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new ju(t,e)}_parse(t){const e=this._queryConstraints.map((s=>s._parse(t))).filter((s=>s.getFilters().length>0));return e.length===1?e[0]:ls.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:((function(n,r){let o=n;const a=r.getFlattenedFilters();for(const c of a)Hy(o,c),o=uh(o,c)})(t._query,e),new on(t.firestore,t.converter,uh(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Hu extends jy{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Hu(t,e)}_apply(t){const e=(function(n,r,o){if(n.startAt!==null)throw new j(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new j(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Qr(r,o)})(t._query,this._field,this._direction);return new on(t.firestore,t.converter,(function(n,r){const o=n.explicitOrderBy.concat([r]);return new Jn(n.path,n.collectionGroup,o,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)})(t._query,e))}}function so(i,t="asc"){const e=t,s=Pc("orderBy",i);return Hu._create(s,e)}function qp(i,t,e){if(typeof(e=Kt(e))=="string"){if(e==="")throw new j(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!B_(t)&&e.indexOf("/")!==-1)throw new j(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const s=t.path.child(Rt.fromString(e));if(!Q.isDocumentKey(s))throw new j(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return cp(i,new Q(s))}if(e instanceof Wt)return cp(i,e._key);throw new j(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uc(e)}.`)}function Gp(i,t){if(!Array.isArray(i)||i.length===0)throw new j(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Hy(i,t){const e=(function(n,r){for(const o of n)for(const a of o.getFlattenedFilters())if(r.indexOf(a.op)>=0)return a.op;return null})(i.filters,(function(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new j(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new j(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class oC{convertValue(t,e="none"){switch(yi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Gt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(_i(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw et(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const s={};return Pi(t,((n,r)=>{s[n]=this.convertValue(r,e)})),s}convertVectorValue(t){const e=t.fields?.[ja].arrayValue?.values?.map((s=>Gt(s.doubleValue)));return new Ss(e)}convertGeoPoint(t){return new Ts(Gt(t.latitude),Gt(t.longitude))}convertArray(t,e){return(t.values||[]).map((s=>this.convertValue(s,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const s=pc(t);return s==null?null:this.convertValue(s,e);case"estimate":return this.convertTimestamp(Kr(t));default:return null}}convertTimestamp(t){const e=mi(t);return new ct(e.seconds,e.nanos)}convertDocumentKey(t,e){const s=Rt.fromString(t);Tt(ay(s),9688,{name:t});const n=new Xr(s.get(1),s.get(3)),r=new Q(s.popFirst(5));return n.isEqual(e)||qs(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}function qy(i,t,e){let s;return s=i?e&&(e.merge||e.mergeFields)?i.toFirestore(t,e):i.toFirestore(t):t,s}class Rr{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Hi extends zy{constructor(t,e,s,n,r,o){super(t,e,s,n,o),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ta(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const s=this._document.data.field(Pc("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new j(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Hi._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Hi._jsonSchemaVersion="firestore/documentSnapshot/1.0",Hi._jsonSchema={type:te("string",Hi._jsonSchemaVersion),bundleSource:te("string","DocumentSnapshot"),bundleName:te("string"),bundle:te("string")};class Ta extends Hi{data(t={}){return super.data(t)}}class kn{constructor(t,e,s,n){this._firestore=t,this._userDataWriter=e,this._snapshot=n,this.metadata=new Rr(n.hasPendingWrites,n.fromCache),this.query=s}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((s=>{t.call(e,new Ta(this._firestore,this._userDataWriter,s.key,s,new Rr(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new j(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(n,r){if(n._snapshot.oldDocs.isEmpty()){let o=0;return n._snapshot.docChanges.map((a=>{const c=new Ta(n._firestore,n._userDataWriter,a.doc.key,a.doc,new Rr(n._snapshot.mutatedKeys.has(a.doc.key),n._snapshot.fromCache),n.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}}))}{let o=n._snapshot.oldDocs;return n._snapshot.docChanges.filter((a=>r||a.type!==3)).map((a=>{const c=new Ta(n._firestore,n._userDataWriter,a.doc.key,a.doc,new Rr(n._snapshot.mutatedKeys.has(a.doc.key),n._snapshot.fromCache),n.query.converter);let l=-1,h=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:aC(a.type),doc:c,oldIndex:l,newIndex:h}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new j(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=kn._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=du.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],s=[],n=[];return this.docs.forEach((r=>{r._document!==null&&(e.push(r._document),s.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),n.push(r.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function aC(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return et(61501,{type:i})}}function Te(i){i=cs(i,Wt);const t=cs(i.firestore,cn);return GI(Fu(t),i._key).then((e=>lC(t,i,e)))}kn._jsonSchemaVersion="firestore/querySnapshot/1.0",kn._jsonSchema={type:te("string",kn._jsonSchemaVersion),bundleSource:te("string","QuerySnapshot"),bundleName:te("string"),bundle:te("string")};class Gy extends oC{constructor(t){super(),this.firestore=t}convertBytes(t){return new Xe(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Wt(this.firestore,null,e)}}function Io(i){i=cs(i,on);const t=cs(i.firestore,cn),e=Fu(t),s=new Gy(t);return rC(i._query),WI(e,i._query).then((n=>new kn(t,s,i,n)))}function Ee(i,t,e){i=cs(i,Wt);const s=cs(i.firestore,cn),n=qy(i.converter,t,e);return xc(s,[Vy(Ic(s),"setDoc",i._key,n,i.converter!==null,e).toMutation(i._key,Qe.none())])}function Wy(i,t,e,...s){i=cs(i,Wt);const n=cs(i.firestore,cn),r=Ic(n);let o;return o=typeof(t=Kt(t))=="string"||t instanceof Tc?eC(r,"updateDoc",i._key,t,e,s):tC(r,"updateDoc",i._key,t),xc(n,[o.toMutation(i._key,Qe.exists(!0))])}function cC(i){return xc(cs(i.firestore,cn),[new bu(i._key,Qe.none())])}function Ky(i,t){const e=cs(i.firestore,cn),s=he(i),n=qy(i.converter,t);return xc(e,[Vy(Ic(i.firestore),"addDoc",s._key,n,i.converter!==null,{}).toMutation(s._key,Qe.exists(!1))]).then((()=>s))}function xc(i,t){return(function(s,n){const r=new $s;return s.asyncQueue.enqueueAndForget((async()=>NI(await qI(s),n,r))),r.promise})(Fu(i),t)}function lC(i,t,e){const s=e.docs.get(t._key),n=new Gy(i);return new Hi(i,n,t._key,s,new Rr(e.hasPendingWrites,e.fromCache),t.converter)}function It(){return new Bu("serverTimestamp")}(function(t,e=!0){(function(n){Xn=n})(sn),pi(new zs("firestore",((s,{instanceIdentifier:n,options:r})=>{const o=s.getProvider("app").getImmediate(),a=new cn(new tT(s.getProvider("auth-internal")),new iT(o,s.getProvider("app-check-internal")),(function(l,h){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new j(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xr(l.options.projectId,h)})(o,n),o);return r={useFetchStreams:e,...r},a._setSettings(r),a}),"PUBLIC").setMultipleInstances(!0)),Ye(Xf,Yf,t),Ye(Xf,Yf,"esm2020")})();const Xy="firebasestorage.googleapis.com",hC="storageBucket",uC=120*1e3,dC=600*1e3;class xs extends Rs{constructor(t,e,s=0){super(Al(t),`Firebase Storage: ${e} (${Al(t)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,xs.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Al(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Cs;(function(i){i.UNKNOWN="unknown",i.OBJECT_NOT_FOUND="object-not-found",i.BUCKET_NOT_FOUND="bucket-not-found",i.PROJECT_NOT_FOUND="project-not-found",i.QUOTA_EXCEEDED="quota-exceeded",i.UNAUTHENTICATED="unauthenticated",i.UNAUTHORIZED="unauthorized",i.UNAUTHORIZED_APP="unauthorized-app",i.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",i.INVALID_CHECKSUM="invalid-checksum",i.CANCELED="canceled",i.INVALID_EVENT_NAME="invalid-event-name",i.INVALID_URL="invalid-url",i.INVALID_DEFAULT_BUCKET="invalid-default-bucket",i.NO_DEFAULT_BUCKET="no-default-bucket",i.CANNOT_SLICE_BLOB="cannot-slice-blob",i.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",i.NO_DOWNLOAD_URL="no-download-url",i.INVALID_ARGUMENT="invalid-argument",i.INVALID_ARGUMENT_COUNT="invalid-argument-count",i.APP_DELETED="app-deleted",i.INVALID_ROOT_OPERATION="invalid-root-operation",i.INVALID_FORMAT="invalid-format",i.INTERNAL_ERROR="internal-error",i.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Cs||(Cs={}));function Al(i){return"storage/"+i}function fC(){const i="An unknown error occurred, please check the error payload for server response.";return new xs(Cs.UNKNOWN,i)}function pC(){return new xs(Cs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function gC(){return new xs(Cs.CANCELED,"User canceled the upload/download.")}function mC(i){return new xs(Cs.INVALID_URL,"Invalid URL '"+i+"'.")}function _C(i){return new xs(Cs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.")}function Wp(i){return new xs(Cs.INVALID_ARGUMENT,i)}function Yy(){return new xs(Cs.APP_DELETED,"The Firebase app was deleted.")}function yC(i){return new xs(Cs.INVALID_ROOT_OPERATION,"The operation '"+i+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}class ss{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let s;try{s=ss.makeFromUrl(t,e)}catch{return new ss(t,"")}if(s.path==="")return s;throw _C(t)}static makeFromUrl(t,e){let s=null;const n="([A-Za-z0-9.\\-_]+)";function r(P){P.path.charAt(P.path.length-1)==="/"&&(P.path_=P.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+n+o,"i"),c={bucket:1,path:3};function l(P){P.path_=decodeURIComponent(P.path)}const h="v[A-Za-z0-9_]+",u=e.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",g=new RegExp(`^https?://${u}/${h}/b/${n}/o${p}`,"i"),y={bucket:1,path:3},m=e===Xy?"(?:storage.googleapis.com|storage.cloud.google.com)":e,v="([^?#]*)",w=new RegExp(`^https?://${m}/${n}/${v}`,"i"),A=[{regex:a,indices:c,postModify:r},{regex:g,indices:y,postModify:l},{regex:w,indices:{bucket:1,path:2},postModify:l}];for(let P=0;P<A.length;P++){const x=A[P],M=x.regex.exec(t);if(M){const S=M[x.indices.bucket];let T=M[x.indices.path];T||(T=""),s=new ss(S,T),x.postModify(s);break}}if(s==null)throw mC(t);return s}}class vC{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function bC(i,t,e){let s=1,n=null,r=null,o=!1,a=0;function c(){return a===2}let l=!1;function h(...v){l||(l=!0,t.apply(null,v))}function u(v){n=setTimeout(()=>{n=null,i(g,c())},v)}function p(){r&&clearTimeout(r)}function g(v,...w){if(l){p();return}if(v){p(),h.call(null,v,...w);return}if(c()||o){p(),h.call(null,v,...w);return}s<64&&(s*=2);let A;a===1?(a=2,A=0):A=(s+Math.random())*1e3,u(A)}let y=!1;function m(v){y||(y=!0,p(),!l&&(n!==null?(v||(a=2),clearTimeout(n),u(0)):v||(a=1)))}return u(0),r=setTimeout(()=>{o=!0,m(!0)},e),m}function wC(i){i(!1)}function AC(i){return i!==void 0}function Kp(i,t,e,s){if(s<t)throw Wp(`Invalid value for '${i}'. Expected ${t} or greater.`);if(s>e)throw Wp(`Invalid value for '${i}'. Expected ${e} or less.`)}function EC(i){const t=encodeURIComponent;let e="?";for(const s in i)if(i.hasOwnProperty(s)){const n=t(s)+"="+t(i[s]);e=e+n+"&"}return e=e.slice(0,-1),e}var Qa;(function(i){i[i.NO_ERROR=0]="NO_ERROR",i[i.NETWORK_ERROR=1]="NETWORK_ERROR",i[i.ABORT=2]="ABORT"})(Qa||(Qa={}));function TC(i,t){const e=i>=500&&i<600,n=[408,429].indexOf(i)!==-1,r=t.indexOf(i)!==-1;return e||n||r}class SC{constructor(t,e,s,n,r,o,a,c,l,h,u,p=!0,g=!1){this.url_=t,this.method_=e,this.headers_=s,this.body_=n,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=h,this.connectionFactory_=u,this.retry=p,this.isUsingEmulator=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((y,m)=>{this.resolve_=y,this.reject_=m,this.start_()})}start_(){const t=(s,n)=>{if(n){s(!1,new ea(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const o=a=>{const c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;const a=r.getErrorCode()===Qa.NO_ERROR,c=r.getStatus();if(!a||TC(c,this.additionalRetryCodes_)&&this.retry){const h=r.getErrorCode()===Qa.ABORT;s(!1,new ea(!1,null,h));return}const l=this.successCodes_.indexOf(c)!==-1;s(!0,new ea(l,r))})},e=(s,n)=>{const r=this.resolve_,o=this.reject_,a=n.connection;if(n.wasSuccessCode)try{const c=this.callback_(a,a.getResponse());AC(c)?r(c):r()}catch(c){o(c)}else if(a!==null){const c=fC();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(n.canceled){const c=this.appDelete_?Yy():gC();o(c)}else{const c=pC();o(c)}};this.canceled_?e(!1,new ea(!1,null,!0)):this.backoffId_=bC(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&wC(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class ea{constructor(t,e,s){this.wasSuccessCode=t,this.connection=e,this.canceled=!!s}}function IC(i,t){t!==null&&t.length>0&&(i.Authorization="Firebase "+t)}function CC(i,t){i["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function PC(i,t){t&&(i["X-Firebase-GMPID"]=t)}function RC(i,t){t!==null&&(i["X-Firebase-AppCheck"]=t)}function xC(i,t,e,s,n,r,o=!0,a=!1){const c=EC(i.urlParams),l=i.url+c,h=Object.assign({},i.headers);return PC(h,t),IC(h,e),CC(h,r),RC(h,s),new SC(l,i.method,h,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,n,o,a)}function kC(i){if(i.length===0)return null;const t=i.lastIndexOf("/");return t===-1?"":i.slice(0,t)}function DC(i){const t=i.lastIndexOf("/",i.length-2);return t===-1?i:i.slice(t+1)}class Ja{constructor(t,e){this._service=t,e instanceof ss?this._location=e:this._location=ss.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new Ja(t,e)}get root(){const t=new ss(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return DC(this._location.path)}get storage(){return this._service}get parent(){const t=kC(this._location.path);if(t===null)return null;const e=new ss(this._location.bucket,t);return new Ja(this._service,e)}_throwIfRoot(t){if(this._location.path==="")throw yC(t)}}function Xp(i,t){const e=t?.[hC];return e==null?null:ss.makeFromBucketSpec(e,i)}function MC(i,t,e,s={}){i.host=`${t}:${e}`;const n=Ti(t);n&&(rc(`https://${i.host}/b`),oc("Storage",!0)),i._isUsingEmulator=!0,i._protocol=n?"https":"http";const{mockUserToken:r}=s;r&&(i._overrideAuthToken=typeof r=="string"?r:Pm(r,i.app.options.projectId))}class NC{constructor(t,e,s,n,r,o=!1){this.app=t,this._authProvider=e,this._appCheckProvider=s,this._url=n,this._firebaseVersion=r,this._isUsingEmulator=o,this._bucket=null,this._host=Xy,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=uC,this._maxUploadRetryTime=dC,this._requests=new Set,n!=null?this._bucket=ss.makeFromBucketSpec(n,this._host):this._bucket=Xp(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=ss.makeFromBucketSpec(this._url,t):this._bucket=Xp(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Kp("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Kp("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(e!==null)return e.accessToken}return null}async _getAppCheckToken(){if(xe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Ja(this,t)}_makeRequest(t,e,s,n,r=!0){if(this._deleted)return new vC(Yy());{const o=xC(t,this._appId,s,n,e,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(t,e){const[s,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,s,n).getPromise()}}const Yp="@firebase/storage",Qp="0.14.0";const Qy="storage";function LC(i=ac(),t){i=Kt(i);const s=go(i,Qy).getImmediate({identifier:t}),n=Jh("storage");return n&&OC(s,...n),s}function OC(i,t,e,s={}){MC(i,t,e,s)}function FC(i,{instanceIdentifier:t}){const e=i.getProvider("app").getImmediate(),s=i.getProvider("auth-internal"),n=i.getProvider("app-check-internal");return new NC(e,s,n,t,sn)}function VC(){pi(new zs(Qy,FC,"PUBLIC").setMultipleInstances(!0)),Ye(Yp,Qp,""),Ye(Yp,Qp,"esm2020")}VC();const Jy="functions";class BC{constructor(t,e,s,n){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,xe(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=e.getImmediate({optional:!0}),this.messaging=s.getImmediate({optional:!0}),this.auth||e.get().then(r=>this.auth=r,()=>{}),this.messaging||s.get().then(r=>this.messaging=r,()=>{}),this.appCheck||n?.get().then(r=>this.appCheck=r,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const e=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(t){const e=await this.getAuthToken(),s=await this.getMessagingToken(),n=await this.getAppCheckToken(t);return{authToken:e,messagingToken:s,appCheckToken:n}}}const Eh="us-central1";class UC{constructor(t,e,s,n,r=Eh,o=(...a)=>fetch(...a)){this.app=t,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new BC(t,e,s,n),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(r);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=Eh}catch{this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(t){const e=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${e}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${e}.cloudfunctions.net/${t}`}}function $C(i,t,e){const s=Ti(t);i.emulatorOrigin=`http${s?"s":""}://${t}:${e}`,s&&(rc(i.emulatorOrigin+"/backends"),oc("Functions",!0))}const Jp="@firebase/functions",Zp="0.13.1";const zC="auth-internal",jC="app-check-internal",HC="messaging-internal";function qC(i){const t=(e,{instanceIdentifier:s})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider(zC),o=e.getProvider(HC),a=e.getProvider(jC);return new UC(n,r,o,a,s)};pi(new zs(Jy,t,"PUBLIC").setMultipleInstances(!0)),Ye(Jp,Zp,i),Ye(Jp,Zp,"esm2020")}function GC(i=ac(),t=Eh){const s=go(Kt(i),Jy).getImmediate({identifier:t}),n=Jh("functions");return n&&WC(s,...n),s}function WC(i,t,e){$C(Kt(i),t,e)}qC();const KC={apiKey:"AIzaSyD3VIZjYjvZxyVSoNrs3FUZxep5r3AXeFA",authDomain:"guerreiro-concursos-oficial.firebaseapp.com",projectId:"guerreiro-concursos-oficial",storageBucket:"guerreiro-concursos-oficial.appspot.com",messagingSenderId:"176980973078",appId:"1:176980973078:web:110816ab0d4a92d62dc737"},kc=km(KC),ni=YE(kc),Lt=XI(kc);LC(kc);GC(kc);function Zy(i){const t={};for(const e in i)i.hasOwnProperty(e)&&i[e]!==void 0&&(t[e]=i[e]);return t}async function El(i,t){const e=he(Lt,"users",i);if((await Te(e)).exists()){console.log(`[GC/UserService] Perfil j existe para ${i}`);return}const n={uid:i,email:t,plan:"free",isTester:!1,premiumUntil:null,subscriptionStatus:void 0,editaisProcessados:0,diasAtivos:0,disciplinasVistas:0,semanasCriadas:0,cartasEstudadas:0,historicoAtividade:[],pontos:0,nivel:1,medalhas:[],progressaoNivel:0,lastActivity:It(),createdAt:It(),updatedAt:It()};await Ee(e,n),console.log(`[GC/UserService] Perfil criado para ${i}`)}async function Sa(i){const t=he(Lt,"users",i),e=await Te(t);if(!e.exists())return null;const s=e.data(),n=s.createdAt instanceof ct?s.createdAt.toDate():s.createdAt?.toDate?.()||new Date,r=s.premiumUntil?s.premiumUntil instanceof ct?s.premiumUntil.toDate():s.premiumUntil?.toDate?.()||null:null,o=s.lastActivity?s.lastActivity instanceof ct?s.lastActivity.toDate():s.lastActivity?.toDate?.()||null:null;return{uid:s.uid,email:s.email||"",displayName:s.displayName,photoURL:s.photoURL,createdAt:n,plan:s.plan||"free",isTester:s.isTester||!1,premiumUntil:r,subscriptionStatus:s.subscriptionStatus||"free",lastActivity:o,editaisProcessados:s.editaisProcessados||0,diasAtivos:s.diasAtivos||0,disciplinasVistas:s.disciplinasVistas||0,semanasCriadas:s.semanasCriadas||0,cartasEstudadas:s.cartasEstudadas||0,historicoAtividade:s.historicoAtividade||[],pontos:s.pontos||0,nivel:s.nivel||1,medalhas:s.medalhas||[],progressaoNivel:s.progressaoNivel||0}}async function Tl(i,t){const e=he(Lt,"users",i),s={updatedAt:It()};t.email!==void 0&&(s.email=t.email),t.displayName!==void 0&&(s.displayName=t.displayName),t.photoURL!==void 0&&(s.photoURL=t.photoURL),t.plan!==void 0&&(s.plan=t.plan),t.isTester!==void 0&&(s.isTester=t.isTester),t.premiumUntil!==void 0&&(s.premiumUntil=t.premiumUntil?ct.fromDate(t.premiumUntil):null),t.subscriptionStatus!==void 0&&(s.subscriptionStatus=t.subscriptionStatus),t.stripeCustomerId!==void 0&&(s.stripeCustomerId=t.stripeCustomerId),t.stripeSubscriptionId!==void 0&&(s.stripeSubscriptionId=t.stripeSubscriptionId),t.lastActivity!==void 0&&(s.lastActivity=t.lastActivity?ct.fromDate(t.lastActivity):It()),t.editaisProcessados!==void 0&&(s.editaisProcessados=t.editaisProcessados),t.diasAtivos!==void 0&&(s.diasAtivos=t.diasAtivos),t.disciplinasVistas!==void 0&&(s.disciplinasVistas=t.disciplinasVistas),t.semanasCriadas!==void 0&&(s.semanasCriadas=t.semanasCriadas),t.cartasEstudadas!==void 0&&(s.cartasEstudadas=t.cartasEstudadas),t.historicoAtividade!==void 0&&(s.historicoAtividade=t.historicoAtividade),t.pontos!==void 0&&(s.pontos=t.pontos),t.nivel!==void 0&&(s.nivel=t.nivel),t.medalhas!==void 0&&(s.medalhas=t.medalhas),t.progressaoNivel!==void 0&&(s.progressaoNivel=t.progressaoNivel);const n=Zy(s);await Ee(e,n,{merge:!0}),console.log(`[GC/UserService] Perfil atualizado para ${i}`,n)}async function tg(i,t){const e=he(Lt,"users",i),s=await Te(e);if(s.exists()){const n=s.data();if(t&&n.email!==t){const r={email:t,updatedAt:It()},o=Zy(r);await Ee(e,o,{merge:!0})}}else{const n={uid:i,email:t||null,plan:"free",isTester:!1,premiumUntil:null,editaisProcessados:0,diasAtivos:0,disciplinasVistas:0,semanasCriadas:0,cartasEstudadas:0,historicoAtividade:[],pontos:0,nivel:1,medalhas:[],progressaoNivel:0,lastActivity:It(),createdAt:It(),updatedAt:It()};await Ee(e,n)}}async function XC(i){const t=he(Lt,"users",i),e=await Te(t);if(!e.exists())return null;const s=e.data(),n=s.premiumUntil?s.premiumUntil instanceof ct?s.premiumUntil.toDate():s.premiumUntil.toDate?.()||null:null;return{plan:s.plan||"free",isTester:s.isTester||!1,premiumUntil:n,subscriptionStatus:s.subscriptionStatus||void 0}}async function YC(i){const t=he(Lt,"users",i),e=await Te(t);if(!e.exists()){await Ee(t,{uid:i,editaisProcessados:1,updatedAt:It()},{merge:!0});return}const n=e.data().editaisProcessados||0;await Ee(t,{editaisProcessados:n+1,updatedAt:It()},{merge:!0})}async function QC(i){const t=he(Lt,"users",i),e=await Te(t);if(!e.exists()){await Ee(t,{uid:i,disciplinasVistas:1,updatedAt:It()},{merge:!0});return}const n=e.data().disciplinasVistas||0;await Ee(t,{disciplinasVistas:n+1,updatedAt:It()},{merge:!0})}async function JC(i){const t=he(Lt,"users",i),e=await Te(t);if(!e.exists()){await Ee(t,{uid:i,semanasCriadas:1,updatedAt:It()},{merge:!0});return}const n=e.data().semanasCriadas||0;await Ee(t,{semanasCriadas:n+1,updatedAt:It()},{merge:!0})}async function tv(i){const t=he(Lt,"users",i),e=await Te(t);if(!e.exists())return;const n=e.data().historicoAtividade||[],r=new Date;r.setHours(0,0,0,0);const o=r.toISOString().split("T")[0];let a=[...n];const c=a.findIndex(h=>h.date===o);c>=0?a[c]={date:o,count:a[c].count+1}:a.push({date:o,count:1});const l=new Date(r);l.setDate(l.getDate()-7),a=a.filter(h=>new Date(h.date)>=l),a.sort((h,u)=>h.date.localeCompare(u.date)),await Ee(t,{historicoAtividade:a,updatedAt:It()},{merge:!0})}async function ZC(i,t,e){const s=he(Lt,"users",i),n=await Te(s);if(!n.exists())return;const o=n.data().diasAtivos||0,a=t.getTime()-e.getTime(),c=Math.ceil(a/(1e3*60*60*24));c>o&&await Ee(s,{diasAtivos:c,updatedAt:It()},{merge:!0})}function t1(i){if(i<100)return{nivel:1,progressaoNivel:Math.min(100,i/100*100)};if(i<250){const t=(i-100)/150*100;return{nivel:2,progressaoNivel:Math.min(100,t)}}else if(i<500){const t=(i-250)/250*100;return{nivel:3,progressaoNivel:Math.min(100,t)}}else if(i<1e3){const t=(i-500)/500*100;return{nivel:4,progressaoNivel:Math.min(100,t)}}else return{nivel:5,progressaoNivel:100}}async function e1(i,t){const e=he(Lt,"users",i),s=await Te(e);if(!s.exists()){console.warn(`[GC/Gamificacao] Usurio ${i} no encontrado ao adicionar pontos`);return}const o=(s.data().pontos||0)+t,{nivel:a,progressaoNivel:c}=t1(o);await Ee(e,{pontos:o,nivel:a,progressaoNivel:c,updatedAt:It()},{merge:!0}),console.log(`[GC/Gamificacao] ${t} pontos adicionados para ${i}. Total: ${o}, Nvel: ${a}`)}async function ri(i,t){const e=he(Lt,"users",i),s=await Te(e);if(!s.exists())return console.warn(`[GC/Gamificacao] Usurio ${i} no encontrado ao adicionar medalha`),!1;const r=s.data().medalhas||[];if(r.includes(t))return!1;const o=[...r,t];return await Ee(e,{medalhas:o,updatedAt:It()},{merge:!0}),console.log(`[GC/Gamificacao] Medalha "${t}" adicionada para ${i}`),!0}async function s1(i){const t=he(Lt,"users",i),e=await Te(t);if(!e.exists()){await Ee(t,{uid:i,cartasEstudadas:1,updatedAt:It()},{merge:!0});return}const n=e.data().cartasEstudadas||0;await Ee(t,{cartasEstudadas:n+1,updatedAt:It()},{merge:!0})}const yr={PRIMEIRO_EDITAL:"primeiro_edital",SETE_DIAS_ATIVO:"sete_dias_ativo",GUERREIRO_CONSTANTE:"guerreiro_constante",PREMIUM_PRIMEIRA_VEZ:"premium_primeira_vez",MAPA_DESBLOQUEADO:"mapa_desbloqueado"};async function Ji(i,t,e){await e1(i,t),await ev(i,e)}async function ev(i,t){const e=await Sa(i);e&&(t?.tipo==="edital_processado"&&e.editaisProcessados===1&&await ri(i,yr.PRIMEIRO_EDITAL),e.diasAtivos&&e.diasAtivos>=7&&await ri(i,yr.SETE_DIAS_ATIVO),t?.tipo==="streak_3_dias"&&await ri(i,yr.GUERREIRO_CONSTANTE),t?.tipo==="premium_ativado"&&e.plan==="premium"&&await ri(i,yr.PREMIUM_PRIMEIRA_VEZ),t?.tipo==="mapa_aberto"&&await ri(i,yr.MAPA_DESBLOQUEADO))}async function i1(i){await Ji(i,5,{tipo:"app_aberto"})}async function n1(i){await Ji(i,10,{tipo:"edital_processado"})}async function r1(i){await Ji(i,3,{tipo:"mapa_aberto"})}async function o1(i){await Ji(i,3,{tipo:"cronograma_aberto"})}async function a1(i){await Ji(i,20,{tipo:"streak_3_dias"})}const sv=Gh(void 0);function Sl(i,t,e,s){if(s)return!0;const n=new Date;if(t==="active")return!0;if(e){const r=e instanceof Date?e:new Date(e);if(!isNaN(r.getTime())&&r>n)return!0}return!1}function c1({children:i}){const[t,e]=$(null),[s,n]=$(!0),[r,o]=$(null),[a,c]=$(!1),[l,h]=$(!1),[u,p]=$("free"),[g,y]=$(!1),[m,v]=$(!1),[w,E]=$(void 0),[A,P]=$(void 0),[x,M]=$(null),[S,T]=$(null),I=async(dt,at)=>{c(!0);try{await tg(dt,at);const z=await Sa(dt);if(z){o(z),p(z.plan),h(!!z.isTester),E(z.subscriptionStatus==="free"?void 0:z.subscriptionStatus),P(z.premiumUntil);const Z=Sl(z.plan,z.subscriptionStatus==="free"?void 0:z.subscriptionStatus,z.premiumUntil,z.isTester);v(Z),M({editaisProcessados:z.editaisProcessados||0,disciplinasVistas:z.disciplinasVistas||0,semanasCriadas:z.semanasCriadas||0,diasAtivos:z.diasAtivos||0,lastActivity:z.lastActivity||null}),T({pontos:z.pontos||0,nivel:z.nivel||1,progressaoNivel:z.progressaoNivel||0,medalhas:z.medalhas||[]})}else if(at){await El(dt,at);const Z=await Sa(dt);Z&&(o(Z),p(Z.plan),h(!!Z.isTester),E(void 0),P(null),v(!1),M({editaisProcessados:Z.editaisProcessados||0,disciplinasVistas:Z.disciplinasVistas||0,semanasCriadas:Z.semanasCriadas||0,diasAtivos:Z.diasAtivos||0,lastActivity:Z.lastActivity||null}),T({pontos:Z.pontos||0,nivel:Z.nivel||1,progressaoNivel:Z.progressaoNivel||0,medalhas:Z.medalhas||[]}))}else o(null),p("free"),h(!1),E(void 0),P(void 0),v(!1)}catch(z){console.error("[GC/Auth] Erro ao carregar perfil do usurio:",z),o(null),p("free"),v(!1)}finally{c(!1)}},k=async(dt,at)=>{y(!0);try{await tg(dt,at);const z=await XC(dt);if(z){p(z.plan),h(!!z.isTester),E(z.subscriptionStatus),P(z.premiumUntil);const Z=Sl(z.plan,z.subscriptionStatus,z.premiumUntil,z.isTester);v(Z)}else p("free"),h(!1),E(void 0),P(void 0),v(!1)}catch(z){console.error("Erro ao carregar plano do usurio:",z),p("free"),h(!1),v(!1)}finally{y(!1)}},R=async()=>{t&&await I(t.uid,t.email||void 0)},N=async()=>{t&&await k(t.uid,t.email||void 0)},D=async dt=>{if(!t)throw new Error("Usurio no autenticado");await Tl(t.uid,dt),await R()};bt(()=>{t&&r&&(t.displayName!==r.displayName||t.photoURL!==r.photoURL)&&Tl(t.uid,{displayName:t.displayName||void 0,photoURL:t.photoURL||void 0}).catch(console.error)},[t,r]),bt(()=>{if(!t||!r)return;const dt=async()=>{const z=new Date;try{if(await Tl(t.uid,{lastActivity:z}),await tv(t.uid),r.createdAt){const Z=r.diasAtivos||0;await ZC(t.uid,z,r.createdAt);const Se=await Sa(t.uid);Se&&Se.diasAtivos===3&&Z<3&&await a1(t.uid)}M(Z=>Z?{...Z,lastActivity:z}:null)}catch(Z){console.error("[GC/Auth] Erro ao atualizar atividade:",Z)}};dt();const at=setInterval(dt,300*1e3);return()=>clearInterval(at)},[t,r]),bt(()=>{t?(I(t.uid,t.email||void 0),i1(t.uid).catch(dt=>{console.error("[GC/Auth] Erro ao conceder pontos por abrir app:",dt)})):(o(null),p("free"),h(!1),v(!1),E(void 0),P(void 0),M(null),T(null),c(!1),y(!1))},[t]),bt(()=>{if(!t||!A)return;const dt=()=>{(A instanceof Date?A:new Date(A))<=new Date&&w!=="active"&&(console.log("[GC/Auth] Premium expirado, recarregando perfil..."),R())};dt();const at=setInterval(dt,6e4);return()=>clearInterval(at)},[t,A,w,R]),bt(()=>{const dt=V0(ni,at=>{e(at),n(!1)});return()=>dt()},[]);const Xt={user:t,loading:s,profile:r,loadingProfile:a,isTester:l,plan:u,loadingPlan:g,isPremium:m,subscriptionStatus:w,premiumUntil:A,analytics:x,gamificacao:S,refreshProfile:R,refreshPlan:N,updateProfile:D,login:async(dt,at)=>{await L0(ni,dt,at)},loginWithGoogle:async()=>{const dt=new Os,at=await rE(ni,dt),z=at.user.email;z&&await El(at.user.uid,z)},register:async(dt,at)=>{const z=await N0(ni,dt,at);await El(z.user.uid,dt)},logout:async()=>{await B0(ni)},isPremiumUser:()=>Sl(u,w,A,l)};return d(sv.Provider,{value:Xt,children:i})}function $t(){const i=Xh(sv);if(i===void 0)throw new Error("useAuth must be used within an AuthProvider");return i}const Ia=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("circle",{cx:"12",cy:"12",r:"10"}),F("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),F("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"}))},l1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),F("polyline",{points:"12 19 5 12 12 5"}))},h1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),F("polyline",{points:"12 5 19 12 12 19"}))},u1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("circle",{cx:"12",cy:"8",r:"7"}),F("polyline",{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}))},Dc=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),F("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"}))},iv=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),F("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"}))},wi=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),F("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),F("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),F("line",{x1:"3",y1:"10",x2:"21",y2:"10"}))},ys=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),F("polyline",{points:"22 4 12 14.01 9 11.01"}))},d1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("polyline",{points:"6 9 12 15 18 9"}))},f1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("circle",{cx:"12",cy:"12",r:"10"}))},Mc=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("circle",{cx:"12",cy:"12",r:"10"}),F("polyline",{points:"12 6 12 12 16 14"}))},p1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),F("line",{x1:"1",y1:"10",x2:"23",y2:"10"}))},g1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),F("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}))},m1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),F("polyline",{points:"15 3 21 3 21 9"}),F("line",{x1:"10",y1:"14",x2:"21",y2:"3"}))},Zi=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),F("polyline",{points:"14 2 14 8 20 8"}),F("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),F("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),F("polyline",{points:"10 9 9 9 8 9"}))},_1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("circle",{cx:"12",cy:"12",r:"10"}),F("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),F("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"}))},Ca=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),F("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}))},y1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),F("polyline",{points:"16 17 21 12 16 7"}),F("line",{x1:"21",y1:"12",x2:"9",y2:"12"}))},v1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),F("polyline",{points:"22,6 12,13 2,6"}))},nv=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("polygon",{points:"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"}),F("line",{x1:"8",y1:"2",x2:"8",y2:"18"}),F("line",{x1:"16",y1:"6",x2:"16",y2:"22"}))},b1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"}))},w1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("polygon",{points:"5 3 19 12 5 21 5 3"}))},A1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),F("line",{x1:"5",y1:"12",x2:"19",y2:"12"}))},E1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("polyline",{points:"1 4 1 10 7 10"}),F("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"}))},T1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),F("polyline",{points:"17 21 17 13 7 13 7 21"}),F("polyline",{points:"7 3 7 8 15 8"}))},S1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("circle",{cx:"11",cy:"11",r:"8"}),F("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}))},I1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),F("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),F("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),F("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),F("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),F("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),F("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),F("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),F("line",{x1:"17",y1:"16",x2:"23",y2:"16"}))},is=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}))},rv=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),F("polyline",{points:"17 6 23 6 23 12"}))},C1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),F("polyline",{points:"17 8 12 3 7 8"}),F("line",{x1:"12",y1:"3",x2:"12",y2:"15"}))},P1=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("circle",{cx:"12",cy:"12",r:"10"}),F("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),F("line",{x1:"9",y1:"9",x2:"15",y2:"15"}))},ov=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),F("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},av=i=>{const t=i.color||"currentColor",e=i.size||24;return delete i.color,delete i.size,F("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:t,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},i),F("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}))},eg=i=>{let t;const e=new Set,s=(l,h)=>{const u=typeof l=="function"?l(t):l;if(!Object.is(u,t)){const p=t;t=h??(typeof u!="object"||u===null)?u:Object.assign({},t,u),e.forEach(g=>g(t,p))}},n=()=>t,a={setState:s,getState:n,getInitialState:()=>c,subscribe:l=>(e.add(l),()=>e.delete(l))},c=t=i(s,n,a);return a},R1=(i=>i?eg(i):eg);function cv(i,t){for(var e in t)i[e]=t[e];return i}function Th(i,t){for(var e in i)if(e!=="__source"&&!(e in t))return!0;for(var s in t)if(s!=="__source"&&i[s]!==t[s])return!0;return!1}function lv(i,t){var e=t(),s=$({t:{__:e,u:t}}),n=s[0].t,r=s[1];return uo(function(){n.__=e,n.u=t,Il(n)&&r({t:n})},[i,e,t]),bt(function(){return Il(n)&&r({t:n}),i(function(){Il(n)&&r({t:n})})},[i]),e}function Il(i){var t,e,s=i.u,n=i.__;try{var r=s();return!((t=n)===(e=r)&&(t!==0||1/t==1/e)||t!=t&&e!=e)}catch{return!0}}function hv(i){i()}function uv(i){return i}function dv(){return[!1,hv]}var fv=uo;function Sh(i,t){this.props=i,this.context=t}function x1(i,t){function e(n){var r=this.props.ref,o=r==n.ref;return!o&&r&&(r.call?r(null):r.current=null),t?!t(this.props,n)||!o:Th(this.props,n)}function s(n){return this.shouldComponentUpdate=e,F(i,n)}return s.displayName="Memo("+(i.displayName||i.name)+")",s.prototype.isReactComponent=!0,s.__f=!0,s.type=i,s}(Sh.prototype=new rs).isPureReactComponent=!0,Sh.prototype.shouldComponentUpdate=function(i,t){return Th(this.props,i)||Th(this.state,t)};var sg=ht.__b;ht.__b=function(i){i.type&&i.type.__f&&i.ref&&(i.props.ref=i.ref,i.ref=null),sg&&sg(i)};var k1=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function D1(i){function t(e){var s=cv({},e);return delete s.ref,i(s,e.ref||null)}return t.$$typeof=k1,t.render=i,t.prototype.isReactComponent=t.__f=!0,t.displayName="ForwardRef("+(i.displayName||i.name)+")",t}var ig=function(i,t){return i==null?null:os(os(i).map(t))},M1={map:ig,forEach:ig,count:function(i){return i?os(i).length:0},only:function(i){var t=os(i);if(t.length!==1)throw"Children.only";return t[0]},toArray:os},N1=ht.__e;ht.__e=function(i,t,e,s){if(i.then){for(var n,r=t;r=r.__;)if((n=r.__c)&&n.__c)return t.__e==null&&(t.__e=e.__e,t.__k=e.__k),n.__c(i,t)}N1(i,t,e,s)};var ng=ht.unmount;function pv(i,t,e){return i&&(i.__c&&i.__c.__H&&(i.__c.__H.__.forEach(function(s){typeof s.__c=="function"&&s.__c()}),i.__c.__H=null),(i=cv({},i)).__c!=null&&(i.__c.__P===e&&(i.__c.__P=t),i.__c.__e=!0,i.__c=null),i.__k=i.__k&&i.__k.map(function(s){return pv(s,t,e)})),i}function gv(i,t,e){return i&&e&&(i.__v=null,i.__k=i.__k&&i.__k.map(function(s){return gv(s,t,e)}),i.__c&&i.__c.__P===t&&(i.__e&&e.appendChild(i.__e),i.__c.__e=!0,i.__c.__P=e)),i}function Pa(){this.__u=0,this.o=null,this.__b=null}function mv(i){var t=i.__.__c;return t&&t.__a&&t.__a(i)}function L1(i){var t,e,s,n=null;function r(o){if(t||(t=i()).then(function(a){a&&(n=a.default||a),s=!0},function(a){e=a,s=!0}),e)throw e;if(!s)throw t;return n?F(n,o):null}return r.displayName="Lazy",r.__f=!0,r}function xr(){this.i=null,this.l=null}ht.unmount=function(i){var t=i.__c;t&&t.__R&&t.__R(),t&&32&i.__u&&(i.type=null),ng&&ng(i)},(Pa.prototype=new rs).__c=function(i,t){var e=t.__c,s=this;s.o==null&&(s.o=[]),s.o.push(e);var n=mv(s.__v),r=!1,o=function(){r||(r=!0,e.__R=null,n?n(a):a())};e.__R=o;var a=function(){if(!--s.__u){if(s.state.__a){var c=s.state.__a;s.__v.__k[0]=gv(c,c.__c.__P,c.__c.__O)}var l;for(s.setState({__a:s.__b=null});l=s.o.pop();)l.forceUpdate()}};s.__u++||32&t.__u||s.setState({__a:s.__b=s.__v.__k[0]}),i.then(o,o)},Pa.prototype.componentWillUnmount=function(){this.o=[]},Pa.prototype.render=function(i,t){if(this.__b){if(this.__v.__k){var e=document.createElement("div"),s=this.__v.__k[0].__c;this.__v.__k[0]=pv(this.__b,e,s.__O=s.__P)}this.__b=null}var n=t.__a&&F(we,null,i.fallback);return n&&(n.__u&=-33),[F(we,null,t.__a?null:i.children),n]};var rg=function(i,t,e){if(++e[1]===e[0]&&i.l.delete(t),i.props.revealOrder&&(i.props.revealOrder[0]!=="t"||!i.l.size))for(e=i.i;e;){for(;e.length>3;)e.pop()();if(e[1]<e[0])break;i.i=e=e[2]}};function O1(i){return this.getChildContext=function(){return i.context},i.children}function F1(i){var t=this,e=i.h;if(t.componentWillUnmount=function(){Fn(null,t.v),t.v=null,t.h=null},t.h&&t.h!==e&&t.componentWillUnmount(),!t.v){for(var s=t.__v;s!==null&&!s.__m&&s.__!==null;)s=s.__;t.h=e,t.v={nodeType:1,parentNode:e,childNodes:[],__k:{__m:s.__m},contains:function(){return!0},insertBefore:function(n,r){this.childNodes.push(n),t.h.insertBefore(n,r)},removeChild:function(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),t.h.removeChild(n)}}}Fn(F(O1,{context:t.context},i.__v),t.v)}function V1(i,t){var e=F(F1,{__v:i,h:t});return e.containerInfo=t,e}(xr.prototype=new rs).__a=function(i){var t=this,e=mv(t.__v),s=t.l.get(i);return s[0]++,function(n){var r=function(){t.props.revealOrder?(s.push(n),rg(t,i,s)):n()};e?e(r):r()}},xr.prototype.render=function(i){this.i=null,this.l=new Map;var t=os(i.children);i.revealOrder&&i.revealOrder[0]==="b"&&t.reverse();for(var e=t.length;e--;)this.l.set(t[e],this.i=[1,0,this.i]);return i.children},xr.prototype.componentDidUpdate=xr.prototype.componentDidMount=function(){var i=this;this.l.forEach(function(t,e){rg(i,e,t)})};var _v=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,B1=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,U1=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,$1=/[A-Z0-9]/g,z1=typeof document<"u",j1=function(i){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(i)};function H1(i,t,e){return t.__k==null&&(t.textContent=""),Fn(i,t),typeof e=="function"&&e(),i?i.__c:null}function q1(i,t,e){return dm(i,t),typeof e=="function"&&e(),i?i.__c:null}rs.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(i){Object.defineProperty(rs.prototype,i,{configurable:!0,get:function(){return this["UNSAFE_"+i]},set:function(t){Object.defineProperty(this,i,{configurable:!0,writable:!0,value:t})}})});var og=ht.event;function G1(){}function W1(){return this.cancelBubble}function K1(){return this.defaultPrevented}ht.event=function(i){return og&&(i=og(i)),i.persist=G1,i.isPropagationStopped=W1,i.isDefaultPrevented=K1,i.nativeEvent=i};var qu,X1={enumerable:!1,configurable:!0,get:function(){return this.class}},ag=ht.vnode;ht.vnode=function(i){typeof i.type=="string"&&(function(t){var e=t.props,s=t.type,n={},r=s.indexOf("-")===-1;for(var o in e){var a=e[o];if(!(o==="value"&&"defaultValue"in e&&a==null||z1&&o==="children"&&s==="noscript"||o==="class"||o==="className")){var c=o.toLowerCase();o==="defaultValue"&&"value"in e&&e.value==null?o="value":o==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?o="ondblclick":c!=="onchange"||s!=="input"&&s!=="textarea"||j1(e.type)?c==="onfocus"?o="onfocusin":c==="onblur"?o="onfocusout":U1.test(o)&&(o=c):c=o="oninput":r&&B1.test(o)?o=o.replace($1,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&n[o=c]&&(o="oninputCapture"),n[o]=a}}s=="select"&&n.multiple&&Array.isArray(n.value)&&(n.value=os(e.children).forEach(function(l){l.props.selected=n.value.indexOf(l.props.value)!=-1})),s=="select"&&n.defaultValue!=null&&(n.value=os(e.children).forEach(function(l){l.props.selected=n.multiple?n.defaultValue.indexOf(l.props.value)!=-1:n.defaultValue==l.props.value})),e.class&&!e.className?(n.class=e.class,Object.defineProperty(n,"className",X1)):(e.className&&!e.class||e.class&&e.className)&&(n.class=n.className=e.className),t.props=n})(i),i.$$typeof=_v,ag&&ag(i)};var cg=ht.__r;ht.__r=function(i){cg&&cg(i),qu=i.__c};var lg=ht.diffed;ht.diffed=function(i){lg&&lg(i);var t=i.props,e=i.__e;e!=null&&i.type==="textarea"&&"value"in t&&t.value!==e.value&&(e.value=t.value==null?"":t.value),qu=null};var Y1={ReactCurrentDispatcher:{current:{readContext:function(i){return qu.__n[i.__c].props.value},useCallback:Kh,useContext:Xh,useDebugValue:mm,useDeferredValue:uv,useEffect:bt,useId:_m,useImperativeHandle:gm,useInsertionEffect:fv,useLayoutEffect:uo,useMemo:ie,useReducer:Wh,useRef:Gi,useState:$,useSyncExternalStore:lv,useTransition:dv}}};function Q1(i){return F.bind(null,i)}function Nc(i){return!!i&&i.$$typeof===_v}function J1(i){return Nc(i)&&i.type===we}function Z1(i){return!!i&&!!i.displayName&&(typeof i.displayName=="string"||i.displayName instanceof String)&&i.displayName.startsWith("Memo(")}function tP(i){return Nc(i)?fm.apply(null,arguments):i}function eP(i){return!!i.__k&&(Fn(null,i),!0)}function sP(i){return i&&(i.base||i.nodeType===1&&i)||null}var iP=function(i,t){return i(t)},nP=function(i,t){return i(t)},rP=we,oP=Nc,sa={useState:$,useId:_m,useReducer:Wh,useEffect:bt,useLayoutEffect:uo,useInsertionEffect:fv,useTransition:dv,useDeferredValue:uv,useSyncExternalStore:lv,startTransition:hv,useRef:Gi,useImperativeHandle:gm,useMemo:ie,useCallback:Kh,useContext:Xh,useDebugValue:mm,version:"18.3.1",Children:M1,render:H1,hydrate:q1,unmountComponentAtNode:eP,createPortal:V1,createElement:F,createContext:Gh,createFactory:Q1,cloneElement:tP,createRef:Lb,Fragment:we,isValidElement:Nc,isElement:oP,isFragment:J1,isMemo:Z1,findDOMNode:sP,Component:rs,PureComponent:Sh,memo:x1,forwardRef:D1,flushSync:nP,unstable_batchedUpdates:iP,StrictMode:rP,Suspense:Pa,SuspenseList:xr,lazy:L1,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Y1};const aP=i=>i;function cP(i,t=aP){const e=sa.useSyncExternalStore(i.subscribe,sa.useCallback(()=>t(i.getState()),[i,t]),sa.useCallback(()=>t(i.getInitialState()),[i,t]));return sa.useDebugValue(e),e}const hg=i=>{const t=R1(i),e=s=>cP(t,s);return Object.assign(e,t),e},yv=(i=>i?hg(i):hg);function Za(i){if(i===null||i===void 0)return i;if(Array.isArray(i))return i.map(e=>Za(e)).filter(e=>e!==void 0);if(typeof i=="object"&&i!==null){const t=i,e={};for(const s in t)if(t.hasOwnProperty(s)){const n=Za(t[s]);n!==void 0&&(e[s]=n)}return e}return i}async function lP({userId:i,data:t,fileName:e}){const n={...Za(t),userId:i,fileName:e,createdAt:It(),updatedAt:It()};try{return(await Ky(an(Lt,"editais"),n)).id}catch(r){throw r}}async function vv(i){const t=eo(an(Lt,"editais"),$r("userId","==",i),so("createdAt","desc"));return(await Io(t)).docs.map(s=>({id:s.id,...s.data()}))}async function hP(i,t){const e=he(Lt,"editais",t),s=await Te(e);if(!s.exists())return null;const n=s.data();return n.userId!==i?null:{...n,id:s.id}}async function uP(i,t,e){const s=he(Lt,"editais",t),n=await Te(s);if(!n.exists())throw new Error("Edital no encontrado");if(n.data().userId!==i)throw new Error("Acesso negado: edital no pertence ao usurio");const o=Za(e);try{await Wy(s,{...o,updatedAt:It()})}catch(a){throw a}}async function dP(i,t){const e=he(Lt,"editais",t),s=await Te(e);if(!s.exists())throw new Error("Edital no encontrado");if(s.data().userId!==i)throw new Error("Acesso negado: edital no pertence ao usurio");await cC(e)}async function fP(i,t){const e=[];for(const s of t.disciplinas||[]){const n=s.nome;for(const r of s.conteudos||[]){const o=pP(n,r);for(const a of o){const c=await Ky(an(Lt,"flashcards",i,"cards"),{userId:i,disciplina:n,topico:a.topico,pergunta:a.pergunta,resposta:a.resposta,dificuldade:a.dificuldade,proximaRevisao:It(),acertos:0,erros:0,createdAt:It(),updatedAt:It()});e.push(c.id)}}}return console.log(`[GC/Flashcards] ${e.length} flashcards gerados para edital ${t.id}`),e}function pP(i,t){const e=[],s=t.trim();if(s.length<20)return e;const r=s.split(`
`).filter(c=>c.trim().length>0)[0]?.trim().substring(0,100)||s.substring(0,100);if(s.includes(":")||s.includes(";")||s.includes("-")){const c=s.split(/[:;]/).filter(l=>l.trim().length>10);c.length>=2&&e.push({topico:r,pergunta:`O que  ${c[0].trim().substring(0,150)}?`,resposta:c.slice(1).join(" ").trim().substring(0,500),dificuldade:"medium"})}const o=r.split(" ").slice(0,5).join(" ");e.push({topico:r,pergunta:`Explique: ${o}`,resposta:s.substring(0,500),dificuldade:"medium"});const a=s.match(/\b[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\b/g);if(a&&a.length>0){const c=a[0];e.push({topico:r,pergunta:`O que  ${c}?`,resposta:s.substring(0,500),dificuldade:"easy"})}return e.slice(0,3)}async function gP(i,t){const e=an(Lt,"flashcards",i,"cards");let s;return t?s=eo(e,$r("disciplina","==",t),so("proximaRevisao","asc")):s=eo(e,so("proximaRevisao","asc")),(await Io(s)).docs.map(r=>{const o=r.data();return{id:r.id,userId:o.userId,disciplina:o.disciplina,topico:o.topico,pergunta:o.pergunta,resposta:o.resposta,dificuldade:o.dificuldade,proximaRevisao:o.proximaRevisao instanceof ct?o.proximaRevisao.toDate():o.proximaRevisao?.toDate?.()||new Date,acertos:o.acertos||0,erros:o.erros||0,createdAt:o.createdAt instanceof ct?o.createdAt.toDate():o.createdAt?.toDate?.()||new Date,updatedAt:o.updatedAt instanceof ct?o.updatedAt.toDate():o.updatedAt?.toDate?.()||new Date}})}async function mP(i){const t=an(Lt,"flashcards",i,"cards"),e=await Io(t),s=new Set;return e.docs.forEach(n=>{const r=n.data();r.disciplina&&s.add(r.disciplina)}),Array.from(s).sort()}async function _P(i,t,e=10){const s=an(Lt,"flashcards",i,"cards"),n=new Date;n.setHours(0,0,0,0);const r=ct.fromDate(n);let o;return t?o=eo(s,$r("disciplina","==",t),$r("proximaRevisao","<=",r),so("proximaRevisao","asc")):o=eo(s,$r("proximaRevisao","<=",r),so("proximaRevisao","asc")),(await Io(o)).docs.slice(0,e).map(l=>{const h=l.data();return{id:l.id,userId:h.userId,disciplina:h.disciplina,topico:h.topico,pergunta:h.pergunta,resposta:h.resposta,dificuldade:h.dificuldade,proximaRevisao:h.proximaRevisao instanceof ct?h.proximaRevisao.toDate():h.proximaRevisao?.toDate?.()||new Date,acertos:h.acertos||0,erros:h.erros||0,createdAt:h.createdAt instanceof ct?h.createdAt.toDate():h.createdAt?.toDate?.()||new Date,updatedAt:h.updatedAt instanceof ct?h.updatedAt.toDate():h.updatedAt?.toDate?.()||new Date}})}async function yP(i,t,e){const s=he(Lt,"flashcards",i,"cards",t),n=await Te(s);if(!n.exists())throw new Error("Flashcard no encontrado");const r=n.data(),o=r.acertos||0,a=r.erros||0;let c=o,l=a;e===0?l=a+1:c=o+1;const h=vP({userId:r.userId,disciplina:r.disciplina,topico:r.topico,pergunta:r.pergunta,resposta:r.resposta,dificuldade:r.dificuldade,proximaRevisao:r.proximaRevisao instanceof ct?r.proximaRevisao.toDate():new Date,acertos:o,erros:a},e);await Wy(s,{acertos:c,erros:l,proximaRevisao:ct.fromDate(h),updatedAt:It()}),console.log(`[GC/Flashcards] Resposta registrada para card ${t}: qualidade=${e}`)}function vP(i,t){const e=new Date;if(e.setHours(0,0,0,0),t===0){const a=new Date(e);return a.setDate(a.getDate()+1),a}const s=i.acertos+i.erros;if(s===0){const a=new Date(e);return a.setDate(a.getDate()+1),a}const n=i.acertos/(s||1);let r=1;t===2?r=Math.max(1,Math.floor((i.acertos+1)*1.5)):t===1&&(n>=.8&&i.acertos>=3?r=Math.max(2,Math.floor(i.acertos*.8)):n>=.6?r=2:r=1),r=Math.min(r,30);const o=new Date(e);return o.setDate(o.getDate()+r),o}async function bP(i){const t=an(Lt,"flashcards",i,"cards");return(await Io(t)).size}function ug(i,t){const{userId:e,fileName:s,createdAt:n,updatedAt:r,...o}=i;let a=new Date().toISOString();return n&&(n instanceof ct||n?.toDate)&&(a=n.toDate().toISOString()),{...o,id:t,criadoEmISO:a,textoBruto:""}}const Fe=yv((i,t)=>({pendingUpload:null,editais:{},ultimoEditalId:null,loading:!1,error:null,setPendingUpload:e=>i({pendingUpload:{file:e,fileName:e.name||"edital.pdf",startedAtISO:new Date().toISOString()}}),clearPendingUpload:()=>i({pendingUpload:null}),salvarEdital:e=>i(s=>({editais:{...s.editais,[e.id]:e},ultimoEditalId:e.id})),salvarEditalProcessado:async e=>{const s=ni.currentUser;if(!s)throw new Error("Usurio no autenticado");i({loading:!0,error:null});try{const{id:n,criadoEmISO:r,textoBruto:o,...a}=e,c=await lP({userId:s.uid,data:a,fileName:e.titulo||"edital.pdf"});try{await YC(s.uid),await n1(s.uid)}catch(h){console.error("[GC/EditalStore] Erro ao incrementar contador de editais:",h)}try{await fP(s.uid,e)}catch(h){console.error("[GC/EditalStore] Erro ao gerar flashcards:",h)}const l={...e,id:c};return i(h=>({editais:{...h.editais,[c]:l},ultimoEditalId:c,loading:!1})),c}catch(n){throw i({loading:!1,error:n?.message||"Erro ao salvar edital"}),n}},getEditalById:e=>t().editais[e]??null,getEditalByIdAsync:async(e,s)=>{const n=t().editais[s];if(n)return n;i({loading:!0,error:null});try{const r=await hP(e,s);if(!r)return i({loading:!1}),null;const o=ug(r,s);return i(a=>({editais:{...a.editais,[s]:o},loading:!1})),o}catch(r){return i({loading:!1,error:r?.message||"Erro ao buscar edital"}),null}},loadEditais:async e=>{i({loading:!0,error:null});try{const s=await vv(e),n={};for(const r of s){const o=ug(r,r.id);n[o.id]=o}i({editais:n,loading:!1})}catch(s){i({loading:!1,error:s?.message||"Erro ao carregar editais"})}},updateEdital:async(e,s,n)=>{i({loading:!0,error:null});try{const{id:r,criadoEmISO:o,...a}=n;await uP(e,s,a);const c=t().editais[s];i(c?l=>({editais:{...l.editais,[s]:{...c,...n}},loading:!1}):{loading:!1})}catch(r){throw i({loading:!1,error:r?.message||"Erro ao atualizar edital"}),r}},deleteEdital:async(e,s)=>{i({loading:!0,error:null});try{await dP(e,s),i(n=>{const{[s]:r,...o}=n.editais;return{editais:o,ultimoEditalId:n.ultimoEditalId===s?null:n.ultimoEditalId,loading:!1}})}catch(n){throw i({loading:!1,error:n?.message||"Erro ao deletar edital"}),n}},_setEditalLocal:e=>{i(s=>({editais:{...s.editais,[e.id]:e},ultimoEditalId:e.id}))}}));function qn(){const{isPremium:i,premiumUntil:t,profile:e,loadingProfile:s}=$t();if(s)return null;if(i&&t){const r=(t instanceof Date?t:new Date(t)).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"});return d("div",{class:"gc-premium-status-banner gc-premium-status-banner-active",children:d("div",{class:"gc-premium-status-content",children:[d(is,{size:20,class:"gc-premium-status-icon"}),d("div",{class:"gc-premium-status-text",children:[d("div",{class:"gc-premium-status-title",children:"PREMIUM ATIVO"}),d("div",{class:"gc-premium-status-subtitle",children:["Vlido at ",r]})]}),d("button",{class:"gc-premium-status-button",onClick:()=>Y("/app/premium-status",!0),title:"Ver detalhes da assinatura",children:"Gerenciar"})]})})}return i?null:d("div",{class:"gc-premium-status-banner gc-premium-status-banner-free",children:d("div",{class:"gc-premium-status-content",children:[d(is,{size:20,class:"gc-premium-status-icon"}),d("div",{class:"gc-premium-status-text",children:[d("div",{class:"gc-premium-status-title",children:"Voc est no plano gratuito"}),d("div",{class:"gc-premium-status-subtitle",children:"Desbloqueie recursos exclusivos Premium"})]}),d("button",{class:"gc-premium-status-button gc-premium-status-button-primary",onClick:()=>Y("/app/upgrade",!0),children:"Fazer Upgrade"})]})})}const lt=({children:i,title:t,subtitle:e,rightSlot:s})=>d("div",{class:"gc-page-wrapper",children:[(t||s)&&d("div",{class:"gc-page-header",children:[d("div",{children:[t&&d("h1",{class:"gc-page-title",children:t}),e&&d("p",{class:"gc-page-subtitle",children:e})]}),s&&d("div",{children:s})]}),d("main",{children:i})]}),dg=()=>{const{user:i}=$t(),t=Fe(m=>m.editais),e=Fe(m=>m.loadEditais),s=Fe(m=>m.loading),n=ie(()=>Object.values(t).sort((v,w)=>{const E=new Date(v.criadoEmISO).getTime();return new Date(w.criadoEmISO).getTime()-E}),[t]),[r,o]=$(""),[a,c]=$("TODOS"),[l,h]=$(!1);bt(()=>{i&&e(i.uid).catch(m=>{console.error("Erro ao carregar editais:",m)})},[i,e]),bt(()=>{if(!l)return;const m=v=>{v.target.closest(".gc-menu-legal-wrapper")||h(!1)};return document.addEventListener("click",m),()=>document.removeEventListener("click",m)},[l]);const u=ie(()=>{const m=r.trim().toLowerCase();return n.filter(v=>!0).filter(v=>m?(v.titulo??"").toLowerCase().includes(m):!0)},[n,r,a]),p=m=>Y(`/app/edital/${m}`),g=()=>{Y("/app/upload",!0)},y=ie(()=>{const v=n.length;return{total:v,completos:v,emAndamento:0,progressoMedio:100}},[n]);return d(lt,{title:"Meus Editais",subtitle:"Pare de adivinhar. Comece a acertar.",children:d("div",{class:"gc-home",children:[d(qn,{}),d("div",{class:"gc-controls",children:[d("div",{class:"gc-search",children:[d(S1,{size:18}),d("input",{value:r,onInput:m=>o(m.target.value),placeholder:"Buscar edital pelo nome...","aria-label":"Buscar edital"}),d("button",{class:"icon-btn subtle",title:"Filtros",children:d(I1,{size:18})})]}),d("div",{class:"gc-chips",children:[d("button",{class:`chip ${a==="TODOS"?"active":""}`,onClick:()=>c("TODOS"),children:"Todos"}),d("button",{class:`chip ${a==="PROCESSING"?"active":""}`,onClick:()=>c("PROCESSING"),children:"Processando"}),d("button",{class:`chip ${a==="PENDING"?"active":""}`,onClick:()=>c("PENDING"),children:"Pendentes"}),d("button",{class:`chip ${a==="COMPLETED"?"active":""}`,onClick:()=>c("COMPLETED"),children:"Concludos"})]})]}),d("div",{class:"gc-stats",children:[d("div",{class:"gc-card stat",children:[d("div",{class:"stat-label",children:"Total"}),d("div",{class:"stat-value",children:y.total})]}),d("div",{class:"gc-card stat",children:[d("div",{class:"stat-label",children:"Processando"}),d("div",{class:"stat-value",children:y.emAndamento})]}),d("div",{class:"gc-card stat",children:[d("div",{class:"stat-label",children:"Concludos"}),d("div",{class:"stat-value",children:y.completos})]}),d("div",{class:"gc-card stat",children:[d("div",{class:"stat-label",children:"Progresso mdio"}),d("div",{class:"stat-value",children:[y.progressoMedio,"%"]})]})]}),d("div",{class:"gc-list",children:s?d("div",{class:"gc-card empty",children:"Carregando editais..."}):u.length===0?d("div",{class:"gc-card empty",children:["Nenhum edital encontrado. Clique no ",d("b",{children:"+"})," para fazer upload."]}):u.map(m=>d("div",{class:"gc-card gc-edital",onClick:()=>p(m.id),children:[d("div",{class:"gc-edital-row",children:[d("div",{class:"gc-edital-title",children:m.titulo||"Edital sem ttulo"}),d("div",{class:"gc-tag completed",children:"Processado"})]}),d("div",{class:"gc-edital-meta",children:[d("div",{class:"gc-edital-info",children:[d("span",{children:m.orgao||""}),m.banca&&d("span",{children:["  ",m.banca]})]}),d("div",{class:"gc-edital-info",children:m.disciplinas?.length>0&&d("span",{children:[m.disciplinas.length," disciplina",m.disciplinas.length>1?"s":""]})})]})]},m.id))}),d("button",{class:"gc-fab",onClick:g,title:"Adicionar edital",children:d(A1,{size:22})})]})})},tr=({message:i,show:t,onClose:e})=>(bt(()=>{if(t){const s=setTimeout(()=>{e()},3e3);return()=>clearTimeout(s)}},[t,e]),t?d("div",{class:"toast show",children:i}):null);function wP(){const[i,t]=$(""),[e,s]=$(""),[n,r]=$(null),[o,a]=$(!1),[c,l]=$(!1),[h,u]=$(!1),{login:p,loginWithGoogle:g,user:y,loading:m}=$t();return bt(()=>{!m&&y&&Y("/app/",!0)},[y,m]),d(lt,{children:[d("div",{class:"login-layout",children:[d("div",{class:"login-left",children:[d("img",{src:"/app/logo.svg",alt:"Guerreiro Concursos",class:"login-left-logo"}),d("h1",{class:"login-headline",children:"Pare de Adivinhar e Comece a Acertar"}),d("p",{class:"login-subheadline",children:"Chegou a Sua Hora Guerreiro(a)!"})]}),d("div",{class:"login-right",children:d("div",{class:"card-premium auth-card",children:[d("h1",{class:"auth-title",children:"Login"}),d("form",{onSubmit:async E=>{E.preventDefault(),r(null),l(!0);try{await p(i,e)}catch(A){console.error("Erro no login:",A);let P="Erro ao fazer login. Tente novamente.";if(A&&typeof A=="object"&&"code"in A){const x=A;x.code==="auth/user-not-found"?P="Usurio no encontrado. Verifique o email.":x.code==="auth/wrong-password"?P="Senha incorreta. Tente novamente.":x.code==="auth/invalid-email"?P="Email invlido. Verifique o formato.":x.code==="auth/user-disabled"?P="Esta conta foi desabilitada.":x.code==="auth/too-many-requests"?P="Muitas tentativas. Tente novamente mais tarde.":x.message&&(P=x.message)}else A instanceof Error&&(P=A.message);r(P),a(!0)}finally{l(!1)}},class:"auth-form",children:[d("input",{type:"email",placeholder:"Email",value:i,onInput:E=>t(E.target.value),class:"auth-input",disabled:c,required:!0}),d("input",{type:"password",placeholder:"Senha",value:e,onInput:E=>s(E.target.value),class:"auth-input",disabled:c,required:!0}),n&&!o&&d("div",{class:"auth-error",style:"color: red; font-size: 0.875rem; margin-top: 0.5rem;",children:n}),d("button",{type:"submit",class:"auth-button",disabled:c||h,children:c?"Entrando...":"Entrar"}),d("div",{class:"auth-divider",children:d("span",{children:"ou"})}),d("button",{type:"button",onClick:async()=>{r(null),u(!0);try{await g()}catch(E){console.error("Erro no login com Google:",E);let A="Erro ao fazer login com Google. Tente novamente.";if(E&&typeof E=="object"&&"code"in E){const P=E;P.code==="auth/popup-closed-by-user"?A="Login cancelado.":P.code==="auth/popup-blocked"?A="Popup bloqueado. Permita popups para este site.":P.code==="auth/account-exists-with-different-credential"?A="J existe uma conta com este email usando outro mtodo de login.":P.message&&(A=P.message)}else E instanceof Error&&(A=E.message);r(A),a(!0)}finally{u(!1)}},class:"auth-button-google",disabled:c||h,children:[!h&&d("svg",{class:"google-icon",width:"18",height:"18",viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg",children:[d("path",{fill:"#4285F4",d:"M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"}),d("path",{fill:"#34A853",d:"M9 18c2.43 0 4.467-.806 5.96-2.184l-2.908-2.258c-.806.54-1.837.86-3.052.86-2.347 0-4.33-1.585-5.04-3.716H.957v2.332C2.438 15.983 5.482 18 9 18z"}),d("path",{fill:"#FBBC05",d:"M3.96 10.714c-.18-.54-.282-1.117-.282-1.714s.102-1.174.282-1.714V4.954H.957C.348 6.174 0 7.55 0 9s.348 2.826.957 4.046l3.003-2.332z"}),d("path",{fill:"#EA4335",d:"M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.954L3.96 7.286C4.67 5.155 6.653 3.58 9 3.58z"})]}),h?"Entrando...":"Entrar com Google"]}),d("p",{class:"auth-link",children:["No tem uma conta? ",d("a",{href:"#",onClick:E=>{E.preventDefault(),Y("/app/register",!0)},children:"Registre-se"})]})]})]})})]}),d(tr,{message:n||"",show:o,onClose:()=>a(!1)})]})}function AP(){const[i,t]=$(""),[e,s]=$(""),[n,r]=$(null),[o,a]=$(!1),[c,l]=$(!1),[h,u]=$(!1),{register:p,loginWithGoogle:g,user:y,loading:m}=$t();return bt(()=>{!m&&y&&Y("/app/",!0)},[y,m]),d(lt,{title:"Registrar",subtitle:"Crie sua conta gratuita",children:d("div",{class:"auth-container",children:[d("div",{class:"card-premium auth-card",children:[d("h1",{class:"auth-title",children:"Registrar"}),d("form",{onSubmit:async E=>{E.preventDefault(),r(null),l(!0);try{await p(i,e)}catch(A){console.error("Erro no registro:",A);let P="Erro ao criar conta. Tente novamente.";if(A&&typeof A=="object"&&"code"in A){const x=A;x.code==="auth/email-already-in-use"?P="Este email j est em uso. Tente fazer login.":x.code==="auth/invalid-email"?P="Email invlido. Verifique o formato.":x.code==="auth/weak-password"?P="Senha muito fraca. Use pelo menos 6 caracteres.":x.code==="auth/operation-not-allowed"?P="Operao no permitida. Contate o suporte.":x.message&&(P=x.message)}else A instanceof Error&&(P=A.message);r(P),a(!0)}finally{l(!1)}},class:"auth-form",children:[d("input",{type:"email",placeholder:"Email",value:i,onInput:E=>t(E.target.value),class:"auth-input",disabled:c,required:!0}),d("input",{type:"password",placeholder:"Senha",value:e,onInput:E=>s(E.target.value),class:"auth-input",disabled:c,required:!0,minLength:6}),n&&!o&&d("div",{class:"auth-error",style:"color: red; font-size: 0.875rem; margin-top: 0.5rem;",children:n}),d("button",{type:"submit",class:"auth-button",disabled:c||h,children:c?"Registrando...":"Registrar"}),d("div",{class:"auth-divider",children:d("span",{children:"ou"})}),d("button",{type:"button",onClick:async()=>{r(null),u(!0);try{await g()}catch(E){console.error("Erro no login com Google:",E);let A="Erro ao fazer login com Google. Tente novamente.";if(E&&typeof E=="object"&&"code"in E){const P=E;P.code==="auth/popup-closed-by-user"?A="Login cancelado.":P.code==="auth/popup-blocked"?A="Popup bloqueado. Permita popups para este site.":P.code==="auth/account-exists-with-different-credential"?A="J existe uma conta com este email usando outro mtodo de login.":P.message&&(A=P.message)}else E instanceof Error&&(A=E.message);r(A),a(!0)}finally{u(!1)}},class:"auth-button-google",disabled:c||h,children:[!h&&d("svg",{class:"google-icon",width:"18",height:"18",viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg",children:[d("path",{fill:"#4285F4",d:"M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"}),d("path",{fill:"#34A853",d:"M9 18c2.43 0 4.467-.806 5.96-2.184l-2.908-2.258c-.806.54-1.837.86-3.052.86-2.347 0-4.33-1.585-5.04-3.716H.957v2.332C2.438 15.983 5.482 18 9 18z"}),d("path",{fill:"#FBBC05",d:"M3.96 10.714c-.18-.54-.282-1.117-.282-1.714s.102-1.174.282-1.714V4.954H.957C.348 6.174 0 7.55 0 9s.348 2.826.957 4.046l3.003-2.332z"}),d("path",{fill:"#EA4335",d:"M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.954L3.96 7.286C4.67 5.155 6.653 3.58 9 3.58z"})]}),h?"Entrando...":"Continuar com Google"]}),d("p",{class:"auth-link",children:["J tem uma conta? ",d("a",{href:"#",onClick:E=>{E.preventDefault(),Y("/app/login",!0)},children:"Login"})]})]})]}),d(tr,{message:n||"",show:o,onClose:()=>a(!1)})]})})}function io({children:i,fallback:t,featureName:e}){const{isPremium:s,loadingPlan:n}=$t();return n?d("div",{class:"premium-gate-loading",children:d("div",{children:"Carregando..."})}):s?d(we,{children:i}):t?d(we,{children:t}):d("div",{class:"premium-gate-card",children:[d("div",{class:"premium-gate-icon",children:d(is,{size:32})}),d("div",{class:"premium-gate-title",children:"Recurso Premium"}),d("div",{class:"premium-gate-description",children:[e," est disponvel apenas no plano Premium."]}),d("button",{class:"premium-gate-button",onClick:()=>Y("/app/planos",!0),children:"Quero ser Premium"})]})}const fg=2;function EP(){const{user:i,isPremium:t,loadingPlan:e}=$t(),s=Fe(m=>m.setPendingUpload),n=Fe(m=>m.editais),r=Fe(m=>m.loadEditais),[o,a]=$(null),[c,l]=$(null),h=ie(()=>o?.name??"Nenhum PDF selecionado",[o]);bt(()=>{i&&!t&&r(i.uid).catch(m=>{console.error("Erro ao carregar editais:",m)})},[i,t,r]);const u=ie(()=>Object.keys(n).length,[n]),p=ie(()=>e?!1:t?!0:u<fg,[t,u,e]);function g(m){const w=m.currentTarget.files?.[0]??null;if(l(null),!w){a(null);return}if(w.type!=="application/pdf"&&!w.name.toLowerCase().endsWith(".pdf")){a(null),l("Selecione um arquivo PDF vlido.");return}a(w)}function y(){if(l(null),!o){l("Selecione um PDF antes de continuar.");return}if(!p){l("Limite de editais atingido. Faa upgrade para Premium.");return}s(o),Y("/app/processamento",!0)}return d(lt,{title:"Novo Edital",subtitle:"Envie seu PDF e deixe o Guerreiro organizar tudo para voc",children:d("div",{class:"gc-upload-page",children:d("div",{class:"gc-content animate-slide-up",children:[!e&&!p&&d(io,{featureName:"Upload de editais ilimitados",fallback:d("div",{class:"gc-card gc-upload-card",children:[d("div",{class:"gc-error-message",children:[d("div",{class:"gc-error-title",children:"Limite atingido"}),d("div",{class:"gc-error-text",children:["Voc j possui ",u," edital(is). O plano Free permite at ",fg," editais. Faa upgrade para Premium para uploads ilimitados."]})]}),d("button",{class:"gc-btn-primary",onClick:()=>Y("/app/planos",!0),children:"Ver Planos"})]}),children:d("div",{})}),p&&d("div",{class:"gc-card gc-upload-card",children:[d("div",{class:"gc-upload-header",children:[d("div",{class:"gc-upload-icon",children:d(Zi,{size:32})}),d("div",{class:"gc-upload-info",children:[d("div",{class:"gc-upload-label",children:"Arquivo selecionado"}),d("div",{class:"gc-upload-filename",children:h})]})]}),d("label",{class:"gc-file-input-label",children:[d(C1,{size:18}),d("span",{children:"Selecionar PDF"}),d("input",{type:"file",accept:"application/pdf,.pdf",class:"gc-file-input",onChange:g})]}),c&&d("div",{class:"gc-error-message",children:[d("div",{class:"gc-error-title",children:"Ateno"}),d("div",{class:"gc-error-text",children:c})]}),d("div",{class:"gc-upload-actions",children:[d("button",{class:`gc-btn-primary ${o?"":"disabled"}`,onClick:y,disabled:!o,children:"Enviar e Processar"}),d("button",{class:"gc-btn-secondary",onClick:()=>Y("/app/",!0),children:"Voltar"})]})]}),d("div",{class:"gc-features-grid",children:[d("div",{class:"gc-card gc-feature-card",children:[d("div",{class:"gc-feature-title",children:"Rpido"}),d("div",{class:"gc-feature-desc",children:"Extrai o texto e j organiza em disciplinas"})]}),d("div",{class:"gc-card gc-feature-card",children:[d("div",{class:"gc-feature-title",children:"Premium"}),d("div",{class:"gc-feature-desc",children:"Cartes limpos, foco e clareza no fluxo"})]}),d("div",{class:"gc-card gc-feature-card",children:[d("div",{class:"gc-feature-title",children:"Evolutivo"}),d("div",{class:"gc-feature-desc",children:"Depois trocamos o mock por IA real"})]})]})]})})})}const TP="modulepreload",SP=function(i){return"/app/"+i},pg={},IP=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){let c=function(l){return Promise.all(l.map(h=>Promise.resolve(h).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");n=c(e.map(l=>{if(l=SP(l),l in pg)return;pg[l]=!0;const h=l.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":TP,h||(p.as="script"),p.crossOrigin="",p.href=l,a&&p.setAttribute("nonce",a),document.head.appendChild(p),h)return new Promise((g,y)=>{p.addEventListener("load",g),p.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})},Pe=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Ih=[.001,0,0,.001,0,0],Cl=1.35,Be={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},oi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},no="pdfjs_internal_editor_",ot={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},_t={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},CP={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ch={TRIANGLES:1,LATTICE:2},se={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Ra={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Qt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},wn={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Lc={ERRORS:0,WARNINGS:1,INFOS:5},ro={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},vr={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},PP={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Oc=Lc.WARNINGS;function RP(i){Number.isInteger(i)&&(Oc=i)}function xP(){return Oc}function Fc(i){Oc>=Lc.INFOS&&console.info(`Info: ${i}`)}function it(i){Oc>=Lc.WARNINGS&&console.warn(`Warning: ${i}`)}function Pt(i){throw new Error(i)}function yt(i,t){i||Pt(t)}function kP(i){switch(i?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function bv(i,t=null,e=null){if(!i)return null;if(e&&typeof i=="string"&&(e.addDefaultProtocol&&i.startsWith("www.")&&i.match(/\./g)?.length>=2&&(i=`http://${i}`),e.tryConvertEncoding))try{i=OP(i)}catch{}const s=t?URL.parse(i,t):URL.parse(i);return kP(s)?s:null}function wv(i,t,e=!1){const s=URL.parse(i);return s?(s.hash=t,s.href):e&&bv(i,"http://example.com")?i.split("#",1)[0]+`${t?`#${t}`:""}`:""}function nt(i,t,e,s=!1){return Object.defineProperty(i,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const ln=(function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t})();class gg extends ln{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Pl extends ln{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Ph extends ln{constructor(t){super(t,"InvalidPDFException")}}class tc extends ln{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class DP extends ln{constructor(t){super(t,"FormatError")}}class Ai extends ln{constructor(t){super(t,"AbortException")}}function Av(i){(typeof i!="object"||i?.length===void 0)&&Pt("Invalid argument for bytesToString");const t=i.length,e=8192;if(t<e)return String.fromCharCode.apply(null,i);const s=[];for(let n=0;n<t;n+=e){const r=Math.min(n+e,t),o=i.subarray(n,r);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function Co(i){typeof i!="string"&&Pt("Invalid argument for stringToBytes");const t=i.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=i.charCodeAt(s)&255;return e}function MP(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function NP(){const i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function LP(){try{return new Function(""),!0}catch{return!1}}class re{static get isLittleEndian(){return nt(this,"isLittleEndian",NP())}static get isEvalSupported(){return nt(this,"isEvalSupported",LP())}static get isOffscreenCanvasSupported(){return nt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return nt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return nt(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return nt(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return nt(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return nt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Rl=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0"));class H{static makeHexColor(t,e,s){return`#${Rl[t]}${Rl[e]}${Rl[s]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,s=0){const n=t[s],r=t[s+1];t[s]=n*e[0]+r*e[2]+e[4],t[s+1]=n*e[1]+r*e[3]+e[5]}static applyTransformToBezier(t,e,s=0){const n=e[0],r=e[1],o=e[2],a=e[3],c=e[4],l=e[5];for(let h=0;h<6;h+=2){const u=t[s+h],p=t[s+h+1];t[s+h]=u*n+p*o+c,t[s+h+1]=u*r+p*a+l}}static applyInverseTransform(t,e){const s=t[0],n=t[1],r=e[0]*e[3]-e[1]*e[2];t[0]=(s*e[3]-n*e[2]+e[2]*e[5]-e[4]*e[3])/r,t[1]=(-s*e[1]+n*e[0]+e[4]*e[1]-e[5]*e[0])/r}static axialAlignedBoundingBox(t,e,s){const n=e[0],r=e[1],o=e[2],a=e[3],c=e[4],l=e[5],h=t[0],u=t[1],p=t[2],g=t[3];let y=n*h+c,m=y,v=n*p+c,w=v,E=a*u+l,A=E,P=a*g+l,x=P;if(r!==0||o!==0){const M=r*h,S=r*p,T=o*u,I=o*g;y+=T,w+=T,v+=I,m+=I,E+=M,x+=M,P+=S,A+=S}s[0]=Math.min(s[0],y,v,m,w),s[1]=Math.min(s[1],E,P,A,x),s[2]=Math.max(s[2],y,v,m,w),s[3]=Math.max(s[3],E,P,A,x)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const s=t[0],n=t[1],r=t[2],o=t[3],a=s**2+n**2,c=s*r+n*o,l=r**2+o**2,h=(a+l)/2,u=Math.sqrt(h**2-(a*l-c**2));e[0]=Math.sqrt(h+u||1),e[1]=Math.sqrt(h-u||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),n=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>n)return null;const r=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),o=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return r>o?null:[s,r,n,o]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,n,r){r[0]=Math.min(r[0],t,s),r[1]=Math.min(r[1],e,n),r[2]=Math.max(r[2],t,s),r[3]=Math.max(r[3],e,n)}static#t(t,e,s,n,r,o,a,c,l,h){if(l<=0||l>=1)return;const u=1-l,p=l*l,g=p*l,y=u*(u*(u*t+3*l*e)+3*p*s)+g*n,m=u*(u*(u*r+3*l*o)+3*p*a)+g*c;h[0]=Math.min(h[0],y),h[1]=Math.min(h[1],m),h[2]=Math.max(h[2],y),h[3]=Math.max(h[3],m)}static#e(t,e,s,n,r,o,a,c,l,h,u,p){if(Math.abs(l)<1e-12){Math.abs(h)>=1e-12&&this.#t(t,e,s,n,r,o,a,c,-u/h,p);return}const g=h**2-4*u*l;if(g<0)return;const y=Math.sqrt(g),m=2*l;this.#t(t,e,s,n,r,o,a,c,(-h+y)/m,p),this.#t(t,e,s,n,r,o,a,c,(-h-y)/m,p)}static bezierBoundingBox(t,e,s,n,r,o,a,c,l){l[0]=Math.min(l[0],t,a),l[1]=Math.min(l[1],e,c),l[2]=Math.max(l[2],t,a),l[3]=Math.max(l[3],e,c),this.#e(t,s,r,a,e,n,o,c,3*(-t+3*(s-r)+a),6*(t-2*s+r),3*(s-t),l),this.#e(t,s,r,a,e,n,o,c,3*(-e+3*(n-o)+c),6*(e-2*n+o),3*(n-e),l)}}function OP(i){return decodeURIComponent(escape(i))}let xl=null,mg=null;function FP(i){return xl||(xl=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,mg=new Map([["","t"]])),i.replaceAll(xl,(t,e,s)=>e?e.normalize("NFKC"):mg.get(s))}function Ev(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const i=new Uint8Array(32);return crypto.getRandomValues(i),Av(i)}const Tn="pdfjs_internal_id_";function VP(i,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,n,...r]=e;if(!i(s)&&!Number.isInteger(s)||!t(n))return!1;const o=r.length;let a=!0;switch(n.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;a=!1;break;default:return!1}for(const c of r)if(!(typeof c=="number"||a&&c===null))return!1;return!0}function Re(i,t,e){return Math.min(Math.max(i,t),e)}function Tv(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(Av(i))}function BP(i){return Uint8Array.fromBase64?Uint8Array.fromBase64(i):Co(atob(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...t){return new Promise(e=>{e(i(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(i){return i.reduce((t,e)=>t+e,0)});class oo{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function n(r){if(!r)return;let o=null;const a=r.name;if(a==="#text")o=r.value;else if(oo.shouldBuildText(a))r?.attributes?.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&e.push({str:o}),!!r.children)for(const c of r.children)n(c)}return n(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class Sv{static setupStorage(t,e,s,n,r){const o=n.getValue(e,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(t.textContent=o.value),r==="print")break;t.addEventListener("input",a=>{n.setValue(e,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?t.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&t.removeAttribute("checked"),r==="print")break;t.addEventListener("change",a=>{n.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&t.setAttribute("value",o.value),r==="print")break;t.addEventListener("input",a=>{n.setValue(e,{value:a.target.value})})}break;case"select":if(o.value!==null){t.setAttribute("value",o.value);for(const a of s.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const c=a.target.options,l=c.selectedIndex===-1?"":c[c.selectedIndex].value;n.setValue(e,{value:l})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:n,linkService:r}){const{attributes:o}=e,a=t instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${n}`);for(const[c,l]of Object.entries(o))if(l!=null)switch(c){case"class":l.length&&t.setAttribute(c,l.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",l);break;case"style":Object.assign(t.style,l);break;case"textContent":t.textContent=l;break;default:(!a||c!=="href"&&c!=="newWindow")&&t.setAttribute(c,l)}a&&r.addLinkAttributes(t,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(t,o.dataId,e,s)}static render(t){const e=t.annotationStorage,s=t.linkService,n=t.xfaHtml,r=t.intent||"display",o=document.createElement(n.name);n.attributes&&this.setAttributes({html:o,element:n,intent:r,linkService:s});const a=r!=="richText",c=t.div;if(c.append(o),t.viewport){const u=`matrix(${t.viewport.transform.join(",")})`;c.style.transform=u}a&&c.setAttribute("class","xfaLayer xfaFont");const l=[];if(n.children.length===0){if(n.value){const u=document.createTextNode(n.value);o.append(u),a&&oo.shouldBuildText(n.name)&&l.push(u)}return{textDivs:l}}const h=[[n,-1,o]];for(;h.length>0;){const[u,p,g]=h.at(-1);if(p+1===u.children.length){h.pop();continue}const y=u.children[++h.at(-1)[1]];if(y===null)continue;const{name:m}=y;if(m==="#text"){const w=document.createTextNode(y.value);l.push(w),g.append(w);continue}const v=y?.attributes?.xmlns?document.createElementNS(y.attributes.xmlns,m):document.createElement(m);if(g.append(v),y.attributes&&this.setAttributes({html:v,element:y,storage:e,intent:r,linkService:s}),y.children?.length>0)h.push([y,-1,v]);else if(y.value){const w=document.createTextNode(y.value);a&&oo.shouldBuildText(m)&&l.push(w),v.append(w)}}for(const u of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:l}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Ms="http://www.w3.org/2000/svg";class Gn{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Po(i,t="text"){if(kr(i,document.baseURI)){const e=await fetch(i);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const n=new XMLHttpRequest;n.open("GET",i,!0),n.responseType=t,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(n.status===200||n.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(n.response);return}e(n.responseText);return}s(new Error(n.statusText))}},n.send(null)})}class Ro{constructor({viewBox:t,userUnit:e,scale:s,rotation:n,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=n,this.offsetX=r,this.offsetY=o,s*=e;const c=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let h,u,p,g;switch(n%=360,n<0&&(n+=360),n){case 180:h=-1,u=0,p=0,g=1;break;case 90:h=0,u=1,p=1,g=0;break;case 270:h=0,u=-1,p=-1,g=0;break;case 0:h=1,u=0,p=0,g=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(p=-p,g=-g);let y,m,v,w;h===0?(y=Math.abs(l-t[1])*s+r,m=Math.abs(c-t[0])*s+o,v=(t[3]-t[1])*s,w=(t[2]-t[0])*s):(y=Math.abs(c-t[0])*s+r,m=Math.abs(l-t[1])*s+o,v=(t[2]-t[0])*s,w=(t[3]-t[1])*s),this.transform=[h*s,u*s,p*s,g*s,y-h*s*c-p*s*l,m-u*s*c-g*s*l],this.width=v,this.height=w}get rawDims(){const t=this.viewBox;return nt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:n=this.offsetY,dontFlip:r=!1}={}){return new Ro({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:n,dontFlip:r})}convertToViewportPoint(t,e){const s=[t,e];return H.applyTransform(s,this.transform),s}convertToViewportRectangle(t){const e=[t[0],t[1]];H.applyTransform(e,this.transform);const s=[t[2],t[3]];return H.applyTransform(s,this.transform),[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){const s=[t,e];return H.applyInverseTransform(s,this.transform),s}}class Gu extends ln{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Vc(i){const t=i.length;let e=0;for(;e<t&&i[e].trim()==="";)e++;return i.substring(e,e+5).toLowerCase()==="data:"}function Wu(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function UP(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function $P(i,t="document.pdf"){if(typeof i!="string")return t;if(Vc(i))return it('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const s=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(i);if(!s)return t;const n=a=>{try{let c=decodeURIComponent(a);return c.includes("/")?(c=c.split("/").at(-1),c.test(/^\.pdf$/i)?c:a):c}catch{return a}},r=/\.pdf$/i,o=s.pathname.split("/").at(-1);if(r.test(o))return n(o);if(s.searchParams.size>0){const a=Array.from(s.searchParams.values()).reverse();for(const l of a)if(r.test(l))return n(l);const c=Array.from(s.searchParams.keys()).reverse();for(const l of c)if(r.test(l))return n(l)}if(s.hash){const c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(c)return n(c[0])}return t}class _g{started=Object.create(null);times=[];time(t){t in this.started&&it(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||it(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:n,end:r}of this.times)t.push(`${s.padEnd(e)} ${r-n}ms
`);return t.join("")}}function kr(i,t){const e=t?URL.parse(i,t):URL.parse(i);return e?.protocol==="http:"||e?.protocol==="https:"}function Ze(i){i.preventDefault()}function jt(i){i.preventDefault(),i.stopPropagation()}function zP(i){console.log("Deprecated API usage: "+i)}class Rh{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const s=parseInt(e[1],10);let n=parseInt(e[2],10);n=n>=1&&n<=12?n-1:0;let r=parseInt(e[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(e[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let c=parseInt(e[6],10);c=c>=0&&c<=59?c:0;const l=e[7]||"Z";let h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,l==="-"?(o+=h,a+=u):l==="+"&&(o-=h,a-=u),new Date(Date.UTC(s,n,r,o,a,c))}}function jP(i,{scale:t=1,rotation:e=0}){const{width:s,height:n}=i.attributes.style,r=[0,0,parseInt(s),parseInt(n)];return new Ro({viewBox:r,userUnit:1,scale:t,rotation:e})}function xo(i){if(i.startsWith("#")){const t=parseInt(i.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(t=>parseInt(t)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(it(`Not a valid color format: "${i}"`),[0,0,0])}function HP(i){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of i.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;i.set(e,xo(s))}t.remove()}function Ft(i){const{a:t,b:e,c:s,d:n,e:r,f:o}=i.getTransform();return[t,e,s,n,r,o]}function ps(i){const{a:t,b:e,c:s,d:n,e:r,f:o}=i.getTransform().invertSelf();return[t,e,s,n,r,o]}function tn(i,t,e=!1,s=!0){if(t instanceof Ro){const{pageWidth:n,pageHeight:r}=t.rawDims,{style:o}=i,a=re.isCSSRoundSupported,c=`var(--total-scale-factor) * ${n}px`,l=`var(--total-scale-factor) * ${r}px`,h=a?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,u=a?`round(down, ${l}, var(--scale-round-y))`:`calc(${l})`;!e||t.rotation%180===0?(o.width=h,o.height=u):(o.width=u,o.height=h)}s&&i.setAttribute("data-main-rotation",t.rotation)}class Ps{constructor(){const{pixelRatio:t}=Ps;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,n,r=-1){let o=1/0,a=1/0,c=1/0;s=Ps.capPixels(s,r),s>0&&(o=Math.sqrt(s/(t*e))),n!==-1&&(a=n/t,c=n/e);const l=Math.min(o,a,c);return this.sx>l||this.sy>l?(this.sx=l,this.sy=l,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,s):s}return t}}const xh=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class qP{static get isDarkMode(){return nt(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class GP{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:s}=window.getComputedStyle(t);return t.remove(),nt(this,"commentForegroundColor",xo(s))}}function WP(i,t,e,s){s=Math.min(Math.max(s??1,0),1);const n=255*(1-s);return i=Math.round(i*s+n),t=Math.round(t*s+n),e=Math.round(e*s+n),[i,t,e]}function yg(i,t){const e=i[0]/255,s=i[1]/255,n=i[2]/255,r=Math.max(e,s,n),o=Math.min(e,s,n),a=(r+o)/2;if(r===o)t[0]=t[1]=0;else{const c=r-o;switch(t[1]=a<.5?c/(r+o):c/(2-r-o),r){case e:t[0]=((s-n)/c+(s<n?6:0))*60;break;case s:t[0]=((n-e)/c+2)*60;break;case n:t[0]=((e-s)/c+4)*60;break}}t[2]=a}function kh(i,t){const e=i[0],s=i[1],n=i[2],r=(1-Math.abs(2*n-1))*s,o=r*(1-Math.abs(e/60%2-1)),a=n-r/2;switch(Math.floor(e/60)){case 0:t[0]=r+a,t[1]=o+a,t[2]=a;break;case 1:t[0]=o+a,t[1]=r+a,t[2]=a;break;case 2:t[0]=a,t[1]=r+a,t[2]=o+a;break;case 3:t[0]=a,t[1]=o+a,t[2]=r+a;break;case 4:t[0]=o+a,t[1]=a,t[2]=r+a;break;case 5:case 6:t[0]=r+a,t[1]=a,t[2]=o+a;break}}function vg(i){return i<=.03928?i/12.92:((i+.055)/1.055)**2.4}function bg(i,t,e){kh(i,e),e.map(vg);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];kh(t,e),e.map(vg);const n=.2126*e[0]+.7152*e[1]+.0722*e[2];return s>n?(s+.05)/(n+.05):(n+.05)/(s+.05)}const wg=new Map;function KP(i,t){const e=i[0]+i[1]*256+i[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let s=wg.get(e);if(s)return s;const n=new Float32Array(9),r=n.subarray(0,3),o=n.subarray(3,6);yg(i,o);const a=n.subarray(6,9);yg(t,a);const c=a[2]<.5,l=c?12:4.5;if(o[2]=c?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),bg(o,a,r)<l){let h,u;c?(h=o[2],u=1):(h=0,u=o[2]);const p=.005;for(;u-h>p;){const g=o[2]=(h+u)/2;c===bg(o,a,r)<l?h=g:u=g}o[2]=c?u:h}return kh(o,r),s=H.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),wg.set(e,s),s}function Iv({html:i,dir:t,className:e},s){const n=document.createDocumentFragment();if(typeof i=="string"){const r=document.createElement("p");r.dir=t||"auto";const o=i.split(/(?:\r\n?|\n)/);for(let a=0,c=o.length;a<c;++a){const l=o[a];r.append(document.createTextNode(l)),a<c-1&&r.append(document.createElement("br"))}n.append(r)}else Sv.render({xfaHtml:i,div:n,intent:"richText"});n.firstElementChild.classList.add("richText",e),s.append(n)}function Cv(i){const t=new Path2D;if(!i)return t;for(let e=0,s=i.length;e<s;)switch(i[e++]){case vr.moveTo:t.moveTo(i[e++],i[e++]);break;case vr.lineTo:t.lineTo(i[e++],i[e++]);break;case vr.curveTo:t.bezierCurveTo(i[e++],i[e++],i[e++],i[e++],i[e++],i[e++]);break;case vr.quadraticCurveTo:t.quadraticCurveTo(i[e++],i[e++],i[e++],i[e++]);break;case vr.closePath:t.closePath();break;default:it(`Unrecognized drawing path operator: ${i[e-1]}`);break}return t}class zr{#t=null;#e=null;#i;#s=null;#o=null;#r=null;#n=null;#a=null;static#l=null;constructor(t){this.#i=t,zr.#l||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#i._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Ze,{signal:e}),t.addEventListener("pointerdown",zr.#c,{signal:e}));const s=this.#s=document.createElement("div");s.className="buttons",t.append(s);const n=this.#i.toolbarPosition;if(n){const{style:r}=t,o=this.#i._uiManager.direction==="ltr"?1-n[0]:n[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*n[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#c(t){t.stopPropagation()}#d(t){this.#i._focusEventsAllowed=!1,jt(t)}#u(t){this.#i._focusEventsAllowed=!0,jt(t)}#f(t){const e=this.#i._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#u.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Ze,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#o?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#i,s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",zr.#l[t]),this.#f(s)&&s.addEventListener("click",n=>{e.delete()},{signal:e._signal}),this.#s.append(s)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#s.append(e,this.#m),this.#o=t}addComment(t,e=null){if(this.#r)return;const s=t.renderForToolbar();if(!s)return;this.#f(s);const n=this.#n=this.#m;e?(this.#s.insertBefore(s,e),this.#s.insertBefore(n,e)):this.#s.append(s,n),this.#r=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#s.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#a=await t.renderEditButton(this.#i);this.#f(e),this.#s.append(e,this.#m)}removeButton(t){t==="comment"&&(this.#r?.removeToolbarCommentButton(),this.#r=null,this.#n?.remove(),this.#n=null)}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,s){if(!e&&t==="comment")return;const n=this.#s.querySelector(s);n&&t==="comment"&&this.addComment(e,n)}updateEditSignatureButton(t){this.#a&&(this.#a.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class XP{#t=null;#e=null;#i;constructor(t){this.#i=t}#s(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#i._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Ze,{signal:e});const s=this.#t=document.createElement("div");return s.className="buttons",t.append(s),this.#i.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#i.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#i.highlightSelection("floating_button")}),t}#o(t,e){let s=0,n=0;for(const r of t){const o=r.y+r.height;if(o<s)continue;const a=r.x+(e?r.width:0);if(o>s){n=a,s=o;continue}e?a>n&&(n=a):a<n&&(n=a)}return[e?1-n:n,s]}show(t,e,s){const[n,r]=this.#o(e,s),{style:o}=this.#e||=this.#s();t.append(this.#e),o.insetInlineEnd=`${100*n}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#r(t,e,s,n){const r=document.createElement("button");r.classList.add("basic",t),r.tabIndex=0,r.setAttribute("data-l10n-id",e);const o=document.createElement("span");r.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",s);const a=this.#i._signal;a instanceof AbortSignal&&!a.aborted&&(r.addEventListener("contextmenu",Ze,{signal:a}),r.addEventListener("click",n,{signal:a})),this.#t.append(r)}}function Pv(i,t,e){for(const s of e)t.addEventListener(s,i[s].bind(i))}class Et{static#t=NaN;static#e=null;static#i=NaN;static#s=null;static initializeAndAddPointerId(t){(Et.#e||=new Set).add(t)}static setPointer(t,e){Et.#t||=e,Et.#s??=t}static setTimeStamp(t){Et.#i=t}static isSamePointerId(t){return Et.#t===t}static isSamePointerIdOrRemove(t){return Et.#t===t?!0:(Et.#e?.delete(t),!1)}static isSamePointerType(t){return Et.#s===t}static isInitializedAndDifferentPointerType(t){return Et.#s!==null&&!Et.isSamePointerType(t)}static isSameTimeStamp(t){return Et.#i===t}static isUsingMultiplePointers(){return Et.#e?.size>=1}static clearPointerType(){Et.#s=null}static clearPointerIds(){Et.#t=NaN,Et.#e=null}static clearTimeStamp(){Et.#i=NaN}}class YP{#t=0;get id(){return`${no}${this.#t++}`}}class Ku{#t=Ev();#e=0;#i=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),n=new Image;n.src=t;const r=n.decode().then(()=>(s.drawImage(n,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return nt(this,"_isSVGFittingCanvas",r)}async#s(t,e){this.#i||=new Map;let s=this.#i.get(t);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let n;if(typeof e=="string"?(s.url=e,n=await Po(e,"blob")):e instanceof File?n=s.file=e:e instanceof Blob&&(n=e),n.type==="image/svg+xml"){const r=Ku._isSVGFittingCanvas,o=new FileReader,a=new Image,c=new Promise((l,h)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,l()},o.onload=async()=>{const u=s.svgUrl=o.result;a.src=await r?`${u}#svgView(preserveAspectRatio(none))`:u},a.onerror=o.onerror=h});o.readAsDataURL(n),await c}else s.bitmap=await createImageBitmap(n);s.refCounter=1}catch(n){it(n),s=null}return this.#i.set(t,s),s&&this.#i.set(s.id,s),s}async getFromFile(t){const{lastModified:e,name:s,size:n,type:r}=t;return this.#s(`${e}_${s}_${n}_${r}`,t)}async getFromUrl(t){return this.#s(t,t)}async getFromBlob(t,e){const s=await e;return this.#s(t,s)}async getFromId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#i||=new Map;let s=this.#i.get(t);if(s?.bitmap)return s.refCounter+=1,s;const n=new OffscreenCanvas(e.width,e.height);return n.getContext("2d").drawImage(e,0,0),s={bitmap:n.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(t,s),this.#i.set(s.id,s),s}getSvgUrl(t){const e=this.#i.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const n=new OffscreenCanvas(s.width,s.height);n.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=n.convertToBlob()}s.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class QP{#t=[];#e=!1;#i;#s=-1;constructor(t=128){this.#i=t}add({cmd:t,undo:e,post:s,mustExec:n,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(n&&t(),this.#e)return;const c={cmd:t,undo:e,post:s,type:r};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(c);return}if(o&&this.#t[this.#s].type===r){a&&(c.undo=this.#t[this.#s].undo),this.#t[this.#s]=c;return}const l=this.#s+1;l===this.#i?this.#t.splice(0,1):(this.#s=l,l<this.#t.length&&this.#t.splice(l)),this.#t.push(c)}undo(){if(this.#s===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(t){if(this.#s!==-1){for(let e=this.#s;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#s-e),this.#s=e;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}}class ko{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=re.platform;for(const[s,n,r={}]of t)for(const o of s){const a=o.startsWith("mac+");e&&a?(this.callbacks.set(o.slice(4),{callback:n,options:r}),this.allKeys.add(o.split("+").at(-1))):!e&&!a&&(this.callbacks.set(o,{callback:n,options:r}),this.allKeys.add(o.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(this.#t(e));if(!s)return;const{callback:n,options:{bubbles:r=!1,args:o=[],checker:a=null}}=s;a&&!a(t,e)||(n.bind(t,...o,e)(),r||jt(e))}}class Xu{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return HP(t),nt(this,"_colors",t)}convert(t){const e=xo(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,n]of this._colors)if(n.every((r,o)=>r===e[o]))return Xu._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?H.makeHexColor(...e):t}}class Ei{#t=new AbortController;#e=null;#i=null;#s=new Map;#o=new Map;#r=null;#n=null;#a=null;#l=new QP;#c=null;#d=null;#u=null;#f=0;#m=new Set;#g=null;#h=null;#p=new Set;_editorUndoBar=null;#_=!1;#v=!1;#y=!1;#S=null;#E=null;#w=null;#C=null;#b=!1;#T=null;#x=new YP;#P=!1;#R=!1;#F=!1;#D=null;#N=null;#V=null;#L=null;#H=null;#I=ot.NONE;#A=new Set;#M=null;#B=null;#$=null;#W=null;#G=null;#K={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#z=[0,0];#O=null;#q=null;#J=null;#Z=null;#U=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=Ei.prototype,e=o=>o.#q.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:c}=a;return c!=="text"&&c!=="number"}return!0},n=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return nt(this,"_keyboardManager",new ko([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&o.#q.contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&o.#q.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:e}]]))}constructor(t,e,s,n,r,o,a,c,l,h,u,p,g,y,m,v){const w=this._signal=this.#t.signal;this.#q=t,this.#J=e,this.#Z=s,this.#r=n,this.#c=r,this.#B=o,this.#G=c,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:w}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),a._on("setpreference",this.onSetPreference.bind(this),{signal:w}),a._on("switchannotationeditorparams",E=>this.updateParams(E.type,E.value),{signal:w}),window.addEventListener("pointerdown",()=>{this.#R=!0},{capture:!0,signal:w}),window.addEventListener("pointerup",()=>{this.#R=!1},{capture:!0,signal:w}),this.#ot(),this.#dt(),this.#et(),this.#n=c.annotationStorage,this.#S=c.filterFactory,this.#$=l,this.#C=h||null,this.#_=u,this.#v=p,this.#y=g,this.#H=y||null,this.viewParameters={realScale:Gn.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null,this._supportsPinchToZoom=v!==!1,r?.setSidebarUiManager(this)}destroy(){this.#U?.resolve(),this.#U=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#o.values())t.destroy();this.#o.clear(),this.#s.clear(),this.#p.clear(),this.#L?.clear(),this.#e=null,this.#A.clear(),this.#l.destroy(),this.#r?.destroy(),this.#c?.destroy(),this.#B?.destroy(),this.#T?.hide(),this.#T=null,this.#V?.destroy(),this.#V=null,this.#i=null,this.#E&&(clearTimeout(this.#E),this.#E=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this._editorUndoBar?.destroy(),this.#G=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#H}get useNewAltTextFlow(){return this.#v}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return nt(this,"hcmFilter",this.#$?this.#S.addHCMFilter(this.#$.foreground,this.#$.background):"none")}get direction(){return nt(this,"direction",getComputedStyle(this.#q).direction)}get _highlightColors(){return nt(this,"_highlightColors",this.#C?new Map(this.#C.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return nt(this,"highlightColors",null);const e=new Map,s=!!this.#$;for(const[n,r]of t){const o=n.endsWith("_HCM");if(s&&o){e.set(n.replace("_HCM",""),r);continue}!s&&!o&&e.set(n,r)}return nt(this,"highlightColors",e)}get highlightColorNames(){return nt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#u=t}setMainHighlightColorPicker(t){this.#V=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}hasCommentManager(){return!!this.#c}editComment(t,e,s,n){this.#c?.showDialog(this,t,e,s,n)}selectComment(t,e){this.#o.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#c?.updateComment(t.getData())}updatePopupColor(t){this.#c?.updatePopupColor(t)}removeComment(t){this.#c?.removeComments([t.uid])}toggleComment(t,e,s=void 0){this.#c?.toggleCommentPopup(t,e,s)}makeCommentColor(t,e){return t&&this.#c?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#c?.dialogElement||null}async waitForEditorsRendered(t){if(this.#o.has(t-1))return;const{resolve:e,promise:s}=Promise.withResolvers(),n=r=>{r.pageNumber===t&&(this._eventBus._off("editorsrendered",n),e())};this._eventBus.on("editorsrendered",n),await s}getSignature(t){this.#B?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#B}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){t==="enableNewAltTextWhenAddingImage"&&(this.#y=e)}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#q.focus()}findParent(t,e){for(const s of this.#o.values()){const{x:n,y:r,width:o,height:a}=s.div.getBoundingClientRect();if(t>=n&&t<=n+o&&e>=r&&e<=r+a)return s}return null}disableUserSelect(t=!1){this.#J.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Gn.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging();this.#u?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of this.#o.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t="",e=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:n,anchorOffset:r,focusNode:o,focusOffset:a}=s,c=s.toString(),h=this.#Q(s).closest(".textLayer"),u=this.getSelectionBoxes(h);if(!u)return;s.empty();const p=this.#tt(h),g=this.#I===ot.NONE,y=()=>{const m=p?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:u,anchorNode:n,anchorOffset:r,focusNode:o,focusOffset:a,text:c});g&&this.showAllEditors("highlight",!0,!0),e&&m?.editComment()};if(g){this.switchToMode(ot.HIGHLIGHT,y);return}y()}commentSelection(t=""){this.highlightSelection(t,!0)}#nt(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=this.#Q(t).closest(".textLayer"),n=this.getSelectionBoxes(s);n&&(this.#T||=new XP(this),this.#T.show(s,n,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#n)return null;const e=`${no}${t}`,s=this.#n.getRawValue(e);return s&&this.#n.remove(e),s}addToAnnotationStorage(t){!t.isEmpty()&&this.#n&&!this.#n.has(t.id)&&this.#n.setValue(t.id,t)}a11yAlert(t,e=null){const s=this.#Z;s&&(s.setAttribute("data-l10n-id",t),e?s.setAttribute("data-l10n-args",JSON.stringify(e)):s.removeAttribute("data-l10n-args"))}#rt(){const t=document.getSelection();if(!t||t.isCollapsed){this.#M&&(this.#T?.hide(),this.#M=null,this.#k({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#M)return;const n=this.#Q(t).closest(".textLayer");if(!n){this.#M&&(this.#T?.hide(),this.#M=null,this.#k({hasSelectedText:!1}));return}if(this.#T?.hide(),this.#M=e,this.#k({hasSelectedText:!0}),!(this.#I!==ot.HIGHLIGHT&&this.#I!==ot.NONE)&&(this.#I===ot.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#b=this.isShiftKeyDown,!this.isShiftKeyDown)){const r=this.#I===ot.HIGHLIGHT?this.#tt(n):null;if(r?.toggleDrawing(),this.#R){const o=new AbortController,a=this.combinedSignal(o),c=l=>{l.type==="pointerup"&&l.button!==0||(o.abort(),r?.toggleDrawing(!0),l.type==="pointerup"&&this.#X("main_toolbar"))};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})}else r?.toggleDrawing(!0),this.#X("main_toolbar")}}#X(t=""){this.#I===ot.HIGHLIGHT?this.highlightSelection(t):this.#_&&this.#nt()}#ot(){document.addEventListener("selectionchange",this.#rt.bind(this),{signal:this._signal})}#at(){if(this.#w)return;this.#w=new AbortController;const t=this.combinedSignal(this.#w);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ct(){this.#w?.abort(),this.#w=null}blur(){if(this.isShiftKeyDown=!1,this.#b&&(this.#b=!1,this.#X("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#A)if(e.div.contains(t)){this.#N=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#N)return;const[t,e]=this.#N;this.#N=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#D)return;this.#D=new AbortController;const t=this.combinedSignal(this.#D);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#lt(){this.#D?.abort(),this.#D=null}#ht(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#ut(){this.#d?.abort(),this.#d=null}#dt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.setEditingState(!0)}removeEditListeners(){this.#lt(),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of this.#h)if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#h)if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of this.#A){const n=s.serialize(!0);n&&e.push(n)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const r of e.items)for(const o of this.#h)if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){it(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const n=this.currentLayer;try{const r=[];for(const c of s){const l=await n.deserialize(c);if(!l)return;r.push(l)}const o=()=>{for(const c of r)this.#st(c);this.#it(r)},a=()=>{for(const c of r)c.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){it(`paste: "${r.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#I!==ot.NONE&&!this.isEditorHandlingKeyboard&&Ei._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#b&&(this.#b=!1,this.#X("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#k(t){Object.entries(t).some(([s,n])=>this.#K[s]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#K,t)}),this.#I===ot.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#j([[_t.HIGHLIGHT_FREE,!0]]))}#j(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#at(),this.#ht(),this.#k({isEditing:this.#I!==ot.NONE,isEmpty:this.#Y(),hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:this.#l.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ct(),this.#ut(),this.#k({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#h){this.#h=t;for(const e of this.#h)this.#j(e.defaultPropertiesToUpdate)}}getId(){return this.#x.id}get currentLayer(){return this.#o.get(this.#f)}getLayer(t){return this.#o.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#o.set(t.pageIndex,t),this.#P?t.enable():t.disable()}removeLayer(t){this.#o.delete(t.pageIndex)}async updateMode(t,e=null,s=!1,n=!1,r=!1,o=!1){if(this.#I!==t&&!(this.#U&&(await this.#U.promise,!this.#U))){if(this.#U=Promise.withResolvers(),this.#u?.commitOrRemove(),this.#I===ot.POPUP&&this.#c?.hideSidebar(),this.#c?.destroyPopup(),this.#I=t,t===ot.NONE){this.setEditingState(!1),this.#pt();for(const a of this.#s.values())a.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#U.resolve();return}for(const a of this.#s.values())a.addStandaloneCommentButton();t===ot.SIGNATURE&&await this.#B?.loadSignatures(),s&&Et.clearPointerType(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const a of this.#o.values())a.updateMode(t);if(t===ot.POPUP){this.#i||=await this.#G.getAnnotationsByType(new Set(this.#h.map(l=>l._editorType)));const a=new Set,c=[];for(const l of this.#s.values()){const{annotationElementId:h,hasComment:u,deleted:p}=l;h&&a.add(h),u&&!p&&c.push(l.getData())}for(const l of this.#i){const{id:h,popupRef:u,contentsObj:p}=l;u&&p?.str&&!a.has(h)&&!this.#m.has(h)&&c.push(l)}this.#c?.showSidebar(c)}if(!e){n&&this.addNewEditorFromKeyboard(),this.#U.resolve();return}for(const a of this.#s.values())a.uid===e?(this.setSelected(a),o?a.editComment():r?a.enterInEditMode():a.focus()):a.unselect();this.#U.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#I&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#h){switch(t){case _t.CREATE:this.currentLayer.addNewEditor(e);return;case _t.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#W||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const s of this.#A)s.updateParams(t,e);else for(const s of this.#h)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){for(const r of this.#s.values())r.editorType===t&&r.show(e);(this.#W?.get(_t.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#j([[_t.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#F!==t){this.#F=t;for(const e of this.#o.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#P){this.#P=!0;const t=[];for(const e of this.#o.values())t.push(e.enable());await Promise.all(t);for(const e of this.#s.values())e.enable()}}#pt(){if(this.unselectAll(),this.#P){this.#P=!1;for(const t of this.#o.values())t.disable();for(const t of this.#s.values())t.disable()}}*getEditors(t){for(const e of this.#s.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#s.get(t)}addEditor(t){this.#s.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#E&&clearTimeout(this.#E),this.#E=setTimeout(()=>{this.focusMainContainer(),this.#E=null},0)),this.#s.delete(t.id),t.annotationElementId&&this.#L?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#m.has(t.annotationElementId))&&this.#n?.remove(t.id)}addDeletedAnnotationElement(t){this.#m.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#m.has(t)}removeDeletedAnnotationElement(t){this.#m.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#st(t){const e=this.#o.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#j(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#A);return t}updateUI(t){this.#gt===t&&this.#j(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#j(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#A.has(t)){this.#A.delete(t),t.unselect(),this.#k({hasSelectedEditor:this.hasSelection});return}this.#A.add(t),t.select(),this.#j(t.propertiesToUpdate),this.#k({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.uid}),this.#u?.commitOrRemove();for(const e of this.#A)e!==t&&e.unselect();this.#A.clear(),this.#A.add(t),t.select(),this.#j(t.propertiesToUpdate),this.#k({hasSelectedEditor:!0})}isSelected(t){return this.#A.has(t)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(t){t.unselect(),this.#A.delete(t),this.#k({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#A.size!==0}get isEnterHandled(){return this.#A.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#l.undo(),this.#k({hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#Y()}),this._editorUndoBar?.hide()}redo(){this.#l.redo(),this.#k({hasSomethingToUndo:!0,hasSomethingToRedo:this.#l.hasSomethingToRedo(),isEmpty:this.#Y()})}addCommands(t){this.#l.add(t),this.#k({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#Y()})}cleanUndoStack(t){this.#l.cleanType(t)}#Y(){if(this.#s.size===0)return!0;if(this.#s.size===1)for(const t of this.#s.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#A],s=()=>{this._editorUndoBar?.show(n,e.length===1?e[0].editorType:e.length);for(const r of e)r.remove()},n=()=>{for(const r of e)this.#st(r)};this.addCommands({cmd:s,undo:n,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#it(t){for(const e of this.#A)e.unselect();this.#A.clear();for(const e of t)e.isEmpty()||(this.#A.add(e),e.select());this.#k({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#A)t.commit();this.#it(this.#s.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#I!==ot.NONE))&&!this.#u?.commitOrRemove()&&this.hasSelection){for(const t of this.#A)t.unselect();this.#A.clear(),this.#k({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#z[0]+=t,this.#z[1]+=e;const[n,r]=this.#z,o=[...this.#A],a=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#z[0]=this.#z[1]=0,this.addCommands({cmd:()=>{for(const c of o)this.#s.has(c.id)&&(c.translateInPage(n,r),c.translationDone())},undo:()=>{for(const c of o)this.#s.has(c.id)&&(c.translateInPage(-n,-r),c.translationDone())},mustExec:!1})},a);for(const c of o)c.translateInPage(t,e),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#g=new Map;for(const t of this.#A)this.#g.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#g)return!1;this.disableUserSelect(!1);const t=this.#g;this.#g=null;let e=!1;for(const[{x:n,y:r,pageIndex:o},a]of t)a.newX=n,a.newY=r,a.newPageIndex=o,e||=n!==a.savedX||r!==a.savedY||o!==a.savedPageIndex;if(!e)return!1;const s=(n,r,o,a)=>{if(this.#s.has(n.id)){const c=this.#o.get(a);c?n._setParentAndPosition(c,r,o):(n.pageIndex=a,n.x=r,n.y=o)}};return this.addCommands({cmd:()=>{for(const[n,{newX:r,newY:o,newPageIndex:a}]of t)s(n,r,o,a)},undo:()=>{for(const[n,{savedX:r,savedY:o,savedPageIndex:a}]of t)s(n,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#g)for(const s of this.#g.keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#A.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#I}isEditingMode(){return this.#I!==ot.NONE}get imageManager(){return nt(this,"imageManager",new Ku)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let l=0,h=e.rangeCount;l<h;l++)if(!t.contains(e.getRangeAt(l).commonAncestorContainer))return null;const{x:s,y:n,width:r,height:o}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(l,h,u,p)=>({x:(h-n)/o,y:1-(l+u-s)/r,width:p/o,height:u/r});break;case"180":a=(l,h,u,p)=>({x:1-(l+u-s)/r,y:1-(h+p-n)/o,width:u/r,height:p/o});break;case"270":a=(l,h,u,p)=>({x:1-(h+p-n)/o,y:(l-s)/r,width:p/o,height:u/r});break;default:a=(l,h,u,p)=>({x:(l-s)/r,y:(h-n)/o,width:u/r,height:p/o});break}const c=[];for(let l=0,h=e.rangeCount;l<h;l++){const u=e.getRangeAt(l);if(!u.collapsed)for(const{x:p,y:g,width:y,height:m}of u.getClientRects())y===0||m===0||c.push(a(p,g,y,m))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#a||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#a?.delete(t)}renderAnnotationElement(t){const e=this.#a?.get(t.data.id);if(!e)return;const s=this.#n.getRawValue(e);s&&(this.#I===ot.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){const n=this.#L?.get(t);n&&(n.setCanvas(e,s),this.#L.delete(t))}addMissingCanvas(t,e){(this.#L||=new Map).set(t,e)}}class vs{#t=null;#e=!1;#i=null;#s=null;#o=null;#r=null;#n=!1;#a=null;#l=null;#c=null;#d=null;#u=!1;static#f=null;static _l10n=null;constructor(t){this.#l=t,this.#u=t._uiManager.useNewAltTextFlow,vs.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){vs._l10n??=t}async render(){const t=this.#i=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#s=document.createElement("span");t.append(e),this.#u?(t.classList.add("new"),t.setAttribute("data-l10n-id",vs.#f.missing),e.setAttribute("data-l10n-id",vs.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#l._uiManager._signal;t.addEventListener("contextmenu",Ze,{signal:s}),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const n=r=>{r.preventDefault(),this.#l._uiManager.editAltText(this.#l),this.#u&&this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",n,{capture:!0,signal:s}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#n=!0,n(r))},{signal:s}),await this.#g(),t}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#n}),this.#n=!1)}isEmpty(){return this.#u?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#u?this.#t!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(t){this.#t===null&&(this.#c=t,this.#d=await vs._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#g())}toggleAltTextBadge(t=!1){if(!this.#u||this.#t){this.#a?.remove(),this.#a=null;return}if(!this.#a){const e=this.#a=document.createElement("div");e.className="noAltTextBadge",this.#l.div.append(e)}this.#a.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#c===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:n,cancel:r=!1}){s&&(this.#c=s,this.#d=n),!(this.#t===t&&this.#e===e)&&(r||(this.#t=t,this.#e=e),this.#g())}toggle(t=!1){this.#i&&(!t&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#i.disabled=!t)}shown(){this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#o=null,this.#a?.remove(),this.#a=null}async#g(){const t=this.#i;if(!t)return;if(this.#u){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",vs.#f[this.#m]),this.#s?.setAttribute("data-l10n-id",vs.#f[`${this.#m}-label`]),!this.#t){this.#o?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#o?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#o;if(!e){this.#o=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#l.id}`;const n=100,r=this.#l._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#o.classList.add("show"),this.#l._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:r}),t.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#o?.classList.remove("show")},{signal:r})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#l.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class ia{#t=null;#e=null;#i=!1;#s=null;#o=null;#r=null;#n=null;#a=null;#l=!1;#c=null;constructor(t){this.#s=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#d(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#s.commentButtonPosition;if(e){const{style:s}=t;s.insetInlineEnd=`calc(${100*(this.#s._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const n=this.#s.commentButtonColor;n&&(s.backgroundColor=n)}return this.#d(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#s.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#s._uiManager.updatePopupColor(this.#s)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#s.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#c)return this.#c;if(!this.#t)return null;const{x:t,y:e,height:s}=this.#t.getBoundingClientRect(),{x:n,y:r,width:o,height:a}=this.#s.parent.boundingClientRect;return[(t-n)/o,(e+s-r)/a]}set commentPopupPositionInLayer(t){this.#c=t}hasDefaultPopupPosition(){return this.#c===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#d(t,e){if(!this.#s._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#s._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=this.#s._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return t;t.addEventListener("contextmenu",Ze,{signal:s}),e&&(t.addEventListener("focusin",r=>{this.#s._focusEventsAllowed=!1,jt(r)},{capture:!0,signal:s}),t.addEventListener("focusout",r=>{this.#s._focusEventsAllowed=!0,jt(r)},{capture:!0,signal:s})),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const n=r=>{r.preventDefault(),t===this.#e?this.edit():this.#s.toggleComment(!0)};return t.addEventListener("click",n,{capture:!0,signal:s}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#i=!0,n(r))},{signal:s}),t.addEventListener("pointerenter",()=>{this.#s.toggleComment(!1,!0)},{signal:s}),t.addEventListener("pointerleave",()=>{this.#s.toggleComment(!1,!1)},{signal:s}),t}edit(t){const e=this.commentPopupPositionInLayer;let s,n;if(e)[s,n]=e;else{[s,n]=this.#s.commentButtonPosition;const{width:h,height:u,x:p,y:g}=this.#s;s=p+s*h,n=g+n*u}const r=this.#s.parent.boundingClientRect,{x:o,y:a,width:c,height:l}=r;this.#s._uiManager.editComment(this.#s,o+s*c,a+n*l,{...t,parentDimensions:r})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#i}),this.#i=!1)}isDeleted(){return this.#l||this.#n===""}isEmpty(){return this.#n===null}hasBeenEdited(){return this.isDeleted()||this.#n!==this.#o}serialize(){return this.data}get data(){return{text:this.#n,richText:this.#r,date:this.#a,deleted:this.isDeleted()}}set data(t){if(t!==this.#n&&(this.#r=null),t===null){this.#n="",this.#l=!0;return}this.#n=t,this.#a=new Date,this.#l=!1}setInitialText(t,e=null){this.#o=t,this.data=t,this.#a=null,this.#r=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#n="",this.#r=null,this.#a=null,this.#s=null,this.#i=!1,this.#l=!1}}class Bc{#t;#e=!1;#i=null;#s;#o;#r;#n;#a=null;#l;#c=null;#d;#u=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:n=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){this.#t=t,this.#i=s,this.#s=e,this.#o=n,this.#r=r,this.#n=o,this.#d=new AbortController,this.#l=AbortSignal.any([a,this.#d.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#l})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Ps.pixelRatio}#f(t){if(this.#s?.())return;if(t.touches.length===1){if(this.#a)return;const n=this.#a=new AbortController,r=AbortSignal.any([this.#l,n.signal]),o=this.#t,a={capture:!0,signal:r,passive:!1},c=l=>{l.pointerType==="touch"&&(this.#a?.abort(),this.#a=null)};o.addEventListener("pointerdown",l=>{l.pointerType==="touch"&&(jt(l),c(l))},a),o.addEventListener("pointerup",c,a),o.addEventListener("pointercancel",c,a);return}if(!this.#u){this.#u=new AbortController;const n=AbortSignal.any([this.#l,this.#u.signal]),r=this.#t,o={signal:n,capture:!1,passive:!1};r.addEventListener("touchmove",this.#m.bind(this),o);const a=this.#g.bind(this);r.addEventListener("touchend",a,o),r.addEventListener("touchcancel",a,o),o.capture=!0,r.addEventListener("pointerdown",jt,o),r.addEventListener("pointermove",jt,o),r.addEventListener("pointercancel",jt,o),r.addEventListener("pointerup",jt,o),this.#o?.()}if(jt(t),t.touches.length!==2||this.#i?.()){this.#c=null;return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),this.#c={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#m(t){if(!this.#c||t.touches.length!==2)return;jt(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:n,screenY:r}=e,{screenX:o,screenY:a}=s,c=this.#c,{touch0X:l,touch0Y:h,touch1X:u,touch1Y:p}=c,g=u-l,y=p-h,m=o-n,v=a-r,w=Math.hypot(m,v)||1,E=Math.hypot(g,y)||1;if(!this.#e&&Math.abs(E-w)<=Bc.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=n,c.touch0Y=r,c.touch1X=o,c.touch1Y=a,!this.#e){this.#e=!0;return}const A=[(n+o)/2,(r+a)/2];this.#r?.(A,E,w)}#g(t){t.touches.length>=2||(this.#u&&(this.#u.abort(),this.#u=null,this.#n?.()),this.#c&&(jt(t),this.#c=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#a?.abort(),this.#a=null}}class X{#t=null;#e=null;#i=null;#s=null;#o=null;#r=!1;#n=null;#a="";#l=null;#c=null;#d=null;#u=null;#f=null;#m="";#g=!1;#h=null;#p=!1;#_=!1;#v=!1;#y=null;#S=0;#E=0;#w=null;#C=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#b=!1;#T=X._zIndex++;static _borderLineWidth=-1;static _colorManager=new Xu;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=X.prototype._resizeWithKeyboard,e=Ei.TRANSLATE_SMALL,s=Ei.TRANSLATE_BIG;return nt(this,"_resizerKeyboardManager",new ko([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],X.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:s,pageHeight:n,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,n],this.pageTranslation=[r,o];const[a,c]=this.parentDimensions;this.x=t.x/a,this.y=t.y/c,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return nt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new JP({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(X._l10n??=t,X._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),X._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);X._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Pt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#b}set _isDraggable(t){this.#b=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#T}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#O(),this.#u?.remove(),this.#u=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,n){const[r,o]=this.parentDimensions;[s,n]=this.screenToPageTranslation(s,n),this.x=(t+s)/r,this.y=(e+n)/o,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,n]=this.parentDimensions;this.setAt(t*s,e*n,this.width*s,this.height*n),this._onTranslated()}#x([t,e],s,n){[s,n]=this.screenToPageTranslation(s,n),this.x+=s/t,this.y+=n/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#x(this.parentDimensions,t,e)}translateInPage(t,e){this.#h||=[this.x,this.y,this.width,this.height],this.#x(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#h||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[n,r]}=this;if(this.x+=t/n,this.y+=e/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[c,l]=this.getBaseTranslation();o+=c,a+=l;const{style:h}=s;h.left=`${(100*o).toFixed(2)}%`,h.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#h&&(this.#h[0]!==this.x||this.#h[1]!==this.y)}get _hasBeenResized(){return!!this.#h&&(this.#h[2]!==this.width||this.#h[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=X,n=s/t,r=s/e;switch(this.rotation){case 90:return[-n,r];case 180:return[n,r];case 270:return[n,-r];default:return[-n,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,n]}=this;let{x:r,y:o,width:a,height:c}=this;if(a*=s,c*=n,r*=s,o*=n,this._mustFixPosition)switch(t){case 0:r=Re(r,0,s-a),o=Re(o,0,n-c);break;case 90:r=Re(r,0,s-c),o=Re(o,a,n);break;case 180:r=Re(r,a,s),o=Re(o,c,n);break;case 270:r=Re(r,c,s),o=Re(o,0,n-a);break}this.x=r/=s,this.y=o/=n;const[l,h]=this.getBaseTranslation();r+=l,o+=h,e.left=`${(100*r).toFixed(2)}%`,e.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#P(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return X.#P(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return X.#P(t,e,360-this.parentRotation)}#R(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(){const{div:{style:t},width:e,height:s}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#F(){if(this.#l)return;this.#l=document.createElement("div"),this.#l.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const n=document.createElement("div");this.#l.append(n),n.classList.add("resizer",s),n.setAttribute("data-resizer-name",s),n.addEventListener("pointerdown",this.#D.bind(this,s),{signal:e}),n.addEventListener("contextmenu",Ze,{signal:e}),n.tabIndex=-1}this.div.prepend(this.#l)}#D(t,e){e.preventDefault();const{isMac:s}=re.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#i?.toggle(!1);const n=this._isDraggable;this._isDraggable=!1,this.#c=[e.screenX,e.screenY];const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#L.bind(this,t),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",jt,{passive:!1,signal:o}),window.addEventListener("contextmenu",Ze,{signal:o}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const l=()=>{r.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=n,this.parent.div.style.cursor=a,this.div.style.cursor=c,this.#V()};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})}#N(t,e,s,n){this.width=s,this.height=n,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#V(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:n}=this.#d;this.#d=null;const r=this.x,o=this.y,a=this.width,c=this.height;r===t&&o===e&&a===s&&c===n||this.addCommands({cmd:this.#N.bind(this,r,o,a,c),undo:this.#N.bind(this,t,e,s,n),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#L(t,e){const[s,n]=this.parentDimensions,r=this.x,o=this.y,a=this.width,c=this.height,l=X.MIN_SIZE/s,h=X.MIN_SIZE/n,u=this.#R(this.rotation),p=(G,K)=>[u[0]*G+u[2]*K,u[1]*G+u[3]*K],g=this.#R(360-this.rotation),y=(G,K)=>[g[0]*G+g[2]*K,g[1]*G+g[3]*K];let m,v,w=!1,E=!1;switch(t){case"topLeft":w=!0,m=(G,K)=>[0,0],v=(G,K)=>[G,K];break;case"topMiddle":m=(G,K)=>[G/2,0],v=(G,K)=>[G/2,K];break;case"topRight":w=!0,m=(G,K)=>[G,0],v=(G,K)=>[0,K];break;case"middleRight":E=!0,m=(G,K)=>[G,K/2],v=(G,K)=>[0,K/2];break;case"bottomRight":w=!0,m=(G,K)=>[G,K],v=(G,K)=>[0,0];break;case"bottomMiddle":m=(G,K)=>[G/2,K],v=(G,K)=>[G/2,0];break;case"bottomLeft":w=!0,m=(G,K)=>[0,K],v=(G,K)=>[G,0];break;case"middleLeft":E=!0,m=(G,K)=>[0,K/2],v=(G,K)=>[G,K/2];break}const A=m(a,c),P=v(a,c);let x=p(...P);const M=X._round(r+x[0]),S=X._round(o+x[1]);let T=1,I=1,k,R;if(e.fromKeyboard)({deltaX:k,deltaY:R}=e);else{const{screenX:G,screenY:K}=e,[ft,Xt]=this.#c;[k,R]=this.screenToPageTranslation(G-ft,K-Xt),this.#c[0]=G,this.#c[1]=K}if([k,R]=y(k/s,R/n),w){const G=Math.hypot(a,c);T=I=Math.max(Math.min(Math.hypot(P[0]-A[0]-k,P[1]-A[1]-R)/G,1/a,1/c),l/a,h/c)}else E?T=Re(Math.abs(P[0]-A[0]-k),l,1)/a:I=Re(Math.abs(P[1]-A[1]-R),h,1)/c;const N=X._round(a*T),D=X._round(c*I);x=p(...v(N,D));const J=M-x[0],wt=S-x[1];this.#h||=[this.x,this.y,this.width,this.height],this.width=N,this.height=D,this.x=J,this.y=wt,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#_)return this._editToolbar;this._editToolbar=new zr(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,s]of t)await this._editToolbar.addButton(e,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#i?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(vs.initialize(X._l10n),this.#i=new vs(this),this.#t&&(this.#i.data=this.#t,this.#t=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(t){this.#i&&(this.#i.data=t)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(t){await this.#i?.setGuessedText(t)}serializeAltText(t){return this.#i?.serialize(t)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}focusCommentButton(){this.#s?.focusButton()}addCommentButton(){return this.canAddComment?this.#s||=new ia(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#o){this._uiManager.isEditingMode()&&this.#o.classList.remove("hidden");return}this.hasComment&&(this.#o=this.#s.renderForStandalone(),this.div.append(this.#o))}}removeStandaloneCommentButton(){this.#s.removeStandaloneCommentButton(),this.#o=null}hideStandaloneCommentButton(){this.#o?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:s,deleted:n}}=this.#s;return{text:e,richText:t,date:s,deleted:n,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#s||=new ia(this),this.#s.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:s}){if(!e||(this.#s||=new ia(this),this.#s.setInitialText(t,s),!this.annotationElementId))return;const n=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);n&&this.updateFromAnnotationLayer(n)}get hasEditedComment(){return this.#s?.hasBeenEdited()}get hasDeletedComment(){return this.#s?.isDeleted()}get hasComment(){return!!this.#s&&!this.#s.isEmpty()&&!this.#s.isDeleted()}async editComment(t){this.#s||=new ia(this),this.#s.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#s.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,n]=t.rect,[r]=this.pageDimensions,[o]=this.pageTranslation,a=o+r+1,c=n-100,l=a+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,c,l,n]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#s.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#$();const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[n,r]=this.getInitialTranslation();return this.translate(n,r),Pv(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new Bc({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#H.bind(this),onPinching:this.#I.bind(this),onPinchEnd:this.#A.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#H(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#I(t,e,s){let r=.7*(s/e)+1-.7;if(r===1)return;const o=this.#R(this.rotation),a=(M,S)=>[o[0]*M+o[2]*S,o[1]*M+o[3]*S],[c,l]=this.parentDimensions,h=this.x,u=this.y,p=this.width,g=this.height,y=X.MIN_SIZE/c,m=X.MIN_SIZE/l;r=Math.max(Math.min(r,1/p,1/g),y/p,m/g);const v=X._round(p*r),w=X._round(g*r);if(v===p&&w===g)return;this.#h||=[h,u,p,g];const E=a(p/2,g/2),A=X._round(h+E[0]),P=X._round(u+E[1]),x=a(v/2,w/2);this.x=A-x[0],this.y=P-x[1],this.width=v,this.height=w,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#A(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#V()}pointerdown(t){const{isMac:e}=re.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#B(t);return}this.#M(t)}#M(t){const{isMac:e}=re.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#B(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const n=new AbortController,r=this._uiManager.combinedSignal(n),o={capture:!0,passive:!1,signal:r},a=l=>{n.abort(),this.#n=null,this.#g=!1,this._uiManager.endDragSession()||this.#M(l),s&&this._onStopDragging()};e&&(this.#S=t.clientX,this.#E=t.clientY,this.#n=t.pointerId,this.#a=t.pointerType,window.addEventListener("pointermove",l=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:h,clientY:u,pointerId:p}=l;if(p!==this.#n){jt(l);return}const[g,y]=this.screenToPageTranslation(h-this.#S,u-this.#E);this.#S=h,this.#E=u,this._uiManager.dragSelectedEditors(g,y)},o),window.addEventListener("touchmove",jt,o),window.addEventListener("pointerdown",l=>{l.pointerType===this.#a&&(this.#C||l.isPrimary)&&a(l),jt(l)},o));const c=l=>{if(!this.#n||this.#n===l.pointerId){a(l);return}jt(l)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const n=this.parentScale,[r,o]=this.pageDimensions,[a,c]=this.pageTranslation,l=t/n,h=e/n,u=this.x*r,p=this.y*o,g=this.width*r,y=this.height*o;switch(s){case 0:return[u+l+a,o-p-h-y+c,u+l+g+a,o-p-h+c];case 90:return[u+h+a,o-p+l+c,u+h+y+a,o-p+l+g+c];case 180:return[u-l-g+a,o-p+h+c,u-l+a,o-p+h+y+c];case 270:return[u-h-y+a,o-p-l-g+c,u-h+a,o-p-l+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,n,r,o]=t,a=r-s,c=o-n;switch(this.rotation){case 0:return[s,e-o,a,c];case 90:return[s,e-n,c,a];case 180:return[r,e-n,a,c];case 270:return[r,e-o,c,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&X._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#s?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:s,opacity:n,deleted:r,richText:o},uid:a,pageIndex:c,creationDate:l,modificationDate:h}=this;return{id:a,pageIndex:c,rect:this.getPDFRect(),richText:o,contentsObj:{str:t},creationDate:l,modificationDate:s||h,popupRef:!r,color:e,opacity:n}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#_=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#_=!1,!0):!1}isInEditMode(){return this.#_}shouldGetKeyboardEvents(){return this.#v}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:n}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return e<o&&n>0&&t<r&&s>0}#$(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#$()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,s){const n=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});n.rotation=t.rotation,n.#t=t.accessibilityData,n._isCopy=t.isCopy||!1;const[r,o]=n.pageDimensions,[a,c,l,h]=n.getRectInCurrentCoords(t.rect,o);return n.x=a/r,n.y=c/o,n.width=l/r,n.height=h/o,n}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#O(),this.removeEditToolbar(),this.#w){for(const t of this.#w.values())clearTimeout(t);this.#w=null}this.parent=null,this.#C?.destroy(),this.#C=null,this.#u?.remove(),this.#u=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#F(),this.#l.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[s,n,r,o]=this.getPDFRect();return[X._round(s+(r-s)*t),X._round(n+(o-n)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#s.commentPopupPositionInLayer}set commentPopupPosition(t){this.#s.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#s.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#s.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#s?.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#l.children;if(!this.#e){this.#e=Array.from(e);const o=this.#W.bind(this),a=this.#G.bind(this),c=this._uiManager._signal;for(const l of this.#e){const h=l.getAttribute("data-resizer-name");l.setAttribute("role","spinbutton"),l.addEventListener("keydown",o,{signal:c}),l.addEventListener("blur",a,{signal:c}),l.addEventListener("focus",this.#K.bind(this,h),{signal:c}),l.setAttribute("data-l10n-id",X._l10nResizer[h])}}const s=this.#e[0];let n=0;for(const o of e){if(o===s)break;n++}const r=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(r!==n){if(r<n)for(let a=0;a<n-r;a++)this.#l.append(this.#l.firstElementChild);else if(r>n)for(let a=0;a<r-n;a++)this.#l.firstElementChild.before(this.#l.lastElementChild);let o=0;for(const a of e){const l=this.#e[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",X._l10nResizer[l])}}this.#z(0),this.#v=!0,this.#l.firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#W(t){X._resizerKeyboardManager.exec(this,t)}#G(t){this.#v&&t.relatedTarget?.parentNode!==this.#l&&this.#O()}#K(t){this.#m=this.#v?t:""}#z(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#v&&this.#L(this.#m,{deltaX:t,deltaY:e,fromKeyboard:!0})}#O(){this.#v=!1,this.#z(-1),this.#V()}_stopResizingWithKeyboard(){this.#O(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#l?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#w||=new Map;const{action:s}=t;let n=this.#w.get(s);n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(t),this.#w.delete(s),this.#w.size===0&&(this.#w=null)},X._telemetryTimeout),this.#w.set(s,n);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(t){if(!this.#u&&!this.deleted){this.#u=t.addFakeAnnotation(this);return}if(this.deleted){this.#u.remove(),this.#u=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#u.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class JP extends X{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Ag=3285377520,Ge=4294901760,gs=65535;class Rv{constructor(t){this.h1=t?t&4294967295:Ag,this.h2=t?t&4294967295:Ag}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let m=0,v=t.length;m<v;m++){const w=t.charCodeAt(m);w<=255?e[s++]=w:(e[s++]=w>>>8,e[s++]=w&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const n=s>>2,r=s-n*4,o=new Uint32Array(e.buffer,0,n);let a=0,c=0,l=this.h1,h=this.h2;const u=3432918353,p=461845907,g=u&gs,y=p&gs;for(let m=0;m<n;m++)m&1?(a=o[m],a=a*u&Ge|a*g&gs,a=a<<15|a>>>17,a=a*p&Ge|a*y&gs,l^=a,l=l<<13|l>>>19,l=l*5+3864292196):(c=o[m],c=c*u&Ge|c*g&gs,c=c<<15|c>>>17,c=c*p&Ge|c*y&gs,h^=c,h=h<<13|h>>>19,h=h*5+3864292196);switch(a=0,r){case 3:a^=e[n*4+2]<<16;case 2:a^=e[n*4+1]<<8;case 1:a^=e[n*4],a=a*u&Ge|a*g&gs,a=a<<15|a>>>17,a=a*p&Ge|a*y&gs,n&1?l^=a:h^=a}this.h1=l,this.h2=h}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Ge|t*36045&gs,e=e*4283543511&Ge|((e<<16|t>>>16)*2950163797&Ge)>>>16,t^=e>>>1,t=t*444984403&Ge|t*60499&gs,e=e*3301882366&Ge|((e<<16|t>>>16)*3120437893&Ge)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Dh=Object.freeze({map:null,hash:"",transfer:void 0});class Yu{#t=!1;#e=null;#i=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=this.#s.get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return this.#s.get(t)}remove(t){const e=this.#s.get(t);if(e!==void 0&&(e instanceof X&&this.#i.delete(e.annotationElementId),this.#s.delete(t),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of this.#s.values())if(s instanceof X)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#s.get(t);let n=!1;if(s!==void 0)for(const[r,o]of Object.entries(e))s[r]!==o&&(n=!0,s[r]=o);else n=!0,this.#s.set(t,e);n&&this.#o(),e instanceof X&&((this.#i||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#s.has(t)}get size(){return this.#s.size}#o(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new xv(this)}get serializable(){if(this.#s.size===0)return Dh;const t=new Map,e=new Rv,s=[],n=Object.create(null);let r=!1;for(const[o,a]of this.#s){const c=a instanceof X?a.serialize(!1,n):a;c&&(t.set(o,c),e.update(`${o}:${JSON.stringify(c)}`),r||=!!c.bitmap)}if(r)for(const o of t.values())o.bitmap&&s.push(o.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:Dh}get editorStats(){let t=null;const e=new Map;let s=0,n=0;for(const r of this.#s.values()){if(!(r instanceof X)){r.popup&&(r.popup.deleted?n+=1:s+=1);continue}r.isCommentDeleted?n+=1:r.hasEditedComment&&(s+=1);const o=r.telemetryFinalData;if(!o)continue;const{type:a}=o;e.has(a)||e.set(a,Object.getPrototypeOf(r).constructor),t||=Object.create(null);const c=t[a]||=new Map;for(const[l,h]of Object.entries(o)){if(l==="type")continue;let u=c.get(l);u||(u=new Map,c.set(l,u));const p=u.get(h)??0;u.set(h,p+1)}}if((n>0||s>0)&&(t||=Object.create(null),t.comments={deleted:n,edited:s}),!t)return null;for(const[r,o]of e)t[r]=o.computeTelemetryFinalData(t[r]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const s=this.#i?.get(t);return s?(s.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#i?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#i)for(const e of this.#i.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#s.entries()}}class xv extends Yu{#t;constructor(t){super();const{map:e,hash:s,transfer:n}=t.serializable,r=structuredClone(e,n?{transfer:n}:null);this.#t={map:r,hash:s,transfer:n}}get print(){Pt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return nt(this,"modifiedIds",{ids:new Set,hash:""})}}class ZP{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||this.#t.has(t.loadedName))){if(yt(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:n,src:r,style:o}=t,a=new FontFace(n,r,o);this.addNativeFontFace(a);try{await a.load(),this.#t.add(n),s?.(t)}catch{it(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Pt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(n){throw it(`Failed to load font '${s.family}': '${n}'.`),t.disableFontFace=!0,n}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const n=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,n)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return nt(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return nt(this,"isSyncFontLoadingSupported",Pe||re.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(yt(!n.done,"completeRequest() cannot be called twice."),n.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,n={done:!1,complete:e,callback:t};return s.push(n),n}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return nt(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(P,x){return P.charCodeAt(x)<<24|P.charCodeAt(x+1)<<16|P.charCodeAt(x+2)<<8|P.charCodeAt(x+3)&255}function n(P,x,M,S){const T=P.substring(0,x),I=P.substring(x+M);return T+S+I}let r,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const c=a.getContext("2d");let l=0;function h(P,x){if(++l>30){it("Load test font never loaded."),x();return}if(c.font="30px "+P,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(h.bind(null,P,x))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=n(p,976,u.length,u);const y=16,m=1482184792;let v=s(p,y);for(r=0,o=u.length-3;r<o;r+=4)v=v-m+s(u,r)|0;r<u.length&&(v=v-m+s(u+"XXX",r)|0),p=n(p,y,4,MP(v));const w=`url(data:font/opentype;base64,${btoa(p)});`,E=`@font-face {font-family:"${u}";src:${w}}`;this.insertRule(E);const A=this._document.createElement("div");A.style.visibility="hidden",A.style.width=A.style.height="10px",A.style.position="absolute",A.style.top=A.style.left="0px";for(const P of[t.loadedName,u]){const x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=P,A.append(x)}this._document.body.append(A),h(u,()=>{A.remove(),e.complete()})}}class tR{#t;constructor(t,e=null,s,n){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,s&&Object.assign(this,s),n&&(this.charProcOperatorList=n)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Tv(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let n;try{n=t.get(s)}catch(o){it(`getPathGenerator - ignoring character: "${o}".`)}const r=Cv(n?.path);return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=r}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}set disableFontFace(t){nt(this,"disableFontFace",!!t)}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}set bbox(t){nt(this,"bbox",t)}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}class Dn{#t;#e;#i;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,s={};let n=0;for(const l of Dn.strings){const h=e.encode(t[l]);s[l]=h,n+=4+h.length}const r=new ArrayBuffer(n),o=new Uint8Array(r),a=new DataView(r);let c=0;for(const l of Dn.strings){const h=s[l],u=h.length;a.setUint32(c,u),o.set(h,c+4),c+=4+u}return yt(c===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}#s(t){yt(t<Dn.strings.length,"Invalid string index");let e=0;for(let n=0;n<t;n++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,s))}get fontFamily(){return this.#s(0)}get fontWeight(){return this.#s(1)}get italicAngle(){return this.#s(2)}}class Mn{#t;#e;#i;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,s={};let n=0;for(const p of Mn.strings){const g=e.encode(t[p]);s[p]=g,n+=4+g.length}n+=4;let r,o,a=1+n;t.style&&(r=e.encode(t.style.style),o=e.encode(t.style.weight),a+=4+r.length+4+o.length);const c=new ArrayBuffer(a),l=new Uint8Array(c),h=new DataView(c);let u=0;h.setUint8(u++,t.guessFallback?1:0),h.setUint32(u,0),u+=4,n=0;for(const p of Mn.strings){const g=s[p],y=g.length;n+=4+y,h.setUint32(u,y),l.set(g,u+4),u+=4+y}return h.setUint32(u-n-4,n),t.style&&(h.setUint32(u,r.length),l.set(r,u+4),u+=4+r.length,h.setUint32(u,o.length),l.set(o,u+4),u+=4+o.length),yt(u<=c.byteLength,"SubstitionInfo.write: Buffer overflow"),c.transferToFixedLength(u)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#s(t){yt(t<Mn.strings.length,"Invalid string index");let e=5;for(let n=0;n<t;n++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,s))}get css(){return this.#s(0)}get loadedName(){return this.#s(1)}get baseFontName(){return this.#s(2)}get src(){return this.#s(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),s=this.#i.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const n=this.#e.getUint32(t),r=this.#i.decode(new Uint8Array(this.#t,t+4,n));return{style:s,weight:r}}}class St{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#i=this.#e+1+8;static#s=this.#i+1+48;static#o=this.#s+1+6;#r;#n;#a;constructor({data:t,extra:e}){this.#r=t,this.#n=new TextDecoder,this.#a=new DataView(this.#r),e&&Object.assign(this,e)}#l(t){yt(t<St.bools.length,"Invalid boolean index");const e=Math.floor(t/4),s=t*2%8,n=this.#a.getUint8(e)>>s&3;return n===0?void 0:n===2}get black(){return this.#l(0)}get bold(){return this.#l(1)}get disableFontFace(){return this.#l(2)}get fontExtraProperties(){return this.#l(3)}get isInvalidPDFjsFont(){return this.#l(4)}get isType3Font(){return this.#l(5)}get italic(){return this.#l(6)}get missingFile(){return this.#l(7)}get remeasure(){return this.#l(8)}get vertical(){return this.#l(9)}#c(t){return yt(t<St.numbers.length,"Invalid number index"),this.#a.getFloat64(St.#t+t*8)}get ascent(){return this.#c(0)}get defaultWidth(){return this.#c(1)}get descent(){return this.#c(2)}get bbox(){let t=St.#e;if(this.#a.getUint8(t)===0)return;t+=1;const s=[];for(let n=0;n<4;n++)s.push(this.#a.getInt16(t,!0)),t+=2;return s}get fontMatrix(){let t=St.#i;if(this.#a.getUint8(t)===0)return;t+=1;const s=[];for(let n=0;n<6;n++)s.push(this.#a.getFloat64(t,!0)),t+=8;return s}get defaultVMetrics(){let t=St.#s;if(this.#a.getUint8(t)===0)return;t+=1;const s=[];for(let n=0;n<3;n++)s.push(this.#a.getInt16(t,!0)),t+=2;return s}#d(t){yt(t<St.strings.length,"Invalid string index");let e=St.#o+4;for(let r=0;r<t;r++)e+=this.#a.getUint32(e)+4;const s=this.#a.getUint32(e),n=new Uint8Array(s);return n.set(new Uint8Array(this.#r,e+4,s)),this.#n.decode(n)}get fallbackName(){return this.#d(0)}get loadedName(){return this.#d(1)}get mimetype(){return this.#d(2)}get name(){return this.#d(3)}get data(){let t=St.#o;const e=this.#a.getUint32(t);t+=4+e;const s=this.#a.getUint32(t);t+=4+s;const n=this.#a.getUint32(t);t+=4+n;const r=this.#a.getUint32(t);if(r!==0)return new Uint8Array(this.#r,t+4,r)}clearData(){let t=St.#o;const e=this.#a.getUint32(t);t+=4+e;const s=this.#a.getUint32(t);t+=4+s;const n=this.#a.getUint32(t);t+=4+n;const r=this.#a.getUint32(t);new Uint8Array(this.#r,t+4,r).fill(0),this.#a.setUint32(t,0)}get cssFontInfo(){let t=St.#o;const e=this.#a.getUint32(t);t+=4+e;const s=this.#a.getUint32(t);t+=4+s;const n=this.#a.getUint32(t);if(n===0)return null;const r=new Uint8Array(n);return r.set(new Uint8Array(this.#r,t+4,n)),new Dn(r.buffer)}get systemFontInfo(){let t=St.#o;const e=this.#a.getUint32(t);t+=4+e;const s=this.#a.getUint32(t);if(s===0)return null;const n=new Uint8Array(s);return n.set(new Uint8Array(this.#r,t+4,s)),new Mn(n.buffer)}static write(t){const e=t.systemFontInfo?Mn.write(t.systemFontInfo):null,s=t.cssFontInfo?Dn.write(t.cssFontInfo):null,n=new TextEncoder,r={};let o=0;for(const m of St.strings)r[m]=n.encode(t[m]),o+=4+r[m].length;const a=St.#o+4+o+4+(e?e.byteLength:0)+4+(s?s.byteLength:0)+4+(t.data?t.data.length:0),c=new ArrayBuffer(a),l=new Uint8Array(c),h=new DataView(c);let u=0;const p=St.bools.length;let g=0,y=0;for(let m=0;m<p;m++){const v=t[St.bools[m]];g|=(v===void 0?0:v?2:1)<<y,y+=2,(y===8||m===p-1)&&(h.setUint8(u++,g),g=0,y=0)}yt(u===St.#t,"FontInfo.write: Boolean properties offset mismatch");for(const m of St.numbers)h.setFloat64(u,t[m]),u+=8;if(yt(u===St.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){h.setUint8(u++,4);for(const m of t.bbox)h.setInt16(u,m,!0),u+=2}else h.setUint8(u++,0),u+=8;if(yt(u===St.#i,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){h.setUint8(u++,6);for(const m of t.fontMatrix)h.setFloat64(u,m,!0),u+=8}else h.setUint8(u++,0),u+=48;if(yt(u===St.#s,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){h.setUint8(u++,1);for(const m of t.defaultVMetrics)h.setInt16(u,m,!0),u+=2}else h.setUint8(u++,0),u+=6;yt(u===St.#o,"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(St.#o,0),u+=4;for(const m of St.strings){const v=r[m],w=v.length;h.setUint32(u,w),l.set(v,u+4),u+=4+w}if(h.setUint32(St.#o,u-St.#o-4),!e)h.setUint32(u,0),u+=4;else{const m=e.byteLength;h.setUint32(u,m),yt(u+4+m<=c.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),l.set(new Uint8Array(e),u+4),u+=4+m}if(!s)h.setUint32(u,0),u+=4;else{const m=s.byteLength;h.setUint32(u,m),yt(u+4+m<=c.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),l.set(new Uint8Array(s),u+4),u+=4+m}return t.data===void 0?(h.setUint32(u,0),u+=4):(h.setUint32(u,t.data.length),l.set(t.data,u+4),u+=4+t.data.length),yt(u<=c.byteLength,"FontInfo.write: Buffer overflow"),c.transferToFixedLength(u)}}class ae{static#t=0;static#e=1;static#i=2;static#s=3;static#o=4;static#r=8;static#n=12;static#a=16;constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,s=null,n=[],r=[],o=[],a=[],c=null,l=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,s=t[2],o=t[3],e===1?n.push(...t[4],...t[5]):n.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,c=t[1],n=t[2],r=t[3],a=t[4]||[],s=t[6],l=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const h=Math.floor(n.length/2),u=Math.floor(r.length/3),p=o.length,g=a.length;let y=0;for(const x of a)y+=1,y=Math.ceil(y/4)*4,y+=4+x.coords.length*4,y+=4+x.colors.length*4,x.verticesPerRow!==void 0&&(y+=4);const m=20+h*8+u*3+p*8+(s?16:0)+(l?3:0)+y,v=new ArrayBuffer(m),w=new DataView(v),E=new Uint8Array(v);w.setUint8(ae.#t,e),w.setUint8(ae.#e,s?1:0),w.setUint8(ae.#i,l?1:0),w.setUint8(ae.#s,c),w.setUint32(ae.#o,h,!0),w.setUint32(ae.#r,u,!0),w.setUint32(ae.#n,p,!0),w.setUint32(ae.#a,g,!0);let A=20;new Float32Array(v,A,h*2).set(n),A+=h*8,E.set(r,A),A+=u*3;for(const[x,M]of o)w.setFloat32(A,x,!0),A+=4,w.setUint32(A,parseInt(M.slice(1),16),!0),A+=4;if(s)for(const x of s)w.setFloat32(A,x,!0),A+=4;l&&(E.set(l,A),A+=3);for(let x=0;x<a.length;x++){const M=a[x];w.setUint8(A,M.type),A+=1,A=Math.ceil(A/4)*4,w.setUint32(A,M.coords.length,!0),A+=4,new Int32Array(v,A,M.coords.length).set(M.coords),A+=M.coords.length*4,w.setUint32(A,M.colors.length,!0),A+=4,new Int32Array(v,A,M.colors.length).set(M.colors),A+=M.colors.length*4,M.verticesPerRow!==void 0&&(w.setUint32(A,M.verticesPerRow,!0),A+=4)}return v}getIR(){const t=this.view,e=this.data[ae.#t],s=!!this.data[ae.#e],n=!!this.data[ae.#i],r=t.getUint32(ae.#o,!0),o=t.getUint32(ae.#r,!0),a=t.getUint32(ae.#n,!0),c=t.getUint32(ae.#a,!0);let l=20;const h=new Float32Array(this.buffer,l,r*2);l+=r*8;const u=new Uint8Array(this.buffer,l,o*3);l+=o*3;const p=[];for(let v=0;v<a;++v){const w=t.getFloat32(l,!0);l+=4;const E=t.getUint32(l,!0);l+=4,p.push([w,`#${E.toString(16).padStart(6,"0")}`])}let g=null;if(s){g=[];for(let v=0;v<4;++v)g.push(t.getFloat32(l,!0)),l+=4}let y=null;n&&(y=new Uint8Array(this.buffer,l,3),l+=3);const m=[];for(let v=0;v<c;++v){const w=t.getUint8(l);l+=1,l=Math.ceil(l/4)*4;const E=t.getUint32(l,!0);l+=4;const A=new Int32Array(this.buffer,l,E);l+=E*4;const P=t.getUint32(l,!0);l+=4;const x=new Int32Array(this.buffer,l,P);l+=P*4;const M={type:w,coords:A,colors:x};w===Ch.LATTICE&&(M.verticesPerRow=t.getUint32(l,!0),l+=4),m.push(M)}if(e===1)return["RadialAxial","axial",g,p,Array.from(h.slice(0,2)),Array.from(h.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",g,p,[h[0],h[1]],[h[3],h[4]],h[2],h[5]];if(e===3){const v=this.data[ae.#s];let w=null;if(h.length>0){let E=h[0],A=h[0],P=h[1],x=h[1];for(let M=0;M<h.length;M+=2){const S=h[M],T=h[M+1];E=E>S?S:E,P=P>T?T:P,A=A<S?S:A,x=x<T?T:x}w=[E,P,A,x]}return["Mesh",v,h,u,m,w,g,y]}throw new Error(`Unsupported pattern kind: ${e}`)}}class eR{static write(t){let e,s;return re.isFloat16ArraySupported?(s=new ArrayBuffer(t.length*2),e=new Float16Array(s)):(s=new ArrayBuffer(t.length*4),e=new Float32Array(s)),e.set(t),s}#t;constructor(t){this.#t=t}get path(){return re.isFloat16ArraySupported?new Float16Array(this.#t):new Float32Array(this.#t)}}function sR(i){if(i instanceof URL)return i.href;if(typeof i=="string"){if(Pe)return i;const t=URL.parse(i,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function iR(i){if(Pe&&typeof Buffer<"u"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return Co(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i?.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function na(i){if(typeof i!="string")return null;if(i.endsWith("/"))return i;throw new Error(`Invalid factory url: "${i}" must include trailing slash.`)}const Mh=i=>typeof i=="object"&&Number.isInteger(i?.num)&&i.num>=0&&Number.isInteger(i?.gen)&&i.gen>=0,nR=i=>typeof i=="object"&&typeof i?.name=="string",rR=VP.bind(null,Mh,nR);class oR{#t=new Map;#e=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[n]of this.#t)n.call(this,s)})}addEventListener(t,e,s=null){let n=null;if(s?.signal instanceof AbortSignal){const{signal:r}=s;if(r.aborted){it("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(t,e);n=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}this.#t.set(e,n)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const ra={DATA:1,ERROR:2},Yt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Eg(){}function Me(i){if(i instanceof Ai||i instanceof Ph||i instanceof gg||i instanceof tc||i instanceof Pl)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||Pt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new Ai(i.message);case"InvalidPDFException":return new Ph(i.message);case"PasswordException":return new gg(i.message,i.code);case"ResponseException":return new tc(i.message,i.status,i.missing);case"UnknownErrorException":return new Pl(i.message,i.details)}return new Pl(i.message,i.toString())}class Dr{#t=new AbortController;constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#s(t);return}if(t.callback){const s=t.callbackId,n=this.callbackCapabilities[s];if(!n)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===ra.DATA)n.resolve(t.data);else if(t.callback===ra.ERROR)n.reject(Me(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,n=t.sourceName,r=this.comObj;Promise.try(e,t.data).then(function(o){r.postMessage({sourceName:s,targetName:n,callback:ra.DATA,callbackId:t.callbackId,data:o})},function(o){r.postMessage({sourceName:s,targetName:n,callback:ra.ERROR,callbackId:t.callbackId,reason:Me(o)})});return}if(t.streamId){this.#i(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const n=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[n]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:n,data:e},s)}catch(o){r.reject(o)}return r.promise}sendWithStream(t,e,s,n){const r=this.streamId++,o=this.sourceName,a=this.targetName,c=this.comObj;return new ReadableStream({start:l=>{const h=Promise.withResolvers();return this.streamControllers[r]={controller:l,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:a,action:t,streamId:r,data:e,desiredSize:l.desiredSize},n),h.promise},pull:l=>{const h=Promise.withResolvers();return this.streamControllers[r].pullCall=h,c.postMessage({sourceName:o,targetName:a,stream:Yt.PULL,streamId:r,desiredSize:l.desiredSize}),h.promise},cancel:l=>{yt(l instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[r].cancelCall=h,this.streamControllers[r].isClosed=!0,c.postMessage({sourceName:o,targetName:a,stream:Yt.CANCEL,streamId:r,reason:Me(l)}),h.promise}},s)}#i(t){const e=t.streamId,s=this.sourceName,n=t.sourceName,r=this.comObj,o=this,a=this.actionHandler[t.action],c={enqueue(l,h=1,u){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=h,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:n,stream:Yt.ENQUEUE,streamId:e,chunk:l},u)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:n,stream:Yt.CLOSE,streamId:e}),delete o.streamSinks[e])},error(l){yt(l instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:n,stream:Yt.ERROR,streamId:e,reason:Me(l)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[e]=c,Promise.try(a,t.data,c).then(function(){r.postMessage({sourceName:s,targetName:n,stream:Yt.START_COMPLETE,streamId:e,success:!0})},function(l){r.postMessage({sourceName:s,targetName:n,stream:Yt.START_COMPLETE,streamId:e,reason:Me(l)})})}#s(t){const e=t.streamId,s=this.sourceName,n=t.sourceName,r=this.comObj,o=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case Yt.START_COMPLETE:t.success?o.startCall.resolve():o.startCall.reject(Me(t.reason));break;case Yt.PULL_COMPLETE:t.success?o.pullCall.resolve():o.pullCall.reject(Me(t.reason));break;case Yt.PULL:if(!a){r.postMessage({sourceName:s,targetName:n,stream:Yt.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||Eg).then(function(){r.postMessage({sourceName:s,targetName:n,stream:Yt.PULL_COMPLETE,streamId:e,success:!0})},function(l){r.postMessage({sourceName:s,targetName:n,stream:Yt.PULL_COMPLETE,streamId:e,reason:Me(l)})});break;case Yt.ENQUEUE:if(yt(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(t.chunk);break;case Yt.CLOSE:if(yt(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#o(o,e);break;case Yt.ERROR:yt(o,"error should have stream controller"),o.controller.error(Me(t.reason)),this.#o(o,e);break;case Yt.CANCEL_COMPLETE:t.success?o.cancelCall.resolve():o.cancelCall.reject(Me(t.reason)),this.#o(o,e);break;case Yt.CANCEL:if(!a)break;const c=Me(t.reason);Promise.try(a.onCancel||Eg,c).then(function(){r.postMessage({sourceName:s,targetName:n,stream:Yt.CANCEL_COMPLETE,streamId:e,success:!0})},function(l){r.postMessage({sourceName:s,targetName:n,stream:Yt.CANCEL_COMPLETE,streamId:e,reason:Me(l)})}),a.sinkCapability.reject(c),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#o(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class kv{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Pt("Abstract method `_createCanvas` called.")}}class aR extends kv{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class Dv{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Pt("Abstract method `_fetch` called.")}}class Tg extends Dv{async _fetch(t){const e=await Po(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Co(e)}}class Mv{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,n,r){return"none"}destroy(t=!1){}}class cR extends Mv{#t;#e;#i;#s;#o;#r;#n=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#s=t,this.#o=e}get#a(){return this.#e||=new Map}get#l(){return this.#r||=new Map}get#c(){if(!this.#i){const t=this.#o.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const s=this.#o.createElementNS(Ms,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#i=this.#o.createElementNS(Ms,"defs"),t.append(s),s.append(this.#i),this.#o.body.append(t)}return this.#i}#d(t){if(t.length===1){const c=t[0],l=new Array(256);for(let u=0;u<256;u++)l[u]=c[u]/255;const h=l.join(",");return[h,h,h]}const[e,s,n]=t,r=new Array(256),o=new Array(256),a=new Array(256);for(let c=0;c<256;c++)r[c]=e[c]/255,o[c]=s[c]/255,a[c]=n[c]/255;return[r.join(","),o.join(","),a.join(",")]}#u(t){if(this.#t===void 0){this.#t="";const e=this.#o.URL;e!==this.#o.baseURI&&(Vc(e)?it('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=wv(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#a.get(t);if(e)return e;const[s,n,r]=this.#d(t),o=t.length===1?s:`${s}${n}${r}`;if(e=this.#a.get(o),e)return this.#a.set(t,e),e;const a=`g_${this.#s}_transfer_map_${this.#n++}`,c=this.#u(a);this.#a.set(t,c),this.#a.set(o,c);const l=this.#g(a);return this.#p(s,n,r,l),c}addHCMFilter(t,e){const s=`${t}-${e}`,n="base";let r=this.#l.get(n);if(r?.key===s||(r?(r.filter?.remove(),r.key=s,r.url="none",r.filter=null):(r={key:s,url:"none",filter:null},this.#l.set(n,r)),!t||!e))return r.url;const o=this.#v(t);t=H.makeHexColor(...o);const a=this.#v(e);if(e=H.makeHexColor(...a),this.#c.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return r.url;const c=new Array(256);for(let g=0;g<=255;g++){const y=g/255;c[g]=y<=.03928?y/12.92:((y+.055)/1.055)**2.4}const l=c.join(","),h=`g_${this.#s}_hcm_filter`,u=r.filter=this.#g(h);this.#p(l,l,l,u),this.#m(u);const p=(g,y)=>{const m=o[g]/255,v=a[g]/255,w=new Array(y+1);for(let E=0;E<=y;E++)w[E]=m+E/y*(v-m);return w.join(",")};return this.#p(p(0,5),p(1,5),p(2,5),u),r.url=this.#u(h),r.url}addAlphaFilter(t){let e=this.#a.get(t);if(e)return e;const[s]=this.#d([t]),n=`alpha_${s}`;if(e=this.#a.get(n),e)return this.#a.set(t,e),e;const r=`g_${this.#s}_alpha_map_${this.#n++}`,o=this.#u(r);this.#a.set(t,o),this.#a.set(n,o);const a=this.#g(r);return this.#_(s,a),o}addLuminosityFilter(t){let e=this.#a.get(t||"luminosity");if(e)return e;let s,n;if(t?([s]=this.#d([t]),n=`luminosity_${s}`):n="luminosity",e=this.#a.get(n),e)return this.#a.set(t,e),e;const r=`g_${this.#s}_luminosity_map_${this.#n++}`,o=this.#u(r);this.#a.set(t,o),this.#a.set(n,o);const a=this.#g(r);return this.#f(a),t&&this.#_(s,a),o}addHighlightHCMFilter(t,e,s,n,r){const o=`${e}-${s}-${n}-${r}`;let a=this.#l.get(t);if(a?.key===o||(a?(a.filter?.remove(),a.key=o,a.url="none",a.filter=null):(a={key:o,url:"none",filter:null},this.#l.set(t,a)),!e||!s))return a.url;const[c,l]=[e,s].map(this.#v.bind(this));let h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),u=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[p,g]=[n,r].map(this.#v.bind(this));u<h&&([h,u,p,g]=[u,h,g,p]),this.#c.style.color="";const y=(w,E,A)=>{const P=new Array(256),x=(u-h)/A,M=w/255,S=(E-w)/(255*A);let T=0;for(let I=0;I<=A;I++){const k=Math.round(h+I*x),R=M+I*S;for(let N=T;N<=k;N++)P[N]=R;T=k+1}for(let I=T;I<256;I++)P[I]=P[T-1];return P.join(",")},m=`g_${this.#s}_hcm_${t}_filter`,v=a.filter=this.#g(m);return this.#m(v),this.#p(y(p[0],g[0],5),y(p[1],g[1],5),y(p[2],g[2],5),v),a.url=this.#u(m),a.url}destroy(t=!1){t&&this.#r?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#r?.clear(),this.#r=null,this.#n=0)}#f(t){const e=this.#o.createElementNS(Ms,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#m(t){const e=this.#o.createElementNS(Ms,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#g(t){const e=this.#o.createElementNS(Ms,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#c.append(e),e}#h(t,e,s){const n=this.#o.createElementNS(Ms,e);n.setAttribute("type","discrete"),n.setAttribute("tableValues",s),t.append(n)}#p(t,e,s,n){const r=this.#o.createElementNS(Ms,"feComponentTransfer");n.append(r),this.#h(r,"feFuncR",t),this.#h(r,"feFuncG",e),this.#h(r,"feFuncB",s)}#_(t,e){const s=this.#o.createElementNS(Ms,"feComponentTransfer");e.append(s),this.#h(s,"feFuncA",t)}#v(t){return this.#c.style.color=t,xo(getComputedStyle(this.#c).getPropertyValue("color"))}}class Nv{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Pt("Abstract method `_fetch` called.")}}class Sg extends Nv{async _fetch(t){const e=await Po(t,"arraybuffer");return new Uint8Array(e)}}class Lv{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Pt("Abstract method `_fetch` called.")}}class Ig extends Lv{async _fetch(t){const e=await Po(t,"arraybuffer");return new Uint8Array(e)}}Pe&&it("Please use the `legacy` build in Node.js environments.");async function Qu(i){const e=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(e)}class lR extends Mv{}class hR extends kv{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class uR extends Dv{async _fetch(t){return Qu(t)}}class dR extends Nv{async _fetch(t){return Qu(t)}}class fR extends Lv{async _fetch(t){return Qu(t)}}const mn="__forcedDependency",{floor:Cg,ceil:Pg}=Math;function oa(i,t,e,s,n,r){i[t*4+0]=Math.min(i[t*4+0],e),i[t*4+1]=Math.min(i[t*4+1],s),i[t*4+2]=Math.max(i[t*4+2],n),i[t*4+3]=Math.max(i[t*4+3],r)}const Nh=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class pR{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===Nh}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const aa=(i,t)=>{if(!i)return;let e=i.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},i.set(t,e)),e};class gR{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[mn]:[]};#i=new Map;#s=[];#o=[];#r=[[1,0,0,1,0,0]];#n=[-1/0,-1/0,1/0,1/0];#a=new Float64Array([1/0,1/0,-1/0,-1/0]);#l=-1;#c=new Set;#d=new Map;#u=new Map;#f;#m;#g;#h;#p;constructor(t,e,s=!1){this.#f=t.width,this.#m=t.height,this.#_(e),s&&(this.#p=new Map)}growOperationsCount(t){t>=this.#h.length&&this.#_(t,this.#h)}#_(t,e){const s=new ArrayBuffer(t*4);this.#g=new Uint8ClampedArray(s),this.#h=new Uint32Array(s),e&&e.length>0?(this.#h.set(e),this.#h.fill(Nh,e.length)):this.#h.fill(Nh)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[mn]:{__proto__:this.#e[mn]}},this.#n={__proto__:this.#n},this.#s.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#n=Object.getPrototypeOf(this.#n);const s=this.#s.pop();return s!==void 0&&(aa(this.#p,t)?.dependencies.add(s),this.#h[t]=this.#h[s]),this}recordOpenMarker(t){return this.#s.push(t),this}getOpenMarker(){return this.#s.length===0?null:this.#s.at(-1)}recordCloseMarker(t){const e=this.#s.pop();return e!==void 0&&(aa(this.#p,t)?.dependencies.add(e),this.#h[t]=this.#h[e]),this}beginMarkedContent(t){return this.#o.push(t),this}endMarkedContent(t){const e=this.#o.pop();return e!==void 0&&(aa(this.#p,t)?.dependencies.add(e),this.#h[t]=this.#h[e]),this}pushBaseTransform(t){return this.#r.push(H.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#i.set(t,e),this}recordSimpleDataFromNamed(t,e,s){this.#t[t]=this.#i.get(e)??s}recordFutureForcedDependency(t,e){return this.recordIncrementalData(mn,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#c)this.recordFutureForcedDependency(mn,t);return this}resetBBox(t){return this.#l!==t&&(this.#l=t,this.#a[0]=1/0,this.#a[1]=1/0,this.#a[2]=-1/0,this.#a[3]=-1/0),this}recordClipBox(t,e,s,n,r,o){const a=H.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform()),c=[1/0,1/0,-1/0,-1/0];H.axialAlignedBoundingBox([s,r,n,o],a,c);const l=H.intersect(this.#n,c);return l?(this.#n[0]=l[0],this.#n[1]=l[1],this.#n[2]=l[2],this.#n[3]=l[3]):(this.#n[0]=this.#n[1]=1/0,this.#n[2]=this.#n[3]=-1/0),this}recordBBox(t,e,s,n,r,o){const a=this.#n;if(a[0]===1/0)return this;const c=H.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform());if(a[0]===-1/0)return H.axialAlignedBoundingBox([s,r,n,o],c,this.#a),this;const l=[1/0,1/0,-1/0,-1/0];return H.axialAlignedBoundingBox([s,r,n,o],c,l),this.#a[0]=Math.min(this.#a[0],Math.max(l[0],a[0])),this.#a[1]=Math.min(this.#a[1],Math.max(l[1],a[1])),this.#a[2]=Math.max(this.#a[2],Math.min(l[2],a[2])),this.#a[3]=Math.max(this.#a[3],Math.min(l[3],a[3])),this}recordCharacterBBox(t,e,s,n=1,r=0,o=0,a){const c=s.bbox;let l,h;if(c&&(l=c[2]!==c[0]&&c[3]!==c[1]&&this.#u.get(s),l!==!1&&(h=[0,0,0,0],H.axialAlignedBoundingBox(c,s.fontMatrix,h),(n!==1||r!==0||o!==0)&&H.scaleMinMax([n,0,0,-n,r,o],h),l)))return this.recordBBox(t,e,h[0],h[2],h[1],h[3]);if(!a)return this.recordFullPageBBox(t);const u=a();return c&&h&&l===void 0&&(l=h[0]<=r-u.actualBoundingBoxLeft&&h[2]>=r+u.actualBoundingBoxRight&&h[1]<=o-u.actualBoundingBoxAscent&&h[3]>=o+u.actualBoundingBoxDescent,this.#u.set(s,l),l)?this.recordBBox(t,e,h[0],h[2],h[1],h[3]):this.recordBBox(t,e,r-u.actualBoundingBoxLeft,r+u.actualBoundingBoxRight,o-u.actualBoundingBoxAscent,o+u.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#a[0]=Math.max(0,this.#n[0]),this.#a[1]=Math.max(0,this.#n[1]),this.#a[2]=Math.min(this.#f,this.#n[2]),this.#a[3]=Math.min(this.#m,this.#n[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const s=this.#c,n=this.#t,r=this.#e;for(const o of e)o in this.#t?s.add(n[o]):o in r&&r[o].forEach(s.add,s);return this}recordNamedDependency(t,e){return this.#i.has(e)&&this.#c.add(this.#i.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[mn]),this.#p){const s=aa(this.#p,t),{dependencies:n}=s;this.#c.forEach(n.add,n),this.#s.forEach(n.add,n),this.#o.forEach(n.add,n),n.delete(t),s.isRenderingOperation=!0}if(this.#l===t){const s=Cg(this.#a[0]*256/this.#f),n=Cg(this.#a[1]*256/this.#m),r=Pg(this.#a[2]*256/this.#f),o=Pg(this.#a[3]*256/this.#m);oa(this.#g,t,s,n,r,o);for(const a of this.#c)a!==t&&oa(this.#g,a,s,n,r,o);for(const a of this.#s)a!==t&&oa(this.#g,a,s,n,r,o);for(const a of this.#o)a!==t&&oa(this.#g,a,s,n,r,o);e||(this.#c.clear(),this.#l=-1)}return this}recordShowTextOperation(t,e=!1){const s=Array.from(this.#c);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const n of s)this.recordIncrementalData("sameLineText",n);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#l===t&&(this.#l=-1,this.#n[0]=Math.max(this.#n[0],this.#a[0]),this.#n[1]=Math.max(this.#n[1],this.#a[1]),this.#n[2]=Math.min(this.#n[2],this.#a[2]),this.#n[3]=Math.min(this.#n[3],this.#a[3]),e||this.#c.clear()),this}_takePendingDependencies(){const t=this.#c;return this.#c=new Set,t}_extractOperation(t){const e=this.#d.get(t);return this.#d.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#c.add(e)}take(){return this.#u.clear(),new pR(this.#h,this.#g)}takeDebugMetadata(){return this.#p}}class ec{#t;#e;#i;#s=0;#o=0;constructor(t,e,s){if(t instanceof ec&&t.#i===!!s)return t;this.#t=t,this.#e=e,this.#i=!!s}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#o++,this.#t.save(this.#e),this}restore(t){return this.#o>0&&(this.#t.restore(this.#e),this.#o--),this}recordOpenMarker(t){return this.#s++,this}getOpenMarker(){return this.#s>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#s--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,s){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#i||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,s,n,r,o){return this.#i||this.#t.recordClipBox(this.#e,e,s,n,r,o),this}recordBBox(t,e,s,n,r,o){return this.#i||this.#t.recordBBox(this.#e,e,s,n,r,o),this}recordCharacterBBox(t,e,s,n,r,o,a){return this.#i||this.#t.recordCharacterBBox(this.#e,e,s,n,r,o,a),this}recordFullPageBBox(t){return this.#i||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#i||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const We={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},fe={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Lh(i,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],n=new Path2D;n.rect(t[0],t[1],e,s),i.clip(n)}class Ju{isModifyingCurrentTransform(){return!1}getPattern(){Pt("Abstract method `getPattern` called.")}}class mR extends Ju{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(t,e=null){let s,n=this._p0,r=this._p1;if(e&&(n=n.slice(),r=r.slice(),H.applyTransform(n,e),H.applyTransform(r,e)),this._type==="axial")s=t.createLinearGradient(n[0],n[1],r[0],r[1]);else if(this._type==="radial"){let o=this._r0,a=this._r1;if(e){const c=new Float32Array(2);H.singularValueDecompose2dScale(e,c),o*=c[0],a*=c[0]}s=t.createRadialGradient(n[0],n[1],o,r[0],r[1],a)}for(const o of this._colorStops)s.addColorStop(o[0],o[1]);return s}getPattern(t,e,s,n){let r;if(n===fe.STROKE||n===fe.FILL){if(this.isOriginBased()){let p=H.transform(s,e.baseTransform);this.matrix&&(p=H.transform(p,this.matrix));const g=.001,y=Math.hypot(p[0],p[1]),m=Math.hypot(p[2],p[3]),v=(p[0]*p[2]+p[1]*p[3])/(y*m);if(Math.abs(v)<g)if(this.isRadial()){if(Math.abs(y-m)<g)return this._createGradient(t,p)}else return this._createGradient(t,p)}const o=e.current.getClippedPathBoundingBox(n,Ft(t))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,c=Math.ceil(o[3]-o[1])||1,l=e.cachedCanvases.getCanvas("pattern",a,c),h=l.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-o[0],-o[1]),s=H.transform(s,[1,0,0,1,o[0],o[1]]),h.transform(...e.baseTransform),this.matrix&&h.transform(...this.matrix),Lh(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),r=t.createPattern(l.canvas,"no-repeat");const u=new DOMMatrix(s);r.setTransform(u)}else Lh(t,this._bbox),r=this._createGradient(t);return r}}function kl(i,t,e,s,n,r,o,a){const c=t.coords,l=t.colors,h=i.data,u=i.width*4;let p;c[e+1]>c[s+1]&&(p=e,e=s,s=p,p=r,r=o,o=p),c[s+1]>c[n+1]&&(p=s,s=n,n=p,p=o,o=a,a=p),c[e+1]>c[s+1]&&(p=e,e=s,s=p,p=r,r=o,o=p);const g=(c[e]+t.offsetX)*t.scaleX,y=(c[e+1]+t.offsetY)*t.scaleY,m=(c[s]+t.offsetX)*t.scaleX,v=(c[s+1]+t.offsetY)*t.scaleY,w=(c[n]+t.offsetX)*t.scaleX,E=(c[n+1]+t.offsetY)*t.scaleY;if(y>=E)return;const A=l[r],P=l[r+1],x=l[r+2],M=l[o],S=l[o+1],T=l[o+2],I=l[a],k=l[a+1],R=l[a+2],N=Math.round(y),D=Math.round(E);let J,wt,G,K,ft,Xt,dt,at;for(let z=N;z<=D;z++){if(z<v){const Dt=z<y?0:(y-z)/(y-v);J=g-(g-m)*Dt,wt=A-(A-M)*Dt,G=P-(P-S)*Dt,K=x-(x-T)*Dt}else{let Dt;z>E?Dt=1:v===E?Dt=0:Dt=(v-z)/(v-E),J=m-(m-w)*Dt,wt=M-(M-I)*Dt,G=S-(S-k)*Dt,K=T-(T-R)*Dt}let Z;z<y?Z=0:z>E?Z=1:Z=(y-z)/(y-E),ft=g-(g-w)*Z,Xt=A-(A-I)*Z,dt=P-(P-k)*Z,at=x-(x-R)*Z;const Se=Math.round(Math.min(J,ft)),He=Math.round(Math.max(J,ft));let qe=u*z+Se*4;for(let Dt=Se;Dt<=He;Dt++)Z=(J-Dt)/(J-ft),Z<0?Z=0:Z>1&&(Z=1),h[qe++]=wt-(wt-Xt)*Z|0,h[qe++]=G-(G-dt)*Z|0,h[qe++]=K-(K-at)*Z|0,h[qe++]=255}}function _R(i,t,e){const s=t.coords,n=t.colors;let r,o;switch(t.type){case Ch.LATTICE:const a=t.verticesPerRow,c=Math.floor(s.length/a)-1,l=a-1;for(r=0;r<c;r++){let h=r*a;for(let u=0;u<l;u++,h++)kl(i,e,s[h],s[h+1],s[h+a],n[h],n[h+1],n[h+a]),kl(i,e,s[h+a+1],s[h+1],s[h+a],n[h+a+1],n[h+1],n[h+a])}break;case Ch.TRIANGLES:for(r=0,o=s.length;r<o;r+=3)kl(i,e,s[r],s[r+1],s[r+2],n[r],n[r+1],n[r+2]);break;default:throw new Error("illegal figure")}}class yR extends Ju{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const a=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),l=Math.ceil(this._bounds[2])-a,h=Math.ceil(this._bounds[3])-c,u=Math.min(Math.ceil(Math.abs(l*t[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(h*t[1]*1.1)),3e3),g=l/u,y=h/p,m={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-c,scaleX:1/g,scaleY:1/y},v=u+4,w=p+4,E=s.getCanvas("mesh",v,w),A=E.context,P=A.createImageData(u,p);if(e){const M=P.data;for(let S=0,T=M.length;S<T;S+=4)M[S]=e[0],M[S+1]=e[1],M[S+2]=e[2],M[S+3]=255}for(const M of this._figures)_R(P,M,m);return A.putImageData(P,2,2),{canvas:E.canvas,offsetX:a-2*g,offsetY:c-2*y,scaleX:g,scaleY:y}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,n){Lh(t,this._bbox);const r=new Float32Array(2);if(n===fe.SHADING)H.singularValueDecompose2dScale(Ft(t),r);else if(this.matrix){H.singularValueDecompose2dScale(this.matrix,r);const[a,c]=r;H.singularValueDecompose2dScale(e.baseTransform,r),r[0]*=a,r[1]*=c}else H.singularValueDecompose2dScale(e.baseTransform,r);const o=this._createMeshCanvas(r,n===fe.SHADING?null:this._background,e.cachedCanvases);return n!==fe.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(o.offsetX,o.offsetY),t.scale(o.scaleX,o.scaleY),t.createPattern(o.canvas,"no-repeat")}}class vR extends Ju{getPattern(){return"hotpink"}}function bR(i){switch(i[0]){case"RadialAxial":return new mR(i);case"Mesh":return new yR(i);case"Dummy":return new vR}throw new Error(`Unknown IR type: ${i[0]}`)}const Rg={COLORED:1,UNCOLORED:2};class Zu{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,n){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=n}createPatternCanvas(t,e){const{bbox:s,operatorList:n,paintType:r,tilingType:o,color:a,canvasGraphicsFactory:c}=this;let{xstep:l,ystep:h}=this;l=Math.abs(l),h=Math.abs(h),Fc("TilingType: "+o);const u=s[0],p=s[1],g=s[2],y=s[3],m=g-u,v=y-p,w=new Float32Array(2);H.singularValueDecompose2dScale(this.matrix,w);const[E,A]=w;H.singularValueDecompose2dScale(this.baseTransform,w);const P=E*w[0],x=A*w[1];let M=m,S=v,T=!1,I=!1;const k=Math.ceil(l*P),R=Math.ceil(h*x),N=Math.ceil(m*P),D=Math.ceil(v*x);k>=N?M=l:T=!0,R>=D?S=h:I=!0;const J=this.getSizeAndScale(M,this.ctx.canvas.width,P),wt=this.getSizeAndScale(S,this.ctx.canvas.height,x),G=t.cachedCanvases.getCanvas("pattern",J.size,wt.size),K=G.context,ft=c.createCanvasGraphics(K,e);if(ft.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(ft,r,a),K.translate(-J.scale*u,-wt.scale*p),ft.transform(0,J.scale,0,0,wt.scale,0,0),K.save(),ft.dependencyTracker?.save(),this.clipBbox(ft,u,p,g,y),ft.baseTransform=Ft(ft.ctx),ft.executeOperatorList(n),ft.endDrawing(),ft.dependencyTracker?.restore(),K.restore(),T||I){const Xt=G.canvas;T&&(M=l),I&&(S=h);const dt=this.getSizeAndScale(M,this.ctx.canvas.width,P),at=this.getSizeAndScale(S,this.ctx.canvas.height,x),z=dt.size,Z=at.size,Se=t.cachedCanvases.getCanvas("pattern-workaround",z,Z),He=Se.context,qe=T?Math.floor(m/l):0,Dt=I?Math.floor(v/h):0;for(let ks=0;ks<=qe;ks++)for(let Ws=0;Ws<=Dt;Ws++)He.drawImage(Xt,z*ks,Z*Ws,z,Z,0,0,z,Z);return{canvas:Se.canvas,scaleX:dt.scale,scaleY:at.scale,offsetX:u,offsetY:p}}return{canvas:G.canvas,scaleX:J.scale,scaleY:wt.scale,offsetX:u,offsetY:p}}getSizeAndScale(t,e,s){const n=Math.max(Zu.MAX_PATTERN_SIZE,e);let r=Math.ceil(t*s);return r>=n?r=n:s=r/t,{scale:s,size:r}}clipBbox(t,e,s,n,r){const o=n-e,a=r-s;t.ctx.rect(e,s,o,a),H.axialAlignedBoundingBox([e,s,n,r],Ft(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const n=t.ctx,r=t.current;switch(e){case Rg.COLORED:const{fillStyle:o,strokeStyle:a}=this.ctx;n.fillStyle=r.fillColor=o,n.strokeStyle=r.strokeColor=a;break;case Rg.UNCOLORED:n.fillStyle=n.strokeStyle=s,r.fillColor=r.strokeColor=s;break;default:throw new DP(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,n,r){let o=s;n!==fe.SHADING&&(o=H.transform(o,e.baseTransform),this.matrix&&(o=H.transform(o,this.matrix)));const a=this.createPatternCanvas(e,r);let c=new DOMMatrix(o);c=c.translate(a.offsetX,a.offsetY),c=c.scale(1/a.scaleX,1/a.scaleY);const l=t.createPattern(a.canvas,"repeat");return l.setTransform(c),l}}function wR({src:i,srcPos:t=0,dest:e,width:s,height:n,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const a=re.isLittleEndian?4278190080:255,[c,l]=o?[r,a]:[a,r],h=s>>3,u=s&7,p=i.length;e=new Uint32Array(e.buffer);let g=0;for(let y=0;y<n;y++){for(const v=t+h;t<v;t++){const w=t<p?i[t]:255;e[g++]=w&128?l:c,e[g++]=w&64?l:c,e[g++]=w&32?l:c,e[g++]=w&16?l:c,e[g++]=w&8?l:c,e[g++]=w&4?l:c,e[g++]=w&2?l:c,e[g++]=w&1?l:c}if(u===0)continue;const m=t<p?i[t++]:255;for(let v=0;v<u;v++)e[g++]=m&1<<7-v?l:c}return{srcPos:t,destPos:g}}const xg=16,kg=100,AR=15,Dg=10,Ne=16,Dl=new DOMMatrix,$e=new Float32Array(2),Sn=new Float32Array([1/0,1/0,-1/0,-1/0]);function ER(i,t){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){t.save(),this.__originalSave()},i.restore=function(){t.restore(),this.__originalRestore()},i.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},i.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},i.transform=function(e,s,n,r,o,a){t.transform(e,s,n,r,o,a),this.__originalTransform(e,s,n,r,o,a)},i.setTransform=function(e,s,n,r,o,a){t.setTransform(e,s,n,r,o,a),this.__originalSetTransform(e,s,n,r,o,a)},i.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},i.rotate=function(e){t.rotate(e),this.__originalRotate(e)},i.clip=function(e){t.clip(e),this.__originalClip(e)},i.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},i.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},i.bezierCurveTo=function(e,s,n,r,o,a){t.bezierCurveTo(e,s,n,r,o,a),this.__originalBezierCurveTo(e,s,n,r,o,a)},i.rect=function(e,s,n,r){t.rect(e,s,n,r),this.__originalRect(e,s,n,r)},i.closePath=function(){t.closePath(),this.__originalClosePath()},i.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class TR{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let n;return this.cache[t]!==void 0?(n=this.cache[t],this.canvasFactory.reset(n,e,s)):(n=this.canvasFactory.create(e,s),this.cache[t]=n),n}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function ca(i,t,e,s,n,r,o,a,c,l){const[h,u,p,g,y,m]=Ft(i);if(u===0&&p===0){const E=o*h+y,A=Math.round(E),P=a*g+m,x=Math.round(P),M=(o+c)*h+y,S=Math.abs(Math.round(M)-A)||1,T=(a+l)*g+m,I=Math.abs(Math.round(T)-x)||1;return i.setTransform(Math.sign(h),0,0,Math.sign(g),A,x),i.drawImage(t,e,s,n,r,0,0,S,I),i.setTransform(h,u,p,g,y,m),[S,I]}if(h===0&&g===0){const E=a*p+y,A=Math.round(E),P=o*u+m,x=Math.round(P),M=(a+l)*p+y,S=Math.abs(Math.round(M)-A)||1,T=(o+c)*u+m,I=Math.abs(Math.round(T)-x)||1;return i.setTransform(0,Math.sign(u),Math.sign(p),0,A,x),i.drawImage(t,e,s,n,r,0,0,I,S),i.setTransform(h,u,p,g,y,m),[I,S]}i.drawImage(t,e,s,n,r,o,a,c,l);const v=Math.hypot(h,u),w=Math.hypot(p,g);return[v*c,w*l]}class Mg{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Ih;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=se.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,s){s?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Sn.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=fe.FILL,e=null){const s=this.minMax.slice();if(t===fe.STROKE){e||Pt("Stroke bounding box must include transform."),H.singularValueDecompose2dScale(e,$e);const n=$e[0]*this.lineWidth/2,r=$e[1]*this.lineWidth/2;s[0]-=n,s[1]-=r,s[2]+=n,s[3]+=r}return s}updateClipFromPath(){const t=H.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Sn,0)}getClippedPathBoundingBox(t=fe.FILL,e=null){return H.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Ng(i,t){if(t instanceof ImageData){i.putImageData(t,0,0);return}const e=t.height,s=t.width,n=e%Ne,r=(e-n)/Ne,o=n===0?r:r+1,a=i.createImageData(s,Ne);let c=0,l;const h=t.data,u=a.data;let p,g,y,m;if(t.kind===Ra.GRAYSCALE_1BPP){const v=h.byteLength,w=new Uint32Array(u.buffer,0,u.byteLength>>2),E=w.length,A=s+7>>3,P=4294967295,x=re.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(y=p<r?Ne:n,l=0,g=0;g<y;g++){const M=v-c;let S=0;const T=M>A?s:M*8-7,I=T&-8;let k=0,R=0;for(;S<I;S+=8)R=h[c++],w[l++]=R&128?P:x,w[l++]=R&64?P:x,w[l++]=R&32?P:x,w[l++]=R&16?P:x,w[l++]=R&8?P:x,w[l++]=R&4?P:x,w[l++]=R&2?P:x,w[l++]=R&1?P:x;for(;S<T;S++)k===0&&(R=h[c++],k=128),w[l++]=R&k?P:x,k>>=1}for(;l<E;)w[l++]=0;i.putImageData(a,0,p*Ne)}}else if(t.kind===Ra.RGBA_32BPP){for(g=0,m=s*Ne*4,p=0;p<r;p++)u.set(h.subarray(c,c+m)),c+=m,i.putImageData(a,0,g),g+=Ne;p<o&&(m=s*n*4,u.set(h.subarray(c,c+m)),i.putImageData(a,0,g))}else if(t.kind===Ra.RGB_24BPP)for(y=Ne,m=s*y,p=0;p<o;p++){for(p>=r&&(y=n,m=s*y),l=0,g=m;g--;)u[l++]=h[c++],u[l++]=h[c++],u[l++]=h[c++],u[l++]=255;i.putImageData(a,0,p*Ne)}else throw new Error(`bad image kind: ${t.kind}`)}function Lg(i,t){if(t.bitmap){i.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,n=e%Ne,r=(e-n)/Ne,o=n===0?r:r+1,a=i.createImageData(s,Ne);let c=0;const l=t.data,h=a.data;for(let u=0;u<o;u++){const p=u<r?Ne:n;({srcPos:c}=wR({src:l,srcPos:c,dest:h,width:s,height:p,nonBlackColor:0})),i.putImageData(a,0,u*Ne)}}function br(i,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)i[s]!==void 0&&(t[s]=i[s]);i.setLineDash!==void 0&&(t.setLineDash(i.getLineDash()),t.lineDashOffset=i.lineDashOffset)}function la(i){i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0);const{filter:t}=i;t!=="none"&&t!==""&&(i.filter="none")}function Og(i,t){if(t)return!0;H.singularValueDecompose2dScale(i,$e);const e=Math.fround(Ps.pixelRatio*Gn.PDF_TO_CSS_UNITS);return $e[0]<=e&&$e[1]<=e}const SR=["butt","round","square"],IR=["miter","round","bevel"],CR={},Fg={};class Nn{constructor(t,e,s,n,r,{optionalContentConfig:o,markedContentStack:a=null},c,l,h){this.ctx=t,this.current=new Mg(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=n,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new TR(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(t,e,s=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):s}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:n=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=n||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,s){const c=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Ft(this.compositeCtx))}this.ctx.save(),la(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Ft(this.ctx)}executeOperatorList(t,e,s,n,r){const o=t.argsArray,a=t.fnArray;let c=e||0;const l=o.length;if(l===c)return c;const h=l-c>Dg&&typeof s=="function",u=h?Date.now()+AR:0;let p=0;const g=this.commonObjs,y=this.objs;let m,v;for(;;){if(n!==void 0&&c===n.nextBreakPoint)return n.breakIt(c,s),c;if(!r||r(c))if(m=a[c],v=o[c]??null,m!==ro.dependency)v===null?this[m](c):this[m](c,...v);else for(const w of v){this.dependencyTracker?.recordNamedData(w,c);const E=w.startsWith("g_")?g:y;if(!E.has(w))return E.get(w,s),c}if(c++,c===l)return c;if(h&&++p>Dg){if(Date.now()>u)return s(),c;p=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth,n=t.height??t.displayHeight;let r=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),a=s,c=n,l="prescale1",h,u;for(;r>2&&a>1||o>2&&c>1;){let p=a,g=c;r>2&&a>1&&(p=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/p),o>2&&c>1&&(g=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/g),h=this.cachedCanvases.getCanvas(l,p,g),u=h.context,u.clearRect(0,0,p,g),u.drawImage(t,0,0,a,c,0,0,p,g),t=h.canvas,a=p,c=g,l=l==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:c}}_createMaskCanvas(t,e){const s=this.ctx,{width:n,height:r}=e,o=this.current.fillColor,a=this.current.patternFill,c=Ft(s);let l,h,u,p;if((e.bitmap||e.data)&&e.count>1){const k=e.bitmap||e.data.buffer;h=JSON.stringify(a?c:[c.slice(0,4),o]),l=this._cachedBitmapsMap.get(k),l||(l=new Map,this._cachedBitmapsMap.set(k,l));const R=l.get(h);if(R&&!a){const N=Math.round(Math.min(c[0],c[2])+c[4]),D=Math.round(Math.min(c[1],c[3])+c[5]);return this.dependencyTracker?.recordDependencies(t,We.transformAndFill),{canvas:R,offsetX:N,offsetY:D}}u=R}u||(p=this.cachedCanvases.getCanvas("maskCanvas",n,r),Lg(p.context,e));let g=H.transform(c,[1/n,0,0,-1/r,0,0]);g=H.transform(g,[1,0,0,1,0,-r]);const y=Sn.slice();H.axialAlignedBoundingBox([0,0,n,r],g,y);const[m,v,w,E]=y,A=Math.round(w-m)||1,P=Math.round(E-v)||1,x=this.cachedCanvases.getCanvas("fillCanvas",A,P),M=x.context,S=m,T=v;M.translate(-S,-T),M.transform(...g),u||(u=this._scaleImage(p.canvas,ps(M)),u=u.img,l&&a&&l.set(h,u)),M.imageSmoothingEnabled=Og(Ft(M),e.interpolate),ca(M,u,0,0,u.width,u.height,0,0,n,r),M.globalCompositeOperation="source-in";const I=H.transform(ps(M),[1,0,0,1,-S,-T]);return M.fillStyle=a?o.getPattern(s,this,I,fe.FILL,t):o,M.fillRect(0,0,n,r),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(h,x.canvas)),this.dependencyTracker?.recordDependencies(t,We.transformAndFill),{canvas:x.canvas,offsetX:Math.round(S),offsetY:Math.round(T)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=SR[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=IR[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,s){this.dependencyTracker?.recordSimpleData("dash",t);const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=s)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[s,n]of e)switch(s){case"LW":this.setLineWidth(t,n);break;case"LC":this.setLineCap(t,n);break;case"LJ":this.setLineJoin(t,n);break;case"ML":this.setMiterLimit(t,n);break;case"D":this.setDash(t,n[0],n[1]);break;case"RI":this.setRenderingIntent(t,n);break;case"FL":this.setFlatness(t,n);break;case"Font":this.setFont(t,n[0],n[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=n;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=n;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=n;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,s=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(n,e,s);this.suspendedCtx=this.ctx;const o=this.ctx=r.context;o.setTransform(this.suspendedCtx.getTransform()),br(this.suspendedCtx,o),ER(o,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),br(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,n){const r=n[0],o=n[1],a=n[2]-r,c=n[3]-o;a===0||c===0||(this.genericComposeSMask(e.context,s,a,c,e.subtype,e.backdrop,e.transferMap,r,o,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,n,r,o,a,c,l,h,u){let p=t.canvas,g=c-h,y=l-u;if(o)if(g<0||y<0||g+s>p.width||y+n>p.height){const v=this.cachedCanvases.getCanvas("maskExtension",s,n),w=v.context;w.drawImage(p,-g,-y),w.globalCompositeOperation="destination-atop",w.fillStyle=o,w.fillRect(0,0,s,n),w.globalCompositeOperation="source-over",p=v.canvas,g=y=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const v=new Path2D;v.rect(g,y,s,n),t.clip(v),t.globalCompositeOperation="destination-atop",t.fillStyle=o,t.fillRect(g,y,s,n),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const m=new Path2D;m.rect(c,l,s,n),e.clip(m),e.globalCompositeOperation="destination-in",e.drawImage(p,g,y,s,n,c,l,s,n),e.restore()}save(t){this.inSMaskMode&&br(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&br(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,n,r,o,a){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,s,n,r,o,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s,n){let[r]=s;if(!n){r||=s[0]=new Path2D,this[e](t,r);return}if(this.dependencyTracker!==null){const o=e===ro.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,n[0]-o,n[2]+o,n[1]-o,n[3]+o).recordDependencies(t,["transform"])}r instanceof Path2D||(r=s[0]=Cv(r)),H.axialAlignedBoundingBox(n,Ft(this.ctx),this.current.minMax),this[e](t,r),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,s=!0){const n=this.ctx,r=this.current.strokeColor;if(n.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&r?.getPattern){const o=r.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.strokeStyle=r.getPattern(n,this,ps(n),fe.STROKE,t),o){const a=new Path2D;a.addPath(e,n.getTransform().invertSelf().multiplySelf(o)),e=a}this.rescaleAndStroke(e,!1),n.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,We.stroke),s&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(fe.STROKE,Ft(this.ctx))),n.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,s=!0){const n=this.ctx,r=this.current.fillColor,o=this.current.patternFill;let a=!1;if(o){const l=r.isModifyingCurrentTransform()?n.getTransform():null;if(this.dependencyTracker?.save(t),n.save(),n.fillStyle=r.getPattern(n,this,ps(n),fe.FILL,t),l){const h=new Path2D;h.addPath(e,n.getTransform().invertSelf().multiplySelf(l)),e=h}a=!0}const c=this.current.getClippedPathBoundingBox();this.contentVisible&&c!==null&&(this.pendingEOFill?(n.fill(e,"evenodd"),this.pendingEOFill=!1):n.fill(e)),this.dependencyTracker?.recordDependencies(t,We.fill),a&&(n.restore(),this.dependencyTracker?.restore(t)),s&&this.consumePath(t,e,c)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,We.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=CR}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=Fg}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:n}=this;e!==void 0&&n.recordFutureForcedDependency("textClip",n.getOpenMarker()).recordFutureForcedDependency("textClip",t),n.recordCloseMarker(t)}if(e!==void 0){const n=new Path2D,r=s.getTransform().invertSelf();for(const{transform:o,x:a,y:c,fontSize:l,path:h}of e)h&&n.addPath(h,new DOMMatrix(o).preMultiplySelf(r).translate(a,c).scale(l,-l));s.clip(n)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,s){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const n=this.commonObjs.get(e),r=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=n.fontMatrix||Ih,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&it("Invalid font matrix for font "+e),s<0?(s=-s,r.fontDirection=-1):r.fontDirection=1,this.current.font=n,this.current.fontSize=s,n.isType3Font)return;const o=n.loadedName||"sans-serif",a=n.systemFontInfo?.css||`"${o}", ${n.fallbackName}`;let c="normal";n.black?c="900":n.bold&&(c="bold");const l=n.italic?"italic":"normal";let h=s;s<xg?h=xg:s>kg&&(h=kg),this.current.fontSizeScale=s/h,this.ctx.font=`${l} ${c} ${h}px ${a}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,s){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=s}setLeadingMoveText(t,e,s){this.setLeading(t,-s),this.moveText(t,e,s)}setTextMatrix(t,e){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:s}=this;s.textMatrix=e,s.textMatrixScale=Math.hypot(e[0],e[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#i(t,e,s){const n=new Path2D;return n.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),n}paintChar(t,e,s,n,r,o){const a=this.ctx,c=this.current,l=c.font,h=c.textRenderingMode,u=c.fontSize/c.fontSizeScale,p=h&se.FILL_STROKE_MASK,g=!!(h&se.ADD_TO_PATH_FLAG),y=c.patternFill&&!l.missingFile,m=c.patternStroke&&!l.missingFile;let v;if((l.disableFontFace||g||y||m)&&!l.missingFile&&(v=l.getPathGenerator(this.commonObjs,e)),v&&(l.disableFontFace||y||m)){a.save(),a.translate(s,n),a.scale(u,-u),this.dependencyTracker?.recordCharacterBBox(t,a,l);let w;if(p===se.FILL||p===se.FILL_STROKE)if(r){w=a.getTransform(),a.setTransform(...r);const E=this.#i(v,w,r);a.fill(E)}else a.fill(v);if(p===se.STROKE||p===se.FILL_STROKE)if(o){w||=a.getTransform(),a.setTransform(...o);const{a:E,b:A,c:P,d:x}=w,M=H.inverseTransform(o),S=H.transform([E,A,P,x,0,0],M);H.singularValueDecompose2dScale(S,$e),a.lineWidth*=Math.max($e[0],$e[1])/u,a.stroke(this.#i(v,w,o))}else a.lineWidth/=u,a.stroke(v);a.restore()}else(p===se.FILL||p===se.FILL_STROKE)&&(a.fillText(e,s,n),this.dependencyTracker?.recordCharacterBBox(t,a,l,u,s,n,()=>a.measureText(e))),(p===se.STROKE||p===se.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,a,l,u,s,n,()=>a.measureText(e)).recordDependencies(t,We.stroke),a.strokeText(e,s,n));g&&((this.pendingTextPaths||=[]).push({transform:Ft(a),x:s,y:n,fontSize:u,path:v}),this.dependencyTracker?.recordCharacterBBox(t,a,l,u,s,n))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let n=3;n<e.length;n+=4)if(e[n]>0&&e[n]<255){s=!0;break}return nt(this,"isFontSubpixelAAEnabled",s)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,We.showText).resetBBox(t),this.current.textRenderingMode&se.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,n=s.font;if(n.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const r=s.fontSize;if(r===0){this.dependencyTracker?.recordOperation(t);return}const o=this.ctx,a=s.fontSizeScale,c=s.charSpacing,l=s.wordSpacing,h=s.fontDirection,u=s.textHScale*h,p=e.length,g=n.vertical,y=g?1:-1,m=n.defaultVMetrics,v=r*s.fontMatrix[0],w=s.textRenderingMode===se.FILL&&!n.disableFontFace&&!s.patternFill;o.save(),s.textMatrix&&o.transform(...s.textMatrix),o.translate(s.x,s.y+s.textRise),h>0?o.scale(u,-1):o.scale(u,1);let E,A;const P=s.textRenderingMode&se.FILL_STROKE_MASK,x=P===se.FILL||P===se.FILL_STROKE,M=P===se.STROKE||P===se.FILL_STROKE;if(x&&s.patternFill){o.save();const R=s.fillColor.getPattern(o,this,ps(o),fe.FILL,t);E=Ft(o),o.restore(),o.fillStyle=R}if(M&&s.patternStroke){o.save();const R=s.strokeColor.getPattern(o,this,ps(o),fe.STROKE,t);A=Ft(o),o.restore(),o.strokeStyle=R}let S=s.lineWidth;const T=s.textMatrixScale;if(T===0||S===0?M&&(S=this.getSinglePixelWidth()):S/=T,a!==1&&(o.scale(a,a),S/=a),o.lineWidth=S,n.isInvalidPDFjsFont){const R=[];let N=0;for(const J of e)R.push(J.unicode),N+=J.width;const D=R.join("");if(o.fillText(D,0,0),this.dependencyTracker!==null){const J=o.measureText(D);this.dependencyTracker.recordBBox(t,this.ctx,-J.actualBoundingBoxLeft,J.actualBoundingBoxRight,-J.actualBoundingBoxAscent,J.actualBoundingBoxDescent).recordShowTextOperation(t)}s.x+=N*v*u,o.restore(),this.compose();return}let I=0,k;for(k=0;k<p;++k){const R=e[k];if(typeof R=="number"){I+=y*R*r/1e3;continue}let N=!1;const D=(R.isSpace?l:0)+c,J=R.fontChar,wt=R.accent;let G,K,ft=R.width;if(g){const at=R.vmetric||m,z=-(R.vmetric?at[1]:ft*.5)*v,Z=at[2]*v;ft=at?-at[0]:ft,G=z/a,K=(I+Z)/a}else G=I/a,K=0;let Xt;if(n.remeasure&&ft>0){Xt=o.measureText(J);const at=Xt.width*1e3/r*a;if(ft<at&&this.isFontSubpixelAAEnabled){const z=ft/at;N=!0,o.save(),o.scale(z,1),G/=z}else ft!==at&&(G+=(ft-at)/2e3*r/a)}if(this.contentVisible&&(R.isInFont||n.missingFile)){if(w&&!wt)o.fillText(J,G,K),this.dependencyTracker?.recordCharacterBBox(t,o,Xt?{bbox:null}:n,r/a,G,K,()=>Xt??o.measureText(J));else if(this.paintChar(t,J,G,K,E,A),wt){const at=G+r*wt.offset.x/a,z=K-r*wt.offset.y/a;this.paintChar(t,wt.fontChar,at,z,E,A)}}const dt=g?ft*v-D*h:ft*v+D*h;I+=dt,N&&o.restore()}g?s.y-=I:s.x+=I*u,o.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const s=this.ctx,n=this.current,r=n.font,o=n.fontSize,a=n.fontDirection,c=r.vertical?1:-1,l=n.charSpacing,h=n.wordSpacing,u=n.textHScale*a,p=n.fontMatrix||Ih,g=e.length,y=n.textRenderingMode===se.INVISIBLE;let m,v,w,E;if(y||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),n.textMatrix&&s.transform(...n.textMatrix),s.translate(n.x,n.y+n.textRise),s.scale(u,a);const A=this.dependencyTracker;for(this.dependencyTracker=A?new ec(A,t):null,m=0;m<g;++m){if(v=e[m],typeof v=="number"){E=c*v*o/1e3,this.ctx.translate(E,0),n.x+=E*u;continue}const P=(v.isSpace?h:0)+l,x=r.charProcOperatorList[v.operatorListId];x?this.contentVisible&&(this.save(),s.scale(o,o),s.transform(...p),this.executeOperatorList(x),this.restore()):it(`Type3 character "${v.operatorListId}" is not available.`);const M=[v.width,0];H.applyTransform(M,p),w=M[0]*o+P,s.translate(w,0),n.x+=w*u}s.restore(),A&&(this.dependencyTracker=A)}setCharWidth(t,e,s){}setCharWidthAndBounds(t,e,s,n,r,o,a){const c=new Path2D;c.rect(n,r,o-n,a-r),this.ctx.clip(c),this.dependencyTracker?.recordBBox(t,this.ctx,n,o,r,a).recordClipBox(t,this.ctx,n,o,r,a),this.endPath(t)}getColorN_Pattern(t,e){let s;if(e[0]==="TilingPattern"){const n=this.baseTransform||Ft(this.ctx),r={createCanvasGraphics:(o,a)=>new Nn(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new ec(this.dependencyTracker,a,!0):null)};s=new Zu(e,this.ctx,r,n)}else s=this._getPattern(t,e[1],e[2]);return s}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,s=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=bR(this.getObject(t,e)),this.cachedPatterns.set(e,n)),s&&(n.matrix=s),n}shadingFill(t,e){if(!this.contentVisible)return;const s=this.ctx;this.save(t);const n=this._getPattern(t,e);s.fillStyle=n.getPattern(s,this,ps(s),fe.SHADING,t);const r=ps(s);if(r){const{width:o,height:a}=s.canvas,c=Sn.slice();H.axialAlignedBoundingBox([0,0,o,a],r,c);const[l,h,u,p]=c;this.ctx.fillRect(l,h,u-l,p-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,We.transform).recordDependencies(t,We.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Pt("Should not call beginInlineImage")}beginImageData(){Pt("Should not call beginImageData")}paintFormXObjectBegin(t,e,s){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=Ft(this.ctx),s)){H.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[n,r,o,a]=s,c=new Path2D;c.rect(n,r,o-n,a-r),this.ctx.clip(c),this.dependencyTracker?.recordClipBox(t,this.ctx,n,o,r,a),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;e.isolated||Fc("TODO: Support non-isolated groups."),e.knockout&&it("Knockout groups not supported.");const n=Ft(s);if(e.matrix&&s.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=Sn.slice();H.axialAlignedBoundingBox(e.bbox,Ft(s),r);const o=[0,0,s.canvas.width,s.canvas.height];r=H.intersect(r,o)||[0,0,0,0];const a=Math.floor(r[0]),c=Math.floor(r[1]),l=Math.max(Math.ceil(r[2])-a,1),h=Math.max(Math.ceil(r[3])-c,1);this.current.startNewPathAndClipBox([0,0,l,h]);let u="groupAt"+this.groupLevel;e.smask&&(u+="_smask_"+this.smaskCounter++%2);const p=this.cachedCanvases.getCanvas(u,l,h),g=p.context;g.translate(-a,-c),g.transform(...n);let y=new Path2D;const[m,v,w,E]=e.bbox;if(y.rect(m,v,w-m,E-v),e.matrix){const A=new Path2D;A.addPath(y,new DOMMatrix(e.matrix)),y=A}g.clip(y),e.smask&&this.smaskStack.push({canvas:p.canvas,context:g,offsetX:a,offsetY:c,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(a,c),s.save()),br(s,g),this.ctx=g,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const r=Ft(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...r);const o=Sn.slice();H.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],r,o),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(t,e,s,n,r,o){if(this.#t(),la(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const a=s[2]-s[0],c=s[3]-s[1];if(o&&this.annotationCanvasMap){n=n.slice(),n[4]-=s[0],n[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=a,s[3]=c,H.singularValueDecompose2dScale(Ft(this.ctx),$e);const{viewportScale:l}=this,h=Math.ceil(a*this.outputScaleX*l),u=Math.ceil(c*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(h,u);const{canvas:p,context:g}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform($e[0],0,0,-$e[1],0,c*$e[1]),la(this.ctx)}else{la(this.ctx),this.endPath(t);const l=new Path2D;l.rect(s[0],s[1],a,c),this.ctx.clip(l)}}this.current=new Mg(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...n),this.transform(t,...r)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const s=e.count;e=this.getObject(t,e.data,e),e.count=s;const n=this.ctx,r=this._createMaskCanvas(t,e),o=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(o,r.offsetX,r.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,r.offsetX,r.offsetX+o.width,r.offsetY,r.offsetY+o.height).recordOperation(t),n.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s,n=0,r=0,o,a){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const c=this.ctx;c.save();const l=Ft(c);c.transform(s,n,r,o,0,0);const h=this._createMaskCanvas(t,e);c.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]),this.dependencyTracker?.resetBBox(t);for(let u=0,p=a.length;u<p;u+=2){const g=H.transform(l,[s,n,r,o,a[u],a[u+1]]);c.drawImage(h.canvas,g[4],g[5]),this.dependencyTracker?.recordBBox(t,this.ctx,g[4],g[4]+h.canvas.width,g[5],g[5]+h.canvas.height)}c.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx,n=this.current.fillColor,r=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,We.transformAndFill);for(const o of e){const{data:a,width:c,height:l,transform:h}=o,u=this.cachedCanvases.getCanvas("maskCanvas",c,l),p=u.context;p.save();const g=this.getObject(t,a,o);Lg(p,g),p.globalCompositeOperation="source-in",p.fillStyle=r?n.getPattern(p,this,ps(s),fe.FILL,t):n,p.fillRect(0,0,c,l),p.restore(),s.save(),s.transform(...h),s.scale(1,-1),ca(s,u.canvas,0,0,c,l,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,c,0,l),s.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const s=this.getObject(t,e);if(!s){it("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,s)}paintImageXObjectRepeat(t,e,s,n,r){if(!this.contentVisible)return;const o=this.getObject(t,e);if(!o){it("Dependent image isn't ready yet");return}const a=o.width,c=o.height,l=[];for(let h=0,u=r.length;h<u;h+=2)l.push({transform:[s,0,0,n,r[h],r[h+1]],x:0,y:0,w:a,h:c});this.paintInlineImageXObjectGroup(t,o,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:n}=t,r=this.cachedCanvases.getCanvas("inlineImage",s,n),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(e,0,0),o.filter="none",r.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const s=e.width,n=e.height,r=this.ctx;this.save(t);const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none"),r.scale(1/s,-1/n);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",s,n).context;Ng(h,e),a=this.applyTransferMapsToCanvas(h)}const c=this._scaleImage(a,ps(r));r.imageSmoothingEnabled=Og(Ft(r),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,r,0,s,-n,0).recordDependencies(t,We.imageXObject).recordOperation(t),ca(r,c.img,0,0,c.paintWidth,c.paintHeight,0,-n,s,n),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,s){if(!this.contentVisible)return;const n=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const o=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",o,a).context;Ng(l,e),r=this.applyTransferMapsToCanvas(l)}this.dependencyTracker?.resetBBox(t);for(const o of s)n.save(),n.transform(...o.transform),n.scale(1,-1),ca(n,r,o.x,o.y,o.w,o.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,1,-1,0),n.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,We.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,s){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,s){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,s){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const r=this.ctx;this.pendingClip?(n||(this.pendingClip===Fg?r.clip(e,"evenodd"):r.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Ft(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),n=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,n)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:n,d:r}=this.ctx.getTransform();let o,a;if(s===0&&n===0){const c=Math.abs(e),l=Math.abs(r);if(c===l)if(t===0)o=a=1/c;else{const h=c*t;o=a=h<1?1/h:1}else if(t===0)o=1/c,a=1/l;else{const h=c*t,u=l*t;o=h<1?1/h:1,a=u<1?1/u:1}}else{const c=Math.abs(e*r-s*n),l=Math.hypot(e,s),h=Math.hypot(n,r);if(t===0)o=h/c,a=l/c;else{const u=t*c;o=h>u?h/u:1,a=l>u?l/u:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:n}}=this,[r,o]=this.getScaleForStroking();if(r===o){s.lineWidth=(n||1)*r,s.stroke(t);return}const a=s.getLineDash();e&&s.save(),s.scale(r,o),Dl.a=1/r,Dl.d=1/o;const c=new Path2D;if(c.addPath(t,Dl),a.length>0){const l=Math.max(r,o);s.setLineDash(a.map(h=>h/l)),s.lineDashOffset/=l}s.lineWidth=n||1,s.stroke(c),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const i in ro)Nn.prototype[i]!==void 0&&(Nn.prototype[ro[i]]=Nn.prototype[i]);class qi{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class PR{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const An=Symbol("INTERNAL");class RR{#t=!1;#e=!1;#i=!1;#s=!0;constructor(t,{name:e,intent:s,usage:n,rbGroups:r}){this.#t=!!(t&Be.DISPLAY),this.#e=!!(t&Be.PRINT),this.name=e,this.intent=s,this.usage=n,this.rbGroups=r}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,s=!1){t!==An&&Pt("Internal method `_setVisible` called."),this.#i=s,this.#s=e}}class xR{#t=null;#e=new Map;#i=null;#s=null;constructor(t,e=Be.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#s=t.order;for(const s of t.groups)this.#e.set(s.id,new RR(e,s));if(t.baseState==="OFF")for(const s of this.#e.values())s._setVisible(An,!1);for(const s of t.on)this.#e.get(s)._setVisible(An,!0);for(const s of t.off)this.#e.get(s)._setVisible(An,!1);this.#i=this.getHash()}}#o(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let n=1;n<e;n++){const r=t[n];let o;if(Array.isArray(r))o=this.#o(r);else if(this.#e.has(r))o=this.#e.get(r).visible;else return it(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return s==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Fc("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(it(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#o(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return it(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return it(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return it(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return it(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return it(`Unknown optional content policy ${t.policy}.`),!0}return it(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){const n=this.#e.get(t);if(!n){it(`Optional content group not found: ${t}`);return}if(s&&e&&n.rbGroups.length)for(const r of n.rbGroups)for(const o of r)o!==t&&this.#e.get(o)?._setVisible(An,!1,!0);n._setVisible(An,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let s;for(const n of t){switch(n){case"ON":case"OFF":case"Toggle":s=n;continue}const r=this.#e.get(n);if(r)switch(s){case"ON":this.setVisibility(n,!0,e);break;case"OFF":this.setVisibility(n,!1,e);break;case"Toggle":this.setVisibility(n,!r.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new Rv;for(const[e,s]of this.#e)t.update(`${e}:${s.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class kR{constructor(t,{disableRange:e=!1,disableStream:s=!1}){yt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:n,initialData:r,progressiveDone:o,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,r?.length>0){const c=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((c,l)=>{this._onReceiveData({begin:c,chunk:l})}),t.addProgressListener((c,l)=>{this._onProgress({loaded:c,total:l})}),t.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const n=this._rangeReaders.some(function(r){return r._begin!==t?!1:(r._enqueue(s),!0)});yt(n,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){yt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new DR(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new MR(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class DR{constructor(t,e,s=!1,n=null){this._stream=t,this._done=s||!1,this._filename=Wu(n)?n:null,this._queuedChunks=e||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class MR{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function NR(i){let t=!0,e=s("filename\\*","i").exec(i);if(e){e=e[1];let h=a(e);return h=unescape(h),h=c(h),h=l(h),r(h)}if(e=o(i),e){const h=l(e);return r(h)}if(e=s("filename","i").exec(i),e){e=e[1];let h=a(e);return h=l(h),r(h)}function s(h,u){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function n(h,u){if(h){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const p=new TextDecoder(h,{fatal:!0}),g=Co(u);u=p.decode(g),t=!1}catch{}}return u}function r(h){return t&&/[\x80-\xff]/.test(h)&&(h=n("utf-8",h),t&&(h=n("iso-8859-1",h))),h}function o(h){const u=[];let p;const g=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=g.exec(h))!==null;){let[,m,v,w]=p;if(m=parseInt(m,10),m in u){if(m===0)break;continue}u[m]=[v,w]}const y=[];for(let m=0;m<u.length&&m in u;++m){let[v,w]=u[m];w=a(w),v&&(w=unescape(w),m===0&&(w=c(w))),y.push(w)}return y.join("")}function a(h){if(h.startsWith('"')){const u=h.slice(1).split('\\"');for(let p=0;p<u.length;++p){const g=u[p].indexOf('"');g!==-1&&(u[p]=u[p].slice(0,g),u.length=p+1),u[p]=u[p].replaceAll(/\\(.)/g,"$1")}h=u.join('"')}return h}function c(h){const u=h.indexOf("'");if(u===-1)return h;const p=h.slice(0,u),y=h.slice(u+1).replace(/^[^']*'/,"");return n(p,y)}function l(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,p,g,y){if(g==="q"||g==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(m,v){return String.fromCharCode(parseInt(v,16))}),n(p,y);try{y=atob(y)}catch{}return n(p,y)})}return""}function Ov(i,t){const e=new Headers;if(!i||!t||typeof t!="object")return e;for(const s in t){const n=t[s];n!==void 0&&e.append(s,n)}return e}function Uc(i){return URL.parse(i)?.origin??null}function Fv({responseHeaders:i,isHttp:t,rangeChunkSize:e,disableRange:s}){const n={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(i.get("Content-Length"),10);return!Number.isInteger(r)||(n.suggestedLength=r,r<=2*e)||s||!t||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(n.allowRangeRequests=!0),n}function Vv(i){const t=i.get("Content-Disposition");if(t){let e=NR(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Wu(e))return e}return null}function Do(i,t){return new tc(`Unexpected server response (${i}) while retrieving PDF "${t}".`,i,i===404||i===0&&t.startsWith("file:"))}function Bv(i){return i===200||i===206}function Uv(i,t,e){return{method:"GET",headers:i,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function $v(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(it(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class LR{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Ov(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return yt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new OR(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new FR(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class OR{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),n=e.url;fetch(n,Uv(s,this._withCredentials,this._abortController)).then(r=>{if(t._responseOrigin=Uc(r.url),!Bv(r.status))throw Do(r.status,n);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:a,suggestedLength:c}=Fv({responseHeaders:o,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=c||this._contentLength,this._filename=Vv(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ai("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:$v(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class FR{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const n=t.source;this._withCredentials=n.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!n.disableStream,this._abortController=new AbortController;const r=new Headers(t.headers);r.append("Range",`bytes=${e}-${s-1}`);const o=n.url;fetch(o,Uv(r,this._withCredentials,this._abortController)).then(a=>{const c=Uc(a.url);if(c!==t._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${t._responseOrigin}".`);if(!Bv(a.status))throw Do(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:$v(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const Ml=200,Nl=206;function VR(i){const t=i.response;return typeof t!="string"?t:Co(t).buffer}class BR{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:s}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Ov(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,n=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[r,o]of this.headers)e.setRequestHeader(r,o);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),n.expectedStatus=Nl):n.expectedStatus=Ml,e.responseType="arraybuffer",yt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),n.onHeadersReceived=t.onHeadersReceived,n.onDone=t.onDone,n.onError=t.onError,n.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){const s=this.pendingRequests[t];s&&s.onProgress?.(e)}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const n=s.xhr;if(n.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),n.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],n.status===0&&this.isHttp){s.onError(n.status);return}const r=n.status||Ml;if(!(r===Ml&&s.expectedStatus===Nl)&&r!==s.expectedStatus){s.onError(n.status);return}const a=VR(n);if(r===Nl){const c=n.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);l?s.onDone({begin:parseInt(l[1],10),chunk:a}):(it('Missing or invalid "Content-Range" header.'),s.onError(0))}else a?s.onDone({begin:0,chunk:a}):s.onError(n.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class UR{constructor(t){this._source=t,this._manager=new BR(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return yt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new $R(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new zR(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class $R{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Uc(e.responseURL);const s=e.getAllResponseHeaders(),n=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[c,...l]=a.split(": ");return[c,l.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=Fv({responseHeaders:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=Vv(n),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Do(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class zR{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=Uc(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Do(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const jR=/^[a-z][a-z0-9\-+.]+:/i;function HR(i){if(jR.test(i))return new URL(i);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(i))}class qR{constructor(t){this.source=t,this.url=HR(t.url),yt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return yt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new GR(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new WR(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class GR{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(n=>{this._contentLength=n.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},n=>{n.code==="ENOENT"&&(n=Do(0,this._url.href)),this._storedError=n,this._headersCapability.reject(n)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ai("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class WR{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const n=t.source;this._isStreamingSupported=!n.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const wr=Symbol("INITIAL_DATA");class zv{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:wr}}get(t,e=null){if(e){const n=this.#e(t);return n.promise.then(()=>e(n.data)),null}const s=this.#t[t];if(!s||s.data===wr)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=this.#t[t];return!!e&&e.data!==wr}delete(t){const e=this.#t[t];return!e||e.data===wr?!1:(delete this.#t[t],!0)}resolve(t,e=null){const s=this.#e(t);s.data=e,s.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==wr&&(yield[t,e])}}}const KR=1e5,Vg=30;class Ue{#t=Promise.withResolvers();#e=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#o=null;#r=null;#n=0;#a=0;#l=null;#c=null;#d=0;#u=0;#f=Object.create(null);#m=[];#g=null;#h=[];#p=new WeakMap;#_=null;static#v=new Map;static#y=new Map;static#S=new WeakMap;static#E=null;static#w=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#g=t;else if(typeof t=="object")this.#g=new ReadableStream({start(c){c.enqueue(t),c.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#c=e,this.#u=s.scale*Ps.pixelRatio,this.#d=s.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:n,pageHeight:r,pageX:o,pageY:a}=s.rawDims;this.#_=[1,0,0,-1,-o,a+r],this.#a=n,this.#n=r,Ue.#R(),e.style.setProperty("--min-font-size",Ue.#E),tn(e,s),this.#t.promise.finally(()=>{Ue.#w.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=re.platform;return nt(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#l.read().then(({value:e,done:s})=>{if(s){this.#t.resolve();return}this.#o??=e.lang,Object.assign(this.#f,e.styles),this.#C(e.items),t()},this.#t.reject)};return this.#l=this.#g.getReader(),Ue.#w.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*Ps.pixelRatio,n=t.rotation;if(n!==this.#d&&(e?.(),this.#d=n,tn(this.#c,{rotation:n})),s!==this.#u){e?.(),this.#u=s;const r={div:null,properties:null,ctx:Ue.#x(this.#o)};for(const o of this.#h)r.properties=this.#p.get(o),r.div=o,this.#T(r)}}cancel(){const t=new Ai("TextLayer task cancelled.");this.#l?.cancel(t).catch(()=>{}),this.#l=null,this.#t.reject(t)}get textDivs(){return this.#h}get textContentItemsStr(){return this.#m}#C(t){if(this.#i)return;this.#r.ctx??=Ue.#x(this.#o);const e=this.#h,s=this.#m;for(const n of t){if(e.length>KR){it("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(n.str===void 0){if(n.type==="beginMarkedContentProps"||n.type==="beginMarkedContent"){const r=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),n.id&&this.#e.setAttribute("id",`${n.id}`),r.append(this.#e)}else n.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(n.str),this.#b(n)}}#b(t){const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#h.push(e);const n=H.transform(this.#_,t.transform);let r=Math.atan2(n[1],n[0]);const o=this.#f[t.fontName];o.vertical&&(r+=Math.PI/2);let a=this.#s&&o.fontSubstitution||o.fontFamily;a=Ue.fontFamilyMap.get(a)||a;const c=Math.hypot(n[2],n[3]),l=c*Ue.#F(a,o,this.#o);let h,u;r===0?(h=n[4],u=n[5]-l):(h=n[4]+l*Math.sin(r),u=n[5]-l*Math.cos(r));const p=e.style;p.left=`${(100*h/this.#a).toFixed(2)}%`,p.top=`${(100*u/this.#n).toFixed(2)}%`,p.setProperty("--font-height",`${c.toFixed(2)}px`),p.fontFamily=a,s.fontSize=c,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#s&&(e.dataset.fontName=o.fontSubstitutionLoadedName||t.fontName),r!==0&&(s.angle=r*(180/Math.PI));let g=!1;if(t.str.length>1)g=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const y=Math.abs(t.transform[0]),m=Math.abs(t.transform[3]);y!==m&&Math.max(y,m)/Math.min(y,m)>1.5&&(g=!0)}if(g&&(s.canvasWidth=o.vertical?t.height:t.width),this.#p.set(e,s),this.#r.div=e,this.#r.properties=s,this.#T(this.#r),s.hasText&&this.#e.append(e),s.hasEOL){const y=document.createElement("br");y.setAttribute("role","presentation"),this.#e.append(y)}}#T(t){const{div:e,properties:s,ctx:n}=t,{style:r}=e;if(s.canvasWidth!==0&&s.hasText){const{fontFamily:o}=r,{canvasWidth:a,fontSize:c}=s;Ue.#P(n,c*this.#u,o);const{width:l}=n.measureText(e.textContent);l>0&&r.setProperty("--scale-x",a*this.#u/l)}s.angle!==0&&r.setProperty("--rotate",`${s.angle}deg`)}static cleanup(){if(!(this.#w.size>0)){this.#v.clear();for(const{canvas:t}of this.#y.values())t.remove();this.#y.clear()}}static#x(t=null){let e=this.#y.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(t,e),this.#S.set(e,{size:0,family:""})}return e}static#P(t,e,s){const n=this.#S.get(t);e===n.size&&s===n.family||(t.font=`${e}px ${s}`,n.size=e,n.family=s)}static#R(){if(this.#E!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#E=t.getBoundingClientRect().height,t.remove()}static#F(t,e,s){const n=this.#v.get(t);if(n)return n;const r=this.#x(s);r.canvas.width=r.canvas.height=Vg,this.#P(r,Vg,t);const o=r.measureText(""),a=o.fontBoundingBoxAscent,c=Math.abs(o.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let l=.8;return a?l=a/(a+c):(re.platform.isFirefox&&it("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?l=e.ascent:e.descent&&(l=1+e.descent)),this.#v.set(t,l),l}}const XR=100;function jv(i={}){typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});const t=new td,{docId:e}=t,s=i.url?sR(i.url):null,n=i.data?iR(i.data):null,r=i.httpHeaders||null,o=i.withCredentials===!0,a=i.password??null,c=i.range instanceof Hv?i.range:null,l=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:2**16;let h=i.worker instanceof ao?i.worker:null;const u=i.verbosity,p=typeof i.docBaseUrl=="string"&&!Vc(i.docBaseUrl)?i.docBaseUrl:null,g=na(i.cMapUrl),y=i.cMapPacked!==!1,m=i.CMapReaderFactory||(Pe?uR:Tg),v=na(i.iccUrl),w=na(i.standardFontDataUrl),E=i.StandardFontDataFactory||(Pe?dR:Sg),A=na(i.wasmUrl),P=i.WasmFactory||(Pe?fR:Ig),x=i.stopAtErrors!==!0,M=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,S=i.isEvalSupported!==!1,T=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!Pe,I=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!Pe&&(re.platform.isFirefox||!globalThis.chrome),k=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,R=typeof i.disableFontFace=="boolean"?i.disableFontFace:Pe,N=i.fontExtraProperties===!0,D=i.enableXfa===!0,J=i.ownerDocument||globalThis.document,wt=i.disableRange===!0,G=i.disableStream===!0,K=i.disableAutoFetch===!0,ft=i.pdfBug===!0,Xt=i.CanvasFactory||(Pe?hR:aR),dt=i.FilterFactory||(Pe?lR:cR),at=i.enableHWA===!0,z=i.useWasm!==!1,Z=c?c.length:i.length??NaN,Se=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!Pe&&!R,He=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:!!(m===Tg&&E===Sg&&P===Ig&&g&&w&&A&&kr(g,document.baseURI)&&kr(w,document.baseURI)&&kr(A,document.baseURI)),qe=null;RP(u);const Dt={canvasFactory:new Xt({ownerDocument:J,enableHWA:at}),filterFactory:new dt({docId:e,ownerDocument:J}),cMapReaderFactory:He?null:new m({baseUrl:g,isCompressed:y}),standardFontDataFactory:He?null:new E({baseUrl:w}),wasmFactory:He?null:new P({baseUrl:A})};h||(h=ao.create({verbosity:u,port:qi.workerPort}),t._worker=h);const ks={docId:e,apiVersion:"5.4.530",data:n,password:a,disableAutoFetch:K,rangeChunkSize:l,length:Z,docBaseUrl:p,enableXfa:D,evaluatorOptions:{maxImageSize:M,disableFontFace:R,ignoreErrors:x,isEvalSupported:S,isOffscreenCanvasSupported:T,isImageDecoderSupported:I,canvasMaxAreaInBytes:k,fontExtraProperties:N,useSystemFonts:Se,useWasm:z,useWorkerFetch:He,cMapUrl:g,iccUrl:v,standardFontDataUrl:w,wasmUrl:A}},Ws={ownerDocument:J,pdfBug:ft,styleElement:qe,loadingParams:{disableAutoFetch:K,enableXfa:D}};return h.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const zc=h.messageHandler.sendWithPromise("GetDocRequest",ks,n?[n.buffer]:null);let er;if(c)er=new kR(c,{disableRange:wt,disableStream:G});else if(!n){if(!s)throw new Error("getDocument - no `url` parameter provided.");const un=kr(s)?LR:Pe?qR:UR;er=new un({url:s,length:Z,httpHeaders:r,withCredentials:o,rangeChunkSize:l,disableRange:wt,disableStream:G})}return zc.then(un=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const dn=new Dr(e,un,h.port),No=new JR(dn,t,er,Ws,Dt,at);t._transport=No,dn.send("Ready",null)})}).catch(t._capability.reject),t}class td{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${td.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Hv{#t=Promise.withResolvers();#e=[];#i=[];#s=[];#o=[];constructor(t,e,s=!1,n=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=n}addRangeListener(t){this.#o.push(t)}addProgressListener(t){this.#s.push(t)}addProgressiveReadListener(t){this.#i.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const s of this.#o)s(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const s of this.#s)s(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#i)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Pt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class YR{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return nt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class QR{#t=!1;constructor(t,e,s,n=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=n?new _g:null,this._pdfBug=n,this.commonObjs=s.commonObjs,this.objs=new zv,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:n=0,dontFlip:r=!1}={}){return new Ro({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:n,dontFlip:r})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return nt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:s,intent:n="display",annotationMode:r=oi.ENABLE,transform:o=null,background:a=null,optionalContentConfigPromise:c=null,annotationCanvasMap:l=null,pageColors:h=null,printAnnotationStorage:u=null,isEditing:p=!1,recordOperations:g=!1,operationsFilter:y=null}){this._stats?.time("Overall");const m=this._transport.getRenderingIntent(n,r,u,p),{renderingIntent:v,cacheKey:w}=m;this.#t=!1,c||=this._transport.getOptionalContentConfig(v);let E=this._intentStates.get(w);E||(E=Object.create(null),this._intentStates.set(w,E)),E.streamReaderCancelTimeout&&(clearTimeout(E.streamReaderCancelTimeout),E.streamReaderCancelTimeout=null);const A=!!(v&Be.PRINT);E.displayReadyCapability||(E.displayReadyCapability=Promise.withResolvers(),E.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(m));const P=!!(this._pdfBug&&globalThis.StepperManager?.enabled),x=!this.recordedBBoxes&&(g||P),M=I=>{if(E.renderTasks.delete(S),x){const k=S.gfx?.dependencyTracker.take();k&&(S.stepper&&S.stepper.setOperatorBBoxes(k,S.gfx.dependencyTracker.takeDebugMetadata()),g&&(this.recordedBBoxes=k))}A&&(this.#t=!0),this.#e(),I?(S.capability.reject(I),this._abortOperatorList({intentState:E,reason:I instanceof Error?I:new Error(I)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new In({callback:M,params:{canvas:e,canvasContext:t,dependencyTracker:x?new gR(e,E.operatorList.length,P):null,viewport:s,transform:o,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:E.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!A,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,operationsFilter:y});(E.renderTasks||=new Set).add(S);const T=S.task;return Promise.all([E.displayReadyCapability.promise,c]).then(([I,k])=>{if(this.destroyed){M();return}if(this._stats?.time("Rendering"),!(k.renderingIntent&v))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:I,optionalContentConfig:k}),S.operatorListChanged()}).catch(M),T}getOperatorList({intent:t="display",annotationMode:e=oi.ENABLE,printAnnotationStorage:s=null,isEditing:n=!1}={}){function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(c))}const o=this._transport.getRenderingIntent(t,e,s,n,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let c;return a.opListReadCapability||(c=Object.create(null),c.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(c),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(n){return n.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>oo.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,n){function r(){o.read().then(function({value:c,done:l}){if(l){s(a);return}a.lang??=c.lang,Object.assign(a.styles,c.styles),a.items.push(...c.items),r()},n)}const o=e.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new _g),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const s=this._intentStates.get(e);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,n=t.length;s<n;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:n}){const{map:r,transfer:o}=s,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:r,modifiedIds:n},o).getReader(),l=this._intentStates.get(e);l.streamReader=c;const h=()=>{c.read().then(({value:u,done:p})=>{if(p){l.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,l),h())},u=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const p of l.renderTasks)p.operatorListChanged();this.#e()}if(l.displayReadyCapability)l.displayReadyCapability.reject(u);else if(l.opListReadCapability)l.opListReadCapability.reject(u);else throw u}})};h()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof Gu){let n=XR;e.extraDelay>0&&e.extraDelay<1e3&&(n+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},n);return}}if(t.streamReader.cancel(new Ai(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[n,r]of this._intentStates)if(r===t){this._intentStates.delete(n);break}this.cleanup()}}}get stats(){return this._stats}}var ai,ts,Ls,Ui,ic,$i,zi,ke,xa,qv,Gv,Mr,Ln,ka;const Nt=class Nt{constructor({name:t=null,port:e=null,verbosity:s=xP()}={}){ds(this,ke);ds(this,ai,Promise.withResolvers());ds(this,ts,null);ds(this,Ls,null);ds(this,Ui,null);if(this.name=t,this.destroyed=!1,this.verbosity=s,e){if(Mt(Nt,zi).has(e))throw new Error("Cannot use more than one PDFWorker per port.");Mt(Nt,zi).set(e,this),fs(this,ke,qv).call(this,e)}else fs(this,ke,Gv).call(this)}get promise(){return Mt(this,ai).promise}get port(){return Mt(this,Ls)}get messageHandler(){return Mt(this,ts)}destroy(){this.destroyed=!0,Mt(this,Ui)?.terminate(),De(this,Ui,null),Mt(Nt,zi).delete(Mt(this,Ls)),De(this,Ls,null),Mt(this,ts)?.destroy(),De(this,ts,null)}static create(t){const e=Mt(this,zi).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Nt(t)}static get workerSrc(){if(qi.workerSrc)return qi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return nt(this,"_setupFakeWorkerGlobal",(async()=>Mt(this,Ln,ka)?Mt(this,Ln,ka):(await import(this.workerSrc)).WorkerMessageHandler)())}};ai=new WeakMap,ts=new WeakMap,Ls=new WeakMap,Ui=new WeakMap,ic=new WeakMap,$i=new WeakMap,zi=new WeakMap,ke=new WeakSet,xa=function(){Mt(this,ai).resolve(),Mt(this,ts).send("configure",{verbosity:this.verbosity})},qv=function(t){De(this,Ls,t),De(this,ts,new Dr("main","worker",t)),Mt(this,ts).on("ready",()=>{}),fs(this,ke,xa).call(this)},Gv=function(){if(Mt(Nt,$i)||Mt(Nt,Ln,ka)){fs(this,ke,Mr).call(this);return}let{workerSrc:t}=Nt;try{Nt._isSameOrigin(window.location,t)||(t=Nt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new Dr("main","worker",e),n=()=>{r.abort(),s.destroy(),e.terminate(),this.destroyed?Mt(this,ai).reject(new Error("Worker was destroyed")):fs(this,ke,Mr).call(this)},r=new AbortController;e.addEventListener("error",()=>{Mt(this,Ui)||n()},{signal:r.signal}),s.on("test",a=>{if(r.abort(),this.destroyed||!a){n();return}De(this,ts,s),De(this,Ls,e),De(this,Ui,e),fs(this,ke,xa).call(this)}),s.on("ready",a=>{if(r.abort(),this.destroyed){n();return}try{o()}catch{fs(this,ke,Mr).call(this)}});const o=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};o();return}catch{Fc("The worker has been disabled.")}fs(this,ke,Mr).call(this)},Mr=function(){Mt(Nt,$i)||(it("Setting up fake worker."),De(Nt,$i,!0)),Nt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){Mt(this,ai).reject(new Error("Worker was destroyed"));return}const e=new oR;De(this,Ls,e);const s=`fake${nf(Nt,ic)._++}`,n=new Dr(s+"_worker",s,e);t.setup(n,e),De(this,ts,new Dr(s,s+"_worker",e)),fs(this,ke,xa).call(this)}).catch(t=>{Mt(this,ai).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},Ln=new WeakSet,ka=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},ds(Nt,Ln),ds(Nt,ic,0),ds(Nt,$i,!1),ds(Nt,zi,new WeakMap),Pe&&(De(Nt,$i,!0),qi.workerSrc||="./pdf.worker.mjs"),Nt._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!s?.origin||s.origin==="null")return!1;const n=new URL(e,s);return s.origin===n.origin},Nt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Nt.fromPort=t=>{if(zP("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Nt.create(t)};let ao=Nt;class JR{#t=new Map;#e=new Map;#i=new Map;#s=new Map;#o=null;constructor(t,e,s,n,r,o){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new zv,this.fontLoader=new ZP({ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this.loadingParams=n.loadingParams,this._params=n,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}#r(t,e=null){const s=this.#t.get(t);if(s)return s;const n=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,n),n}get annotationStorage(){return nt(this,"annotationStorage",new Yu)}getRenderingIntent(t,e=oi.ENABLE,s=null,n=!1,r=!1){let o=Be.DISPLAY,a=Dh;switch(t){case"any":o=Be.ANY;break;case"display":break;case"print":o=Be.PRINT;break;default:it(`getRenderingIntent - invalid intent: ${t}`)}const c=o&Be.PRINT&&s instanceof xv?s:this.annotationStorage;switch(e){case oi.DISABLE:o+=Be.ANNOTATIONS_DISABLE;break;case oi.ENABLE:break;case oi.ENABLE_FORMS:o+=Be.ANNOTATIONS_FORMS;break;case oi.ENABLE_STORAGE:o+=Be.ANNOTATIONS_STORAGE,a=c.serializable;break;default:it(`getRenderingIntent - invalid annotationMode: ${e}`)}n&&(o+=Be.IS_EDITING),r&&(o+=Be.OPLIST);const{ids:l,hash:h}=c.modifiedIds,u=[o,a.hash,h];return{renderingIntent:o,cacheKey:u.join("_"),annotationStorageSerializable:a,modifiedIds:l}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#o?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#e.values())t.push(s._destroy());this.#e.clear(),this.#i.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Ue.cleanup(),this._networkStream?.cancelAllRequests(new Ai("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,n)=>{yt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},n.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){n.close();return}yt(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{n.error(r)})},n.onCancel=r=>{this._fullReader.cancel(r),n.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("ReaderHeadersReady",async s=>{await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:r,contentLength:o}=this._fullReader;return(!n||!r)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{e.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:n,isRangeSupported:r,contentLength:o}}),t.on("GetRangeReader",(s,n)=>{yt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){n.close();return}n.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){n.close();return}yt(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{n.error(o)})},n.onCancel=o=>{r.cancel(o),n.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new YR(s,this))}),t.on("DocException",s=>{e._capability.reject(Me(s))}),t.on("PasswordRequest",s=>{this.#o=Promise.withResolvers();try{if(!e.onPassword)throw Me(s);const n=r=>{r instanceof Error?this.#o.reject(r):this.#o.resolve({password:r})};e.onPassword(n,s.code)}catch(n){this.#o.reject(n)}return this.#o.promise}),t.on("DataLoaded",s=>{e.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;this.#e.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,n,r])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(n){case"Font":if("error"in r){const u=r.error;it(`Error during font loading: ${u}`),this.commonObjs.resolve(s,u);break}const o=new St(r),a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(u,p)=>globalThis.FontInspector.fontAdded(u,p):null,c=new tR(o,a,r.extra,r.charProcOperatorList);this.fontLoader.bind(c).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!c.fontExtraProperties&&c.data&&c.clearData(),this.commonObjs.resolve(s,c)});break;case"CopyLocalImage":const{imageRef:l}=r;yt(l,"The imageRef must be defined.");for(const u of this.#e.values())for(const[,p]of u.objs)if(p?.ref===l)return p.dataLen?(this.commonObjs.resolve(s,structuredClone(p)),p.dataLen):null;break;case"FontPath":this.commonObjs.resolve(s,new eR(r));break;case"Image":this.commonObjs.resolve(s,r);break;case"Pattern":const h=new ae(r);this.commonObjs.resolve(s,h.getIR());break;default:throw new Error(`Got unknown common object type ${n}`)}return null}),t.on("obj",([s,n,r,o])=>{if(this.destroyed)return;const a=this.#e.get(n);if(!a.objs.has(s)){if(a._intentStates.size===0){o?.bitmap?.close();return}switch(r){case"Image":case"Pattern":a.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),t.on("DocProgress",s=>{this.destroyed||e.onProgress?.({loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const n=this[s.type];if(!n)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return n.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&it("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=this.#i.get(e);if(s)return s;const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&this.#s.set(r.refStr,t);const o=new QR(e,r,this,this._params.pdfBug);return this.#e.set(e,o),o});return this.#i.set(e,n),n}getPageIndex(t){return Mh(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#r("GetFieldObjects")}hasJSActions(){return this.#r("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#r("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#r("GetOptionalContentConfig").then(e=>new xR(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(n=>({info:n[0],metadata:n[1]?new PR(n[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:n[2]}));return this.#t.set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Ue.cleanup()}}cachedPageNumber(t){if(!Mh(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#s.get(e)??null}}class ZR{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class In{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:n,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:c,filterFactory:l,useRequestAnimationFrame:h=!1,pdfBug:u=!1,pageColors:p=null,enableHWA:g=!1,operationsFilter:y=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=n,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=c,this.filterFactory=l,this._pdfBug=u,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new ZR(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=g,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=y}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(In.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");In.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:n,background:r,dependencyTracker:o}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Nn(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:n,viewport:s,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),In.#e.delete(this._canvas),t||=new Gu(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),In.#e.delete(this._canvas),this.callback())))}}const tx="5.4.530",ex="50cc4adac";class Ke{#t=null;#e=null;#i;#s=null;#o=!1;#r=!1;#n=null;#a;#l=null;#c=null;static#d=null;static get _keyboardManager(){return nt(this,"_keyboardManager",new ko([[["Escape","mac+Escape"],Ke.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ke.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ke.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ke.prototype._moveToPrevious],[["Home","mac+Home"],Ke.prototype._moveToBeginning],[["End","mac+End"],Ke.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#r=!1,this.#n=t):this.#r=!0,this.#c=t?._uiManager||e,this.#a=this.#c._eventBus,this.#i=t?.color?.toUpperCase()||this.#c?.highlightColors.values().next().value||"#FFFF98",Ke.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#n&&(t.ariaControls=`${this.#n.id}_colorpicker_dropdown`);const e=this.#c._signal;t.addEventListener("click",this.#g.bind(this),{signal:e}),t.addEventListener("keydown",this.#m.bind(this),{signal:e});const s=this.#e=document.createElement("span");return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=this.#i,t.append(s),t}renderMainDropdown(){const t=this.#s=this.#u();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#u(){const t=document.createElement("div"),e=this.#c._signal;t.addEventListener("contextmenu",Ze,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#n&&(t.id=`${this.#n.id}_colorpicker_dropdown`);for(const[s,n]of this.#c.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",n),r.title=s,r.setAttribute("data-l10n-id",Ke.#d[s]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=n,r.ariaSelected=n===this.#i,r.addEventListener("click",this.#f.bind(this,n),{signal:e}),t.append(r)}return t.addEventListener("keydown",this.#m.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:_t.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#g(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#p){this.#g(t);return}if(t.target===this.#t){this.#s.firstElementChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#s?.firstElementChild||t.target===this.#t){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#g(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#p){this.#g(t);return}this.#s.firstElementChild?.focus()}_moveToEnd(t){if(!this.#p){this.#g(t);return}this.#s.lastElementChild?.focus()}#m(t){Ke._keyboardManager.exec(this,t)}#g(t){if(this.#p){this.hideDropdown();return}if(this.#o=t.detail===0,this.#l||(this.#l=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#c.combinedSignal(this.#l)})),this.#t.ariaExpanded="true",this.#s){this.#s.classList.remove("hidden");return}const e=this.#s=this.#u();this.#t.append(e)}#h(t){this.#s?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#l?.abort(),this.#l=null}get#p(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#p){this.#n?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#o})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#s)return;const e=this.#c.highlightColors.values();for(const s of this.#s.children)s.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}}class co{#t=null;#e=null;#i=null;static#s=null;constructor(t){this.#e=t,this.#i=t._uiManager,co.#s||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,color:s}=this.#e,n=this.#t=document.createElement("input");return n.type="color",n.value=s||"#000000",n.className="basicColorPicker",n.tabIndex=0,n.setAttribute("data-l10n-id",co.#s[t]),n.addEventListener("input",()=>{this.#i.updateParams(e,n.value)},{signal:this.#i._signal}),n}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function Bg(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function Ar(i){return Math.max(0,Math.min(255,255*i))}class Ug{static CMYK_G([t,e,s,n]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+n)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Ar(t),[t,t,t]}static G_HTML([t]){const e=Bg(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(Ar)}static RGB_HTML(t){return`#${t.map(Bg).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,n]){return["RGB",1-Math.min(1,t+n),1-Math.min(1,s+n),1-Math.min(1,e+n)]}static CMYK_rgb([t,e,s,n]){return[Ar(1-Math.min(1,t+n)),Ar(1-Math.min(1,s+n)),Ar(1-Math.min(1,e+n))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const n=1-t,r=1-e,o=1-s,a=Math.min(n,r,o);return["CMYK",n,r,o,a]}}class sx{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),s||(n.setAttribute("width",`${t}px`),n.setAttribute("height",`${e}px`)),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox",`0 0 ${t} ${e}`),n}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Pt("Abstract method `_createSVG` called.")}}class sc extends sx{_createSVG(t){return document.createElementNS(Ms,t)}}const ix=9,en=new WeakSet,nx=new Date().getTimezoneOffset()*60*1e3;class Ll{static create(t){switch(t.data.annotationType){case Qt.LINK:return new ed(t);case Qt.TEXT:return new ox(t);case Qt.WIDGET:switch(t.data.fieldType){case"Tx":return new ax(t);case"Btn":return t.data.radioButton?new Wv(t):t.data.checkBox?new lx(t):new hx(t);case"Ch":return new ux(t);case"Sig":return new cx(t)}return new hn(t);case Qt.POPUP:return new Oh(t);case Qt.FREETEXT:return new Kv(t);case Qt.LINE:return new fx(t);case Qt.SQUARE:return new px(t);case Qt.CIRCLE:return new gx(t);case Qt.POLYLINE:return new Xv(t);case Qt.CARET:return new _x(t);case Qt.INK:return new sd(t);case Qt.POLYGON:return new mx(t);case Qt.HIGHLIGHT:return new Yv(t);case Qt.UNDERLINE:return new yx(t);case Qt.SQUIGGLY:return new vx(t);case Qt.STRIKEOUT:return new bx(t);case Qt.STAMP:return new Qv(t);case Qt.FILEATTACHMENT:return new wx(t);default:return new Bt(t)}}}class Bt{#t=null;#e=!1;#i=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:n=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(s)),n&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Bt._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:s,rect:n}=this.data;let r=-1/0,o=-1/0;if(e?.length>=8){for(let a=0;a<e.length;a+=8)e[a+1]>o?(o=e[a+1],r=e[a+2]):e[a+1]===o&&(r=Math.max(r,e[a+2]));return[r,o]}if(s?.length>=1){for(const a of s)for(let c=0,l=a.length;c<l;c+=2)a[c+1]>o?(o=a[c+1],r=a[c]):a[c+1]===o&&(r=Math.max(r,a[c]));if(r!==1/0)return[r,o]}return n?[n[2],n[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:s,pageHeight:n,pageX:r,pageY:o}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-r)/s,t[1]=100*(t[1]-o)/n,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${no}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,s={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:s})||this.annotationStorage.setValue(`${no}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#i?.popup||this.popup)?.remove(),this.#i=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:s}=t;e&&this.#s(e);let n=this.#i?.popup||this.popup;!n&&s?.text&&(this._createPopup(s),n=this.#i.popup),n&&(n.updateEdited(t),s?.deleted&&(n.remove(),this.#i=null,this.popup=null))}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#s(t){const{container:{style:e},data:{rect:s,rotation:n},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:c}}}}=this;s?.splice(0,4,...t),e.left=`${100*(t[0]-a)/r}%`,e.top=`${100*(o-t[3]+c)/o}%`,n===0?(e.width=`${100*(t[2]-t[0])/r}%`,e.height=`${100*(t[3]-t[1])/o}%`):this.setRotation(n)}_createContainer(t){const{data:e,parent:{page:s,viewport:n}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),!(this instanceof hn)&&!(this instanceof ed)&&(r.tabIndex=0);const{style:o}=r;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof Oh){const{rotation:m}=e;return!e.hasOwnCanvas&&m!==0&&this.setRotation(m,r),r}const{width:a,height:c}=this;if(!t&&e.borderStyle.width>0){o.borderWidth=`${e.borderStyle.width}px`;const m=e.borderStyle.horizontalCornerRadius,v=e.borderStyle.verticalCornerRadius;if(m>0||v>0){const E=`calc(${m}px * var(--total-scale-factor)) / calc(${v}px * var(--total-scale-factor))`;o.borderRadius=E}else if(this instanceof Wv){const E=`calc(${a}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;o.borderRadius=E}switch(e.borderStyle.style){case wn.SOLID:o.borderStyle="solid";break;case wn.DASHED:o.borderStyle="dashed";break;case wn.BEVELED:it("Unimplemented border style: beveled");break;case wn.INSET:it("Unimplemented border style: inset");break;case wn.UNDERLINE:o.borderBottomStyle="solid";break}const w=e.borderColor||null;w?(this.#e=!0,o.borderColor=H.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):o.borderWidth=0}const l=H.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:h,pageHeight:u,pageX:p,pageY:g}=n.rawDims;o.left=`${100*(l[0]-p)/h}%`,o.top=`${100*(l[1]-g)/u}%`;const{rotation:y}=e;return e.hasOwnCanvas||y===0?(o.width=`${100*a/h}%`,o.height=`${100*c/u}%`):this.setRotation(y,r),r}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:n}=this.parent.viewport.rawDims;let{width:r,height:o}=this;t%180!==0&&([r,o]=[o,r]),e.style.width=`${100*r/s}%`,e.style.height=`${100*o/n}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,n)=>{const r=n.detail[e],o=r[0],a=r.slice(1);n.target.style[s]=Ug[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:Ug[`${o}_rgb`](a)})};return nt(this,"_commonActions",{display:e=>{const{display:s}=e.detail,n=s%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const n of Object.keys(e.detail))(t[n]||s[n])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[n,r]of Object.entries(e)){const o=s[n];if(o){const a={detail:{[n]:r},target:t};o(a),delete e[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,n,r]=this.data.rect.map(m=>Math.fround(m));if(t.length===8){const[m,v,w,E]=t.subarray(2,6);if(n===m&&r===v&&e===w&&s===E)return}const{style:o}=this.container;let a;if(this.#e){const{borderColor:m,borderWidth:v}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${v}">`],this.container.classList.add("hasBorder")}const c=n-e,l=r-s,{svgFactory:h}=this,u=h.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0),u.role="none";const p=h.createElement("defs");u.append(p);const g=h.createElement("clipPath"),y=`clippath_${this.data.id}`;g.setAttribute("id",y),g.setAttribute("clipPathUnits","objectBoundingBox"),p.append(g);for(let m=2,v=t.length;m<v;m+=8){const w=t[m],E=t[m+1],A=t[m+2],P=t[m+3],x=h.createElement("rect"),M=(A-e)/c,S=(r-E)/l,T=(w-A)/c,I=(E-P)/l;x.setAttribute("x",M),x.setAttribute("y",S),x.setAttribute("width",T),x.setAttribute("height",I),g.append(x),a?.push(`<rect vector-effect="non-scaling-stroke" x="${M}" y="${S}" width="${T}" height="${I}"/>`)}this.#e&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(u),this.container.style.clipPath=`url(#${y})`}_createPopup(t=null){const{data:e}=this;let s,n;t?(s={str:t.text},n=t.date):(s=e.contentsObj,n=e.modificationDate),this.#i=new Oh({data:{color:e.color,titleObj:e.titleObj,modificationDate:n,contentsObj:s,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#i||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#i}render(){Pt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const n=this._fieldObjects[t];if(n)for(const{page:r,id:o,exportValues:a}of n){if(r===-1||o===e)continue;const c=typeof a=="string"?a:null,l=document.querySelector(`[data-element-id="${o}"]`);if(l&&!en.has(l)){it(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:c,domElement:l})}return s}for(const n of document.getElementsByName(t)){const{exportValue:r}=n,o=n.getAttribute("data-element-id");o!==e&&en.has(n)&&s.push({id:o,exportValue:r,domElement:n})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class rx extends Bt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class ed extends Bt{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let n=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(s,t.action,t.overlaidText),n=!0):t.attachment?(this.#e(s,t.attachment,t.overlaidText,t.attachmentDest),n=!0):t.setOCGState?(this.#i(s,t.setOCGState,t.overlaidText),n=!0):t.dest?(this._bindLink(s,t.dest,t.overlaidText),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),n=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(s,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&(this.contentElement=s,this.container.append(s)),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,s=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),s&&(t.title=s)}_bindNamedAction(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),s&&(t.title=s),this.#t()}#e(t,e,s="",n=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:s&&(t.title=s),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,n),!1),this.#t()}#i(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),s&&(t.title=s),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(e.actions)){const r=s.get(n);r&&(t[r]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:n}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){it('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();const{fields:n,refs:r,include:o}=e,a=[];if(n.length!==0||r.length!==0){const h=new Set(r);for(const u of n){const p=this._fieldObjects[u]||[];for(const{id:g}of p)h.add(g)}for(const u of Object.values(this._fieldObjects))for(const p of u)h.has(p.id)===o&&a.push(p)}else for(const h of Object.values(this._fieldObjects))a.push(...h);const c=this.annotationStorage,l=[];for(const h of a){const{id:u}=h;switch(l.push(u),h.type){case"text":{const g=h.defaultValue||"";c.setValue(u,{value:g});break}case"checkbox":case"radiobutton":{const g=h.defaultValue===h.exportValues;c.setValue(u,{value:g});break}case"combobox":case"listbox":{const g=h.defaultValue||"";c.setValue(u,{value:g});break}default:continue}const p=document.querySelector(`[data-element-id="${u}"]`);if(p){if(!en.has(p)){it(`_bindResetFormAction - element not allowed: ${u}`);continue}}else continue;p.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}}),!1}}}class ox extends Bt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class hn extends Bt{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return re.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,n,r){s.includes("mouse")?t.addEventListener(s,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):t.addEventListener(s,o=>{if(s==="blur"){if(!e.focused||!o.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:r(o)}})})}_setEventListeners(t,e,s,n){for(const[r,o]of s)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,r,o,n),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":H.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||ix,r=t.style;let o;const a=2,c=l=>Math.round(10*l)/10;if(this.data.multiLine){const l=Math.abs(this.data.rect[3]-this.data.rect[1]-a),h=Math.round(l/(Cl*n))||1,u=l/h;o=Math.min(n,c(u/Cl))}else{const l=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(n,c(l/Cl))}r.fontSize=`calc(${o}px * var(--total-scale-factor))`,r.color=H.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class ax extends hn{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,n){const r=this.annotationStorage;for(const o of this._getElementsByName(t.name,t.id))o.domElement&&(o.domElement[e]=s),r.setValue(o.id,{[n]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const n=t.getValue(e,{value:this.data.fieldValue});let r=n.value||"";const o=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;o&&r.length>o&&(r=r.slice(0,o));let a=n.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const c={userValue:r,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=a??r,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",a??r),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),en.add(s),this.contentElement=s,s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:l,datetimeType:h,timeStep:u}=this.data,p=!!h&&this.enableScripting;l&&(s.title=l),this._setRequired(s,this.data.required),o&&(s.maxLength=o),s.addEventListener("input",y=>{t.setValue(e,{value:y.target.value}),this.setPropertyOnSiblings(s,"value",y.target.value,"value"),c.formattedValue=null}),s.addEventListener("resetform",y=>{const m=this.data.defaultFieldValue??"";s.value=c.userValue=m,c.formattedValue=null});let g=y=>{const{formattedValue:m}=c;m!=null&&(y.target.value=m),y.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",m=>{if(c.focused)return;const{target:v}=m;if(p&&(v.type=h,u&&(v.step=u)),c.userValue){const w=c.userValue;if(p)if(h==="time"){const E=new Date(w),A=[E.getHours(),E.getMinutes(),E.getSeconds()];v.value=A.map(P=>P.toString().padStart(2,"0")).join(":")}else v.value=new Date(w-nx).toISOString().split(h==="date"?"T":".",1)[0];else v.value=w}c.lastCommittedValue=v.value,c.commitKey=1,this.data.actions?.Focus||(c.focused=!0)}),s.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);const v={value(w){c.userValue=w.detail.value??"",p||t.setValue(e,{value:c.userValue.toString()}),w.target.value=c.userValue},formattedValue(w){const{formattedValue:E}=w.detail;c.formattedValue=E,E!=null&&w.target!==document.activeElement&&(w.target.value=E);const A={formattedValue:E};p&&(A.value=E),t.setValue(e,A)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{const{charLimit:E}=w.detail,{target:A}=w;if(E===0){A.removeAttribute("maxLength");return}A.setAttribute("maxLength",E);let P=c.userValue;!P||P.length<=E||(P=P.slice(0,E),A.value=c.userValue=P,t.setValue(e,{value:P}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:P,willCommit:!0,commitKey:1,selStart:A.selectionStart,selEnd:A.selectionEnd}}))}};this._dispatchEventFromSandbox(v,m)}),s.addEventListener("keydown",m=>{c.commitKey=1;let v=-1;if(m.key==="Escape"?v=0:m.key==="Enter"&&!this.data.multiLine?v=2:m.key==="Tab"&&(c.commitKey=3),v===-1)return;const{value:w}=m.target;c.lastCommittedValue!==w&&(c.lastCommittedValue=w,c.userValue=w,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:v,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});const y=g;g=null,s.addEventListener("blur",m=>{if(!c.focused||!m.relatedTarget)return;this.data.actions?.Blur||(c.focused=!1);const{target:v}=m;let{value:w}=v;if(p){if(w&&h==="time"){const E=w.split(":").map(A=>parseInt(A,10));w=new Date(2e3,0,1,E[0],E[1],E[2]||0).valueOf(),v.step=""}else w.includes("T")||(w=`${w}T00:00`),w=new Date(w).valueOf();v.type="text"}c.userValue=w,c.lastCommittedValue!==w&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:c.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}),y(m)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",m=>{c.lastCommittedValue=null;const{data:v,target:w}=m,{value:E,selectionStart:A,selectionEnd:P}=w;let x=A,M=P;switch(m.inputType){case"deleteWordBackward":{const S=E.substring(0,A).match(/\w*[^\w]*$/);S&&(x-=S[0].length);break}case"deleteWordForward":{const S=E.substring(A).match(/^[^\w]*\w*/);S&&(M+=S[0].length);break}case"deleteContentBackward":A===P&&(x-=1);break;case"deleteContentForward":A===P&&(M+=1);break}m.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:E,change:v||"",willCommit:!1,selStart:x,selEnd:M}})}),this._setEventListeners(s,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(g&&s.addEventListener("blur",g),this.data.comb){const m=(this.data.rect[2]-this.data.rect[0])/o;s.classList.add("comb"),s.style.letterSpacing=`calc(${m}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class cx extends hn{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class lx extends hn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let n=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",t.setValue(s,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return en.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=e.fieldName,n&&r.setAttribute("checked",!0),r.setAttribute("exportValue",e.exportValue),r.tabIndex=0,r.addEventListener("change",o=>{const{name:a,checked:c}=o.target;for(const l of this._getElementsByName(a,s)){const h=c&&l.exportValue===e.exportValue;l.domElement&&(l.domElement.checked=h),t.setValue(l.id,{value:h})}t.setValue(s,{value:c})}),r.addEventListener("resetform",o=>{const a=e.defaultFieldValue||"Off";o.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const a={value(c){c.target.checked=c.detail.value!=="Off",t.setValue(s,{value:c.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Wv extends hn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let n=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof n=="string"&&(n=n!==e.buttonValue,t.setValue(s,{value:n})),n)for(const o of this._getElementsByName(e.fieldName,s))t.setValue(o.id,{value:!1});const r=document.createElement("input");if(en.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=e.fieldName,n&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",o=>{const{name:a,checked:c}=o.target;for(const l of this._getElementsByName(a,s))t.setValue(l.id,{value:!1});t.setValue(s,{value:c})}),r.addEventListener("resetform",o=>{const a=e.defaultFieldValue;o.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const o=e.buttonValue;r.addEventListener("updatefromsandbox",a=>{const c={value:l=>{const h=o===l.detail.value;for(const u of this._getElementsByName(l.target.name)){const p=h&&u.id===s;u.domElement&&(u.domElement.checked=p),t.setValue(u.id,{value:p})}}};this._dispatchEventFromSandbox(c,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class hx extends ed{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class ux extends hn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),n=document.createElement("select");en.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",h=>{const u=this.data.defaultFieldValue;for(const p of n.options)p.selected=p.value===u});for(const h of this.data.options){const u=document.createElement("option");u.textContent=h.displayValue,u.value=h.exportValue,s.value.includes(h.exportValue)&&(u.setAttribute("selected",!0),r=!1),n.append(u)}let o=null;if(r){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),n.prepend(h),o=()=>{h.remove(),n.removeEventListener("input",o),o=null},n.addEventListener("input",o)}const a=h=>{const u=h?"value":"textContent",{options:p,multiple:g}=n;return g?Array.prototype.filter.call(p,y=>y.selected).map(y=>y[u]):p.selectedIndex===-1?null:p[p.selectedIndex][u]};let c=a(!1);const l=h=>{const u=h.target.options;return Array.prototype.map.call(u,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",h=>{const u={value(p){o?.();const g=p.detail.value,y=new Set(Array.isArray(g)?g:[g]);for(const m of n.options)m.selected=y.has(m.value);t.setValue(e,{value:a(!0)}),c=a(!1)},multipleSelection(p){n.multiple=!0},remove(p){const g=n.options,y=p.detail.remove;g[y].selected=!1,n.remove(y),g.length>0&&Array.prototype.findIndex.call(g,v=>v.selected)===-1&&(g[0].selected=!0),t.setValue(e,{value:a(!0),items:l(p)}),c=a(!1)},clear(p){for(;n.length!==0;)n.remove(0);t.setValue(e,{value:null,items:[]}),c=a(!1)},insert(p){const{index:g,displayValue:y,exportValue:m}=p.detail.insert,v=n.children[g],w=document.createElement("option");w.textContent=y,w.value=m,v?v.before(w):n.append(w),t.setValue(e,{value:a(!0),items:l(p)}),c=a(!1)},items(p){const{items:g}=p.detail;for(;n.length!==0;)n.remove(0);for(const y of g){const{displayValue:m,exportValue:v}=y,w=document.createElement("option");w.textContent=m,w.value=v,n.append(w)}n.options.length>0&&(n.options[0].selected=!0),t.setValue(e,{value:a(!0),items:l(p)}),c=a(!1)},indices(p){const g=new Set(p.detail.indices);for(const y of p.target.options)y.selected=g.has(y.index);t.setValue(e,{value:a(!0)}),c=a(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(u,h)}),n.addEventListener("input",h=>{const u=a(!0),p=a(!1);t.setValue(e,{value:u}),h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:c,change:p,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):n.addEventListener("input",function(h){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Oh extends Bt{constructor(t){const{data:e,elements:s,parent:n}=t,r=!!n._commentManager;if(super(t,{isRenderable:!r&&Bt._hasPopupData(e)}),this.elements=s,r&&Bt._hasPopupData(e)){const o=this.popup=this.#t();for(const a of s)a.popup=o}else this.popup=null}#t(){return new dx({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),s=[];for(const n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",s.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(n=>`${Tn}${n}`).join(",")),this.container}}class dx{#t=null;#e=this.#H.bind(this);#i=this.#B.bind(this);#s=this.#M.bind(this);#o=this.#A.bind(this);#r=null;#n=null;#a=null;#l=null;#c=null;#d=null;#u=null;#f=!1;#m=null;#g=null;#h=null;#p=null;#_=null;#v=null;#y=null;#S=null;#E=null;#w=null;#C=!1;#b=null;#T=null;constructor({container:t,color:e,elements:s,titleObj:n,modificationDate:r,contentsObj:o,richText:a,parent:c,rect:l,parentRect:h,open:u,commentManager:p=null}){this.#n=t,this.#E=n,this.#a=o,this.#S=a,this.#d=c,this.#r=e,this.#y=l,this.#u=h,this.#c=s,this.#t=p,this.#b=s[0],this.#l=Rh.toDateObject(r),this.trigger=s.flatMap(g=>g.getElementsToTriggerPopup()),p||(this.#x(),this.#n.hidden=!0,u&&this.#A())}#x(){if(this.#g)return;this.#g=new AbortController;const{signal:t}=this.#g;for(const e of this.trigger)e.addEventListener("click",this.#o,{signal:t}),e.addEventListener("pointerenter",this.#s,{signal:t}),e.addEventListener("pointerleave",this.#i,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#c)e.container?.addEventListener("keydown",this.#e,{signal:t})}#P(){const t=this.#c.find(e=>e.hasCommentButton);t&&(this.#_=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#b.container.after(this.#p);return}if(this.#_||this.#P(),!this.#_)return;const{signal:t}=this.#g=new AbortController,e=this.#b.hasOwnCommentButton,s=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},n=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},r=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#p=this.#b.container;for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",this.#e,{signal:t}),o.addEventListener("click",s,{signal:t}),o.addEventListener("pointerenter",n,{signal:t}),o.addEventListener("pointerleave",r,{signal:t}),o.classList.add("popupTriggerArea")}else{const o=this.#p=document.createElement("button");o.className="annotationCommentButton";const a=this.#b.container;o.style.zIndex=a.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#F(),this.#R(),o.addEventListener("keydown",this.#e,{signal:t}),o.addEventListener("click",s,{signal:t}),o.addEventListener("pointerenter",n,{signal:t}),o.addEventListener("pointerleave",r,{signal:t}),a.after(o)}}#R(){if(this.#b.extraPopupElement&&!this.#b.editor)return;this.#p||this.renderCommentButton();const[t,e]=this.#_,{style:s}=this.#p;s.left=`calc(${t}%)`,s.top=`calc(${e}% - var(--comment-button-dim))`}#F(){this.#b.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#b.commentData;return t?this.#d._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:t,color:e,opacity:s,creationDate:n,modificationDate:r}=this.#b.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:s,creationDate:n,modificationDate:r}}get elementBeforePopup(){return this.#p}get comment(){return this.#T||=this.#b.commentText,this.#T}set comment(t){t!==this.comment&&(this.#b.commentText=this.#T=t)}focus(){this.#b.container?.focus()}get parentBoundingClientRect(){return this.#b.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#p&&(this.#p.classList.toggle("selected",t),this.#p.ariaExpanded=e)}setSelectedCommentButton(t){this.#p.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#v)return this.#v;const{x:t,y:e,height:s}=this.#p.getBoundingClientRect(),{x:n,y:r,width:o,height:a}=this.#b.layer.getBoundingClientRect();return[(t-n)/o,(e+s-r)/a]}set commentPopupPosition(t){this.#v=t}hasDefaultPopupPosition(){return this.#v===null}get commentButtonPosition(){return this.#_}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,s]=this.#v||this.commentButtonPosition.map(l=>l/100),n=this.parentBoundingClientRect,{x:r,y:o,width:a,height:c}=n;this.#t.showDialog(null,this,r+e*a,o+s*c,{...t,parentDimensions:n})}render(){if(this.#m)return;const t=this.#m=document.createElement("div");if(t.className="popup",this.#r){const s=t.style.outlineColor=H.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#E?.str){const s=document.createElement("span");s.className="title",e.append(s),{dir:s.dir,str:s.textContent}=this.#E}if(t.append(e),this.#l){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#l.valueOf()})),s.dateTime=this.#l.toISOString(),e.append(s)}Iv({html:this.#D||this.#a.str,dir:this.#a?.dir,className:"popupContent"},t),this.#n.append(t)}get#D(){const t=this.#S,e=this.#a;return t?.str&&(!e?.str||e.str===t.str)&&this.#S.html||null}get#N(){return this.#D?.attributes?.style?.fontSize||0}get#V(){return this.#D?.attributes?.style?.color||null}#L(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},n={style:{color:this.#V,fontSize:this.#N?`calc(${this.#N}px * var(--total-scale-factor))`:""}};for(const r of t.split(`
`))e.push({name:"span",value:r,attributes:n});return s}#H(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#A()}updateEdited({rect:t,popup:e,deleted:s}){if(this.#t){s?(this.remove(),this.#T=null):e&&(e.deleted?this.remove():(this.#F(),this.#T=e.text)),t&&(this.#_=null,this.#P(),this.#R());return}if(s||e?.deleted){this.remove();return}this.#x(),this.#w||={contentsObj:this.#a,richText:this.#S},t&&(this.#h=null),e&&e.text&&(this.#S=this.#L(e.text),this.#l=Rh.toDateObject(e.date),this.#a=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#w&&({contentsObj:this.#a,richText:this.#S}=this.#w,this.#w=null,this.#m?.remove(),this.#m=null,this.#h=null)}remove(){if(this.#g?.abort(),this.#g=null,this.#m?.remove(),this.#m=null,this.#C=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#I(){if(this.#h!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:n,pageY:r}}}=this.#d;let o=!!this.#u,a=o?this.#u:this.#y;for(const y of this.#c)if(!a||H.intersect(y.data.rect,a)!==null){a=y.data.rect,o=!0;break}const c=H.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),h=o?a[2]-a[0]+5:0,u=c[0]+h,p=c[1];this.#h=[100*(u-n)/e,100*(p-r)/s];const{style:g}=this.#n;g.left=`${this.#h[0]}%`,g.top=`${this.#h[1]}%`}#A(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#M(),this.#n.addEventListener("click",this.#o),this.#n.addEventListener("keydown",this.#e)):(this.#B(),this.#n.removeEventListener("click",this.#o),this.#n.removeEventListener("keydown",this.#e))}#M(){this.#m||this.render(),this.isVisible?this.#f&&this.#n.classList.add("focused"):(this.#I(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#B(){this.#n.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#n.hidden=!0)}maybeShow(){this.#t||(this.#x(),this.#C&&(this.#m||this.#M(),this.#C=!1,this.#n.hidden=!1))}get isVisible(){return this.#t?!1:this.#n.hidden===!1}}class Kv extends Bt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=ot.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class fx extends Bt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:s}=this,n=this.svgFactory.create(e,s,!0),r=this.#t=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class px extends Bt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:s}=this,n=this.svgFactory.create(e,s,!0),r=t.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",r/2),o.setAttribute("y",r/2),o.setAttribute("width",e-r),o.setAttribute("height",s-r),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class gx extends Bt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:s}=this,n=this.svgFactory.create(e,s,!0),r=t.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",e/2),o.setAttribute("cy",s/2),o.setAttribute("rx",e/2-r/2),o.setAttribute("ry",s/2-r/2),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Xv extends Bt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:n},width:r,height:o}=this;if(!e)return this.container;const a=this.svgFactory.create(r,o,!0);let c=[];for(let h=0,u=e.length;h<u;h+=2){const p=e[h]-t[0],g=t[3]-e[h+1];c.push(`${p},${g}`)}c=c.join(" ");const l=this.#t=this.svgFactory.createElement(this.svgElementName);return l.setAttribute("points",c),l.setAttribute("stroke-width",s.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!n&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class mx extends Xv{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class _x extends Bt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class sd extends Bt{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ot.HIGHLIGHT:ot.INK}#i(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:n,popupRef:r}}=this,{transform:o,width:a,height:c}=this.#i(e,t),l=this.svgFactory.create(a,c,!0),h=this.#t=this.svgFactory.createElement("svg:g");l.append(h),h.setAttribute("stroke-width",n.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",o);for(let u=0,p=s.length;u<p;u++){const g=this.svgFactory.createElement(this.svgElementName);this.#e.push(g),g.setAttribute("points",s[u].join(",")),h.append(g)}return!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(l),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:n}=t,r=this.#t;if(e>=0&&r.setAttribute("stroke-width",e||1),s)for(let o=0,a=this.#e.length;o<a;o++)this.#e[o].setAttribute("points",s[o].join(","));if(n){const{transform:o,width:a,height:c}=this.#i(this.data.rotation,n);r.parentElement.setAttribute("viewBox",`0 0 ${a} ${c}`),r.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Yv extends Bt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ot.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class yx extends Bt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class vx extends Bt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class bx extends Bt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Qv extends Bt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ot.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class wx extends Bt{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:n}=re.platform;return t.addEventListener("keydown",r=>{r.key==="Enter"&&(n?r.metaKey:r.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class id{#t=null;#e=null;#i=null;#s=new Map;#o=null;#r=null;#n=[];#a=!1;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:n,page:r,viewport:o,structTreeLayer:a,commentManager:c,linkService:l,annotationStorage:h}){this.div=t,this.#t=e,this.#e=s,this.#o=a||null,this.#r=l||null,this.#i=h||new Yu,this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=n,this._commentManager=c||null}hasEditableAnnotations(){return this.#s.size>0}async render(t){const{annotations:e}=t,s=this.div;tn(s,this.viewport);const n=new Map,r=[],o={data:null,layer:s,linkService:this.#r,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new sc,annotationStorage:this.#i,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const c=a.annotationType===Qt.POPUP;if(c){const u=n.get(a.id);if(!u)continue;if(!this._commentManager){r.push(a);continue}o.elements=u}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;o.data=a;const l=Ll.create(o);if(!l.isRenderable)continue;if(!c&&(this.#n.push(l),a.popupRef)){const u=n.get(a.popupRef);u?u.push(l):n.set(a.popupRef,[l])}const h=l.render();a.hidden&&(h.style.visibility="hidden"),l._isEditable&&(this.#s.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}await this.#l();for(const a of r){const c=o.elements=n.get(a.id);o.data=a;const l=Ll.create(o);if(!l.isRenderable)continue;const h=l.render();l.contentElement.id=`${Tn}${a.id}`,a.hidden&&(h.style.visibility="hidden"),c.at(-1).container.after(h)}this.#c()}async#l(){if(this.#n.length===0)return;this.div.replaceChildren();const t=[];if(!this.#a){this.#a=!0;for(const{contentElement:s,data:{id:n}}of this.#n){const r=s.id=`${Tn}${n}`;t.push(this.#o?.getAriaAttributes(r).then(o=>{if(o)for(const[a,c]of o)s.setAttribute(a,c)}))}}this.#n.sort(({data:{rect:[s,n,r,o]}},{data:{rect:[a,c,l,h]}})=>{if(s===r&&n===o)return 1;if(a===l&&c===h)return-1;const u=o,p=n,g=(n+o)/2,y=h,m=c,v=(c+h)/2;if(g>=y&&v<=p)return-1;if(v>=u&&g<=m)return 1;const w=(s+r)/2,E=(a+l)/2;return w-E});const e=document.createDocumentFragment();for(const s of this.#n)e.append(s.container),this._commentManager?(s.extraPopupElement?.popup||s.popup)?.renderCommentButton():s.extraPopupElement&&e.append(s.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),this.#t)for(const s of this.#n)this.#t.addPointerInTextLayer(s.contentElement,!1)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#r,svgFactory:new sc,parent:this};for(const s of t){s.borderStyle||=id._defaultBorderStyle,e.data=s;const n=Ll.create(e);n.isRenderable&&(n.render(),n.contentElement.id=`${Tn}${s.id}`,this.#n.push(n))}await this.#l()}update({viewport:t}){const e=this.div;this.viewport=t,tn(e,{rotation:t.rotation}),this.#c(),e.hidden=!1}#c(){if(!this.#e)return;const t=this.div;for(const[e,s]of this.#e){const n=t.querySelector(`[data-annotation-id="${e}"]`);if(!n)continue;s.className="annotationContent";const{firstChild:r}=n;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):n.append(s);const o=this.#s.get(e);o&&(o._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,n.id,s),o._hasNoCanvas=!1):o.canvas=s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(t){return this.#s.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:s,rotation:n}=t,r=new rx({data:{id:s,rect:t.getPDFRect(),rotation:n},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#i});return r.render(),r.contentElement.id=`${Tn}${s}`,r.createOrUpdatePopup(),this.#n.push(r),r}removeAnnotation(t){const e=this.#n.findIndex(n=>n.data.id===t);if(e<0)return;const[s]=this.#n.splice(e,1);this.#t?.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);this.#l()}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return nt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:wn.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const ha=/\r\n?|\n/g;class ce extends X{#t="";#e=`${this.id}-editor`;#i=null;#s;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=ce.prototype,e=r=>r.isEmpty(),s=Ei.TRANSLATE_SMALL,n=Ei.TRANSLATE_BIG;return nt(this,"_keyboardManager",new ko([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}]]))}static _type="freetext";static _editorType=ot.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||ce._defaultColor||X._defaultLineColor,this.#s=t.fontSize||ce._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(t,e){X.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case _t.FREETEXT_SIZE:ce._defaultFontSize=e;break;case _t.FREETEXT_COLOR:ce._defaultColor=e;break}}updateParams(t,e){switch(t){case _t.FREETEXT_SIZE:this.#o(e);break;case _t.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[_t.FREETEXT_SIZE,ce._defaultFontSize],[_t.FREETEXT_COLOR,ce._defaultColor||X._defaultLineColor]]}get propertiesToUpdate(){return[[_t.FREETEXT_SIZE,this.#s],[_t.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new co(this),[["colorPicker",this._colorPicker]]}get colorType(){return _t.FREETEXT_COLOR}#o(t){const e=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-this.#s)*this.parentScale),this.#s=n,this.#a()},s=this.#s;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_t.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(t){const e=n=>{this.color=n,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_t.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-ce._internalPadding*t,-(ce._internalPadding+this.#s)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#n(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(ce.#l(s)),e=s);return t.join(`
`)}#a(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:n,div:r}=this,o=r.style.display,a=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",n.div.append(this.div),s=r.getBoundingClientRect(),r.remove(),r.style.display=o,r.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/e):(this.width=s.height/t,this.height=s.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#n().trimEnd();if(t===e)return;const s=n=>{if(this.#t=n,!n){this.remove();return}this.#c(),this._uiManager.rebuild(this),this.#a()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#a()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){ce._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,r]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[a,c]=this.getInitialTranslation();[a,c]=this.pageTranslationToScreen(a,c);const[l,h]=this.pageDimensions,[u,p]=this.pageTranslation;let g,y;switch(this.rotation){case 0:g=t+(o[0]-u)/l,y=e+this.height-(o[1]-p)/h;break;case 90:g=t+(o[0]-u)/l,y=e-(o[1]-p)/h,[a,c]=[c,-a];break;case 180:g=t-this.width+(o[0]-u)/l,y=e-(o[1]-p)/h,[a,c]=[-a,-c];break;case 270:g=t+(o[0]-u-this.height*h)/l,y=e+(o[1]-p-this.width*l)/h,[a,c]=[-c,a];break}this.setAt(g*n,y*r,a,c)}else this._moveAfterPaste(t,e);this.#c(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#l(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(ha,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:s}=e;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const n=ce.#u(e.getData("text")||"").replaceAll(ha,`
`);if(!n)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const o=r.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:a,startOffset:c}=o,l=[],h=[];if(a.nodeType===Node.TEXT_NODE){const g=a.parentElement;if(h.push(a.nodeValue.slice(c).replaceAll(ha,"")),g!==this.editorDiv){let y=l;for(const m of this.editorDiv.childNodes){if(m===g){y=h;continue}y.push(ce.#l(m))}}l.push(a.nodeValue.slice(0,c).replaceAll(ha,""))}else if(a===this.editorDiv){let g=l,y=0;for(const m of this.editorDiv.childNodes)y++===c&&(g=h),g.push(ce.#l(m))}this.#t=`${l.join(`
`)}${n}${h.join(`
`)}`,this.#c();const u=new Range;let p=Math.sumPrecise(l.map(g=>g.length));for(const{firstChild:g}of this.editorDiv.childNodes)if(g.nodeType===Node.TEXT_NODE){const y=g.nodeValue.length;if(p<=y){u.setStart(g,p),u.setEnd(g,p);break}p-=y}r.removeAllRanges(),r.addRange(u)}#c(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#d(){return this.#t.replaceAll(""," ")}static#u(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=ce._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,s){let n=null;if(t instanceof Kv){const{data:{defaultAppearanceData:{fontSize:o,fontColor:a},rect:c,rotation:l,id:h,popupRef:u,richText:p,contentsObj:g,creationDate:y,modificationDate:m},textContent:v,textPosition:w,parent:{page:{pageNumber:E}}}=t;if(!v||v.length===0)return null;n=t={annotationType:ot.FREETEXT,color:Array.from(a),fontSize:o,value:v.join(`
`),position:w,pageIndex:E-1,rect:c.slice(0),rotation:l,annotationElementId:h,id:h,deleted:!1,popupRef:u,comment:g?.str||null,richText:p,creationDate:y,modificationDate:m}}const r=await super.deserialize(t,e,s);return r.#s=t.fontSize,r.color=H.makeHexColor(...t.color),r.#t=ce.#u(t.value),r._initialData=n,t.comment&&r.setCommentData(t),r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=X._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(t),{color:e,fontSize:this.#s,value:this.#d()});return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!this.#f(s)?null:(s.id=this.annotationElementId,s)}#f(t){const{value:e,fontSize:s,color:n,pageIndex:r}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((o,a)=>o!==n[a])||t.pageIndex!==r}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:s}=e;s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,e.replaceChildren();for(const n of this.#t.split(`
`)){const r=document.createElement("div");r.append(n?document.createTextNode(n):document.createElement("br")),e.append(r)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class W{static PRECISION=1e-4;toSVGPath(){Pt("Abstract method `toSVGPath` must be implemented.")}get box(){Pt("Abstract getter `box` must be implemented.")}serialize(t,e){Pt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,n,r,o){o||=new Float32Array(t.length);for(let a=0,c=t.length;a<c;a+=2)o[a]=e+t[a]*n,o[a+1]=s+t[a+1]*r;return o}static _rescaleAndSwap(t,e,s,n,r,o){o||=new Float32Array(t.length);for(let a=0,c=t.length;a<c;a+=2)o[a]=e+t[a+1]*n,o[a+1]=s+t[a]*r;return o}static _translate(t,e,s,n){n||=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r+=2)n[r]=e+t[r],n[r+1]=s+t[r+1];return n}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,n,r){switch(r){case 90:return[1-e/s,t/n];case 180:return[1-t/s,1-e/n];case 270:return[e/s,1-t/n];default:return[t/s,e/n]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,n,r,o){return[(t+5*s)/6,(e+5*n)/6,(5*s+r)/6,(5*n+o)/6,(s+r)/2,(n+o)/2]}}class Bi{#t;#e=[];#i;#s;#o=[];#r=new Float32Array(18);#n;#a;#l;#c;#d;#u;#f=[];static#m=8;static#g=2;static#h=Bi.#m+Bi.#g;constructor({x:t,y:e},s,n,r,o,a=0){this.#t=s,this.#u=r*n,this.#s=o,this.#r.set([NaN,NaN,NaN,NaN,t,e],6),this.#i=a,this.#c=Bi.#m*n,this.#l=Bi.#h*n,this.#d=n,this.#f.push(t,e)}isEmpty(){return isNaN(this.#r[8])}#p(){const t=this.#r.subarray(4,6),e=this.#r.subarray(16,18),[s,n,r,o]=this.#t;return[(this.#n+(t[0]-e[0])/2-s)/r,(this.#a+(t[1]-e[1])/2-n)/o,(this.#n+(e[0]-t[0])/2-s)/r,(this.#a+(e[1]-t[1])/2-n)/o]}add({x:t,y:e}){this.#n=t,this.#a=e;const[s,n,r,o]=this.#t;let[a,c,l,h]=this.#r.subarray(8,12);const u=t-l,p=e-h,g=Math.hypot(u,p);if(g<this.#l)return!1;const y=g-this.#c,m=y/g,v=m*u,w=m*p;let E=a,A=c;a=l,c=h,l+=v,h+=w,this.#f?.push(t,e);const P=-w/y,x=v/y,M=P*this.#u,S=x*this.#u;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([l+M,h+S],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([l-M,h-S],16),isNaN(this.#r[6])?(this.#o.length===0&&(this.#r.set([a+M,c+S],2),this.#o.push(NaN,NaN,NaN,NaN,(a+M-s)/r,(c+S-n)/o),this.#r.set([a-M,c-S],14),this.#e.push(NaN,NaN,NaN,NaN,(a-M-s)/r,(c-S-n)/o)),this.#r.set([E,A,a,c,l,h],6),!this.isEmpty()):(this.#r.set([E,A,a,c,l,h],6),Math.abs(Math.atan2(A-c,E-a)-Math.atan2(w,v))<Math.PI/2?([a,c,l,h]=this.#r.subarray(2,6),this.#o.push(NaN,NaN,NaN,NaN,((a+l)/2-s)/r,((c+h)/2-n)/o),[a,c,E,A]=this.#r.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((E+a)/2-s)/r,((A+c)/2-n)/o),!0):([E,A,a,c,l,h]=this.#r.subarray(0,6),this.#o.push(((E+5*a)/6-s)/r,((A+5*c)/6-n)/o,((5*a+l)/6-s)/r,((5*c+h)/6-n)/o,((a+l)/2-s)/r,((c+h)/2-n)/o),[l,h,a,c,E,A]=this.#r.subarray(12,18),this.#e.push(((E+5*a)/6-s)/r,((A+5*c)/6-n)/o,((5*a+l)/6-s)/r,((5*c+h)/6-n)/o,((a+l)/2-s)/r,((c+h)/2-n)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#o,e=this.#e;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#_();const s=[];s.push(`M${t[4]} ${t[5]}`);for(let n=6;n<t.length;n+=6)isNaN(t[n])?s.push(`L${t[n+4]} ${t[n+5]}`):s.push(`C${t[n]} ${t[n+1]} ${t[n+2]} ${t[n+3]} ${t[n+4]} ${t[n+5]}`);this.#y(s);for(let n=e.length-6;n>=6;n-=6)isNaN(e[n])?s.push(`L${e[n+4]} ${e[n+5]}`):s.push(`C${e[n]} ${e[n+1]} ${e[n+2]} ${e[n+3]} ${e[n+4]} ${e[n+5]}`);return this.#v(s),s.join(" ")}#_(){const[t,e,s,n]=this.#t,[r,o,a,c]=this.#p();return`M${(this.#r[2]-t)/s} ${(this.#r[3]-e)/n} L${(this.#r[4]-t)/s} ${(this.#r[5]-e)/n} L${r} ${o} L${a} ${c} L${(this.#r[16]-t)/s} ${(this.#r[17]-e)/n} L${(this.#r[14]-t)/s} ${(this.#r[15]-e)/n} Z`}#v(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#y(t){const[e,s,n,r]=this.#t,o=this.#r.subarray(4,6),a=this.#r.subarray(16,18),[c,l,h,u]=this.#p();t.push(`L${(o[0]-e)/n} ${(o[1]-s)/r} L${c} ${l} L${h} ${u} L${(a[0]-e)/n} ${(a[1]-s)/r}`)}newFreeDrawOutline(t,e,s,n,r,o){return new Jv(t,e,s,n,r,o)}getOutlines(){const t=this.#o,e=this.#e,s=this.#r,[n,r,o,a]=this.#t,c=new Float32Array((this.#f?.length??0)+2);for(let u=0,p=c.length-2;u<p;u+=2)c[u]=(this.#f[u]-n)/o,c[u+1]=(this.#f[u+1]-r)/a;if(c[c.length-2]=(this.#n-n)/o,c[c.length-1]=(this.#a-r)/a,isNaN(s[6])&&!this.isEmpty())return this.#S(c);const l=new Float32Array(this.#o.length+24+this.#e.length);let h=t.length;for(let u=0;u<h;u+=2){if(isNaN(t[u])){l[u]=l[u+1]=NaN;continue}l[u]=t[u],l[u+1]=t[u+1]}h=this.#w(l,h);for(let u=e.length-6;u>=6;u-=6)for(let p=0;p<6;p+=2){if(isNaN(e[u+p])){l[h]=l[h+1]=NaN,h+=2;continue}l[h]=e[u+p],l[h+1]=e[u+p+1],h+=2}return this.#E(l,h),this.newFreeDrawOutline(l,c,this.#t,this.#d,this.#i,this.#s)}#S(t){const e=this.#r,[s,n,r,o]=this.#t,[a,c,l,h]=this.#p(),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(e[2]-s)/r,(e[3]-n)/o,NaN,NaN,NaN,NaN,(e[4]-s)/r,(e[5]-n)/o,NaN,NaN,NaN,NaN,a,c,NaN,NaN,NaN,NaN,l,h,NaN,NaN,NaN,NaN,(e[16]-s)/r,(e[17]-n)/o,NaN,NaN,NaN,NaN,(e[14]-s)/r,(e[15]-n)/o],0),this.newFreeDrawOutline(u,t,this.#t,this.#d,this.#i,this.#s)}#E(t,e){const s=this.#e;return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6}#w(t,e){const s=this.#r.subarray(4,6),n=this.#r.subarray(16,18),[r,o,a,c]=this.#t,[l,h,u,p]=this.#p();return t.set([NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/c,NaN,NaN,NaN,NaN,l,h,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(n[0]-r)/a,(n[1]-o)/c],e),e+=24}}class Jv extends W{#t;#e=new Float32Array(4);#i;#s;#o;#r;#n;constructor(t,e,s,n,r,o){super(),this.#n=t,this.#o=e,this.#t=s,this.#r=n,this.#i=r,this.#s=o,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#a(o);const[a,c,l,h]=this.#e;for(let u=0,p=t.length;u<p;u+=2)t[u]=(t[u]-a)/l,t[u+1]=(t[u+1]-c)/h;for(let u=0,p=e.length;u<p;u+=2)e[u]=(e[u]-a)/l,e[u+1]=(e[u+1]-c)/h}toSVGPath(){const t=[`M${this.#n[4]} ${this.#n[5]}`];for(let e=6,s=this.#n.length;e<s;e+=6){if(isNaN(this.#n[e])){t.push(`L${this.#n[e+4]} ${this.#n[e+5]}`);continue}t.push(`C${this.#n[e]} ${this.#n[e+1]} ${this.#n[e+2]} ${this.#n[e+3]} ${this.#n[e+4]} ${this.#n[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,n],r){const o=s-t,a=n-e;let c,l;switch(r){case 0:c=W._rescale(this.#n,t,n,o,-a),l=W._rescale(this.#o,t,n,o,-a);break;case 90:c=W._rescaleAndSwap(this.#n,t,e,o,a),l=W._rescaleAndSwap(this.#o,t,e,o,a);break;case 180:c=W._rescale(this.#n,s,e,-o,a),l=W._rescale(this.#o,s,e,-o,a);break;case 270:c=W._rescaleAndSwap(this.#n,s,n,-o,-a),l=W._rescaleAndSwap(this.#o,s,n,-o,-a);break}return{outline:Array.from(c),points:[Array.from(l)]}}#a(t){const e=this.#n;let s=e[4],n=e[5];const r=[s,n,s,n];let o=s,a=n,c=s,l=n;const h=t?Math.max:Math.min,u=new Float32Array(4);for(let g=6,y=e.length;g<y;g+=6){const m=e[g+4],v=e[g+5];isNaN(e[g])?(H.pointBoundingBox(m,v,r),a>v?(o=m,a=v):a===v&&(o=h(o,m)),l<v?(c=m,l=v):l===v&&(c=h(c,m))):(u[0]=u[1]=1/0,u[2]=u[3]=-1/0,H.bezierBoundingBox(s,n,...e.slice(g,g+6),u),H.rectBoundingBox(u[0],u[1],u[2],u[3],r),a>u[1]?(o=u[0],a=u[1]):a===u[1]&&(o=h(o,u[0])),l<u[3]?(c=u[2],l=u[3]):l===u[3]&&(c=h(c,u[2]))),s=m,n=v}const p=this.#e;p[0]=r[0]-this.#i,p[1]=r[1]-this.#i,p[2]=r[2]-r[0]+2*this.#i,p[3]=r[3]-r[1]+2*this.#i,this.firstPoint=[o,a],this.lastPoint=[c,l]}get box(){return this.#e}newOutliner(t,e,s,n,r,o=0){return new Bi(t,e,s,n,r,o)}getNewOutline(t,e){const[s,n,r,o]=this.#e,[a,c,l,h]=this.#t,u=r*l,p=o*h,g=s*l+a,y=n*h+c,m=this.newOutliner({x:this.#o[0]*u+g,y:this.#o[1]*p+y},this.#t,this.#r,t,this.#s,e??this.#i);for(let v=2;v<this.#o.length;v+=2)m.add({x:this.#o[v]*u+g,y:this.#o[v+1]*p+y});return m.getOutlines()}}class Fh{#t;#e;#i;#s=[];#o=[];constructor(t,e=0,s=0,n=!0){const r=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:m,y:v,width:w,height:E}of t){const A=Math.floor((m-e)/o)*o,P=Math.ceil((m+w+e)/o)*o,x=Math.floor((v-e)/o)*o,M=Math.ceil((v+E+e)/o)*o,S=[A,x,M,!0],T=[P,x,M,!1];this.#s.push(S,T),H.rectBoundingBox(A,x,P,M,r)}const a=r[2]-r[0]+2*s,c=r[3]-r[1]+2*s,l=r[0]-s,h=r[1]-s;let u=n?-1/0:1/0,p=1/0;const g=this.#s.at(n?-1:-2),y=[g[0],g[2]];for(const m of this.#s){const[v,w,E,A]=m;!A&&n?w<p?(p=w,u=v):w===p&&(u=Math.max(u,v)):A&&!n&&(w<p?(p=w,u=v):w===p&&(u=Math.min(u,v))),m[0]=(v-l)/a,m[1]=(w-h)/c,m[2]=(E-h)/c}this.#t=new Float32Array([l,h,a,c]),this.#e=[u,p],this.#i=y}getOutlines(){this.#s.sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of this.#s)e[3]?(t.push(...this.#c(e)),this.#a(e)):(this.#l(e),t.push(...this.#c(e)));return this.#r(t)}#r(t){const e=[],s=new Set;for(const o of t){const[a,c,l]=o;e.push([a,c,o],[a,l,o])}e.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=e.length;o<a;o+=2){const c=e[o][2],l=e[o+1][2];c.push(l),l.push(c),s.add(c),s.add(l)}const n=[];let r;for(;s.size>0;){const o=s.values().next().value;let[a,c,l,h,u]=o;s.delete(o);let p=a,g=c;for(r=[a,l],n.push(r);;){let y;if(s.has(h))y=h;else if(s.has(u))y=u;else break;s.delete(y),[a,c,l,h,u]=y,p!==a&&(r.push(p,g,a,g===c?c:l),p=a),g=g===c?l:c}r.push(p,g)}return new Ax(n,this.#t,this.#e,this.#i)}#n(t){const e=this.#o;let s=0,n=e.length-1;for(;s<=n;){const r=s+n>>1,o=e[r][0];if(o===t)return r;o<t?s=r+1:n=r-1}return n+1}#a([,t,e]){const s=this.#n(t);this.#o.splice(s,0,[t,e])}#l([,t,e]){const s=this.#n(t);for(let n=s;n<this.#o.length;n++){const[r,o]=this.#o[n];if(r!==t)break;if(r===t&&o===e){this.#o.splice(n,1);return}}for(let n=s-1;n>=0;n--){const[r,o]=this.#o[n];if(r!==t)break;if(r===t&&o===e){this.#o.splice(n,1);return}}}#c(t){const[e,s,n]=t,r=[[e,s,n]],o=this.#n(n);for(let a=0;a<o;a++){const[c,l]=this.#o[a];for(let h=0,u=r.length;h<u;h++){const[,p,g]=r[h];if(!(l<=p||g<=c)){if(p>=c){if(g>l)r[h][1]=l;else{if(u===1)return[];r.splice(h,1),h--,u--}continue}r[h][2]=c,g>l&&r.push([e,l,g])}}}return r}}class Ax extends W{#t;#e;constructor(t,e,s,n){super(),this.#e=t,this.#t=e,this.firstPoint=s,this.lastPoint=n}toSVGPath(){const t=[];for(const e of this.#e){let[s,n]=e;t.push(`M${s} ${n}`);for(let r=2;r<e.length;r+=2){const o=e[r],a=e[r+1];o===s?(t.push(`V${a}`),n=a):a===n&&(t.push(`H${o}`),s=o)}t.push("Z")}return t.join(" ")}serialize([t,e,s,n],r){const o=[],a=s-t,c=n-e;for(const l of this.#e){const h=new Array(l.length);for(let u=0;u<l.length;u+=2)h[u]=t+l[u]*a,h[u+1]=n-l[u+1]*c;o.push(h)}return o}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class Vh extends Bi{newFreeDrawOutline(t,e,s,n,r,o){return new Ex(t,e,s,n,r,o)}}class Ex extends Jv{newOutliner(t,e,s,n,r,o=0){return new Vh(t,e,s,n,r,o)}}class qt extends X{#t=null;#e=0;#i;#s=null;#o=null;#r=null;#n=null;#a=0;#l=null;#c=null;#d=null;#u=!1;#f=null;#m=null;#g=null;#h="";#p;#_="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=ot.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=qt.prototype;return nt(this,"_keyboardManager",new ko([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||qt._defaultColor,this.#p=t.thickness||qt._defaultThickness,this.opacity=t.opacity||qt._defaultOpacity,this.#i=t.boxes||null,this.#_=t.methodOfCreation||"",this.#h=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#u=!0,this.#y(t),this.#b()):this.#i&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#n=t.focusNode,this.#a=t.focusOffset,this.#v(),this.#b(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#u?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#_}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#v(){const t=new Fh(this.#i,.001);this.#c=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const e=new Fh(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#r=e.getOutlines();const{firstPoint:s}=this.#c;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height];const{lastPoint:n}=this.#r;this.#m=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#y({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#c=t;const n=1.5;if(this.#r=t.getNewOutline(this.#p/2+n,.0025),e>=0)this.#d=e,this.#s=s,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#g=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const u=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:qt.#T(this.#c.box,(u-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#g,{bbox:qt.#T(this.#r.box,u),path:{d:this.#r.toSVGPath()}})}const[r,o,a,c]=t.box;switch(this.rotation){case 0:this.x=r,this.y=o,this.width=a,this.height=c;break;case 90:{const[u,p]=this.parentDimensions;this.x=o,this.y=1-r,this.width=a*p/u,this.height=c*u/p;break}case 180:this.x=1-r,this.y=1-o,this.width=a,this.height=c;break;case 270:{const[u,p]=this.parentDimensions;this.x=1-o,this.y=r,this.width=a*p/u,this.height=c*u/p;break}}const{firstPoint:l}=t;this.#f=[(l[0]-r)/a,(l[1]-o)/c];const{lastPoint:h}=this.#r;this.#m=[(h[0]-r)/a,(h[1]-o)/c]}static initialize(t,e){X.initialize(t,e),qt._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case _t.HIGHLIGHT_COLOR:qt._defaultColor=e;break;case _t.HIGHLIGHT_THICKNESS:qt._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case _t.HIGHLIGHT_COLOR:this.#S(e);break;case _t.HIGHLIGHT_THICKNESS:this.#E(e);break}}static get defaultPropertiesToUpdate(){return[[_t.HIGHLIGHT_COLOR,qt._defaultColor],[_t.HIGHLIGHT_THICKNESS,qt._defaultThickness]]}get propertiesToUpdate(){return[[_t.HIGHLIGHT_COLOR,this.color||qt._defaultColor],[_t.HIGHLIGHT_THICKNESS,this.#p||qt._defaultThickness],[_t.HIGHLIGHT_FREE,this.#u]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#o?.updateColor(this.color),super.onUpdatedColor()}#S(t){const e=(r,o)=>{this.color=r,this.opacity=o,this.onUpdatedColor()},s=this.color,n=this.opacity;this.addCommands({cmd:e.bind(this,t,qt._defaultOpacity),undo:e.bind(this,s,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_t.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#E(t){const e=this.#p,s=n=>{this.#p=n,this.#w(n)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_t.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#o=new Ke({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#R())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#R())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#C(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#b(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#C():t&&(this.#b(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#w(t){this.#u&&(this.#y({highlightOutlines:this.#c.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())}#C(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#g),this.#g=null)}#b(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#s}=t.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#u},path:{d:this.#c.toSVGPath()}},!1,!0),this.#g=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#u},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#u),this.#l&&(this.#l.style.clipPath=this.#s))}static#T([t,e,s,n],r){switch(r){case 90:return[1-e-n,t,n,s];case 180:return[1-t-s,1-e-n,s,n];case 270:return[e,1-t-s,n,s]}return[t,e,s,n]}rotate(t){const{drawLayer:e}=this.parent;let s;this.#u?(t=(t-this.rotation+360)%360,s=qt.#T(this.#c.box,t)):s=qt.#T([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:s,root:{"data-main-rotation":t}}),e.updateProperties(this.#g,{bbox:qt.#T(this.#r.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#h&&(t.setAttribute("aria-label",this.#h),t.setAttribute("role","mark")),this.#u?t.classList.add("free"):this.div.addEventListener("keydown",this.#x.bind(this),{signal:this._uiManager._signal});const e=this.#l=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#s,this.setDims(),Pv(this,this.#l,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1}})}#x(t){qt._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#P(!0);break;case 1:case 3:this.#P(!1);break}}#P(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#n,this.#a)}select(){super.select(),this.#g&&this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#g&&(this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{selected:!1}}),this.#u||this.#P(!1))}get _mustFixPosition(){return!this.#u}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#g,{rootClass:{hidden:!t}}))}#R(){return this.#u?this.rotation:0}#F(){if(this.#u)return null;const[t,e]=this.pageDimensions,[s,n]=this.pageTranslation,r=this.#i,o=new Float32Array(r.length*8);let a=0;for(const{x:c,y:l,width:h,height:u}of r){const p=c*t+s,g=(1-l)*e+n;o[a]=o[a+4]=p,o[a+1]=o[a+3]=g,o[a+2]=o[a+6]=p+h*t,o[a+5]=o[a+7]=g-u*e,a+=8}return o}#D(t){return this.#c.serialize(t,this.#R())}static startHighlighting(t,e,{target:s,x:n,y:r}){const{x:o,y:a,width:c,height:l}=s.getBoundingClientRect(),h=new AbortController,u=t.combinedSignal(h),p=g=>{h.abort(),this.#V(t,g)};window.addEventListener("blur",p,{signal:u}),window.addEventListener("pointerup",p,{signal:u}),window.addEventListener("pointerdown",jt,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",Ze,{signal:u}),s.addEventListener("pointermove",this.#N.bind(this,t),{signal:u}),this._freeHighlight=new Vh({x:n,y:r},[o,a,c,l],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#N(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#V(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,s){let n=null;if(t instanceof Yv){const{data:{quadPoints:y,rect:m,rotation:v,id:w,color:E,opacity:A,popupRef:P,richText:x,contentsObj:M,creationDate:S,modificationDate:T},parent:{page:{pageNumber:I}}}=t;n=t={annotationType:ot.HIGHLIGHT,color:Array.from(E),opacity:A,quadPoints:y,boxes:null,pageIndex:I-1,rect:m.slice(0),rotation:v,annotationElementId:w,id:w,deleted:!1,popupRef:P,richText:x,comment:M?.str||null,creationDate:S,modificationDate:T}}else if(t instanceof sd){const{data:{inkLists:y,rect:m,rotation:v,id:w,color:E,borderStyle:{rawWidth:A},popupRef:P,richText:x,contentsObj:M,creationDate:S,modificationDate:T},parent:{page:{pageNumber:I}}}=t;n=t={annotationType:ot.HIGHLIGHT,color:Array.from(E),thickness:A,inkLists:y,boxes:null,pageIndex:I-1,rect:m.slice(0),rotation:v,annotationElementId:w,id:w,deleted:!1,popupRef:P,richText:x,comment:M?.str||null,creationDate:S,modificationDate:T}}const{color:r,quadPoints:o,inkLists:a,opacity:c}=t,l=await super.deserialize(t,e,s);l.color=H.makeHexColor(...r),l.opacity=c||1,a&&(l.#p=t.thickness),l._initialData=n,t.comment&&l.setCommentData(t);const[h,u]=l.pageDimensions,[p,g]=l.pageTranslation;if(o){const y=l.#i=[];for(let m=0;m<o.length;m+=8)y.push({x:(o[m]-p)/h,y:1-(o[m+1]-g)/u,width:(o[m+2]-o[m])/h,height:(o[m+1]-o[m+5])/u});l.#v(),l.#b(),l.rotate(l.rotation)}else if(a){l.#u=!0;const y=a[0],m={x:y[0]-p,y:u-(y[1]-g)},v=new Vh(m,[0,0,h,u],1,l.#p/2,!0,.001);for(let A=0,P=y.length;A<P;A+=2)m.x=y[A]-p,m.y=u-(y[A+1]-g),v.add(m);const{id:w,clipPathId:E}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:l.color,"fill-opacity":l._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:v.toSVGPath()}},!0,!0);l.#y({highlightOutlines:v.getOutlines(),highlightId:w,clipPathId:E}),l.#b(),l.rotate(l.parentRotation)}return l}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=X._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(t);return Object.assign(s,{color:e,opacity:this.opacity,thickness:this.#p,quadPoints:this.#F(),outlines:this.#D(s.rect)}),this.addComment(s),this.annotationElementId&&!this.#L(s)?null:(s.id=this.annotationElementId,s)}#L(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((s,n)=>s!==e[n])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class Zv{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Pt("Not implemented")}}class At extends X{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#s=null;static#o=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#r(t),this.#l())}#r({drawOutlines:t,drawId:e,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#n(t,this.parent),this.#u(t.box)}#n(t,e){const{id:s}=e.drawLayer.draw(At._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[n,r]of Object.entries(e))s.has(n)?Object.assign(t[n],r):t[n]=r;return t}static getDefaultDrawingOptions(t){Pt("Not implemented")}static get typesMap(){Pt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(At.#i.updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,n]of this.typesMap)t.push([s,e[n]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,n]of this.constructor.typesMap)t.push([s,e[n]]);return t}_updateProperty(t,e,s){const n=this._drawingOptions,r=n[e],o=a=>{n.updateProperty(e,a);const c=this.#t.updateProperty(e,a);c&&this.#u(c),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,s),undo:o.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,At._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#d()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,At._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#d()),{bbox:this.#f()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,At._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#d(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#a(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#l(),this.#u(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#a()):t&&(this._uiManager.addShouldRescale(this),this.#l(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#a(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#l(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#n(this.#t,t)}}#c([t,e,s,n]){const{parentDimensions:[r,o],rotation:a}=this;switch(a){case 90:return[e,1-t,s*(o/r),n*(r/o)];case 180:return[1-t,1-e,s,n];case 270:return[1-e,t,s*(o/r),n*(r/o)];default:return[t,e,s,n]}}#d(){const{x:t,y:e,width:s,height:n,parentDimensions:[r,o],rotation:a}=this;switch(a){case 90:return[1-e,t,s*(r/o),n*(o/r)];case 180:return[1-t,1-e,s,n];case 270:return[e,1-t,s*(r/o),n*(o/r)];default:return[t,e,s,n]}}#u(t){[this.x,this.y,this.width,this.height]=this.#c(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:t,y:e,width:s,height:n,rotation:r,parentRotation:o,parentDimensions:[a,c]}=this;switch((r*4+o)/90){case 1:return[1-e-n,t,n,s];case 2:return[1-t-s,1-e-n,s,n];case 3:return[e,1-t-s,n,s];case 4:return[t,e-s*(a/c),n*(c/a),s*(a/c)];case 5:return[1-e,t,s*(a/c),n*(c/a)];case 6:return[1-t-n*(c/a),1-e,n*(c/a),s*(a/c)];case 7:return[e-s*(a/c),1-t-n*(c/a),s*(a/c),n*(c/a)];case 8:return[t-s,e-n,s,n];case 9:return[1-e,t-s,n,s];case 10:return[1-t,1-e,s,n];case 11:return[e-n,1-t,n,s];case 12:return[t-n*(c/a),e,n*(c/a),s*(a/c)];case 13:return[1-e-s*(a/c),t-n*(c/a),s*(a/c),n*(c/a)];case 14:return[1-t,1-e-s*(a/c),n*(c/a),s*(a/c)];case 15:return[e,1-t,s*(a/c),n*(c/a)];default:return[t,e,s,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,At._mergeSVGProperties({bbox:this.#f()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#u(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const s=super.render();s.classList.add("draw");const n=document.createElement("div");return s.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),s}static createDrawerInstance(t,e,s,n,r){Pt("Not implemented")}static startDrawing(t,e,s,n){const{target:r,offsetX:o,offsetY:a,pointerId:c,pointerType:l}=n;if(Et.isInitializedAndDifferentPointerType(l))return;const{viewport:{rotation:h}}=t,{width:u,height:p}=r.getBoundingClientRect(),g=At.#s=new AbortController,y=t.combinedSignal(g);if(Et.setPointer(l,c),window.addEventListener("pointerup",m=>{Et.isSamePointerIdOrRemove(m.pointerId)&&this._endDraw(m)},{signal:y}),window.addEventListener("pointercancel",m=>{Et.isSamePointerIdOrRemove(m.pointerId)&&this._currentParent.endDrawingSession()},{signal:y}),window.addEventListener("pointerdown",m=>{Et.isSamePointerType(m.pointerType)&&(Et.initializeAndAddPointerId(m.pointerId),At.#i.isCancellable()&&(At.#i.removeLastElement(),At.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Ze,{signal:y}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),r.addEventListener("touchmove",m=>{Et.isSameTimeStamp(m.timeStamp)&&jt(m)},{signal:y}),t.toggleDrawing(),e._editorUndoBar?.hide(),At.#i){t.drawLayer.updateProperties(this._currentDrawId,At.#i.startNew(o,a,u,p,h));return}e.updateUIForDefaultProperties(this),At.#i=this.createDrawerInstance(o,a,u,p,h),At.#o=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(At.#o.toSVGProperties(),At.#i.defaultSVGProperties),!0,!1)}static _drawMove(t){if(Et.isSameTimeStamp(t.timeStamp),!At.#i)return;const{offsetX:e,offsetY:s,pointerId:n}=t;if(Et.isSamePointerId(n)){if(Et.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,At.#i.add(e,s)),Et.setTimeStamp(t.timeStamp),jt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,At.#i=null,At.#o=null,Et.clearTimeStamp()),At.#s&&(At.#s.abort(),At.#s=null,Et.clearPointerIds())}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,At.#i.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=At.#i,n=this._currentDrawId,r=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(n,s.setLastElement(r))},undo:()=>{e.drawLayer.updateProperties(n,s.removeLastElement())},mustExec:!1,type:_t.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(_t.DRAW_STEP),!At.#i.isEmpty()){const{pageDimensions:[s,n],scale:r}=e,o=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:At.#i.getOutlines(s*r,n*r,r,this._INNER_MARGIN),drawingOptions:At.#o,mustBeCommitted:!t});return this._cleanup(!0),o}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,n,r,o){Pt("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:a}}=e.viewport,c=this.deserializeDraw(o,a,n,r,this._INNER_MARGIN,t),l=await super.deserialize(t,e,s);return l.createDrawingOptions(t),l.#r({drawOutlines:c}),l.#l(),l.onScaleChanging(),l.rotate(),l}serializeDraw(t){const[e,s]=this.pageTranslation,[n,r]=this.pageDimensions;return this.#t.serialize([e,s,n,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class Tx{#t=new Float64Array(6);#e;#i;#s;#o;#r;#n="";#a=0;#l=new Mo;#c;#d;constructor(t,e,s,n,r,o){this.#c=s,this.#d=n,this.#s=r,this.#o=o,[t,e]=this.#u(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e],this.#i=[{line:a,points:this.#r}],this.#t.set(a,0)}updateProperty(t,e){t==="stroke-width"&&(this.#o=e)}#u(t,e){return W._normalizePoint(t,e,this.#c,this.#d,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#r.length<=10}add(t,e){[t,e]=this.#u(t,e);const[s,n,r,o]=this.#t.subarray(2,6),a=t-r,c=e-o;return Math.hypot(this.#c*a,this.#d*c)<=2?null:(this.#r.push(t,e),isNaN(s)?(this.#t.set([r,o,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,n,r,o,t,e],0),this.#e.push(...W.createBezierPoints(s,n,r,o,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,n,r){this.#c=s,this.#d=n,this.#s=r,[t,e]=this.#u(t,e);const o=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e];const a=this.#i.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#i.push({line:o,points:this.#r}),this.#t.set(o,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(t){return this.#i?(this.#i.push(t),this.#e=t.line,this.#r=t.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#l.setLastElement(t)}removeLastElement(){if(!this.#i)return this.#l.removeLastElement();this.#i.pop(),this.#n="";for(let t=0,e=this.#i.length;t<e;t++){const{line:s,points:n}=this.#i[t];this.#e=s,this.#r=n,this.#a=0,this.toSVGPath()}return{path:{d:this.#n}}}toSVGPath(){const t=W.svgRound(this.#e[4]),e=W.svgRound(this.#e[5]);if(this.#r.length===2)return this.#n=`${this.#n} M ${t} ${e} Z`,this.#n;if(this.#r.length<=6){const n=this.#n.lastIndexOf("M");this.#n=`${this.#n.slice(0,n)} M ${t} ${e}`,this.#a=6}if(this.#r.length===4){const n=W.svgRound(this.#e[10]),r=W.svgRound(this.#e[11]);return this.#n=`${this.#n} L ${n} ${r}`,this.#a=12,this.#n}const s=[];this.#a===0&&(s.push(`M ${t} ${e}`),this.#a=6);for(let n=this.#a,r=this.#e.length;n<r;n+=6){const[o,a,c,l,h,u]=this.#e.slice(n,n+6).map(W.svgRound);s.push(`C${o} ${a} ${c} ${l} ${h} ${u}`)}return this.#n+=s.join(" "),this.#a=this.#e.length,this.#n}getOutlines(t,e,s,n){const r=this.#i.at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),this.#l.build(this.#i,t,e,s,this.#s,this.#o,n),this.#t=null,this.#e=null,this.#i=null,this.#n=null,this.#l}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Mo extends W{#t;#e=0;#i;#s;#o;#r;#n;#a;#l;build(t,e,s,n,r,o,a){this.#o=e,this.#r=s,this.#n=n,this.#a=r,this.#l=o,this.#i=a??0,this.#s=t,this.#u()}get thickness(){return this.#l}setLastElement(t){return this.#s.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#s){if(t.push(`M${W.svgRound(e[4])} ${W.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${W.svgRound(e[10])} ${W.svgRound(e[11])}`);continue}for(let s=6,n=e.length;s<n;s+=6){const[r,o,a,c,l,h]=e.subarray(s,s+6).map(W.svgRound);t.push(`C${r} ${o} ${a} ${c} ${l} ${h}`)}}return t.join("")}serialize([t,e,s,n],r){const o=[],a=[],[c,l,h,u]=this.#d();let p,g,y,m,v,w,E,A,P;switch(this.#a){case 0:P=W._rescale,p=t,g=e+n,y=s,m=-n,v=t+c*s,w=e+(1-l-u)*n,E=t+(c+h)*s,A=e+(1-l)*n;break;case 90:P=W._rescaleAndSwap,p=t,g=e,y=s,m=n,v=t+l*s,w=e+c*n,E=t+(l+u)*s,A=e+(c+h)*n;break;case 180:P=W._rescale,p=t+s,g=e,y=-s,m=n,v=t+(1-c-h)*s,w=e+l*n,E=t+(1-c)*s,A=e+(l+u)*n;break;case 270:P=W._rescaleAndSwap,p=t+s,g=e+n,y=-s,m=-n,v=t+(1-l-u)*s,w=e+(1-c-h)*n,E=t+(1-l)*s,A=e+(1-c)*n;break}for(const{line:x,points:M}of this.#s)o.push(P(x,p,g,y,m,r?new Array(x.length):null)),a.push(P(M,p,g,y,m,r?new Array(M.length):null));return{lines:o,points:a,rect:[v,w,E,A]}}static deserialize(t,e,s,n,r,{paths:{lines:o,points:a},rotation:c,thickness:l}){const h=[];let u,p,g,y,m;switch(c){case 0:m=W._rescale,u=-t/s,p=e/n+1,g=1/s,y=-1/n;break;case 90:m=W._rescaleAndSwap,u=-e/n,p=-t/s,g=1/n,y=1/s;break;case 180:m=W._rescale,u=t/s+1,p=-e/n,g=-1/s,y=1/n;break;case 270:m=W._rescaleAndSwap,u=e/n+1,p=t/s+1,g=-1/n,y=-1/s;break}if(!o){o=[];for(const w of a){const E=w.length;if(E===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(E===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const A=new Float32Array(3*(E-2));o.push(A);let[P,x,M,S]=w.subarray(0,4);A.set([NaN,NaN,NaN,NaN,P,x],0);for(let T=4;T<E;T+=2){const I=w[T],k=w[T+1];A.set(W.createBezierPoints(P,x,M,S,I,k),(T-2)*3),[P,x,M,S]=[M,S,I,k]}}}for(let w=0,E=o.length;w<E;w++)h.push({line:m(o[w].map(A=>A??NaN),u,p,g,y),points:m(a[w].map(A=>A??NaN),u,p,g,y)});const v=new this.prototype.constructor;return v.build(h,s,n,1,c,l,r),v}#c(t=this.#l){const e=this.#i+t/2*this.#n;return this.#a%180===0?[e/this.#o,e/this.#r]:[e/this.#r,e/this.#o]}#d(){const[t,e,s,n]=this.#t,[r,o]=this.#c(0);return[t+r,e+o,s-2*r,n-2*o]}#u(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:n}of this.#s){if(n.length<=12){for(let a=4,c=n.length;a<c;a+=6)H.pointBoundingBox(n[a],n[a+1],t);continue}let r=n[4],o=n[5];for(let a=6,c=n.length;a<c;a+=6){const[l,h,u,p,g,y]=n.subarray(a,a+6);H.bezierBoundingBox(r,o,l,h,u,p,g,y,t),r=g,o=y}}const[e,s]=this.#c();t[0]=Re(t[0]-e,0,1),t[1]=Re(t[1]-s,0,1),t[2]=Re(t[2]+e,0,1),t[3]=Re(t[3]+s,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,s]=this.#c();this.#l=t;const[n,r]=this.#c(),[o,a]=[n-e,r-s],c=this.#t;return c[0]-=o,c[1]-=a,c[2]+=2*o,c[3]+=2*a,c}updateParentDimensions([t,e],s){const[n,r]=this.#c();this.#o=t,this.#r=e,this.#n=s;const[o,a]=this.#c(),c=o-n,l=a-r,h=this.#t;return h[0]-=c,h[1]-=l,h[2]+=2*c,h[3]+=2*l,h}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(W.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let s=0,n=0,r=0,o=0,a=0,c=0;switch(this.#e){case 90:n=e/t,r=-t/e,a=t;break;case 180:s=-1,o=-1,a=t,c=e;break;case 270:n=-e/t,r=t/e,c=e;break;default:return""}return`matrix(${s} ${n} ${r} ${o} ${W.svgRound(a)} ${W.svgRound(c)})`}getPathResizingSVGProperties([t,e,s,n]){const[r,o]=this.#c(),[a,c,l,h]=this.#t;if(Math.abs(l-r)<=W.PRECISION||Math.abs(h-o)<=W.PRECISION){const m=t+s/2-(a+l/2),v=e+n/2-(c+h/2);return{path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(e)}`,transform:`${this.rotationTransform} translate(${m} ${v})`}}}const u=(s-2*r)/(l-2*r),p=(n-2*o)/(h-2*o),g=l/s,y=h/n;return{path:{"transform-origin":`${W.svgRound(a)} ${W.svgRound(c)}`,transform:`${this.rotationTransform} scale(${g} ${y}) translate(${W.svgRound(r)} ${W.svgRound(o)}) scale(${u} ${p}) translate(${W.svgRound(-r)} ${W.svgRound(-o)})`}}}getPathResizedSVGProperties([t,e,s,n]){const[r,o]=this.#c(),a=this.#t,[c,l,h,u]=a;if(a[0]=t,a[1]=e,a[2]=s,a[3]=n,Math.abs(h-r)<=W.PRECISION||Math.abs(u-o)<=W.PRECISION){const v=t+s/2-(c+h/2),w=e+n/2-(l+u/2);for(const{line:E,points:A}of this.#s)W._translate(E,v,w,E),W._translate(A,v,w,A);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(s-2*r)/(h-2*r),g=(n-2*o)/(u-2*o),y=-p*(c+r)+t+r,m=-g*(l+o)+e+o;if(p!==1||g!==1||y!==0||m!==0)for(const{line:v,points:w}of this.#s)W._rescale(v,y,m,p,g,v),W._rescale(w,y,m,p,g,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[n,r]=s,o=this.#t,a=t-o[0],c=e-o[1];if(this.#o===n&&this.#r===r)for(const{line:l,points:h}of this.#s)W._translate(l,a,c,l),W._translate(h,a,c,h);else{const l=this.#o/n,h=this.#r/r;this.#o=n,this.#r=r;for(const{line:u,points:p}of this.#s)W._rescale(u,a,c,l,h,u),W._rescale(p,a,c,l,h,p);o[2]*=l,o[3]*=h}return o[0]=t,o[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${W.svgRound(t)} ${W.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${W.svgRound(t[0])} ${W.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class $c extends Zv{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:X._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new $c(this._viewParameters);return t.updateAll(this),t}}class nd extends At{static _type="ink";static _editorType=ot.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){X.initialize(t,e),this._defaultDrawingOptions=new $c(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return nt(this,"typesMap",new Map([[_t.INK_THICKNESS,"stroke-width"],[_t.INK_COLOR,"stroke"],[_t.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,n,r){return new Tx(t,e,s,n,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,n,r,o){return Mo.deserialize(t,e,s,n,r,o)}static async deserialize(t,e,s){let n=null;if(t instanceof sd){const{data:{inkLists:o,rect:a,rotation:c,id:l,color:h,opacity:u,borderStyle:{rawWidth:p},popupRef:g,richText:y,contentsObj:m,creationDate:v,modificationDate:w},parent:{page:{pageNumber:E}}}=t;n=t={annotationType:ot.INK,color:Array.from(h),thickness:p,opacity:u,paths:{points:o},boxes:null,pageIndex:E-1,rect:a.slice(0),rotation:c,annotationElementId:l,id:l,deleted:!1,popupRef:g,richText:y,comment:m?.str||null,creationDate:v,modificationDate:w}}const r=await super.deserialize(t,e,s);return r._initialData=n,t.comment&&r.setCommentData(t),r}get toolbarButtons(){return this._colorPicker||=new co(this),[["colorPicker",this._colorPicker]]}get colorType(){return _t.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=nd.getDefaultDrawingOptions({stroke:H.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{stroke:n,"stroke-opacity":r,"stroke-width":o}}=this,a=Object.assign(super.serialize(t),{color:X._colorManager.convert(n),opacity:r,thickness:o,paths:{lines:e,points:s}});return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#t(a)?null:(a.id=this.annotationElementId,a)}#t(t){const{color:e,thickness:s,opacity:n,pageIndex:r}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((o,a)=>o!==e[a])||t.thickness!==s||t.opacity!==n||t.pageIndex!==r}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class Bh extends Mo{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const ua=8,Er=3;class En{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,s,n){return s-=t,n-=e,s===0?n>0?0:4:s===1?n+6:2-n}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#s(t,e,s,n,r,o,a){const c=this.#e(s,n,r,o);for(let l=0;l<8;l++){const h=(-l+c-a+16)%8,u=this.#i[2*h],p=this.#i[2*h+1];if(t[(s+u)*e+(n+p)]!==0)return h}return-1}static#o(t,e,s,n,r,o,a){const c=this.#e(s,n,r,o);for(let l=0;l<8;l++){const h=(l+c+a+16)%8,u=this.#i[2*h],p=this.#i[2*h+1];if(t[(s+u)*e+(n+p)]!==0)return h}return-1}static#r(t,e,s,n){const r=t.length,o=new Int32Array(r);for(let h=0;h<r;h++)o[h]=t[h]<=n?1:0;for(let h=1;h<s-1;h++)o[h*e]=o[h*e+e-1]=0;for(let h=0;h<e;h++)o[h]=o[e*s-1-h]=0;let a=1,c;const l=[];for(let h=1;h<s-1;h++){c=1;for(let u=1;u<e-1;u++){const p=h*e+u,g=o[p];if(g===0)continue;let y=h,m=u;if(g===1&&o[p-1]===0)a+=1,m-=1;else if(g>=1&&o[p+1]===0)a+=1,m+=1,g>1&&(c=g);else{g!==1&&(c=Math.abs(g));continue}const v=[u,h],w=m===u+1,E={isHole:w,points:v,id:a,parent:0};l.push(E);let A;for(const R of l)if(R.id===c){A=R;break}A?A.isHole?E.parent=w?A.parent:c:E.parent=w?c:A.parent:E.parent=w?c:0;const P=this.#s(o,e,h,u,y,m,0);if(P===-1){o[p]=-a,o[p]!==1&&(c=Math.abs(o[p]));continue}let x=this.#i[2*P],M=this.#i[2*P+1];const S=h+x,T=u+M;y=S,m=T;let I=h,k=u;for(;;){const R=this.#o(o,e,I,k,y,m,1);x=this.#i[2*R],M=this.#i[2*R+1];const N=I+x,D=k+M;v.push(D,N);const J=I*e+k;if(o[J+1]===0?o[J]=-a:o[J]===1&&(o[J]=a),N===h&&D===u&&I===S&&k===T){o[p]!==1&&(c=Math.abs(o[p]));break}else y=I,m=k,I=N,k=D}}}return l}static#n(t,e,s,n){if(s-e<=4){for(let S=e;S<s-2;S+=2)n.push(t[S],t[S+1]);return}const r=t[e],o=t[e+1],a=t[s-4]-r,c=t[s-3]-o,l=Math.hypot(a,c),h=a/l,u=c/l,p=h*o-u*r,g=c/a,y=1/l,m=Math.atan(g),v=Math.cos(m),w=Math.sin(m),E=y*(Math.abs(v)+Math.abs(w)),A=y*(1-E+E**2),P=Math.max(Math.atan(Math.abs(w+v)*A),Math.atan(Math.abs(w-v)*A));let x=0,M=e;for(let S=e+2;S<s-2;S+=2){const T=Math.abs(p-h*t[S+1]+u*t[S]);T>x&&(M=S,x=T)}x>(l*P)**2?(this.#n(t,e,M+2,n),this.#n(t,M,s,n)):n.push(r,o)}static#a(t){const e=[],s=t.length;return this.#n(t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e}static#l(t,e,s,n,r,o){const a=new Float32Array(o**2),c=-2*n**2,l=o>>1;for(let m=0;m<o;m++){const v=(m-l)**2;for(let w=0;w<o;w++)a[m*o+w]=Math.exp((v+(w-l)**2)/c)}const h=new Float32Array(256),u=-2*r**2;for(let m=0;m<256;m++)h[m]=Math.exp(m**2/u);const p=t.length,g=new Uint8Array(p),y=new Uint32Array(256);for(let m=0;m<s;m++)for(let v=0;v<e;v++){const w=m*e+v,E=t[w];let A=0,P=0;for(let M=0;M<o;M++){const S=m+M-l;if(!(S<0||S>=s))for(let T=0;T<o;T++){const I=v+T-l;if(I<0||I>=e)continue;const k=t[S*e+I],R=a[M*o+T]*h[Math.abs(k-E)];A+=k*R,P+=R}}const x=g[w]=Math.round(A/P);y[x]++}return[g,y]}static#c(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e}static#d(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let n=-1/0,r=1/0;for(let a=0,c=s.length;a<c;a++){const l=s[a]=t[a<<2];n=Math.max(n,l),r=Math.min(r,l)}const o=255/(n-r);for(let a=0,c=s.length;a<c;a++)s[a]=(s[a]-r)*o;return s}static#u(t){let e,s=-1/0,n=-1/0;const r=t.findIndex(c=>c!==0);let o=r,a=r;for(e=r;e<256;e++){const c=t[e];c>s&&(e-o>n&&(n=e-o,a=e-1),s=c,o=e)}for(e=a-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:s,height:n}=t,{maxDim:r}=this.#t;let o=s,a=n;if(s>r||n>r){let p=s,g=n,y=Math.log2(Math.max(s,n)/r);const m=Math.floor(y);y=y===m?m-1:m;for(let w=0;w<y;w++){o=Math.ceil(p/2),a=Math.ceil(g/2);const E=new OffscreenCanvas(o,a);E.getContext("2d").drawImage(t,0,0,p,g,0,0,o,a),p=o,g=a,t!==e&&t.close(),t=E.transferToImageBitmap()}const v=Math.min(r/o,r/a);o=Math.round(o*v),a=Math.round(a*v)}const l=new OffscreenCanvas(o,a).getContext("2d",{willReadFrequently:!0});l.fillStyle="white",l.fillRect(0,0,o,a),l.filter="grayscale(1)",l.drawImage(t,0,0,t.width,t.height,0,0,o,a);const h=l.getImageData(0,0,o,a).data;return[this.#d(h),o,a]}static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:n},r,o,a,c){let l=new OffscreenCanvas(1,1),h=l.getContext("2d",{alpha:!1});const u=200,p=h.font=`${s} ${n} ${u}px ${e}`,{actualBoundingBoxLeft:g,actualBoundingBoxRight:y,actualBoundingBoxAscent:m,actualBoundingBoxDescent:v,fontBoundingBoxAscent:w,fontBoundingBoxDescent:E,width:A}=h.measureText(t),P=1.5,x=Math.ceil(Math.max(Math.abs(g)+Math.abs(y)||0,A)*P),M=Math.ceil(Math.max(Math.abs(m)+Math.abs(v)||u,Math.abs(w)+Math.abs(E)||u)*P);l=new OffscreenCanvas(x,M),h=l.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=p,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,x,M),h.fillStyle="black",h.fillText(t,x*(P-1)/2,M*(3-P)/2);const S=this.#d(h.getImageData(0,0,x,M).data),T=this.#c(S),I=this.#u(T),k=this.#r(S,x,M,I);return this.processDrawnLines({lines:{curves:k,width:x,height:M},pageWidth:r,pageHeight:o,rotation:a,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(t,e,s,n,r){const[o,a,c]=this.#f(t),[l,h]=this.#l(o,a,c,Math.hypot(a,c)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),u=this.#u(h),p=this.#r(l,a,c,u);return this.processDrawnLines({lines:{curves:p,width:a,height:c},pageWidth:e,pageHeight:s,rotation:n,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:n,innerMargin:r,mustSmooth:o,areContours:a}){n%180!==0&&([e,s]=[s,e]);const{curves:c,width:l,height:h}=t,u=t.thickness??0,p=[],g=Math.min(e/l,s/h),y=g/e,m=g/s,v=[];for(const{points:E}of c){const A=o?this.#a(E):E;if(!A)continue;v.push(A);const P=A.length,x=new Float32Array(P),M=new Float32Array(3*(P===2?2:P-2));if(p.push({line:M,points:x}),P===2){x[0]=A[0]*y,x[1]=A[1]*m,M.set([NaN,NaN,NaN,NaN,x[0],x[1]],0);continue}let[S,T,I,k]=A;S*=y,T*=m,I*=y,k*=m,x.set([S,T,I,k],0),M.set([NaN,NaN,NaN,NaN,S,T],0);for(let R=4;R<P;R+=2){const N=x[R]=A[R]*y,D=x[R+1]=A[R+1]*m;M.set(W.createBezierPoints(S,T,I,k,N,D),(R-2)*3),[S,T,I,k]=[I,k,N,D]}}if(p.length===0)return null;const w=a?new Bh:new Mo;return w.build(p,e,s,1,n,a?0:u,r),{outline:w,newCurves:v,areContours:a,thickness:u,width:l,height:h}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:n,height:r}){let o=1/0,a=-1/0,c=0;for(const A of t){c+=A.length;for(let P=2,x=A.length;P<x;P++){const M=A[P]-A[P-2];o=Math.min(o,M),a=Math.max(a,M)}}let l;o>=-128&&a<=127?l=Int8Array:o>=-32768&&a<=32767?l=Int16Array:l=Int32Array;const h=t.length,u=ua+Er*h,p=new Uint32Array(u);let g=0;p[g++]=u*Uint32Array.BYTES_PER_ELEMENT+(c-2*h)*l.BYTES_PER_ELEMENT,p[g++]=0,p[g++]=n,p[g++]=r,p[g++]=e?0:1,p[g++]=Math.max(0,Math.floor(s??0)),p[g++]=h,p[g++]=l.BYTES_PER_ELEMENT;for(const A of t)p[g++]=A.length-2,p[g++]=A[0],p[g++]=A[1];const y=new CompressionStream("deflate-raw"),m=y.writable.getWriter();await m.ready,m.write(p);const v=l.prototype.constructor;for(const A of t){const P=new v(A.length-2);for(let x=2,M=A.length;x<M;x++)P[x-2]=A[x]-A[x-2];m.write(P)}m.close();const w=await new Response(y.readable).arrayBuffer(),E=new Uint8Array(w);return Tv(E)}static async decompressSignature(t){try{const e=BP(t),{readable:s,writable:n}=new DecompressionStream("deflate-raw"),r=n.getWriter();await r.ready,r.write(e).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,a=0;for await(const A of s)o||=new Uint8Array(new Uint32Array(A.buffer,0,4)[0]),o.set(A,a),a+=A.length;const c=new Uint32Array(o.buffer,0,o.length>>2),l=c[1];if(l!==0)throw new Error(`Invalid version: ${l}`);const h=c[2],u=c[3],p=c[4]===0,g=c[5],y=c[6],m=c[7],v=[],w=(ua+Er*y)*Uint32Array.BYTES_PER_ELEMENT;let E;switch(m){case Int8Array.BYTES_PER_ELEMENT:E=new Int8Array(o.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:E=new Int16Array(o.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:E=new Int32Array(o.buffer,w);break}a=0;for(let A=0;A<y;A++){const P=c[Er*A+ua],x=new Float32Array(P+2);v.push(x);for(let M=0;M<Er-1;M++)x[M]=c[Er*A+ua+M+1];for(let M=0;M<P;M++)x[M+2]=x[M]+E[a++]}return{areContours:p,thickness:g,outlines:v,width:h,height:u}}catch(e){return it(`decompressSignature: ${e}`),null}}}class rd extends Zv{constructor(){super(),super.updateProperties({fill:X._defaultLineColor,"stroke-width":0})}clone(){const t=new rd;return t.updateAll(this),t}}class od extends $c{constructor(t){super(t),super.updateProperties({stroke:X._defaultLineColor,"stroke-width":1})}clone(){const t=new od(this._viewParameters);return t.updateAll(this),t}}class ms extends At{#t=!1;#e=null;#i=null;#s=null;static _type="signature";static _editorType=ot.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){X.initialize(t,e),this._defaultDrawingOptions=new rd,this._defaultDrawnSignatureOptions=new od(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return nt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:n,mustSmooth:r,areContours:o,description:a,uuid:c,heightInPage:l}=this.#i,{rawDims:{pageWidth:h,pageHeight:u},rotation:p}=this.parent.viewport,g=En.processDrawnLines({lines:n,pageWidth:h,pageHeight:u,rotation:p,innerMargin:ms._INNER_MARGIN,mustSmooth:r,areContours:o});this.addSignature(g,l,a,c)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#s=t,this.addEditToolbar()}getUuid(){return this.#s}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:s,width:n,height:r}=this.#i,o=Math.max(n,r),a=En.processDrawnLines({lines:{curves:t.map(c=>({points:c})),thickness:s,width:n,height:r},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,s,n){const{x:r,y:o}=this,{outline:a}=this.#i=t;this.#t=a instanceof Bh,this.description=s;let c;this.#t?c=ms.getDefaultDrawingOptions():(c=ms._defaultDrawnSignatureOptions.clone(),c.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:c});const[,l]=this.pageDimensions;let h=e/l;h=h>=1?.5:h,this.width*=h/this.height,this.width>=1&&(h*=.9/this.width,this.width=.9),this.height=h,this.setDims(),this.x=r,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:n}=this.parent.viewport;return En.process(t,e,s,n,ms._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:s,pageHeight:n},rotation:r}=this.parent.viewport;return En.extractContoursFromText(t,e,s,n,r,ms._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:n}=this.parent.viewport;return En.processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:n,innerMargin:ms._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=ms.getDefaultDrawingOptions():(this._drawingOptions=ms._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":n}}=this,r=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:n});return this.addComment(r),t?(r.paths={lines:e,points:s},r.uuid=this.#s,r.isCopy=!0):r.lines=e,this.#e&&(r.accessibilityData={type:"Figure",alt:this.#e}),r}static deserializeDraw(t,e,s,n,r,o){return o.areContours?Bh.deserialize(t,e,s,n,r,o):Mo.deserialize(t,e,s,n,r,o)}static async deserialize(t,e,s){const n=await super.deserialize(t,e,s);return n.#t=t.areContours,n.description=t.accessibilityData?.alt||"",n.#s=t.uuid,n}}class Sx extends X{#t=null;#e=null;#i=null;#s=null;#o=null;#r="";#n=null;#a=!1;#l=null;#c=!1;#d=!1;static _type="stamp";static _editorType=ot.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#s=t.bitmapUrl,this.#o=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){X.initialize(t,e)}static isHandlingMimeForPasting(t){return xh.includes(t)}static paste(t,e){e.pasteEditor({mode:ot.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#u(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#c=t.isSvg),t.file&&(this.#r=t.file.name),this.#g()}#f(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#n){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:r,height:o}=t||this.copyCanvas(null,null,!0).imageData,a=await s.guess({name:"altText",request:{data:n,width:r,height:o,channels:n.length/(r*o)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const c=a.output;return await this.setGuessedAltText(c),e&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#u(s,!0)).finally(()=>this.#f());return}if(this.#s){const s=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(s).then(n=>this.#u(n)).finally(()=>this.#f());return}if(this.#o){const s=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(s).then(n=>this.#u(n)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=xh.join(",");const e=this._uiManager._signal;this.#i=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#u(n)}s()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#n?.remove(),this.#n=null,this.#l&&(clearTimeout(this.#l),this.#l=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#n===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#o||this.#e||this.#a)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#a||(this.#t?this.#g():this.#m()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:s,bitmap:n}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(this.#e=s,n&&(this.#t=n),this.#a=!1,this.#g())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#l!==null&&clearTimeout(this.#l);const t=200;this.#l=setTimeout(()=>{this.#l=null,this.#p()},t)}#g(){const{div:t}=this;let{width:e,height:s}=this.#t;const[n,r]=this.pageDimensions,o=.75;if(this.width)e=this.width*n,s=this.height*r;else if(e>o*n||s>o*r){const c=Math.min(o*n/e,o*r/s);e*=c,s*=c}this._uiManager.enableWaiting(!1);const a=this.#n=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=e/n,this.height=s/r,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#p(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,s=!1){t||(t=224);const{width:n,height:r}=this.#t,o=new Ps;let a=this.#t,c=n,l=r,h=null;if(e){if(n>e||r>e){const M=Math.min(e/n,e/r);c=Math.floor(n*M),l=Math.floor(r*M)}h=document.createElement("canvas");const p=h.width=Math.ceil(c*o.sx),g=h.height=Math.ceil(l*o.sy);this.#c||(a=this.#h(p,g));const y=h.getContext("2d");y.filter=this._uiManager.hcmFilter;let m="white",v="#cfcfd8";this._uiManager.hcmFilter!=="none"?v="black":qP.isDarkMode&&(m="#8f8f9d",v="#42414d");const w=15,E=w*o.sx,A=w*o.sy,P=new OffscreenCanvas(E*2,A*2),x=P.getContext("2d");x.fillStyle=m,x.fillRect(0,0,E*2,A*2),x.fillStyle=v,x.fillRect(0,0,E,A),x.fillRect(E,A,E,A),y.fillStyle=y.createPattern(P,"repeat"),y.fillRect(0,0,p,g),y.drawImage(a,0,0,a.width,a.height,0,0,p,g)}let u=null;if(s){let p,g;if(o.symmetric&&a.width<t&&a.height<t)p=a.width,g=a.height;else if(a=this.#t,n>t||r>t){const v=Math.min(t/n,t/r);p=Math.floor(n*v),g=Math.floor(r*v),this.#c||(a=this.#h(p,g))}const m=new OffscreenCanvas(p,g).getContext("2d",{willReadFrequently:!0});m.drawImage(a,0,0,a.width,a.height,0,0,p,g),u={width:p,height:g,data:m.getImageData(0,0,p,g).data}}return{canvas:h,width:c,height:l,imageData:u}}#h(t,e){const{width:s,height:n}=this.#t;let r=s,o=n,a=this.#t;for(;r>2*t||o>2*e;){const c=r,l=o;r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),o>2*e&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const h=new OffscreenCanvas(r,o);h.getContext("2d").drawImage(a,0,0,c,l,0,0,r,o),a=h.transferToImageBitmap()}return a}#p(){const[t,e]=this.parentDimensions,{width:s,height:n}=this,r=new Ps,o=Math.ceil(s*t*r.sx),a=Math.ceil(n*e*r.sy),c=this.#n;if(!c||c.width===o&&c.height===a)return;c.width=o,c.height=a;const l=this.#c?this.#t:this.#h(o,a),h=c.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(l,0,0,l.width,l.height,0,0,o,a)}#_(t){if(t){if(this.#c){const n=this._uiManager.imageManager.getSvgUrl(this.#e);if(n)return n}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#c){const[e,s]=this.pageDimensions,n=Math.round(this.width*e*Gn.PDF_TO_CSS_UNITS),r=Math.round(this.height*s*Gn.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,r);return o.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,n,r),o.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,s){let n=null,r=!1;if(t instanceof Qv){const{data:{rect:m,rotation:v,id:w,structParent:E,popupRef:A,richText:P,contentsObj:x,creationDate:M,modificationDate:S},container:T,parent:{page:{pageNumber:I}},canvas:k}=t;let R,N;k?(delete t.canvas,{id:R,bitmap:N}=s.imageManager.getFromCanvas(T.id,k),k.remove()):(r=!0,t._hasNoCanvas=!0);const D=(await e._structTree.getAriaAttributes(`${Tn}${w}`))?.get("aria-label")||"";n=t={annotationType:ot.STAMP,bitmapId:R,bitmap:N,pageIndex:I-1,rect:m.slice(0),rotation:v,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:D},isSvg:!1,structParent:E,popupRef:A,richText:P,comment:x?.str||null,creationDate:M,modificationDate:S}}const o=await super.deserialize(t,e,s),{rect:a,bitmap:c,bitmapUrl:l,bitmapId:h,isSvg:u,accessibilityData:p}=t;r?(s.addMissingCanvas(t.id,o),o.#a=!0):h&&s.imageManager.isValidId(h)?(o.#e=h,c&&(o.#t=c)):o.#s=l,o.#c=u;const[g,y]=o.pageDimensions;return o.width=(a[2]-a[0])/g,o.height=(a[3]-a[1])/y,p&&(o.altTextData=p),o._initialData=n,t.comment&&o.setCommentData(t),o.#d=!!n,o}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#c});if(this.addComment(s),t)return s.bitmapUrl=this.#_(!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:n,altText:r}=this.serializeAltText(!1);if(!n&&r&&(s.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const a=this.#v(s);return a.isSame?null:(a.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(e===null)return s;e.stamps||=new Map;const o=this.#c?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:o,serialized:s}),s.bitmap=this.#_(!1);else if(this.#c){const a=e.stamps.get(this.#e);o>a.area&&(a.area=o,a.serialized.bitmap.close(),a.serialized.bitmap=this.#_(!1))}return s}#v(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,n=t.pageIndex===e,r=(t.accessibilityData?.alt||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&n&&r,isSameAltText:r}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Ns{#t;#e=!1;#i=null;#s=null;#o=null;#r=new Map;#n=!1;#a=!1;#l=!1;#c=null;#d=null;#u=null;#f=null;#m=null;#g=-1;#h;static _initialized=!1;static#p=new Map([ce,nd,Sx,qt,ms].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:n,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:c,viewport:l,l10n:h}){const u=[...Ns.#p.values()];if(!Ns._initialized){Ns._initialized=!0;for(const p of u)p.initialize(h,t)}t.registerEditorTypes(u),this.#h=t,this.pageIndex=e,this.div=s,this.#t=r,this.#i=o,this.viewport=l,this.#u=c,this.drawLayer=a,this._structTree=n,this.#h.addLayer(this)}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#h.getMode()===ot.NONE}updateToolbar(t){this.#h.updateToolbar(t)}updateMode(t=this.#h.getMode()){switch(this.#w(),t){case ot.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ot.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ot.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===ot.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const s of Ns.#p.values())e.toggle(`${s._type}Editing`,t===s._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#u?.div}setEditingState(t){this.#h.setEditingState(t)}addCommands(t){this.#h.addCommands(t)}cleanUndoStack(t){this.#h.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.togglePointerEvents(t)}get#_(){return this.#r.size!==0?this.#r.values():this.#h.getEditors(this.pageIndex)}async enable(){this.#l=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const t=new Set;for(const s of this.#_)s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#h.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));const e=this.#i;if(e)for(const s of e.getEditableAnnotations()){if(s.hide(),this.#h.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const n=await this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}this.#l=!1,this.#h._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#u&&!this.#m){this.#m=new AbortController;const n=this.#h.combinedSignal(this.#m);this.#u.div.addEventListener("pointerdown",r=>{const{clientX:a,clientY:c,timeStamp:l}=r,h=this.#g;if(l-h>500){this.#g=l;return}this.#g=-1;const{classList:u}=this.div;u.toggle("getElements",!0);const p=document.elementsFromPoint(a,c);if(u.toggle("getElements",!1),!this.div.contains(p[0]))return;let g;const y=new RegExp(`^${no}[0-9]+$`);for(const v of p)if(y.test(v.id)){g=v.id;break}if(!g)return;const m=this.#r.get(g);m?.annotationElementId===null&&(r.stopPropagation(),r.preventDefault(),m.dblclick(r))},{signal:n,capture:!0})}const t=this.#i,e=[];if(t){const n=new Map,r=new Map;for(const a of this.#_){if(a.disableEditing(),!a.annotationElementId){e.push(a);continue}if(a.serialize()!==null){n.set(a.annotationElementId,a);continue}else r.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}const o=t.getEditableAnnotations();for(const a of o){const{id:c}=a.data;if(this.#h.isDeletedAnnotationElement(c)){a.updateEdited({deleted:!0});continue}let l=r.get(c);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=n.get(c),l&&(this.#h.addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}this.#w(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const n of Ns.#p.values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t?.updateFakeAnnotations(e),this.#a=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#h.getActive()!==t&&this.#h.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#u?.div&&!this.#f){this.#f=new AbortController;const t=this.#h.combinedSignal(this.#f);this.#u.div.addEventListener("pointerdown",this.#v.bind(this),{signal:t}),this.#u.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#u?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#u.div.classList.remove("highlighting"))}#v(t){this.#h.unselectAll();const{target:e}=t;if(e===this.#u.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#u.div.contains(e)){const{isMac:s}=re.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#h.showAllEditors("highlight",!0,!0),this.#u.div.classList.add("free"),this.toggleDrawing(),qt.startHighlighting(this,this.#h.direction==="ltr",{target:this.#u.div,x:t.x,y:t.y}),this.#u.div.addEventListener("pointerup",()=>{this.#u.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#h._signal}),t.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;const t=this.#h.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#s?.abort(),this.#s=null}attach(t){this.#r.set(t.id,t);const{annotationElementId:e}=t;e&&this.#h.isDeletedAnnotationElement(e)&&this.#h.removeDeletedAnnotationElement(t)}detach(t){this.#r.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#a&&t.annotationElementId&&this.#h.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#h.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#h.addDeletedAnnotationElement(t),X.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#h.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#l),this.#h.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#o&&(t._focusEventsAllowed=!1,this.#o=setTimeout(()=>{this.#o=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#h._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getEditorByUID(t){for(const e of this.#r.values())if(e.uid===t)return e;return null}getNextId(){return this.#h.getId()}get#y(){return Ns.#p.get(this.#h.getMode())}combinedSignal(t){return this.#h.combinedSignal(t)}#S(t){const e=this.#y;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#y?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#h.updateMode(t.mode);const{offsetX:s,offsetY:n}=this.#E(),r=this.getNextId(),o=this.#S({parent:this,id:r,x:s,y:n,uiManager:this.#h,isCentered:!0,...e});o&&this.add(o)}async deserialize(t){return await Ns.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#h)||null}createAndAddNewEditor(t,e,s={}){const n=this.getNextId(),r=this.#S({parent:this,id:n,x:t.offsetX,y:t.offsetY,uiManager:this.#h,isCentered:e,...s});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}#E(){const{x:t,y:e,width:s,height:n}=this.boundingClientRect,r=Math.max(0,t),o=Math.max(0,e),a=Math.min(window.innerWidth,t+s),c=Math.min(window.innerHeight,e+n),l=(r+a)/2-t,h=(o+c)/2-e,[u,p]=this.viewport.rotation%180===0?[l,h]:[h,l];return{offsetX:u,offsetY:p}}addNewEditor(t={}){this.createAndAddNewEditor(this.#E(),!0,t)}setSelected(t){this.#h.setSelected(t)}toggleSelected(t){this.#h.toggleSelected(t)}unselect(t){this.#h.unselect(t)}pointerup(t){const{isMac:e}=re.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#n||(this.#n=!1,this.#y?.isDrawer&&this.#y.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const s=this.#h.getMode();if(s===ot.STAMP||s===ot.SIGNATURE){this.#h.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#h.getMode()===ot.HIGHLIGHT&&this.enableTextSelection(),this.#n){this.#n=!1;return}const{isMac:e}=re.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#n=!0,this.#y?.isDrawer){this.startDrawingSession(t);return}const s=this.#h.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#c){this.#y.startDrawing(this,this.#h,!1,t);return}this.#h.setCurrentDrawingSession(this),this.#c=new AbortController;const e=this.#h.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#y.startDrawing(this,this.#h,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#c?(this.#h.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#d=null,this.#y.endDrawing(t)):null}findNewParent(t,e,s){const n=this.#h.findParent(e,s);return n===null||n===this?!1:(n.changeParent(t),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#h.getActive()?.parent===this&&(this.#h.commitOrRemove(),this.#h.setActiveEditor(null)),this.#o&&(clearTimeout(this.#o),this.#o=null);for(const t of this.#r.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#r.clear(),this.#h.removeLayer(this)}#w(){for(const t of this.#r.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,tn(this.div,t);for(const e of this.#h.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#h.commitOrRemove(),this.#w();const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,tn(this.div,{rotation:s}),e!==s)for(const n of this.#r.values())n.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#h.viewParameters.realScale}}class ue{#t=null;#e=new Map;#i=new Map;static#s=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return nt(this,"_svgFactory",new sc)}static#o(t,[e,s,n,r]){const{style:o}=t;o.top=`${100*s}%`,o.left=`${100*e}%`,o.width=`${100*n}%`,o.height=`${100*r}%`}#r(){const t=ue._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#n(t,e){const s=ue._svgFactory.createElement("clipPath");t.append(s);const n=`clip_${e}`;s.setAttribute("id",n),s.setAttribute("clipPathUnits","objectBoundingBox");const r=ue._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${e}`),r.classList.add("clip"),n}#a(t,e){for(const[s,n]of Object.entries(e))n===null?t.removeAttribute(s):t.setAttribute(s,n)}draw(t,e=!1,s=!1){const n=ue.#s++,r=this.#r(),o=ue._svgFactory.createElement("defs");r.append(o);const a=ue._svgFactory.createElement("path");o.append(a);const c=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",c),a.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#i.set(n,a);const l=s?this.#n(o,c):null,h=ue._svgFactory.createElement("use");return r.append(h),h.setAttribute("href",`#${c}`),this.updateProperties(r,t),this.#e.set(n,r),{id:n,clipPathId:`url(#${l})`}}drawOutline(t,e){const s=ue.#s++,n=this.#r(),r=ue._svgFactory.createElement("defs");n.append(r);const o=ue._svgFactory.createElement("path");r.append(o);const a=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(e){const u=ue._svgFactory.createElement("mask");r.append(u),c=`mask_p${this.pageIndex}_${s}`,u.setAttribute("id",c),u.setAttribute("maskUnits","objectBoundingBox");const p=ue._svgFactory.createElement("rect");u.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const g=ue._svgFactory.createElement("use");u.append(g),g.setAttribute("href",`#${a}`),g.setAttribute("stroke","none"),g.setAttribute("fill","black"),g.setAttribute("fill-rule","nonzero"),g.classList.add("mask")}const l=ue._svgFactory.createElement("use");n.append(l),l.setAttribute("href",`#${a}`),c&&l.setAttribute("mask",`url(#${c})`);const h=l.cloneNode();return n.append(h),l.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(n,t),this.#e.set(s,n),s}finalizeDraw(t,e){this.#i.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:s,bbox:n,rootClass:r,path:o}=e,a=typeof t=="number"?this.#e.get(t):t;if(a){if(s&&this.#a(a,s),n&&ue.#o(a,n),r){const{classList:c}=a;for(const[l,h]of Object.entries(r))c.toggle(l,h)}if(o){const l=a.firstElementChild.firstElementChild;this.#a(l,o)}}}updateParent(t,e){if(e===this)return;const s=this.#e.get(t);s&&(e.#t.append(s),this.#e.delete(t),e.#e.set(t,s))}remove(t){this.#i.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Fh};globalThis.pdfjsLib={AbortException:Ai,AnnotationEditorLayer:Ns,AnnotationEditorParamsType:_t,AnnotationEditorType:ot,AnnotationEditorUIManager:Ei,AnnotationLayer:id,AnnotationMode:oi,AnnotationType:Qt,applyOpacity:WP,build:ex,ColorPicker:Ke,createValidAbsoluteUrl:bv,CSSConstants:GP,DOMSVGFactory:sc,DrawLayer:ue,FeatureTest:re,fetchData:Po,findContrastColor:KP,getDocument:jv,getFilenameFromUrl:UP,getPdfFilenameFromUrl:$P,getRGB:xo,getUuid:Ev,getXfaPageViewport:jP,GlobalWorkerOptions:qi,ImageKind:Ra,InvalidPDFException:Ph,isDataScheme:Vc,isPdfFile:Wu,isValidExplicitDest:rR,MathClamp:Re,noContextMenu:Ze,normalizeUnicode:FP,OPS:ro,OutputScale:Ps,PasswordResponses:PP,PDFDataRangeTransport:Hv,PDFDateString:Rh,PDFWorker:ao,PermissionFlag:CP,PixelsPerInch:Gn,RenderingCancelledException:Gu,renderRichText:Iv,ResponseException:tc,setLayerDimensions:tn,shadow:nt,SignatureExtractor:En,stopEvent:jt,SupportedImageMimeTypes:xh,TextLayer:Ue,TouchManager:Bc,updateUrlHash:wv,Util:H,VerbosityLevel:Lc,version:tx,XfaLayer:Sv};typeof window<"u"&&IP(()=>import("./pdf.worker.min-B1SJBlSi.js"),[]).then(i=>{qi.workerSrc=i.default}).catch(()=>{qi.workerSrc="/app/pdf.worker.min.mjs"});async function Ix(i){const t=await i.arrayBuffer(),s=await jv({data:t}).promise,n=s.numPages,r=[];for(let a=1;a<=n;a++)try{const h=(await(await s.getPage(a)).getTextContent()).items.map(u=>typeof u.str=="string"&&u.str.trim().length>0?u.str:"").filter(u=>u.length>0).join(" ");h.trim().length>0&&r.push(h)}catch(c){console.warn(`Erro ao extrair pgina ${a}:`,c),r.push(`[Erro ao extrair pgina ${a}]`)}const o=r.join(`

`);if(o.trim().length===0)throw new Error("Nenhum texto foi extrado do PDF. O arquivo pode estar corrompido ou ser uma imagem escaneada.");return o}function $g(i){const t=i.length,e=i.split(`
`).length,s=e>0?t/e:0;i.toLowerCase();const n=/anexo|contedo\s+programtico/i.test(i),r=t<1e3&&!n,o=t>=500&&t<2e3;let a;return r?a="escaneado":o?a="fragmentado":a="texto_valido",{classificacao:a,linhas:e,tamanho:t,densidade:s,flagProvavelEscaneado:r,flagFragmentado:o}}function zg(i){const t=i.length,e=i.split(`
`),s=e.length,n=s>0?t/s:0,r=t<800,o=n<8,a=i.toLowerCase(),c=a.includes("contedo")||a.includes("conteudo"),l=a.includes("programtico")||a.includes("programatico"),h=a.includes("disciplina"),u=!c&&!l&&!h;let p=0;for(const A of e){const P=A.trim().split(/\s+/).filter(x=>x.length>0);P.length>=1&&P.length<=3&&A.trim().length>0&&p++}const g=s>0?p/s*100:0,y=g>35,m=new Map;for(const A of e){const P=A.trim();P.length>0&&P.length<100&&m.set(P,(m.get(P)||0)+1)}let v=!1;for(const[A,P]of m.entries())if(P>3){v=!0;break}return{flags:{textoInsuficiente:r,densidadeBaixa:o,semPalavrasChave:u,estruturaQuebrada:y,ruidoRepetitivo:v},estatisticas:{tamanho:t,linhas:s,densidade:n,linhasCurta:p,percentualLinhasCurta:g}}}function Cx(i){let t=i.replace(/[\u00A0\u200B\u200C\u200D\uFEFF]/g," ");return t=t.replace(/[ \t]+/g," "),t=t.trim(),t}function Px(i){const t=[];let e=0;for(;e<i.length;){const s=i[e],n=s.trim();if((n.endsWith(";")||n.endsWith(":"))&&e+1<i.length){const r=i[e+1].trim();if(r.length>0){t.push(n+" "+r),e+=2;continue}}if(n.endsWith(",")&&e+1<i.length){const r=i[e+1].trim();if(r.length>0){const o=r.split(/\s+/).filter(a=>a.length>0);if(o.length>=1&&o.length<=3&&!(/^[A-Z][A-Z\s]+$/.test(r)||/^\d+\./.test(r))){t.push(n+" "+r),e+=2;continue}}}t.push(s),e++}return t}function jg(i){return i.trim().split(/\s+/).filter(t=>t.length>0).length}function Rx(i){let t=i;t=t.replace(/\r\n/g,`
`),t=t.replace(/\r/g,`
`),t=t.replace(/[\u00A0\u200B\u200C\u200D\uFEFF]/g," "),t=t.replace(/([a-zA-Z])\s*-\s*\n\s*([a-zA-Z])/g,"$1$2"),t=t.replace(/[ \t]+/g," "),t=t.replace(/\n{3,}/g,`

`);let e=t.split(`
`);return e=e.map(Cx),e=Px(e),t=e.join(`
`),t}function xx(i){return i.replace(/[\u00A0\u200B\u200C\u200D\uFEFF]/g," ").replace(/\s+/g," ").toLowerCase()}function Hg(i){const t=xx(i),e=/anexo\s*[-]?\s*ii/gi,s=t.match(e);return s?s.length:0}function kx(i){const t=i.length,e=Hg(i),s=i.split(`
`).length,n=i.split(`
`).filter(p=>{const g=jg(p);return g>=1&&g<=3&&p.trim().length>0}).length,r=Rx(i),o=r.length,a=Hg(r),c=r.split(`
`).length,l=r.split(`
`).filter(p=>{const g=jg(p);return g>=1&&g<=3&&p.trim().length>0}).length,h=n-l,u=n>0?Math.round(h/n*100):0;return{textoProcessado:r,stats:{tamanhoOriginal:t,tamanhoProcessado:o,ocorrenciasAnexoIIAntes:e,ocorrenciasAnexoIIDepois:a,linhasAntes:s,linhasDepois:c,linhasSuspeitas:n,percentualRuidoRemovido:u}}}const Ol=["Lngua Portuguesa","Geografia","Raciocnio Lgico Matemtico","Noes de Informtica","tica no Servio Pblico"],Dx=["edital","numero","instituto brasileiro","geografia e estatistica","ibge","processo seletivo","anexo","conteudo programatico","quadro","estrutura da prova"];function ge(i){return i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim()}const Mx={"lingua portuguesa":"Lngua Portuguesa","lngua portuguesa":"Lngua Portuguesa",portugues:"Lngua Portuguesa","lingua inglesa":"Lngua Inglesa","lngua inglesa":"Lngua Inglesa",ingles:"Lngua Inglesa",matematica:"Matemtica","matematica basica":"Matemtica","matematica financeira":"Matemtica Financeira","matematica financeira basica":"Matemtica Financeira","probabilidade e estatistica":"Probabilidade e Estatstica","conhecimentos bancarios":"Conhecimentos Bancrios","atualidades do mercado financeiro":"Atualidades do Mercado Financeiro","conhecimentos de informatica":"Conhecimentos de Informtica",informatica:"Conhecimentos de Informtica","tecnologia da informacao":"Tecnologia da Informao","tecnologia da informacao e comunicacao":"Tecnologia da Informao","vendas e negociacao":"Vendas e Negociao"};function tb(i){const t=i.trim(),e=ge(t);return{nomeNormalizado:Mx[e]??t,nomeOriginal:t}}function ns(i,t,e=0){const s=ge(t);return i.indexOf(s,e)}function qg(i,t){const e=[],s=ge(t);let n=0;for(;;){const r=i.indexOf(s,n);if(r===-1)break;e.push(r),n=r+1}return e}function Nx(i){const t=ge(i),e=[],s=[ns(t,"quadro 1"),ns(t,"quadro i"),ns(t,"estrutura da prova")].filter(o=>o!==-1);if(s.length===0)return Ol;const n=Math.min(...s),r=t.substring(n,n+5e3);for(const o of Ol)ns(r,o)!==-1&&e.push(o);return e.length<3?Ol:e}function Lx(i,t){const e=ge(i),s=t.map(p=>ge(p)),n=[ns(e,"quadro 1"),ns(e,"quadro i"),ns(e,"estrutura da prova")].filter(p=>p!==-1);if(n.length===0)return{pesos:[],metodo:"nao_encontrado",encontrado:!1,aviso:"Quadro 1 no encontrado no texto"};const r=Math.min(...n),o=r,a=Math.min(r+8e3,e.length),c=e.substring(o,a),l=[];let h=null;for(let p=0;p<t.length;p++){const g=t[p],y=s[p];let m=c.indexOf(y);if(m===-1){const S=y.split(/\s+/).filter(T=>T.length>3);for(const T of S)if(m=c.indexOf(T),m!==-1)break}if(m===-1)continue;const v=c.substring(m,Math.min(m+200,c.length)),w=v.match(/\b(\d{1,3})\b/g);if(!w||w.length===0)continue;const E=w.map(S=>parseInt(S,10)).filter(S=>S>=1&&S<=200);if(E.length===0)continue;const A=/pontos?/i.test(v),P=/quest[o]es?/i.test(v)||!A,x=E[0];P&&!h?h="questoes":A&&!h&&(h="pontos");const M={disciplina:g};P?M.questoes=x:A?M.pontos=x:(M.questoes=x,h||(h="questoes")),l.push(M)}return l.length<3?{pesos:[],metodo:"nao_encontrado",encontrado:!1,aviso:`Quadro 1 encontrou apenas ${l.length} disciplina(s) com nmero vlido (mnimo: 3)`}:{pesos:l,metodo:h||"questoes",encontrado:!0}}function Ox(i,t){const e=i.substring(0,800);if(!(ns(e,"anexo ii")!==-1))return!1;const n=i.substring(0,2e3);if(!(ns(n,"conteudo programatico")!==-1||ns(n,"conteudos programaticos")!==-1))return!1;let o=!1;for(const a of t){const c=a.split(/\s+/).filter(h=>h.length>3);let l=-1;if(l=i.indexOf(a),l===-1){for(const h of c)if(l=i.indexOf(h),l!==-1)break}if(l!==-1){const h=i.substring(l,Math.min(l+300,i.length));if(/\d+[\.\)]\s+/.test(h)){o=!0;break}}}return!!o}function Fx(i,t){const e=ge(i),s=t.map(y=>ge(y)),n=()=>{const y=["conteudos programaticos","conteudo programatico"],m=[];for(const v of y)m.push(...qg(e,v));if(m.length===0)return-1;m.sort((v,w)=>v-w);for(let v=m.length-1;v>=0;v--){const w=m[v],E=i.substring(w,Math.min(w+1500,i.length));if(/[A-Z][A-Z\s\/\-]{3,80}:/.test(E))return w}return m[m.length-1]},r=qg(e,"anexo ii");if(r.length===0){const y=n();if(y===-1)return{trechoOriginal:"",trechoNormalizado:"",startIdx:-1,endIdx:-1,encontrado:!1};const m=i.substring(y),v=e.substring(y);return{trechoOriginal:m,trechoNormalizado:v,startIdx:y,endIdx:i.length,encontrado:!0}}let o=-1;for(let y=r.length-1;y>=0;y--){const m=r[y],v=e.substring(m,Math.min(m+2e3,e.length));if(Ox(v,s)){o=m;break}}if(o===-1){const y=n();y!==-1?(o=y,e.substring(y,Math.min(y+2e3,e.length))):o=r[r.length-1]}const a=e.substring(o),l=["anexo iii","anexo 3","anexo iv","anexo 4"].map(y=>ns(a,y)).filter(y=>y!==-1),h=l.length>0?Math.min(...l):-1;let u;h!==-1?u=o+h:u=i.length;const p=i.substring(o,u),g=e.substring(o,u);return{trechoOriginal:p,trechoNormalizado:g,startIdx:o,endIdx:u,encontrado:!0}}function Vx(i){return i.split(/\s+/).filter(e=>e.length>3).map(e=>e.trim())}function Bx(i,t,e){const s=Vx(t);if(e.toLowerCase().includes("informtica")||e.toLowerCase().includes("informatica")){const o=i.indexOf("informatica");if(o!==-1){const a=i.substring(Math.max(0,o-50),o);if(a.includes("nocoes")||a.includes("basicas")){const c=a.lastIndexOf("nocoes"),l=a.lastIndexOf("basicas"),h=Math.max(c,l);if(h!==-1){const u=Math.max(0,o-50)+h,p=i.substring(o,Math.min(o+200,i.length));if(/\d+[\.\)]/.test(p))return u}}}}const n=s[0];if(!n)return null;let r=0;for(;;){const o=i.indexOf(n,r);if(o===-1)break;const a=i.substring(o,Math.min(o+100,i.length));let c=!0;for(let l=1;l<s.length;l++)if(!a.includes(s[l])){c=!1;break}if(c){const l=i.substring(o,Math.min(o+200,i.length));if(/\d+[\.\)]/.test(l))return o}r=o+1}return null}function Ux(i){const t=[],e=/([A-Z][A-Z0-9\s\/\-]{2,80}?):/g;let s;for(;(s=e.exec(i))!==null;){let n=s[1].trim().replace(/\s+/g," ");const r=s.index??0,o=i.substring(r,Math.min(r+200,i.length));if(!/\d+\s*[\-\.]/.test(o)||n.length<3||n.length>80||n.startsWith("ANEXO")||/[a-z]/.test(n)||ge(n).includes("conteudos programaticos"))continue;const a=n.split(" ").filter(p=>p.trim().length>0),c=["escriturario","nome","relacionamento","agente","conhecimentos","basicos","especificos","comercial","area"];if(a.length>3){const p=a.filter(g=>!c.includes(ge(g)));p.length>=2?n=p.slice(-4).join(" "):n=a.slice(-4).join(" ")}if(n=n.split(" ").slice(-4).join(" ").trim(),n.length<3)continue;const l=ge(n);if(l==="de"||l==="-"||l.replace(/[^a-z]/g,"").length<3)continue;const u=[{teste:/lingua portuguesa/,valor:"Lngua Portuguesa"},{teste:/lingua inglesa/,valor:"Lngua Inglesa"},{teste:/matematica financeira/,valor:"Matemtica Financeira"},{teste:/matematica\b/,valor:"Matemtica"},{teste:/atualidades do mercado financeiro/,valor:"Atualidades do Mercado Financeiro"},{teste:/probabilidade e estatistica/,valor:"Probabilidade e Estatstica"},{teste:/conhecimentos bancarios/,valor:"Conhecimentos Bancrios"},{teste:/conhecimentos de informatica/,valor:"Conhecimentos de Informtica"},{teste:/tecnologia da informacao/,valor:"Tecnologia da Informao"},{teste:/vendas e negociacao/,valor:"Vendas e Negociao"}];for(const p of u)if(p.teste.test(l)){n=p.valor;break}t.includes(n)||t.push(n)}return t}function $x(i,t,e,s){const n=[];for(let r=0;r<e.length;r++){const o=e[r],a=s[r];let c=i.indexOf(a);c===-1&&(c=Bx(i,a,o)??-1),c!==-1&&n.push({disciplina:o,inicio:c})}return n.sort((r,o)=>r.inicio-o.inicio),n}function zx(i){const t=ge(i);return Dx.some(e=>t.includes(e))}function jx(i){const t=[],e=new Set,s=new Set,n=a=>{const c=a.trim().replace(/\s+/g," ");if(c.length<3||c.length>240)return!1;const l=c.replace(/[;:]+$/,"").trim();return l.length<3||zx(l)||e.has(l)?!1:(t.push(l),e.add(l),!0)},r=a=>{const c=a.trim().replace(/\s+/g," ");if(c.length===0)return[];const l=c.split(/;\s*/).map(u=>u.trim()).filter(Boolean);if(l.length>1)return l;const h=c.split(/(?=\b(?:\d{1,2}|[ivxlcdm]{1,4}|[a-z])[\)\-.]\s+)/i).map(u=>u.trim()).filter(Boolean);if(h.length>1)return h;if(c.length>180){const u=c.split(new RegExp("(?<=[.;])\\s+(?=[A-Z])")).map(g=>g.trim()).filter(g=>g.length>=20&&g.length<=240);if(u.length>1)return u;const p=c.split(/,\s+(?=[A-Z])/).map(g=>g.trim()).filter(g=>g.length>=20&&g.length<=240);if(p.length>1)return p}return[c]},o=i.split(/\n/);for(let a=0;a<o.length;a++){const c=o[a].trim();if(c.length===0)continue;let l=!1;const h=c.matchAll(/\d+\s*[\.\)\-]\s+([^0-9]+?)(?=\d+\s*[\.\)\-]|$)/g);for(const y of h)y[1]&&n(y[1])&&(l=!0);if(l){s.add(a);continue}const u=c.match(/^\d+\s*[\.\)\-]\s+(.+)/);if(u&&u[1]){n(u[1])&&(s.add(a),l=!0);continue}const p=/^[A-Z\s]{10,}$/.test(c),g=/^\d+[\.\)]/.test(c);if(!p&&!g){const y=r(c);let m=!1;for(const v of y)n(v)&&(m=!0);m&&(s.add(a),l=!0)}if(l){s.add(a);continue}c.length>=3&&c.length<=240&&!p&&!g&&!s.has(a)&&n(c)}return t.slice(0,120)}function Hx(i){const{disciplinas:t,debug:e}=i,s=t.map(m=>{const v=m.nome.trim().replace(/\s+/g," "),{nomeNormalizado:w}=tb(v);return{nome:w,nomeOriginal:m.nomeOriginal??v,conteudos:m.conteudos}}),n=[],r=new Set;for(const m of s){const v=ge(m.nome);if(r.has(v)){const w=n.find(E=>ge(E.nome)===v);if(w){const E=new Set([...w.conteudos,...m.conteudos]);w.conteudos=Array.from(E)}}else{const w=m.conteudos.map(A=>{let P=A.trim().replace(/\s+/g," ");return P=P.replace(/[;:]+$/,"").trim(),P.length<3||P.length>240?null:P}).filter(A=>A!==null),E=Array.from(new Set(w));n.push({nome:m.nome,nomeOriginal:m.nomeOriginal??m.nome,conteudos:E}),r.add(v)}}const o=[],a=new Map(n.map(m=>[ge(m.nome),m]));if(e.disciplinasOficiais&&e.disciplinasOficiais.length>0)for(const m of e.disciplinasOficiais){const v=ge(m),w=a.get(v);w?o.push(w):o.push({nome:m,nomeOriginal:m,conteudos:[]})}else o.push(...n);const c=o.length,l=o.reduce((m,v)=>m+v.conteudos.length,0),h=c>0?l/c:0,u=e.disciplinasOficiais?.length||0,p=o.filter(m=>m.conteudos.length>0).length,g=u>0?p/u*100:0;let y=0;return e.anexoEncontrado&&(y+=30),y+=Math.min(g/100*40,40),y+=Math.min(h/20*30,30),y=Math.round(y),{disciplinas:o,debug:{...e,disciplinasDetectadas:c,nomesDisciplinas:o.map(m=>m.nome),totalDisciplinas:c,totalTopicos:l,densidadeTextual:Math.round(h*100)/100,percentualCompletude:Math.round(g*100)/100,scoreDeConfiabilidade:y}}}function qx(i){const t=Nx(i),e=Lx(i,t),{trechoOriginal:s,trechoNormalizado:n,startIdx:r,endIdx:o,encontrado:a}=Fx(i,t);let c=t;if(!e.encontrado&&s.length>0){const v=Ux(s);v.length>=3&&(c=v)}const l=s.substring(0,200).replace(/\n/g," ").trim();if(!a||s.length===0)return{disciplinas:[],debug:{anexoEncontrado:!1,anexoStart:-1,anexoEnd:-1,anexoChars:0,anexoSnippet:"",disciplinasOficiais:t,disciplinasDetectadas:0,nomesDisciplinas:[],porDisciplina:t.map(v=>({nome:v,encontrou:!1,inicio:-1,fim:-1,chars:0,topicos:0,motivoFalha:"ANEXO II no encontrado"})),quadro1Encontrado:e.encontrado,quadro1Pesos:e.encontrado?e.pesos:void 0,quadro1Metodo:e.metodo,quadro1Aviso:e.aviso}};const h=c.map(v=>ge(v)),u=$x(n,s,c,h),p=[],g=[],y=[];for(let v=0;v<c.length;v++){const w=c[v],{nomeNormalizado:E,nomeOriginal:A}=tb(w),P=u.find(x=>x.disciplina===w);if(P){let x=n.length;const M=u.findIndex(k=>k.inicio>P.inicio);M!==-1&&(x=u[M].inicio);const S=s.substring(P.inicio,x),T=S.length,I=jx(S);I.length>0&&(p.push({nome:E,nomeOriginal:A,conteudos:I}),g.push(w)),y.push({nome:w,encontrou:!0,inicio:P.inicio,fim:x,chars:T,topicos:I.length,motivoFalha:I.length===0?"Nenhum tpico encontrado na seo":void 0})}else y.push({nome:w,encontrou:!1,inicio:-1,fim:-1,chars:0,topicos:0,motivoFalha:"Heading da disciplina no encontrado no ANEXO II"})}const m={disciplinas:p,debug:{anexoEncontrado:a,anexoStart:r,anexoEnd:o,anexoChars:s.length,anexoSnippet:l,disciplinasOficiais:c,disciplinasDetectadas:p.length,nomesDisciplinas:g,porDisciplina:y,quadro1Encontrado:e.encontrado,quadro1Pesos:e.encontrado?e.pesos:void 0,quadro1Metodo:e.metodo,quadro1Aviso:e.aviso}};return Hx(m)}function eb(i){const t=i.flags,e={fragmentado:t.fragmentado,escaneado:t.escaneado},s={possivelAnexoPerdido:t.possivelAnexoPerdido,headingsQuebrados:t.headingsQuebrados},n={textoInsuficiente:t.textoInsuficiente,densidadeBaixa:t.densidadeBaixa,semPalavrasChave:t.semPalavrasChave,estruturaQuebrada:t.estruturaQuebrada,ruidoRepetitivo:t.ruidoRepetitivo},r={tamanho:i.textoOriginal.length},o=i.status==="ok"?{anexoEncontrado:i.resultadoParser.debug.anexoEncontrado,disciplinasDetectadas:i.resultadoParser.debug.disciplinasDetectadas,disciplinasOficiais:i.resultadoParser.debug.disciplinasOficiais.length,topicosTotal:i.resultadoParser.disciplinas.reduce((c,l)=>c+l.conteudos.length,0)}:void 0;return{classificacao:e,failSafe:s,prevalidacao:n,estatisticasTexto:r,estatisticasParser:o,status:i.status}}async function Gx(i){try{const t=await Ix(i),e=$g(t),s=zg(t);if(e.classificacao==="escaneado"){const a={fragmentado:!1,escaneado:!0,possivelAnexoPerdido:!1,headingsQuebrados:!1,textoInsuficiente:s.flags.textoInsuficiente,densidadeBaixa:s.flags.densidadeBaixa,semPalavrasChave:s.flags.semPalavrasChave,estruturaQuebrada:s.flags.estruturaQuebrada,ruidoRepetitivo:s.flags.ruidoRepetitivo};return typeof window<"u",{status:"pdf_escaneado",textoOriginal:t,flags:a,mensagem:"Este PDF parece estar escaneado. Utilize uma verso com texto selecionvel."}}const{textoProcessado:n}=kx(t),r=qx(n),o={fragmentado:e.classificacao==="fragmentado",escaneado:!1,possivelAnexoPerdido:t.length>=2e3&&!r.debug.anexoEncontrado,headingsQuebrados:r.debug.disciplinasDetectadas<=1&&r.debug.disciplinasOficiais.length>=3,textoInsuficiente:s.flags.textoInsuficiente,densidadeBaixa:s.flags.densidadeBaixa,semPalavrasChave:s.flags.semPalavrasChave,estruturaQuebrada:s.flags.estruturaQuebrada,ruidoRepetitivo:s.flags.ruidoRepetitivo};return eb({status:"ok",textoOriginal:t,textoProcessado:n,resultadoParser:r,flags:o}),{status:"ok",textoOriginal:t,textoProcessado:n,resultadoParser:r,flags:o}}catch(t){const e=t instanceof Error?t.message:"Erro desconhecido ao processar PDF";let s="";const n={fragmentado:!1,escaneado:!1,possivelAnexoPerdido:!1,headingsQuebrados:!1,textoInsuficiente:!1,densidadeBaixa:!1,semPalavrasChave:!1,estruturaQuebrada:!1,ruidoRepetitivo:!1};try{if(s=t instanceof Error&&"textoOriginal"in t?t.textoOriginal:"",s.length>0){const r=$g(s);n.escaneado=r.classificacao==="escaneado",n.fragmentado=r.classificacao==="fragmentado";try{const o=zg(s);n.textoInsuficiente=o.flags.textoInsuficiente,n.densidadeBaixa=o.flags.densidadeBaixa,n.semPalavrasChave=o.flags.semPalavrasChave,n.estruturaQuebrada=o.flags.estruturaQuebrada,n.ruidoRepetitivo=o.flags.ruidoRepetitivo}catch{}}}catch{}return{status:"erro_extracao",textoOriginal:s,flags:n,mensagem:e}}}function Fl(i){const t=i.replace(/\.pdf$/i,"").trim();return t.length>0?t:"Edital Processado"}function Wx(i){const e=i.split(`
`).slice(0,500).join(" ").toLowerCase(),s=i.toLowerCase();let n="rgo no identificado";const r=[/(?:rgo|orgo|organizao):\s*([A-Z][A-Za-z\s]{5,40})/i,/(?:ministrio|secretaria|instituto|agncia|autarquia)\s+([A-Z][A-Za-z\s]{5,40})/i,/instituto\s+brasileiro\s+de\s+geografia\s+e\s+estatstica/i];for(const p of r){const g=e.match(p);if(g&&g[1]){n=g[1].trim();break}else if(g&&p.source.includes("instituto brasileiro")){n="Instituto Brasileiro de Geografia e Estatstica (IBGE)";break}}let o="Banca no identificada";const a=[/(?:banca|organizadora):\s*([A-Z][A-Za-z\s]{3,30})/i,/(?:cebraspe|cespe|fcc|funesp|vunesp|fgv|cesgranrio|esaf)/i];for(const p of a){const g=e.match(p);if(g&&g[1])o=g[1].trim();else if(g){const y=e.match(/(cebraspe|cespe|fcc|funesp|vunesp|fgv|cesgranrio|esaf)/i);y&&(o=y[1].toUpperCase())}}let c="Cargo no identificado";const l=[/(?:cargo|funo):\s*([A-Z][A-Za-z\s]{5,50})/i,/(?:para\s+o\s+cargo\s+de|para\s+provimento\s+do\s+cargo)\s+([A-Z][A-Za-z\s]{5,50})/i,/agente\s+de\s+pesquisas\s+e\s+mapeamento/i];for(const p of l){const g=e.match(p);if(g&&g[1]){c=g[1].trim();break}else if(g&&p.source.includes("agente de pesquisas")){c="Agente de Pesquisas e Mapeamento (APM)";break}}let h="";const u=[/(?:vagas?|nmero\s+de\s+vagas?):\s*(\d+)/i,/(\d+)\s+vagas?/i];for(const p of u){let g=e.match(p);if(g||(g=s.match(p)),g&&g[1]){h=g[1];break}}return{orgao:n,banca:o,cargo:c,vagas:h}}function Kx(i,t,e){return t?/contedo\s+programtico/i.test(i)?e.some(r=>new RegExp(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i").test(i))?"Estrutura no reconhecida pelo parser":"Nenhuma disciplina do Quadro 1 foi encontrada no texto":"Estrutura de contedo programtico no reconhecida":"Anexo II no encontrado no edital"}async function Xx(i){const{file:t,fileName:e}=i;await new Promise(y=>setTimeout(y,900));const s=crypto.randomUUID(),n=await Gx(t);if(n.status==="pdf_escaneado"){const y=n.textoOriginal;return{id:s,titulo:Fl(e),orgao:"rgo no identificado",banca:"Banca no identificada",cargo:"Cargo no identificado",vagas:"",disciplinas:[{nome:"Erro no Processamento",conteudos:[n.mensagem,"O PDF parece estar escaneado (imagem).","Utilize uma verso do edital com texto selecionvel."]}],textoBruto:y,criadoEmISO:new Date().toISOString(),debugInfo:void 0}}if(n.status==="erro_extracao"){const y=n.textoOriginal;return{id:s,titulo:Fl(e),orgao:"rgo no identificado",banca:"Banca no identificada",cargo:"Cargo no identificado",vagas:"",disciplinas:[{nome:"Erro no Processamento",conteudos:[n.mensagem,"Erro ao processar o PDF."]}],textoBruto:y,criadoEmISO:new Date().toISOString(),debugInfo:void 0}}const{resultadoParser:r,textoOriginal:o,flags:a}=n,{disciplinas:c,debug:l}=r,h=Wx(o),u=c.length>0?c:[{nome:"Contedo Programtico",conteudos:[Kx(o,l.anexoEncontrado,l.disciplinasOficiais),"O parser no conseguiu identificar a estrutura de disciplinas.","Verifique se o PDF contm o ANEXO II com contedo programtico."]}],p=l.quadro1Pesos&&l.quadro1Metodo==="questoes"?l.quadro1Pesos.reduce((y,m)=>y+(m.questoes||0),0):void 0;return eb(n),{id:s,titulo:Fl(e),orgao:h.orgao,banca:h.banca,cargo:h.cargo,vagas:h.vagas,disciplinas:u,textoBruto:o,criadoEmISO:new Date().toISOString(),quadro1Pesos:l.quadro1Pesos,totalQuestoesQuadro1:p,debugInfo:void 0}}const Ds={fragmentado:{key:"fragmentado",severity:"MEDIA",title:"PDF com texto fragmentado",message:"Este PDF parece estar com o texto fragmentado. Posso continuar, mas o resultado pode sair incompleto ou fora de ordem.",primaryAction:"CONTINUE",secondaryAction:"UPLOAD_OTHER"},escaneado:{key:"escaneado",severity:"ALTA",title:"No consigo ler este PDF",message:"Este arquivo parece ser um PDF escaneado (sem texto selecionvel). Assim, no d para extrair o Anexo II com segurana.",primaryAction:"UPLOAD_OTHER",secondaryAction:"RETRY"},possivelAnexoPerdido:{key:"possivelAnexoPerdido",severity:"MEDIA",title:"Pode faltar parte do Anexo II",message:"Encontrei sinais de que o Anexo II pode estar incompleto neste arquivo. Posso tentar, mas o mapa pode ficar faltando itens.",primaryAction:"CONTINUE",secondaryAction:"UPLOAD_OTHER"},headingsQuebrados:{key:"headingsQuebrados",severity:"MEDIA",title:"Estrutura do anexo est confusa",message:"A estrutura de ttulos e sees do Anexo II est inconsistente. Posso tentar, mas pode haver classificao errada de disciplinas/tpicos.",primaryAction:"CONTINUE",secondaryAction:"UPLOAD_OTHER"},textoInsuficiente:{key:"textoInsuficiente",severity:"ALTA",title:"Contedo insuficiente para extrao",message:"O contedo extrado  insuficiente para montar o mapa do Anexo II. Tente um PDF com texto selecionvel e completo.",primaryAction:"UPLOAD_OTHER",secondaryAction:"RETRY"},estruturaQuebrada:{key:"estruturaQuebrada",severity:"ALTA",title:"No encontrei o Anexo II de forma confivel",message:"Este PDF no contm o Anexo II de um jeito que eu consiga identificar com segurana. Envie outra verso do edital.",primaryAction:"UPLOAD_OTHER",secondaryAction:"RETRY"},densidadeBaixa:{key:"densidadeBaixa",severity:"MEDIA",title:"Qualidade do texto est ruim",message:"O texto extrado est com muitos rudos. Posso continuar, mas pode haver erros no resultado.",primaryAction:"CONTINUE",secondaryAction:"UPLOAD_OTHER"},semPalavrasChave:{key:"semPalavrasChave",severity:"MEDIA",title:"Estrutura do anexo parece incompleta",message:"A estrutura do Anexo II parece incompleta. Posso tentar, mas o resultado pode faltar partes.",primaryAction:"CONTINUE",secondaryAction:"UPLOAD_OTHER"},ruidoRepetitivo:{key:"ruidoRepetitivo",severity:"BAIXA",title:"Encontrei pequenas inconsistncias",message:"Encontrei pequenas inconsistncias no texto, mas nada que impea continuar.",primaryAction:"CONTINUE",secondaryAction:"UPLOAD_OTHER"}},sb={pdf_escaneado:{key:"status_pdf_escaneado",severity:"ALTA",title:"No consigo ler este PDF",message:"Este arquivo est no formato escaneado (imagem). Preciso de um PDF com texto selecionvel para extrair o Anexo II.",primaryAction:"UPLOAD_OTHER",secondaryAction:"RETRY"},erro_extracao:{key:"status_erro_extracao",severity:"ALTA",title:"Falha ao extrair o Anexo II",message:"No consegui extrair o Anexo II com segurana a partir deste PDF. Tente outro arquivo (ou uma verso com texto selecionvel).",primaryAction:"UPLOAD_OTHER",secondaryAction:"RETRY"}};function Yx(i){const t=[];return i.classificacao.fragmentado&&t.push(Ds.fragmentado),i.classificacao.escaneado&&t.push(Ds.escaneado),i.failSafe.possivelAnexoPerdido&&t.push(Ds.possivelAnexoPerdido),i.failSafe.headingsQuebrados&&t.push(Ds.headingsQuebrados),i.prevalidacao.textoInsuficiente&&t.push(Ds.textoInsuficiente),i.prevalidacao.estruturaQuebrada&&t.push(Ds.estruturaQuebrada),i.prevalidacao.densidadeBaixa&&t.push(Ds.densidadeBaixa),i.prevalidacao.semPalavrasChave&&t.push(Ds.semPalavrasChave),i.prevalidacao.ruidoRepetitivo&&t.push(Ds.ruidoRepetitivo),(i.status==="pdf_escaneado"||i.status==="erro_extracao")&&t.unshift(sb[i.status]),t}function Qx(i){if(i.length===0)return null;const t=["estruturaQuebrada","status_pdf_escaneado","status_erro_extracao","escaneado","textoInsuficiente"],e=["fragmentado","headingsQuebrados","possivelAnexoPerdido","densidadeBaixa","semPalavrasChave"],s=i.filter(o=>o.severity==="ALTA"),n=i.filter(o=>o.severity==="MEDIA"),r=i.filter(o=>o.severity==="BAIXA");if(s.length>0){for(const o of t){const a=s.find(c=>c.key===o);if(a)return a}return s[0]}if(n.length>0){for(const o of e){const a=n.find(c=>c.key===o);if(a)return a}return n[0]}return r.length>0?r[0]:null}function ib(i){const t=Yx(i);if(t.length===0){if(i.status==="ok")return null;if(i.status==="pdf_escaneado"||i.status==="erro_extracao"){const l=sb[i.status];return{severity:l.severity,mode:"BLOCK",title:l.title,message:`No deu para extrair o Anexo II com segurana.

`+l.message,primary:{label:"Enviar outro PDF",action:l.primaryAction},secondary:{label:"Tentar novamente",action:l.secondaryAction},key:l.key}}return null}const e=Qx(t);if(!e&&i.status==="ok"){const l=t.some(u=>u.severity==="MEDIA"||u.severity==="BAIXA"),h=t.some(u=>u.severity==="ALTA");if(l&&!h)return{severity:"MEDIA",mode:"CONFIRM",title:"Posso continuar, mas com risco",message:`Posso continuar, mas o resultado pode ficar incompleto.

Posso continuar a extrao, porm existem alertas que podem afetar a qualidade do resultado.`,primary:{label:"Continuar mesmo assim",action:"CONTINUE"},secondary:{label:"Trocar PDF",action:"UPLOAD_OTHER"},key:"OK_COM_ALERTAS"}}if(!e)return null;const n=t.filter(l=>l!==e&&l.severity===e.severity).slice(0,2).map(l=>({title:l.title,message:l.message}));let r;e.severity==="ALTA"?r="BLOCK":e.severity==="MEDIA"?r="CONFIRM":r="INFO";let o;r==="BLOCK"?o=`No deu para extrair o Anexo II com segurana.

`+e.message:r==="CONFIRM"?o=`Posso continuar, mas o resultado pode ficar incompleto.

`+e.message:o=e.message;const a={UPLOAD_OTHER:"Enviar outro PDF",RETRY:"Tentar novamente",CONTINUE:r==="INFO"?"Entendi":"Continuar mesmo assim"},c={severity:e.severity,mode:r,title:e.title,message:o,primary:{label:a[e.primaryAction],action:e.primaryAction},key:e.key};return r!=="INFO"&&e.secondaryAction&&(c.secondary={label:a[e.secondaryAction],action:e.secondaryAction}),r!=="INFO"&&n.length>0&&(c.otherAlerts=n),c}function Uh(i){const{decision:t,isBusy:e=!1}=i,[s,n]=$(!1);if(s)return null;if(t.mode==="INFO"){const{onDismiss:c}=i,l=()=>{e||(n(!0),c&&c())};return d("div",{class:"gc-ux-gate-banner",children:d("div",{class:"gc-ux-gate-banner-content",children:[d("div",{class:"gc-ux-gate-banner-icon",children:""}),d("div",{class:"gc-ux-gate-banner-text",children:[d("div",{class:"gc-ux-gate-banner-title",children:t.title}),d("div",{class:"gc-ux-gate-banner-message",children:t.message})]}),d("button",{class:"gc-ux-gate-banner-close",disabled:e,onClick:l,children:t.primary.label})]})})}if(t.mode==="BLOCK"){const{onUploadOther:c,onRetry:l}=i,h=u=>{e||(u==="UPLOAD_OTHER"?c():u==="RETRY"&&l())};return d("div",{class:"gc-ux-gate-overlay",children:d("div",{class:"gc-ux-gate-modal",children:[d("div",{class:"gc-ux-gate-modal-header",children:[d("div",{class:`gc-ux-gate-modal-icon gc-ux-gate-modal-icon-${t.severity.toLowerCase()}`,children:t.severity==="ALTA"?"":""}),d("div",{class:"gc-ux-gate-modal-title",children:t.title})]}),d("div",{class:"gc-ux-gate-modal-body",children:[d("div",{class:"gc-ux-gate-modal-message",children:t.message}),t.otherAlerts&&t.otherAlerts.length>0&&d("div",{class:"gc-ux-gate-modal-other-alerts",children:[d("div",{class:"gc-ux-gate-modal-other-alerts-title",children:"Outros alertas:"}),t.otherAlerts.map((u,p)=>d("div",{class:"gc-ux-gate-modal-other-alert-item",children:[d("strong",{children:[u.title,":"]})," ",u.message]},p))]}),d("div",{class:"gc-ux-gate-modal-tips",children:[d("div",{class:"gc-ux-gate-modal-tips-title",children:"Como resolver:"}),d("ul",{class:"gc-ux-gate-modal-tips-list",children:[d("li",{children:'Prefira "PDF com texto selecionvel".'}),d("li",{children:'Se tiver, baixe uma verso "Digital" no site da banca.'}),d("li",{children:"Evite foto/scan e arquivos muito comprimidos."})]})]})]}),d("div",{class:"gc-ux-gate-modal-actions",children:[d("button",{class:"gc-ux-gate-modal-btn gc-ux-gate-modal-btn-primary",disabled:e,onClick:()=>h(t.primary.action),children:t.primary.label}),t.secondary&&d("button",{class:"gc-ux-gate-modal-btn gc-ux-gate-modal-btn-secondary",disabled:e,onClick:()=>h(t.secondary.action),children:t.secondary.label})]})]})})}const{onContinue:r,onUploadOther:o}=i,a=c=>{e||(c==="UPLOAD_OTHER"?o():r())};return d("div",{class:"gc-ux-gate-overlay",children:d("div",{class:"gc-ux-gate-modal",children:[d("div",{class:"gc-ux-gate-modal-header",children:[d("div",{class:`gc-ux-gate-modal-icon gc-ux-gate-modal-icon-${t.severity.toLowerCase()}`,children:t.severity==="ALTA"?"":""}),d("div",{class:"gc-ux-gate-modal-title",children:t.title})]}),d("div",{class:"gc-ux-gate-modal-body",children:[d("div",{class:"gc-ux-gate-modal-message",children:t.message}),t.otherAlerts&&t.otherAlerts.length>0&&d("div",{class:"gc-ux-gate-modal-other-alerts",children:[d("div",{class:"gc-ux-gate-modal-other-alerts-title",children:"Outros alertas:"}),t.otherAlerts.map((c,l)=>d("div",{class:"gc-ux-gate-modal-other-alert-item",children:[d("strong",{children:[c.title,":"]})," ",c.message]},l))]})]}),d("div",{class:"gc-ux-gate-modal-actions",children:[d("button",{class:"gc-ux-gate-modal-btn gc-ux-gate-modal-btn-primary",disabled:e,onClick:()=>a(t.primary.action),children:t.primary.label}),t.secondary&&d("button",{class:"gc-ux-gate-modal-btn gc-ux-gate-modal-btn-secondary",disabled:e,onClick:()=>a(t.secondary.action),children:t.secondary.label})]})]})})}function Jx(){return null}function Zx(){const i=Fe(E=>E.pendingUpload),t=Fe(E=>E.clearPendingUpload),e=Fe(E=>E.salvarEditalProcessado),[s,n]=$("idle"),[r,o]=$(null),[a,c]=$(null),[l,h]=$(null),u=Gi(!1),p=ie(()=>i?.fileName??"edital.pdf",[i]),g=Kh(async()=>{if(!u.current){u.current=!0;try{if(!i?.file){Y("/app/upload",!0);return}o(null),n("processing");const E=await Xx({file:i.file,fileName:i.fileName});let A=E.debugInfo?.diagnosticoPdf;const P=Jx();if(P&&(A=P),A){const M=ib(A);if(M&&(M.mode==="BLOCK"||M.mode==="CONFIRM")){M.key,h(E),c(M),n("awaiting_action");return}}n("saving");const x=await e(E);t(),c(null),h(null),Y(`/app/edital/${x}`,!0)}catch(E){n("error"),o(E?.message?String(E.message):"Falha ao processar o PDF.")}finally{u.current=!1}}},[i,e,t]),y=()=>{a?.mode,c(null),h(null),t(),Y("/app/upload",!0)},m=async()=>{a?.mode,c(null),h(null),o(null),await g()},v=async()=>{if(a?.mode,l){n("saving");try{const E=await e(l);t(),c(null),h(null),Y(`/app/edital/${E}`,!0)}catch(E){n("error"),o(E?.message||"Erro ao salvar edital")}}else c(null)};return bt(()=>{g()},[]),d(lt,{title:"Processando seu edital",subtitle:`Arquivo: ${p}  ${{idle:"Iniciando...",extracting:"Extraindo texto...",processing:"Analisando contedo...",saving:"Salvando no app...",error:"Erro",awaiting_action:"Aguardando sua ao..."}[s]}`,children:d("div",{class:"gc-processamento-page",children:[a&&(()=>{const E=s==="processing"||s==="saving";return a.mode==="BLOCK"?d(Uh,{decision:a,isBusy:E,onUploadOther:y,onRetry:m}):a.mode==="CONFIRM"?d(Uh,{decision:a,isBusy:E,onContinue:v,onUploadOther:y}):null})(),d("div",{class:"gc-content animate-slide-up",children:d("div",{class:"gc-card gc-process-card",children:[d("div",{class:"gc-steps",children:[d(Vl,{done:s!=="idle",current:s==="idle",label:"Iniciar processamento"}),d(Vl,{done:s==="saving"||s==="error",current:s==="processing",label:"Processar PDF"}),d(Vl,{done:s==="error"?!1:s==="saving",current:s==="saving",label:"Salvar no sistema"})]}),s==="error"&&d("div",{class:"gc-error-section",children:[d("div",{class:"gc-error-message",children:[d(Ia,{size:20}),d("div",{children:[d("div",{class:"gc-error-title",children:"Erro no processamento"}),d("div",{class:"gc-error-text",children:r??"Erro desconhecido."})]})]}),d("button",{class:"gc-btn-primary",onClick:()=>Y("/app/upload",!0),children:"Voltar para Upload"})]}),s!=="error"&&d("div",{class:"gc-info-note",children:d("div",{class:"gc-info-text",children:'Dica: se esse PDF for "escaneado" (imagem), ele pode vir sem texto. A precisa OCR (depois a gente faz).'})})]})})]})})}function Vl(i){return d("div",{class:"gc-step",children:[d("div",{class:`gc-step-icon ${i.done?"done":i.current?"current":"pending"}`,children:i.done?d(ys,{size:18}):d(f1,{size:18})}),d("div",{class:`gc-step-label ${i.done?"done":i.current?"current":"pending"}`,children:i.label})]})}function tk(i){const t=i.id??"",{user:e,isPremium:s}=$t(),n=Fe(E=>E.getEditalById),r=Fe(E=>E.getEditalByIdAsync),o=Fe(E=>E.loading),[a,c]=$(null),[l,h]=$(!1),u=ie(()=>t?n(t):null,[t,n]);bt(()=>{t&&e&&!u&&!l&&!a&&(h(!0),r(e.uid,t).then(E=>{E&&c(E)}).catch(E=>{console.error("Erro ao carregar edital:",E)}).finally(()=>{h(!1)}))},[t,e,u,l,a,r]);const p=u||a,g=ie(()=>{if(!p?.debugInfo?.diagnosticoPdf)return null;const E=ib(p.debugInfo.diagnosticoPdf);return E&&E.mode==="INFO"?E:null},[p?.debugInfo?.diagnosticoPdf]),y=`gc:uxinfo:dismissed:${t}`,[m,v]=$(()=>typeof window>"u"?!1:sessionStorage.getItem(y)==="1");bt(()=>{g&&!m&&(g.key,void 0)},[g,m]);const w=()=>{v(!0),typeof window<"u"&&sessionStorage.setItem(y,"1")};return t?l||o?d(lt,{title:"Detalhes do Edital",subtitle:"Viso geral do concurso",children:d(Bl,{title:"Carregando...",desc:"Buscando informaes do edital...",primaryLabel:"Aguardando...",onPrimary:()=>{}})}):p?d(lt,{title:p.titulo,subtitle:`Criado em: ${new Date(p.criadoEmISO).toLocaleString()}`,children:d("div",{class:"gc-detalhes-page",children:[g&&!m&&g.mode==="INFO"&&d(Uh,{decision:g,onDismiss:w}),d("div",{class:"gc-content animate-slide-up",children:[d("div",{class:"gc-info-grid",children:[d("div",{class:"gc-card gc-info-card",children:[d("div",{class:"gc-info-label",children:"rgo"}),d("div",{class:"gc-info-value",children:p.orgao})]}),d("div",{class:"gc-card gc-info-card",children:[d("div",{class:"gc-info-label",children:"Banca"}),d("div",{class:"gc-info-value",children:p.banca})]}),d("div",{class:"gc-card gc-info-card",children:[d("div",{class:"gc-info-label",children:"Cargo"}),d("div",{class:"gc-info-value",children:p.cargo})]})]}),d("div",{class:"gc-card gc-disciplinas-card",children:[d("div",{class:"gc-section-header",children:[d("div",{class:"gc-section-title",children:"Disciplinas e Contedos"}),d("div",{class:"gc-section-subtitle",children:"Processado automaticamente (mock por enquanto)"})]}),d("div",{class:"gc-disciplinas-list",children:p.disciplinas.map(E=>d("div",{class:"gc-disciplina-item",children:[d("div",{class:"gc-disciplina-header",children:[d("div",{class:"gc-disciplina-name",children:E.nome}),d("div",{class:"gc-disciplina-count",children:[E.conteudos.length," tpico(s)"]})]}),d("div",{class:"gc-conteudos-grid",children:E.conteudos.map(A=>d("div",{class:"gc-conteudo-tag",children:A},A))})]},E.nome))})]}),d("div",{class:"gc-actions-grid",children:[d(Ul,{icon:d(nv,{size:24}),title:"Mapa Ttico",desc:"Quebra por disciplinas, peso e prioridade",label:"Abrir Mapa Ttico",onClick:()=>Y(`/app/edital/${t}/mapa`,!0),isPremium:!0,isUserPremium:s}),d(Ul,{icon:d(Dc,{size:24}),title:"Flashcards",desc:"Gerar e revisar cards por contedo",label:"Abrir Flashcards",onClick:()=>alert("Flashcards: vamos ligar essa rota no prximo passo."),isPremium:!0,isUserPremium:s}),d(Ul,{icon:d(Zi,{size:24}),title:"Questes",desc:"Treino de questes por tpico e desempenho",label:"Abrir Questes",onClick:()=>alert("Questes: vamos ligar essa rota no prximo passo."),isPremium:!0,isUserPremium:s})]}),typeof window<"u"&&!1,typeof window<"u"&&!1,!1,p.textoBruto&&d("details",{class:"gc-card gc-debug-section",children:[d("summary",{class:"gc-debug-summary",children:[d(Zi,{size:18}),d("span",{children:"Ver texto bruto extrado (debug)"}),d(d1,{size:18,class:"gc-chevron"})]}),d("pre",{class:"gc-debug-text",children:[p.textoBruto.slice(0,12e3),p.textoBruto.length>12e3?`

... (cortado)`:""]})]})]})]})}):d(lt,{title:"Detalhes do Edital",subtitle:"Viso geral do concurso",children:d(Bl,{title:"Edital no encontrado",desc:"Esse edital no foi encontrado. Pode ter sido deletado ou voc no tem permisso para acess-lo.",primaryLabel:"Ir para Upload",onPrimary:()=>Y("/app/upload",!0),secondaryLabel:"Voltar",onSecondary:()=>Y("/app/",!0)})}):d(lt,{title:"Detalhes do Edital",subtitle:"Viso geral do concurso",children:d(Bl,{title:"ID do edital no veio na rota",desc:"Volte e processe um edital novamente.",primaryLabel:"Ir para Upload",onPrimary:()=>Y("/app/upload",!0)})})}function Bl(i){return d("div",{class:"gc-card gc-empty-state",children:[d("div",{class:"gc-empty-title",children:i.title}),d("div",{class:"gc-empty-desc",children:i.desc}),d("div",{class:"gc-empty-actions",children:[d("button",{class:"gc-btn-primary",onClick:i.onPrimary,children:i.primaryLabel}),i.secondaryLabel&&i.onSecondary&&d("button",{class:"gc-btn-secondary",onClick:i.onSecondary,children:i.secondaryLabel})]})]})}function Ul(i){const t=i.isPremium&&!i.isUserPremium;return d("div",{class:`gc-card gc-action-card ${t?"gc-action-card-locked":""}`,title:t?"Recurso exclusivo para assinantes Premium":void 0,children:[d("div",{class:"gc-action-icon",children:[i.icon,t&&d("div",{class:"gc-action-lock-overlay",children:d(Ca,{size:16})})]}),d("div",{class:"gc-action-title",children:[i.title,t&&d(Ca,{size:14,class:"gc-action-title-lock"})]}),d("div",{class:"gc-action-desc",children:i.desc}),d("button",{class:`gc-action-btn ${t?"gc-action-btn-locked":""}`,onClick:i.onClick,title:t?"Recurso exclusivo para assinantes Premium":void 0,children:t?d(we,{children:[d(Ca,{size:14}),"Premium"]}):i.label})]})}function Gg(i){return i.conteudos.reduce((t,e)=>t+e.length,0)}function ek(i){return i>=25?"ALTA":i>=10?"MEDIA":"BAIXA"}function sk(i,t,e){return e==="questoes"&&i!==void 0?i*.7+t*.3:t}function nb(i){const{disciplinas:t,quadro1Pesos:e,totalQuestoesQuadro1:s}=i;let n=0,r=0;for(const u of t){const p=Gg(u);n+=p,r+=u.conteudos.length}const o=void 0;let a=s;const c=e&&e.length>0&&a&&a>0,l=c?"questoes":"chars",h=t.map(u=>{const p=u.conteudos.length,g=Gg(u),y=n>0?g/n*100:0,v=e?.find(x=>Wg(x.disciplina)===Wg(u.nome))?.questoes;let w;c&&v!==void 0&&a&&(w=v/a*100);const E=l==="questoes"&&w!==void 0?w:y,A=ek(E),P=sk(w,y,l);return{nome:u.nome,totalTopicos:p,totalChars:g,questoes:v,pesoQuestoes:w!==void 0?Math.round(w*100)/100:void 0,pesoChars:Math.round(y*100)/100,pesoRelativo:Math.round(E*100)/100,metodoPeso:l,prioridade:A,scorePrioridade:Math.round(P*100)/100,rank:0}});return h.sort((u,p)=>p.scorePrioridade-u.scorePrioridade),h.forEach((u,p)=>{u.rank=p+1}),{totalDisciplinas:t.length,totalTopicos:r,totalChars:n,totalQuestoes:a||s,metodoPeso:l,disciplinas:h,validacao:o}}function Wg(i){return i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}function ik(i){const t=i.id??"",{isPremium:e,loadingPlan:s,user:n}=$t(),r=Fe(h=>h.getEditalById),o=Gi(!1),a=ie(()=>t?r(t):null,[t,r]),c=ie(()=>a?nb(a):null,[a]);if(bt(()=>{c&&n&&!o.current&&c.totalDisciplinas>0&&(o.current=!0,QC(n.uid).catch(h=>{console.error("[GC/MapaTatico] Erro ao incrementar disciplinasVistas:",h)}),r1(n.uid).catch(h=>{console.error("[GC/MapaTatico] Erro ao conceder pontos:",h)}))},[c,n]),!t)return d(lt,{title:"Mapa Ttico",subtitle:"Anlise de prioridades",children:d($l,{title:"ID do edital no veio na rota",desc:"Volte e processe um edital novamente.",primaryLabel:"Ir para Upload",onPrimary:()=>Y("/app/upload",!0)})});if(!a)return d(lt,{title:"Mapa Ttico",subtitle:"Anlise de prioridades",children:d($l,{title:"Edital no encontrado",desc:"Esse edital no est no store. Pode ter sido um refresh na pgina (o store  em memria).",primaryLabel:"Ir para Upload",onPrimary:()=>Y("/app/upload",!0),secondaryLabel:"Voltar",onSecondary:()=>Y("/app/",!0)})});if(!c||c.totalDisciplinas===0)return d(lt,{title:"Mapa Ttico",subtitle:"Anlise de prioridades",children:d($l,{title:"Mapa Ttico vazio",desc:"Este edital no possui disciplinas processadas. Verifique se o parser encontrou contedo.",primaryLabel:"Voltar ao Edital",onPrimary:()=>Y(`/app/edital/${t}`,!0),secondaryLabel:"Ir para Home",onSecondary:()=>Y("/app/",!0)})});const l=h=>{switch(h){case"ALTA":return"gc-prioridade-alta";case"MEDIA":return"gc-prioridade-media";case"BAIXA":return"gc-prioridade-baixa"}};if(!e&&!s){const h=c?.disciplinas.slice(0,Math.ceil(c.disciplinas.length*.1))||[];return d(lt,{title:"Mapa Ttico",subtitle:a.titulo,children:[d("div",{class:"gc-content animate-slide-up",children:d("div",{class:"gc-card gc-mapa-tatico-card",children:[d("div",{class:"gc-section-header",children:[d("div",{class:"gc-section-title",children:"Anlise por Disciplina (Prvia - 10%)"}),d("div",{class:"gc-section-subtitle",children:"Desbloqueie o Premium para ver o mapa completo"})]}),d("div",{class:"gc-mapa-tatico-table",children:[d("div",{class:"gc-mapa-tatico-table-header",children:[d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-disciplina",children:"Disciplina"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico gc-mapa-tatico-cell-rank",children:"Rank"}),c.metodoPeso==="questoes"&&d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:"Questes"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:"Tpicos"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:"Peso (%)"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-prioridade",children:"Prioridade"})]}),h.map(u=>d("div",{class:"gc-mapa-tatico-table-row",children:[d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-disciplina",children:u.nome}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico gc-mapa-tatico-cell-rank",children:d("span",{class:"gc-rank-badge",children:["#",u.rank]})}),c.metodoPeso==="questoes"&&d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:u.questoes!==void 0?u.questoes:""}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:u.totalTopicos.toLocaleString()}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:[u.pesoRelativo.toFixed(2),"%"]}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-prioridade",children:d("span",{class:`gc-prioridade-badge ${l(u.prioridade)}`,children:u.prioridade})})]},u.nome))]})]})}),d(io,{featureName:"Mapa Ttico"})]})}return d(lt,{title:"Mapa Ttico",subtitle:a.titulo,children:d(io,{featureName:"Mapa Ttico",children:d("div",{class:"gc-detalhes-page",children:d("div",{class:"gc-content animate-slide-up",children:[d("div",{class:"gc-card gc-metodo-peso-badge",children:[d("div",{class:"gc-metodo-peso-label",children:"Mtodo de peso:"}),d("div",{class:`gc-metodo-peso-value ${c.metodoPeso==="questoes"?"gc-metodo-questoes":"gc-metodo-chars"}`,children:c.metodoPeso==="questoes"?"Quadro 1 (questes)":"Contedo (chars)"}),a.debugInfo?.quadro1Aviso&&c.metodoPeso==="chars"&&d("div",{class:"gc-metodo-peso-aviso",children:a.debugInfo.quadro1Aviso}),typeof window<"u"&&!1]}),d("div",{class:"gc-info-grid",children:[d("div",{class:"gc-card gc-info-card",children:[d("div",{class:"gc-info-label",children:"Total de Disciplinas"}),d("div",{class:"gc-info-value",children:c.totalDisciplinas})]}),d("div",{class:"gc-card gc-info-card",children:[d("div",{class:"gc-info-label",children:"Total de Tpicos"}),d("div",{class:"gc-info-value",children:c.totalTopicos.toLocaleString()})]}),d("div",{class:"gc-card gc-info-card",children:[d("div",{class:"gc-info-label",children:"Total de Caracteres"}),d("div",{class:"gc-info-value",children:c.totalChars.toLocaleString()})]}),d("div",{class:"gc-card gc-info-card",children:[d("div",{class:"gc-info-label",children:"Total de Questes (Quadro 1)"}),d("div",{class:"gc-info-value",children:c.totalQuestoes!==void 0?c.totalQuestoes.toLocaleString():""})]})]}),d("div",{class:"gc-card gc-mapa-tatico-card",children:[d("div",{class:"gc-section-header",children:[d("div",{class:"gc-section-title",children:"Anlise por Disciplina"}),d("div",{class:"gc-section-subtitle",children:["Prioridade baseada no peso relativo"," ",c.metodoPeso==="questoes"?"(questes)":"(contedo)"]})]}),d("div",{class:"gc-mapa-tatico-table",children:[d("div",{class:"gc-mapa-tatico-table-header",children:[d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-disciplina",children:"Disciplina"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico gc-mapa-tatico-cell-rank",children:"Rank"}),c.metodoPeso==="questoes"&&d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:"Questes"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:"Tpicos"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:"Chars"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:"Peso (%)"}),c.metodoPeso==="questoes"&&d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico gc-mapa-tatico-cell-secundario",children:"Peso (chars)"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico gc-mapa-tatico-cell-secundario",children:"Score"}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-prioridade",children:"Prioridade"})]}),c.disciplinas.map(h=>d("div",{class:"gc-mapa-tatico-table-row",children:[d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-disciplina",children:h.nome}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico gc-mapa-tatico-cell-rank",children:d("span",{class:"gc-rank-badge",children:["#",h.rank]})}),c.metodoPeso==="questoes"&&d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:h.questoes!==void 0?h.questoes:""}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:h.totalTopicos.toLocaleString()}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:h.totalChars.toLocaleString()}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico",children:[h.pesoRelativo.toFixed(2),"%"]}),c.metodoPeso==="questoes"&&d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico gc-mapa-tatico-cell-secundario",children:[h.pesoChars.toFixed(2),"%"]}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-numerico gc-mapa-tatico-cell-secundario",children:h.scorePrioridade.toFixed(1)}),d("div",{class:"gc-mapa-tatico-cell gc-mapa-tatico-cell-prioridade",children:d("span",{class:`gc-prioridade-badge ${l(h.prioridade)}`,children:h.prioridade})})]},h.nome))]})]})]})})})})}function $l(i){return d("div",{class:"gc-card gc-empty-state",children:[d("div",{class:"gc-empty-title",children:i.title}),d("div",{class:"gc-empty-desc",children:i.desc}),d("div",{class:"gc-empty-actions",children:[d("button",{class:"gc-btn-primary",onClick:i.onPrimary,children:i.primaryLabel}),i.secondaryLabel&&i.onSecondary&&d("button",{class:"gc-btn-secondary",onClick:i.onSecondary,children:i.secondaryLabel})]})]})}function nk(i,t){let e;try{e=i()}catch{return}return{getItem:n=>{var r;const o=c=>c===null?null:JSON.parse(c,void 0),a=(r=e.getItem(n))!=null?r:null;return a instanceof Promise?a.then(o):o(a)},setItem:(n,r)=>e.setItem(n,JSON.stringify(r,void 0)),removeItem:n=>e.removeItem(n)}}const $h=i=>t=>{try{const e=i(t);return e instanceof Promise?e:{then(s){return $h(s)(e)},catch(s){return this}}}catch(e){return{then(s){return this},catch(s){return $h(s)(e)}}}},rk=(i,t)=>(e,s,n)=>{let r={storage:nk(()=>localStorage),partialize:m=>m,version:0,merge:(m,v)=>({...v,...m}),...t},o=!1;const a=new Set,c=new Set;let l=r.storage;if(!l)return i((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),e(...m)},s,n);const h=()=>{const m=r.partialize({...s()});return l.setItem(r.name,{state:m,version:r.version})},u=n.setState;n.setState=(m,v)=>(u(m,v),h());const p=i((...m)=>(e(...m),h()),s,n);n.getInitialState=()=>p;let g;const y=()=>{var m,v;if(!l)return;o=!1,a.forEach(E=>{var A;return E((A=s())!=null?A:p)});const w=((v=r.onRehydrateStorage)==null?void 0:v.call(r,(m=s())!=null?m:p))||void 0;return $h(l.getItem.bind(l))(r.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==r.version){if(r.migrate){const A=r.migrate(E.state,E.version);return A instanceof Promise?A.then(P=>[!0,P]):[!0,A]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var A;const[P,x]=E;if(g=r.merge(x,(A=s())!=null?A:p),e(g,!0),P)return h()}).then(()=>{w?.(g,void 0),g=s(),o=!0,c.forEach(E=>E(g))}).catch(E=>{w?.(void 0,E)})};return n.persist={setOptions:m=>{r={...r,...m},m.storage&&(l=m.storage)},clearStorage:()=>{l?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>y(),hasHydrated:()=>o,onHydrate:m=>(a.add(m),()=>{a.delete(m)}),onFinishHydration:m=>(c.add(m),()=>{c.delete(m)})},r.skipHydration||y(),g||p},ok=rk,da=yv()(ok((i,t)=>({configs:{},cronogramas:{},setConfig:(e,s)=>i(n=>({configs:{...n.configs,[e]:s}})),getConfig:e=>t().configs[e]||null,setCronograma:(e,s)=>i(n=>({cronogramas:{...n.cronogramas,[e]:s}})),getCronograma:e=>t().cronogramas[e]||null,clearCronograma:e=>i(s=>{const{[e]:n,...r}=s.cronogramas;return{cronogramas:r}})}),{name:"gc_cronograma_store_v1",version:1,partialize:i=>({configs:i.configs,cronogramas:i.cronogramas})}));function ak(i){const t=i.horasPorDia*60,e=i.diasSemanaAtivos.length;return t*e}function ck(i,t,e=1){const n=e*25;if(i.totalDisciplinas*n>t)return new Map;const o=new Map;return i.disciplinas.forEach(a=>{o.set(a.nome,n)}),o}function lk(i,t=25){return i<=0?t:Math.max(t,Math.round(i/t)*t)}function hk(i){const t=new Date;t.setHours(0,0,0,0);const s=new Date(i+"T00:00:00").getTime()-t.getTime(),n=Math.ceil(s/(1e3*60*60*24)),r=Math.ceil(n/7);return Math.max(1,Math.min(52,r))}function Kg(i,t,e){const s=[],n=new Date(e);n.setDate(e.getDate()+(i-1)*7);for(let r=0;r<7;r++){const o=new Date(n);o.setDate(n.getDate()+r);const a=o.getDay();t.diasSemanaAtivos.includes(a)&&s.push(o)}return s}function uk(i,t,e){const s=new Map,n=i.disciplinas.reduce((a,c)=>{const l=c.scorePrioridade??0;return a+(isNaN(l)?0:l)},0);if(n===0){const a=t/i.totalDisciplinas;for(const c of i.disciplinas)s.set(c.nome,a);return s}let r=t;Array.from(e.entries()).forEach(([a,c])=>{s.set(a,c),r-=c});const o=Math.max(0,r);for(const a of i.disciplinas){const c=s.get(a.nome)||0,l=a.scorePrioridade??0,h=isNaN(l)?0:l,u=n>0?h/n:0,p=o*u;s.set(a.nome,c+p)}return s}function dk(i,t,e,s,n=25){const r=[];let o=Math.max(0,s);for(;o>=n;){const a=Math.min(o,n*2),c=lk(a,n),l=Math.min(c,o);r.push({tipo:"ESTUDO",duracaoMin:l,disciplinaNome:i,disciplinaRank:t,disciplinaScore:e??0,origem:`rank ${t}`}),o-=l}return r}function fk(i,t,e,s){const n=new Date;n.setHours(0,0,0,0);const r=new Date(n);r.setDate(n.getDate()+e*7);const o=[1,7,21];for(const a of o){const c=new Date(t);c.setDate(t.getDate()+a),c<=r&&s.push({data:c,bloco:{tipo:"REVISAO",duracaoMin:i.duracaoMin,disciplinaNome:i.disciplinaNome,disciplinaRank:i.disciplinaRank,disciplinaScore:i.disciplinaScore,origem:`reviso D+${a}`}})}}function pk(i,t){const e={1:[],7:[],21:[]};for(const o of i){const a=o.bloco.origem||"";let c=0;a.includes("D+21")?c=21:a.includes("D+7")?c=7:a.includes("D+1")&&(c=1),c>0&&e[c].push(o)}e[1].sort((o,a)=>o.data.getTime()-a.data.getTime()),e[7].sort((o,a)=>o.data.getTime()-a.data.getTime()),e[21].sort((o,a)=>o.data.getTime()-a.data.getTime());const s=[];let n=0;const r=[1,7,21];for(const o of r)for(const a of e[o]){const c=a.bloco.duracaoMin;n+c<=t&&(s.push(a),n+=c)}return s.sort((o,a)=>o.data.getTime()-a.data.getTime()),s}function gk(i,t){let e;const s=new Date;s.setHours(0,0,0,0),t.dataProva?e=hk(t.dataProva):e=Math.max(1,t.horizonteSemanas||4);const n=ak(t),r=Math.floor(n*t.percentRevisao),o=n-r,a=ck(i,o,1),c=uk(i,o,a),l=[],h=[];let u=0;for(let E=1;E<=e;E++){const A=Kg(E,t,s);u+=A.length}const p=new Map;for(const E of i.disciplinas)p.set(E.nome,0);for(let E=1;E<=e;E++){const A=Kg(E,t,s),P=[];for(const x of A){const M=[];let S=0;const T=t.horasPorDia*60;for(const I of i.disciplinas){if(S>=T)break;const k=c.get(I.nome)||0,R=k/u,N=p.get(I.nome)||0;if(N<k&&R>0){const D=k-N,J=Math.min(R,D,T-S);if(J>=25){const wt=dk(I.nome,I.rank,I.scorePrioridade??0,J);for(const G of wt){if(S+G.duracaoMin>T)break;M.push(G),S+=G.duracaoMin,fk(G,x,e,h);const K=p.get(I.nome)||0;p.set(I.nome,K+G.duracaoMin)}}}}P.push({dataISO:x.toISOString().split("T")[0],totalMin:S,blocos:M})}l.push({indice:E,dias:P})}h.reduce((E,A)=>E+A.bloco.duracaoMin,0);const g=pk(h,r*e);for(const E of g){const A=E.data.toISOString().split("T")[0],P=l.find(x=>x.dias.some(M=>M.dataISO===A));if(P){const x=P.dias.find(M=>M.dataISO===A);x&&(x.blocos.push(E.bloco),x.totalMin+=E.bloco.duracaoMin)}}let y=0,m=0,v=0,w=0;for(const E of l)for(const A of E.dias)for(const P of A.blocos)P.tipo==="ESTUDO"?(y+=P.duracaoMin,v++):(m+=P.duracaoMin,w++);return{config:t,semanas:l,meta:{totalMinPlanejado:y,totalMinRevisao:m,totalBlocosEstudo:v,totalBlocosRevisao:w}}}function mk(i){const t=i.id??"",{isPremium:e,loadingPlan:s,user:n}=$t(),r=Fe(A=>A.getEditalById),o=Gi(!1),a=Gi(!1),c=da(A=>A.configs[t]),l=da(A=>A.cronogramas[t]),h=da(A=>A.setConfig),u=da(A=>A.setCronograma),p=ie(()=>t?r(t):null,[t,r]),g=ie(()=>p?nb(p):null,[p]),y={editalId:t,horizonteSemanas:12,diasSemanaAtivos:[1,2,3,4,5],horasPorDia:2,percentRevisao:.2},[m,v]=$(()=>c||y),w=l||null;if(!t)return d(lt,{title:"Cronograma",subtitle:"Gerador de estudo inteligente",children:d(zl,{title:"ID do edital no veio na rota",desc:"Volte e processe um edital novamente.",primaryLabel:"Ir para Upload",onPrimary:()=>Y("/app/upload",!0)})});if(!p)return d(lt,{title:"Cronograma",subtitle:"Gerador de estudo inteligente",children:d(zl,{title:"Edital no encontrado",desc:"Esse edital no est no store.",primaryLabel:"Ir para Upload",onPrimary:()=>Y("/app/upload",!0),secondaryLabel:"Voltar",onSecondary:()=>Y("/app/",!0)})});if(!g||g.totalDisciplinas===0)return d(lt,{title:"Cronograma",subtitle:"Gerador de estudo inteligente",children:d(zl,{title:"Mapa Ttico vazio",desc:"Este edital no possui disciplinas processadas.",primaryLabel:"Voltar ao Edital",onPrimary:()=>Y(`/app/edital/${t}`,!0),secondaryLabel:"Ir para Home",onSecondary:()=>Y("/app/",!0)})});bt(()=>{n&&p&&!a.current&&(a.current=!0,o1(n.uid).catch(A=>{console.error("[GC/Cronograma] Erro ao conceder pontos:",A)}))},[n,p]);const E=()=>{if(!g)return;h(t,m);const A=gk(g,m);u(t,A),n&&A.semanas.length>0&&!o.current&&(o.current=!0,JC(n.uid).catch(P=>{console.error("[GC/Cronograma] Erro ao incrementar semanasCriadas:",P)}))};if(!e&&!s){const A=w?.semanas.slice(0,Math.ceil((w?.semanas.length||0)*.1))||[];return d(lt,{title:"Cronograma de Estudo",subtitle:p.titulo,children:[d("div",{class:"gc-content animate-slide-up",children:w&&d("div",{class:"gc-card gc-cronograma-resultado",children:[d("div",{class:"gc-section-header",children:[d("div",{class:"gc-section-title",children:"Cronograma Gerado (Prvia - 10%)"}),d("div",{class:"gc-section-subtitle",children:"Desbloqueie o Premium para ver o cronograma completo"})]}),d("div",{class:"gc-cronograma-semanas",children:A.map(P=>d("div",{class:"gc-semana-card",children:[d("div",{class:"gc-semana-header",children:d("div",{class:"gc-semana-title",children:["Semana ",P.indice]})}),d("div",{class:"gc-semana-dias",children:P.dias.slice(0,2).map(x=>d("div",{class:"gc-dia-card",children:d("div",{class:"gc-dia-header",children:[d("div",{class:"gc-dia-data",children:new Date(x.dataISO).toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit",month:"short"})}),d("div",{class:"gc-dia-total",children:[x.totalMin," min"]})]})},x.dataISO))})]},P.indice))})]})}),d(io,{featureName:"Cronograma Inteligente"})]})}return d(lt,{title:"Cronograma de Estudo",subtitle:p.titulo,children:d(io,{featureName:"Cronograma Inteligente",children:d("div",{class:"gc-content animate-slide-up",children:[d("div",{class:"gc-card gc-cronograma-config",children:[d("div",{class:"gc-section-header",children:d("div",{class:"gc-section-title",children:"Configurao do Cronograma"})}),d("div",{class:"gc-config-grid",children:[d("div",{class:"gc-config-item",children:[d("label",{class:"gc-config-label",children:[d(wi,{size:16}),"Data da Prova (opcional)"]}),d("input",{type:"date",class:"gc-input",value:m.dataProva||"",onChange:A=>v({...m,dataProva:A.target.value||void 0,horizonteSemanas:A.target.value?void 0:m.horizonteSemanas})})]}),d("div",{class:"gc-config-item",children:[d("label",{class:"gc-config-label",children:[d(wi,{size:16}),"Horizonte (semanas)"]}),d("input",{type:"number",class:"gc-input",min:"1",max:"52",value:m.horizonteSemanas||12,disabled:!!m.dataProva,onChange:A=>v({...m,horizonteSemanas:parseInt(A.target.value)||12})})]}),d("div",{class:"gc-config-item",children:[d("label",{class:"gc-config-label",children:[d(Mc,{size:16}),"Horas por Dia"]}),d("input",{type:"number",class:"gc-input",min:"0.5",max:"12",step:"0.5",value:m.horasPorDia,onChange:A=>v({...m,horasPorDia:parseFloat(A.target.value)||2})})]}),d("div",{class:"gc-config-item",children:[d("label",{class:"gc-config-label",children:[d(Dc,{size:16}),"% Reviso (0-50%)"]}),d("input",{type:"number",class:"gc-input",min:"0",max:"50",step:"5",value:m.percentRevisao*100,onChange:A=>v({...m,percentRevisao:(parseFloat(A.target.value)||0)/100})})]})]}),d("div",{class:"gc-config-item-full",children:[d("label",{class:"gc-config-label",children:"Dias da Semana Ativos"}),d("div",{class:"gc-dias-semana",children:[{value:0,label:"Dom"},{value:1,label:"Seg"},{value:2,label:"Ter"},{value:3,label:"Qua"},{value:4,label:"Qui"},{value:5,label:"Sex"},{value:6,label:"Sb"}].map(A=>d("label",{class:"gc-dia-checkbox",children:[d("input",{type:"checkbox",checked:m.diasSemanaAtivos.includes(A.value),onChange:P=>{const x=P.target.checked?[...m.diasSemanaAtivos,A.value]:m.diasSemanaAtivos.filter(M=>M!==A.value);v({...m,diasSemanaAtivos:x})}}),A.label]},A.value))})]}),d("button",{class:"gc-btn-primary gc-btn-gerar",onClick:E,children:"Gerar Cronograma"})]}),w&&d("div",{class:"gc-card gc-cronograma-resultado",children:[d("div",{class:"gc-section-header",children:[d("div",{class:"gc-section-title",children:"Cronograma Gerado"}),d("div",{class:"gc-section-subtitle",children:[w.semanas.length," semanas "," ",w.meta.totalBlocosEstudo," blocos de estudo "," ",w.meta.totalBlocosRevisao," revises"]})]}),d("div",{class:"gc-cronograma-meta",children:[d("div",{class:"gc-meta-item",children:[d("div",{class:"gc-meta-label",children:"Minutos Planejados"}),d("div",{class:"gc-meta-value",children:[w.meta.totalMinPlanejado.toLocaleString()," min"]})]}),d("div",{class:"gc-meta-item",children:[d("div",{class:"gc-meta-label",children:"Minutos de Reviso"}),d("div",{class:"gc-meta-value",children:[w.meta.totalMinRevisao.toLocaleString()," min"]})]})]}),d("div",{class:"gc-cronograma-semanas",children:w.semanas.map(A=>d("div",{class:"gc-semana-card",children:[d("div",{class:"gc-semana-header",children:d("div",{class:"gc-semana-title",children:["Semana ",A.indice]})}),d("div",{class:"gc-semana-dias",children:A.dias.map(P=>d("div",{class:"gc-dia-card",children:[d("div",{class:"gc-dia-header",children:[d("div",{class:"gc-dia-data",children:new Date(P.dataISO).toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit",month:"short"})}),d("div",{class:"gc-dia-total",children:[P.totalMin," min"]})]}),d("div",{class:"gc-dia-blocos",children:P.blocos.map((x,M)=>d("div",{class:`gc-bloco gc-bloco-${x.tipo.toLowerCase()}`,children:[d("div",{class:"gc-bloco-tipo",children:x.tipo}),d("div",{class:"gc-bloco-disciplina",children:x.disciplinaNome}),d("div",{class:"gc-bloco-duracao",children:[x.duracaoMin," min"]}),x.origem&&d("div",{class:"gc-bloco-origem",children:x.origem})]},M))})]},P.dataISO))})]},A.indice))})]})]})})})}function zl(i){return d("div",{class:"gc-card gc-empty-state",children:[d("div",{class:"gc-empty-title",children:i.title}),d("div",{class:"gc-empty-desc",children:i.desc}),d("div",{class:"gc-empty-actions",children:[d("button",{class:"gc-btn-primary",onClick:i.onPrimary,children:i.primaryLabel}),i.secondaryLabel&&i.onSecondary&&d("button",{class:"gc-btn-secondary",onClick:i.onSecondary,children:i.secondaryLabel})]})]})}const _k="https://us-central1-guerreiro-concursos-oficial.cloudfunctions.net/createCheckoutSession",yk="https://us-central1-guerreiro-concursos-oficial.cloudfunctions.net/createBillingPortalSession";async function rb(i){const t=ni.currentUser;if(!t)throw new Error("Usurio no autenticado");try{const e=await fetch(_k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{userId:t.uid,priceId:i}})});if(!e.ok){const r=await e.text();throw console.error("Erro ao criar checkout:",r),new Error("Falha ao iniciar checkout.")}const s=await e.json(),n=s.result?.data||s.data||s;if(!n||!n.url)throw console.error("Resposta do servidor:",s),new Error("Resposta invlida do servidor: URL no encontrada");return n.url}catch(e){throw console.error("Erro ao criar checkout session:",e),e instanceof Error?e:new Error("Erro ao criar sesso de checkout")}}async function vk(){const i=ni.currentUser;if(!i)throw new Error("Usurio no autenticado");try{const t=await fetch(yk,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{userId:i.uid}})});if(!t.ok){const n=await t.text();throw console.error("Erro ao criar billing portal:",n),new Error("Falha ao abrir portal de assinatura.")}const e=await t.json(),s=e.result?.data||e.data||e;if(!s||!s.url)throw console.error("Resposta do servidor:",e),new Error("Resposta invlida do servidor: URL no encontrada");return s.url}catch(t){throw console.error("Erro ao criar billing portal session:",t),t instanceof Error?t:new Error("Erro ao criar sesso do portal")}}const Xg="price_1SlaYtPSUiyACBIdcy5SmTqq",Yg="price_1SlaeNPSUiyACBIdJEMEVpAp";function bk(){const{user:i,refreshPlan:t}=$t(),[e,s]=$(null),[n,r]=$(null),[o,a]=$(!1);bt(()=>{if(typeof window>"u")return;const h=new URLSearchParams(window.location.search).get("status");if(h==="success"&&i)r("Assinatura ativada com sucesso!"),a(!0),setTimeout(()=>{t();const u=new URL(window.location.href);u.searchParams.delete("status"),u.searchParams.delete("session_id"),window.history.replaceState({},"",u.toString())},2e3);else if(h==="cancel"&&i){r("Pagamento cancelado, nenhum valor foi cobrado."),a(!0);const u=new URL(window.location.href);u.searchParams.delete("status"),u.searchParams.delete("session_id"),window.history.replaceState({},"",u.toString())}},[i,t]);const c=async l=>{if(i){s(l);try{const h=await rb(l);window.location.href=h}catch(h){console.error("Erro ao criar checkout session:",h),alert("Erro ao iniciar assinatura. Tente novamente."),s(null)}}};return d(lt,{title:"Planos disponveis",subtitle:"Escolha o plano ideal para os seus estudos",children:[d("div",{class:"gc-home",children:d("div",{class:"gc-grid-3",children:[d("div",{class:"gc-card gc-edital",children:[d("h2",{children:"Premium Mensal"}),d("p",{class:"gc-price",children:"R$ 39,90/ms"}),d("ul",{class:"gc-list",children:[d("li",{children:"Editais ilimitados"}),d("li",{children:"Processamento avanado"}),d("li",{children:"Mapa ttico completo"}),d("li",{children:"Cronograma inteligente"}),d("li",{children:"Suporte prioritrio"})]}),d("button",{class:"gc-btn-primary",onClick:()=>c(Xg),disabled:e!==null||!i,children:e===Xg?"Carregando...":"Assinar Mensal"})]}),d("div",{class:"gc-card gc-edital",children:[d("h2",{children:"Free"}),d("p",{class:"gc-price",children:"R$ 0/ms"}),d("ul",{class:"gc-list",children:[d("li",{children:"1 edital"}),d("li",{children:"Processamento bsico"}),d("li",{children:"Mapa ttico bsico"})]}),d("button",{class:"gc-btn-disabled",disabled:!0,children:"Plano Atual"})]}),d("div",{class:"gc-card gc-edital",children:[d("div",{class:"gc-badge",children:"Melhor valor"}),d("h2",{children:"Premium Anual"}),d("p",{class:"gc-price",children:"R$ 399,00/ano"}),d("ul",{class:"gc-list",children:[d("li",{children:"Editais ilimitados"}),d("li",{children:"Processamento avanado"}),d("li",{children:"Mapa ttico completo"}),d("li",{children:"Cronograma inteligente"}),d("li",{children:"Suporte prioritrio"})]}),d("button",{class:"gc-btn-primary",onClick:()=>c(Yg),disabled:e!==null||!i,children:e===Yg?"Carregando...":"Assinar Anual"})]})]})}),d(tr,{message:n||"",show:o,onClose:()=>{a(!1),r(null)}})]})}function wk(){const{isPremium:i,user:t}=$t(),[e,s]=$(null),[n,r]=$(null),[o,a]=$(!1),c=async l=>{if(t){s(l);try{const h=await rb(l);window.location.href=h}catch(h){console.error("Erro ao criar checkout session:",h),r("Erro ao iniciar assinatura. Tente novamente."),a(!0),s(null)}}};return d(lt,{title:"Upgrade para Premium",subtitle:"Desbloqueie todo o potencial do Guerreiro Concursos",children:[d("div",{class:"gc-home",children:[d(qn,{}),d("div",{class:"gc-grid-3",children:[d("div",{class:"gc-card gc-edital",children:[d("h2",{class:"gc-card-title",children:"Premium Mensal"}),d("ul",{class:"gc-list",children:[d("li",{children:"Editais ilimitados"}),d("li",{children:"Processamento avanado"}),d("li",{children:"Mapa ttico completo"}),d("li",{children:"Cronograma inteligente"}),d("li",{children:"Suporte prioritrio"})]}),d("div",{class:"gc-price",children:"R$ 39,90/ms"}),!i&&d("button",{class:"gc-btn-primary",onClick:()=>c("price_1SlaYtPSUiyACBIdcy5SmTqq"),disabled:e!==null||!t,children:e==="price_1SlaYtPSUiyACBIdcy5SmTqq"?"Carregando...":"ASSINAR MENSAL  R$ 39,90"})]}),d("div",{class:"gc-card gc-edital",children:[d("h2",{class:"gc-card-title",children:"Free"}),d("ul",{class:"gc-list",children:[d("li",{children:"1 edital"}),d("li",{children:"Processamento bsico"}),d("li",{children:"Mapa ttico"})]}),d("div",{class:"gc-price",children:"R$ 0/ms"}),d("button",{class:"gc-btn-disabled",disabled:!0,children:"PLANO ATUAL"})]}),d("div",{class:"gc-card gc-edital",children:[d("h2",{class:"gc-card-title",children:"Premium Anual"}),d("span",{class:"gc-badge green",children:"Melhor valor"}),d("ul",{class:"gc-list",children:[d("li",{children:"Editais ilimitados"}),d("li",{children:"Processamento avanado"}),d("li",{children:"Mapa ttico completo"}),d("li",{children:"Cronograma inteligente"}),d("li",{children:"Suporte prioritrio"})]}),d("div",{class:"gc-price",children:"R$ 399,00/ano"}),!i&&d("button",{class:"gc-btn-primary",onClick:()=>c("price_1SlaeNPSUiyACBIdJEMEVpAp"),disabled:e!==null||!t,children:e==="price_1SlaeNPSUiyACBIdJEMEVpAp"?"Carregando...":"ASSINAR ANUAL  R$ 399,00"})]})]})]}),d(tr,{message:n||"",show:o,onClose:()=>{a(!1),r(null)}})]})}function Ak(){const{user:i,profile:t,isPremium:e,premiumUntil:s,subscriptionStatus:n,refreshProfile:r}=$t(),[o,a]=$(!1),[c,l]=$(null),[h,u]=$(!1),[p,g]=$(!1);bt(()=>{s&&(s instanceof Date?s:new Date(s))<=new Date&&n!=="active"&&g(!0)},[s,n]),bt(()=>{if(!i)return;const A=setInterval(async()=>{await r()},6e4);return()=>clearInterval(A)},[i,r]),bt(()=>{if(p&&!e){const A=setTimeout(()=>{Y("/app/upgrade",!0)},3e3);return()=>clearTimeout(A)}},[p,e]);const y=async()=>{if(!i){Y("/app/login",!0);return}a(!0);try{const A=await vk();window.location.href=A}catch(A){console.error("Erro ao abrir portal de assinatura:",A),l("Erro ao abrir portal de assinatura. Tente novamente."),u(!0),a(!1)}},m=A=>{switch(A){case"active":return"Ativa";case"canceled":return"Cancelada";case"past_due":return"Pagamento Atrasado";case"incomplete":return"Incompleta";case"trialing":return"Perodo de Teste";case"unpaid":return"No Paga";case"unknown":return"Desconhecido";default:return"Gratuito"}},v=A=>A==="active"?d(ys,{size:16,style:"color: #30E88A;"}):A==="past_due"||A==="unpaid"?d(Ia,{size:16,style:"color: #ef4444;"}):d(Ia,{size:16,style:"color: var(--gc-text-muted);"}),w=s?s instanceof Date?s:new Date(s):null,E=w?w.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"";return d(lt,{title:"Status da Assinatura",subtitle:"Gerencie sua assinatura Premium",children:[d("div",{class:"gc-home",children:[d(qn,{}),d("div",{class:"gc-list",children:[p&&d("div",{class:"gc-card gc-edital",style:"border-color: rgba(239, 68, 68, 0.5); background: rgba(239, 68, 68, 0.05);",children:[d("div",{class:"gc-edital-row",children:d("div",{class:"gc-edital-title",style:"display: flex; align-items: center; gap: 8px;",children:[d(Ia,{size:18,style:"color: #ef4444;"}),"Sua assinatura expirou"]})}),d("div",{class:"gc-edital-meta",children:d("div",{class:"gc-edital-info",children:"Voc ser redirecionado para a pgina de upgrade em alguns segundos..."})})]}),d("div",{class:"gc-card gc-edital",children:[d("div",{class:"gc-edital-row",children:d("div",{class:"gc-edital-title",style:"display: flex; align-items: center; gap: 8px;",children:[e?d(is,{size:18,style:"color: var(--gc-primary);"}):d(is,{size:18,style:"color: var(--gc-text-dim);"}),e?"Plano Premium":"Plano Gratuito"]})}),d("div",{class:"gc-edital-meta",children:[d("div",{class:"gc-edital-info",children:d("span",{children:t?.email||i?.email||""})}),d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(wi,{size:14}),d("span",{children:["Status: ",v(n)," ",m(n)]})]}),w&&d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(is,{size:14}),d("span",{children:["Vlido at: ",E]})]}),t?.createdAt&&d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(wi,{size:14}),d("span",{children:["Conta criada em: ",new Date(t.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})]})]})]}),e&&n==="active"&&d("div",{class:"gc-edital-meta",style:"margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.08);",children:d("button",{style:"background: var(--gc-primary); color: #00131b; border: none; padding: 10px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;",onClick:y,disabled:o,children:[d(p1,{size:16}),o?"Carregando...":"Gerenciar Assinatura"]})}),!e&&d("div",{class:"gc-edital-meta",style:"margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.08);",children:d("button",{style:"background: var(--gc-primary); color: #00131b; border: none; padding: 10px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;",onClick:()=>Y("/app/upgrade",!0),children:[d(is,{size:16}),"Fazer Upgrade"]})})]}),d("div",{class:"gc-card gc-edital",children:[d("div",{class:"gc-edital-row",children:d("div",{class:"gc-edital-title",children:"Benefcios Premium"})}),d("div",{class:"gc-edital-meta",children:[d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(ys,{size:14,style:"color: #30E88A; flex-shrink: 0;"}),d("span",{children:"Editais ilimitados"})]}),d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(ys,{size:14,style:"color: #30E88A; flex-shrink: 0;"}),d("span",{children:"Mapa Ttico completo"})]}),d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(ys,{size:14,style:"color: #30E88A; flex-shrink: 0;"}),d("span",{children:"Cronograma Inteligente"})]}),d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(ys,{size:14,style:"color: #30E88A; flex-shrink: 0;"}),d("span",{children:"Flashcards de reviso"})]}),d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(ys,{size:14,style:"color: #30E88A; flex-shrink: 0;"}),d("span",{children:"Questes inditas"})]}),d("div",{class:"gc-edital-info",style:"display: flex; align-items: center; gap: 8px;",children:[d(ys,{size:14,style:"color: #30E88A; flex-shrink: 0;"}),d("span",{children:"Anlise de desempenho"})]})]})]})]})]}),d(tr,{message:c||"",show:h,onClose:()=>{u(!1),l(null)}})]})}function Ek(){return d(lt,{title:"Termos de Uso",subtitle:"Regras e condies para o uso seguro da plataforma",children:d("div",{class:"gc-legal-page",children:d("div",{class:"gc-content",children:d("div",{class:"gc-card gc-legal-card",children:[d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"1. Escopo do Servio"}),d("p",{class:"gc-legal-text",children:"O Guerreiro Concursos  uma plataforma que oferece ferramentas para organizao e estudo de editais de concursos pblicos. O servio inclui processamento de PDFs, gerao de mapas tticos e cronogramas de estudo."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"2. Conta do Usurio"}),d("p",{class:"gc-legal-text",children:"Ao criar uma conta, voc  responsvel por manter a segurana de suas credenciais. Voc no deve compartilhar sua conta com terceiros.  sua responsabilidade notificar-nos imediatamente sobre qualquer uso no autorizado."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"3. Uso Aceitvel"}),d("p",{class:"gc-legal-text",children:"Voc concorda em usar o servio apenas para fins legais e de acordo com estes termos.  proibido usar o servio para qualquer atividade ilegal, fraudulenta ou que viole direitos de terceiros."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"4. Iseno de Responsabilidade"}),d("p",{class:"gc-legal-text",children:'O servio  fornecido "como est", sem garantias de qualquer tipo. No garantimos que o servio ser ininterrupto, seguro ou livre de erros. Voc usa o servio por sua conta e risco.'})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"5. Mudanas nos Termos"}),d("p",{class:"gc-legal-text",children:"Reservamo-nos o direito de modificar estes termos a qualquer momento. Alteraes significativas sero comunicadas aos usurios. O uso continuado do servio aps as mudanas constitui aceitao dos novos termos."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"6. Contato"}),d("p",{class:"gc-legal-text",children:"Para questes sobre estes termos, entre em contato atravs da pgina de Suporte."})]}),d("div",{class:"gc-legal-footer",children:d("p",{class:"gc-legal-footer-text",children:["ltima atualizao: ",new Date().toLocaleDateString("pt-BR")]})})]})})})})}function Tk(){return d(lt,{title:"Poltica de Privacidade",subtitle:"Transparncia total sobre como cuidamos dos seus dados",children:d("div",{class:"gc-legal-page",children:d("div",{class:"gc-content",children:d("div",{class:"gc-card gc-legal-card",children:[d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"1. Dados Coletados"}),d("p",{class:"gc-legal-text",children:"Coletamos informaes que voc nos fornece diretamente, como email e senha para autenticao. Tambm armazenamos dados relacionados aos editais que voc processa, incluindo contedo extrado e metadados."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"2. Armazenamento"}),d("p",{class:"gc-legal-text",children:"Utilizamos o Firebase (Google) para armazenar seus dados de forma segura. Os dados so criptografados em trnsito e em repouso. Cada usurio tem acesso apenas aos seus prprios dados."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"3. Reteno de Dados"}),d("p",{class:"gc-legal-text",children:"Mantemos seus dados enquanto sua conta estiver ativa. Voc pode solicitar a excluso de sua conta e dados a qualquer momento atravs da pgina de Suporte."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"4. Direitos do Usurio"}),d("p",{class:"gc-legal-text",children:"Voc tem o direito de acessar, corrigir ou excluir seus dados pessoais. Tambm pode solicitar uma cpia dos dados que mantemos sobre voc. Entre em contato atravs da pgina de Suporte para exercer esses direitos."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"5. Compartilhamento"}),d("p",{class:"gc-legal-text",children:"No vendemos, alugamos ou compartilhamos seus dados pessoais com terceiros, exceto quando necessrio para fornecer o servio (ex: Firebase) ou quando exigido por lei."})]}),d("section",{class:"gc-legal-section",children:[d("h2",{class:"gc-legal-section-title",children:"6. Contato"}),d("p",{class:"gc-legal-text",children:"Para questes sobre privacidade ou para exercer seus direitos, entre em contato atravs da pgina de Suporte."})]}),d("div",{class:"gc-legal-footer",children:d("p",{class:"gc-legal-footer-text",children:["ltima atualizao: ",new Date().toLocaleDateString("pt-BR")]})})]})})})})}function Sk(){return d(lt,{title:"Suporte",subtitle:"Estamos aqui para ajudar voc a conquistar sua vaga",children:d("div",{class:"gc-legal-page",children:d("div",{class:"gc-content",children:[d("div",{class:"gc-card gc-support-card",children:[d("h2",{class:"gc-support-title",children:"Entre em Contato"}),d("div",{class:"gc-support-contact-grid",children:[d("div",{class:"gc-support-contact-item",children:[d(v1,{size:24}),d("div",{children:[d("div",{class:"gc-support-contact-label",children:"Email"}),d("div",{class:"gc-support-contact-value",children:"suporte@guerreiroconcursos.com"})]})]}),d("div",{class:"gc-support-contact-item",children:[d(b1,{size:24}),d("div",{children:[d("div",{class:"gc-support-contact-label",children:"WhatsApp"}),d("div",{class:"gc-support-contact-value",children:"(11) 99999-9999"})]})]}),d("div",{class:"gc-support-contact-item",children:[d(Mc,{size:24}),d("div",{children:[d("div",{class:"gc-support-contact-label",children:"Horrio de Atendimento"}),d("div",{class:"gc-support-contact-value",children:"Segunda a Sexta, 9h s 18h"})]})]})]})]}),d("div",{class:"gc-card gc-support-card",children:[d("h2",{class:"gc-support-title",children:[d(_1,{size:20}),"Perguntas Frequentes"]}),d("div",{class:"gc-support-faq",children:[d("div",{class:"gc-support-faq-item",children:[d("div",{class:"gc-support-faq-question",children:"Como fao upload de um edital?"}),d("div",{class:"gc-support-faq-answer",children:'V para a pgina "Upload de Edital", selecione o arquivo PDF e clique em "Enviar e Processar". O sistema ir extrair e organizar o contedo automaticamente.'})]}),d("div",{class:"gc-support-faq-item",children:[d("div",{class:"gc-support-faq-question",children:"Qual  o limite de editais no plano Free?"}),d("div",{class:"gc-support-faq-answer",children:"O plano Free permite at 2 editais. Para uploads ilimitados, faa upgrade para Premium."})]}),d("div",{class:"gc-support-faq-item",children:[d("div",{class:"gc-support-faq-question",children:"Meu PDF no est sendo processado corretamente"}),d("div",{class:"gc-support-faq-answer",children:"Certifique-se de que o PDF contm texto selecionvel (no  uma imagem escaneada). PDFs escaneados precisam de OCR antes do upload. Se o problema persistir, entre em contato."})]}),d("div",{class:"gc-support-faq-item",children:[d("div",{class:"gc-support-faq-question",children:"Como cancelar minha assinatura Premium?"}),d("div",{class:"gc-support-faq-answer",children:"Entre em contato atravs do email ou WhatsApp acima para solicitar o cancelamento. Voc continuar tendo acesso at o fim do perodo pago."})]}),d("div",{class:"gc-support-faq-item",children:[d("div",{class:"gc-support-faq-question",children:"Posso deletar meus editais?"}),d("div",{class:"gc-support-faq-answer",children:"Sim, voc pode deletar seus editais a qualquer momento. A funcionalidade de excluso estar disponvel em breve na interface."})]})]})]}),d("div",{class:"gc-card gc-support-card",children:[d("h2",{class:"gc-support-title",children:"Links Rpidos"}),d("div",{class:"gc-support-links",children:[d("button",{class:"gc-support-link-btn",onClick:()=>Y("/app/termos",!0),children:"Termos de Uso"}),d("button",{class:"gc-support-link-btn",onClick:()=>Y("/app/privacidade",!0),children:"Poltica de Privacidade"}),d("button",{class:"gc-support-link-btn",onClick:()=>Y("/app/planos",!0),children:"Planos e Preos"})]})]})]})})})}function ob({isPremium:i,size:t="medium"}){return d("span",{className:`gc-plan-badge ${i?"premium":"free"} ${t}`,children:i?" Premium":"Free"})}function Ik(){const{user:i,profile:t,isPremium:e,premiumUntil:s,logout:n}=$t(),r=async()=>{confirm("Tem certeza que deseja sair?")&&(await n(),Y("/app/login",!0))},o=()=>i?.photoURL?i.photoURL:t?.photoURL?t.photoURL:`https://ui-avatars.com/api/?name=${encodeURIComponent(t?.displayName||i?.displayName||i?.email||"U")}&background=6366f1&color=fff&size=128`,a=()=>t?.displayName||i?.displayName||i?.email||"Usurio",c=s?s instanceof Date?s:new Date(s):null,l=c?c.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):"";return d(lt,{title:"Meu Perfil",subtitle:"Gerencie suas informaes e status de assinatura",children:d("div",{class:"gc-profile-page",children:d("div",{class:"gc-content animate-slide-up",children:d("div",{className:"gc-card gc-profile-card",children:[d("div",{className:"gc-profile-header",children:[d("div",{className:"gc-profile-avatar-wrapper",children:d("img",{src:o(),alt:"Avatar",className:"gc-profile-avatar"})}),d("div",{className:"gc-profile-info",children:[d("div",{className:"gc-profile-name",children:a()}),d("div",{className:"gc-profile-email",children:i?.email||t?.email||""}),d("div",{className:"gc-profile-badge",children:d(ob,{isPremium:e})})]})]}),d("div",{className:"gc-profile-details",children:[e&&c&&d("div",{className:"gc-profile-detail-item",children:[d("div",{className:"gc-profile-detail-label",children:[d(is,{size:16}),"Premium at"]}),d("div",{className:"gc-profile-detail-value",children:l})]}),t?.createdAt&&d("div",{className:"gc-profile-detail-item",children:[d("div",{className:"gc-profile-detail-label",children:[d(wi,{size:16}),"Conta criada em"]}),d("div",{className:"gc-profile-detail-value",children:new Date(t.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})})]}),t?.editaisProcessados!==void 0&&d("div",{className:"gc-profile-detail-item",children:[d("div",{className:"gc-profile-detail-label",children:[d(Zi,{size:16}),"Editais processados"]}),d("div",{className:"gc-profile-detail-value",children:t.editaisProcessados})]})]}),d("div",{className:"gc-profile-actions",children:[d("button",{className:"gc-btn-secondary gc-profile-action-button",onClick:()=>Y("/app/profile/edit",!0),children:[d(g1,{size:18}),"Editar Perfil"]}),d("button",{className:"gc-btn-secondary gc-profile-action-button",onClick:()=>Y("/app/premium-status",!0),children:[d(is,{size:18}),"Status Premium"]}),d("button",{className:"gc-btn-danger gc-profile-action-button",onClick:r,children:[d(y1,{size:18}),"Sair"]})]})]})})})})}function jl({label:i,...t}){return d("div",{class:"form-group",children:[d("label",{children:i}),d("input",{class:"input-field",...t})]})}function Qg({children:i,variant:t="primary",...e}){return d("button",{class:`btn btn-${t}`,...e,children:i})}function Ck(){const{user:i,profile:t,updateProfile:e}=$t(),[s,n]=$(""),[r,o]=$(""),[a,c]=$(!1),[l,h]=$(null),[u,p]=$(!1),[g,y]=$({});bt(()=>{t?(n(t.displayName||""),o(t.photoURL||"")):i&&(n(i.displayName||""),o(i.photoURL||""))},[t,i]);const m=()=>{const A={};if(s.trim().length<2&&(A.displayName="O nome deve ter pelo menos 2 caracteres"),r&&r.trim()!=="")try{new URL(r)}catch{A.photoURL="URL invlida"}return y(A),Object.keys(A).length===0},v=async()=>{if(!m()){h("Por favor, corrija os erros antes de salvar"),p(!0);return}if(!i){h("Usurio no autenticado"),p(!0);return}c(!0);try{await e({displayName:s.trim()||void 0,photoURL:r.trim()||void 0}),h("Perfil atualizado com sucesso!"),p(!0),setTimeout(()=>{Y("/app/profile",!0)},1500)}catch(A){console.error("Erro ao atualizar perfil:",A),h("Erro ao atualizar perfil. Tente novamente."),p(!0)}finally{c(!1)}},w=()=>{Y("/app/profile",!0)};return d(lt,{title:"Editar Perfil",subtitle:"Mantenha seus dados sempre atualizados",children:d("div",{class:"gc-profile-edit-page",children:[d("div",{class:"gc-content",children:d("div",{className:"gc-card gc-profile-edit-card",children:[d("div",{className:"gc-profile-edit-avatar-section",children:[d("div",{className:"gc-profile-edit-avatar-wrapper",children:d("img",{src:r&&r.trim()!==""?r:i?.photoURL?i.photoURL:t?.photoURL?t.photoURL:`https://ui-avatars.com/api/?name=${encodeURIComponent(s||i?.email||"U")}&background=6366f1&color=fff&size=128`,alt:"Avatar preview",className:"gc-profile-edit-avatar"})}),d("p",{className:"gc-profile-edit-avatar-hint",children:"O avatar ser atualizado automaticamente quando voc salvar"})]}),d("div",{className:"gc-profile-edit-form",children:[d(jl,{label:"Nome",type:"text",value:s,onInput:A=>n(A.target.value),placeholder:"Seu nome completo",maxLength:100}),g.displayName&&d("div",{className:"gc-profile-edit-error",children:g.displayName}),d(jl,{label:"URL da Foto (opcional)",type:"url",value:r,onInput:A=>o(A.target.value),placeholder:"https://exemplo.com/foto.jpg"}),g.photoURL&&d("div",{className:"gc-profile-edit-error",children:g.photoURL}),d(jl,{label:"Email",type:"email",value:i?.email||t?.email||"",disabled:!0,placeholder:"Email no pode ser alterado"}),d("p",{className:"gc-profile-edit-hint",children:"O email no pode ser alterado por questes de segurana"})]}),d("div",{className:"gc-profile-edit-actions",children:[d(Qg,{variant:"secondary",onClick:w,disabled:a,children:[d(ov,{size:18}),"Cancelar"]}),d(Qg,{variant:"primary",onClick:v,disabled:a,children:[d(T1,{size:18}),a?"Salvando...":"Salvar"]})]})]})}),d(tr,{message:l||"",show:u,onClose:()=>{p(!1),h(null)}})]})})}function Pk(){const{user:i,isPremium:t}=$t(),[e,s]=$([]),[n,r]=$(!0),[o,a]=$("");bt(()=>{i&&c()},[i]);const c=async()=>{if(i){r(!0);try{const y=await vv(i.uid);s(y)}catch(y){console.error("Erro ao carregar editais:",y)}finally{r(!1)}}},l=ie(()=>{const y=o.trim().toLowerCase();return e.filter(m=>y?(m.titulo||"").toLowerCase().includes(y):!0)},[e,o]),h=y=>{if(!y)return"";try{return(y instanceof Date?y:y?.toDate?y.toDate():new Date(y)).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return""}},u=y=>{Y(`/app/edital/${y}`,!0)},p=y=>{Y(`/app/edital/${y}/mapa`,!0)},g=y=>{Y(`/app/edital/${y}/cronograma`,!0)};return d(lt,{title:"Meus Editais",subtitle:"Histrico completo de todos os seus editais processados",children:d("div",{class:"gc-profile-editais-page",children:d("div",{class:"gc-content",children:[d("div",{className:"gc-profile-editais-search",children:d("input",{type:"text",value:o,onInput:y=>a(y.target.value),placeholder:"Buscar edital...",className:"gc-profile-editais-search-input"})}),d("div",{className:"gc-profile-editais-stats",children:[d("div",{className:"gc-profile-editais-stat",children:[d("div",{className:"gc-profile-editais-stat-label",children:"Total"}),d("div",{className:"gc-profile-editais-stat-value",children:e.length})]}),d("div",{className:"gc-profile-editais-stat",children:[d("div",{className:"gc-profile-editais-stat-label",children:"Exibindo"}),d("div",{className:"gc-profile-editais-stat-value",children:l.length})]})]}),n?d("div",{className:"gc-card gc-profile-editais-empty",children:"Carregando editais..."}):l.length===0?d("div",{className:"gc-card gc-profile-editais-empty",children:o?"Nenhum edital encontrado com essa busca.":"Voc ainda no processou nenhum edital."}):d("div",{className:"gc-profile-editais-list",children:l.map(y=>d("div",{className:"gc-card gc-profile-editais-item",children:[d("div",{className:"gc-profile-editais-item-header",children:[d("div",{className:"gc-profile-editais-item-title",children:y.titulo||"Edital sem ttulo"}),d(ob,{isPremium:t,size:"small"})]}),d("div",{className:"gc-profile-editais-item-meta",children:[d("div",{className:"gc-profile-editais-item-meta-item",children:[d(wi,{size:14}),d("span",{children:h(y.createdAt)})]}),y.orgao&&d("div",{className:"gc-profile-editais-item-meta-item",children:[d(Zi,{size:14}),d("span",{children:y.orgao})]})]}),d("div",{className:"gc-profile-editais-item-actions",children:[d("button",{className:"gc-profile-editais-action-btn",onClick:()=>u(y.id),children:[d(m1,{size:16}),"Detalhes"]}),t&&d(we,{children:[d("button",{className:"gc-profile-editais-action-btn",onClick:()=>p(y.id),children:[d(nv,{size:16}),"Mapa Ttico"]}),d("button",{className:"gc-profile-editais-action-btn",onClick:()=>g(y.id),children:[d(Mc,{size:16}),"Cronograma"]})]})]})]},y.id))})]})})})}function fa({title:i,value:t,icon:e,gradient:s="free",subtitle:n}){return d("div",{class:`gc-card-analytics gc-card-${s}`,children:[e&&d("div",{class:"gc-card-analytics-icon",children:e}),d("div",{class:"gc-card-analytics-content",children:[d("div",{class:"gc-card-analytics-title",children:i}),d("div",{class:"gc-card-analytics-value",children:t}),n&&d("div",{class:"gc-card-analytics-subtitle",children:n})]})]})}function Rk({diasAtivos:i,streakAtual:t}){const e=t||i;return d("div",{class:"gc-streak-bar",children:[d("div",{class:"gc-streak-header",children:[d("div",{class:"gc-streak-icon",children:d(av,{size:20})}),d("div",{class:"gc-streak-content",children:[d("div",{class:"gc-streak-label",children:"Sequncia de Dias Ativos"}),d("div",{class:"gc-streak-value",children:[e," ",e===1?"dia":"dias"]})]})]}),d("div",{class:"gc-streak-progress",children:d("div",{class:"gc-streak-progress-fill",style:{width:`${Math.min(e/30*100,100)}%`}})}),d("div",{class:"gc-streak-hint",children:[e<7&&"Continue estudando para aumentar sua sequncia!",e>=7&&e<30&&"timo progresso! Mantenha o ritmo!",e>=30&&" Voc est no fogo! Continue assim!"]})]})}function xk({historico:i}){const t=new Date,e=[];for(let n=6;n>=0;n--){const r=new Date(t);r.setDate(r.getDate()-n),r.setHours(0,0,0,0);const o=r.toISOString().split("T")[0],a=i.find(l=>l.date===o),c=r.toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit"});e.push({date:o,count:a?.count||0,label:c})}const s=Math.max(...e.map(n=>n.count),1);return d("div",{class:"gc-mini-chart-7",children:[d("div",{class:"gc-mini-chart-header",children:d("div",{class:"gc-mini-chart-title",children:"Atividade dos ltimos 7 Dias"})}),d("div",{class:"gc-mini-chart-bars",children:e.map(n=>d("div",{class:"gc-mini-chart-bar-wrapper",children:[d("div",{class:"gc-mini-chart-bar-container",children:d("div",{class:"gc-mini-chart-bar",style:{height:`${n.count/s*100}%`,opacity:n.count>0?1:.3}})}),d("div",{class:"gc-mini-chart-label",children:n.label}),n.count>0&&d("div",{class:"gc-mini-chart-value",children:n.count})]},n.date))})]})}function kk({createdAt:i,editaisProcessados:t,disciplinasVistas:e,semanasCriadas:s}){const n=[];if(n.push({type:"created",date:i,label:"Conta criada",description:"Voc comeou sua jornada no Guerreiro Concursos"}),t>0){const a=new Date(i);a.setDate(a.getDate()+1),n.push({type:"edital",date:a,label:"Primeiro edital processado",description:`${t} edital${t>1?"is":""} processado${t>1?"s":""} no total`})}if(e>0){const a=new Date(i);a.setDate(a.getDate()+2),n.push({type:"disciplina",date:a,label:"Primeira disciplina estudada",description:`${e} disciplina${e>1?"s":""} vista${e>1?"s":""} no total`})}if(s>0){const a=new Date(i);a.setDate(a.getDate()+3),n.push({type:"cronograma",date:a,label:"Primeiro cronograma criado",description:`${s} semana${s>1?"s":""} criada${s>1?"s":""} no total`})}n.sort((a,c)=>a.date.getTime()-c.date.getTime());const r=a=>{switch(a){case"created":return d(wi,{size:18});case"edital":return d(Zi,{size:18});case"disciplina":return d(Dc,{size:18});case"cronograma":return d(Mc,{size:18})}},o=a=>{switch(a){case"created":return"gc-timeline-created";case"edital":return"gc-timeline-edital";case"disciplina":return"gc-timeline-disciplina";case"cronograma":return"gc-timeline-cronograma"}};return d("div",{class:"gc-timeline",children:[d("div",{class:"gc-timeline-header",children:[d("div",{class:"gc-timeline-title",children:"Sua Jornada"}),d("div",{class:"gc-timeline-subtitle",children:"Marcos importantes da sua evoluo"})]}),d("div",{class:"gc-timeline-events",children:n.length===0?d("div",{class:"gc-timeline-empty",children:[d("div",{class:"gc-timeline-empty-text",children:"Nenhum evento ainda"}),d("div",{class:"gc-timeline-empty-hint",children:"Comece processando um edital para ver sua jornada aqui!"})]}):n.map((a,c)=>d("div",{class:`gc-timeline-event ${o(a.type)}`,children:[d("div",{class:"gc-timeline-icon",children:r(a.type)}),d("div",{class:"gc-timeline-content",children:[d("div",{class:"gc-timeline-label",children:a.label}),a.description&&d("div",{class:"gc-timeline-description",children:a.description}),d("div",{class:"gc-timeline-date",children:a.date.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})})]})]},c))})]})}function Dk(){const{user:i,profile:t,analytics:e,loadingProfile:s,refreshProfile:n}=$t();bt(()=>{i&&!s&&n().catch(console.error)},[i,s,n]);const r=ie(()=>{if(!e?.lastActivity)return"Nunca";const o=e.lastActivity,c=new Date().getTime()-o.getTime(),l=Math.floor(c/6e4),h=Math.floor(c/36e5),u=Math.floor(c/864e5);return l<1?"Agora mesmo":l<60?`${l} minuto${l>1?"s":""} atrs`:h<24?`${h} hora${h>1?"s":""} atrs`:u<7?`${u} dia${u>1?"s":""} atrs`:o.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})},[e?.lastActivity]);return i?s||!e||!t?d(lt,{title:"Minha Evoluo",subtitle:"Acompanhe seu progresso e conquistas",children:d("div",{class:"gc-analytics-loading",children:"Carregando..."})}):d(lt,{title:"Minha Evoluo",subtitle:"Acompanhe seu progresso e conquistas",children:d("div",{class:"gc-analytics-page",children:[d(qn,{}),d("div",{class:"gc-analytics-content animate-slide-up",children:[d("div",{class:"gc-analytics-grid",children:[d(fa,{title:"Editais Processados",value:e.editaisProcessados,icon:d(Zi,{size:24}),gradient:"premium"}),d(fa,{title:"Disciplinas Estudadas",value:e.disciplinasVistas,icon:d(Dc,{size:24}),gradient:"free"}),d(fa,{title:"Semanas Criadas",value:e.semanasCriadas,icon:d(wi,{size:24}),gradient:"free"}),d(fa,{title:"Dias Ativos",value:e.diasAtivos,icon:d(rv,{size:24}),gradient:"premium",subtitle:r!=="Nunca"?`ltima atividade: ${r}`:void 0})]}),d(Rk,{diasAtivos:e.diasAtivos}),t.historicoAtividade&&t.historicoAtividade.length>0&&d(xk,{historico:t.historicoAtividade}),d(kk,{createdAt:t.createdAt,editaisProcessados:e.editaisProcessados,disciplinasVistas:e.disciplinasVistas,semanasCriadas:e.semanasCriadas})]})]})}):d(lt,{title:"Minha Evoluo",subtitle:"Acompanhe seu progresso e conquistas",children:d("div",{class:"gc-analytics-empty",children:d("div",{class:"gc-analytics-empty-text",children:"Faa login para ver sua evoluo"})})})}const Jg={primeiro_edital:{nome:"Primeiro Edital",descricao:"Processou seu primeiro edital",icone:""},sete_dias_ativo:{nome:"Sete Dias Ativo",descricao:"Manteve-se ativo por 7 dias",icone:""},guerreiro_constante:{nome:"Guerreiro Constante",descricao:"Completou streak de 3 dias",icone:""},premium_primeira_vez:{nome:"Premium Primeira Vez",descricao:"Assinou o plano Premium",icone:""},mapa_desbloqueado:{nome:"Mapa Desbloqueado",descricao:"Acessou o Mapa Ttico",icone:""}};function Mk(){const{user:i,profile:t,loadingProfile:e,refreshProfile:s}=$t();if(bt(()=>{i&&!e&&s().catch(console.error)},[i,e,s]),!i)return d(lt,{title:"Minhas Recompensas",subtitle:"Acompanhe seus pontos, nvel e medalhas",children:d("div",{class:"gc-recompensas-page",children:d("div",{class:"gc-recompensas-empty",children:d("div",{class:"gc-recompensas-empty-text",children:"Faa login para ver suas recompensas"})})})});if(e||!t)return d(lt,{title:"Minhas Recompensas",subtitle:"Acompanhe seus pontos, nvel e medalhas",children:d("div",{class:"gc-recompensas-page",children:d("div",{class:"gc-recompensas-loading",children:"Carregando..."})})});const n=t.pontos||0,r=t.nivel||1,o=t.progressaoNivel||0,a=t.medalhas||[],c=r===1?100-n:r===2?250-n:r===3?500-n:r===4?1e3-n:0;return d(lt,{title:"Minhas Recompensas",subtitle:"Acompanhe seus pontos, nvel e medalhas",children:d("div",{class:"gc-recompensas-page",children:d("div",{class:"gc-recompensas-content animate-slide-up",children:[d("div",{class:"gc-card gc-recompensas-card",children:[d("div",{class:"gc-recompensas-header",children:[d("div",{class:"gc-recompensas-pontos",children:[d(is,{size:32,class:"gc-recompensas-icone-pontos"}),d("div",{class:"gc-recompensas-pontos-valor",children:n.toLocaleString()}),d("div",{class:"gc-recompensas-pontos-label",children:"Pontos"})]}),d("div",{class:"gc-recompensas-nivel",children:[d(rv,{size:32,class:"gc-recompensas-icone-nivel"}),d("div",{class:"gc-recompensas-nivel-valor",children:["Nvel ",r]}),d("div",{class:"gc-recompensas-nivel-label",children:r===5?"Nvel Mximo!":`${c} pontos para o prximo nvel`})]})]}),r<5&&d("div",{class:"gc-recompensas-progresso",children:[d("div",{class:"gc-recompensas-progresso-label",children:["Progresso para Nvel ",r+1]}),d("div",{class:"gc-recompensas-progresso-bar",children:d("div",{class:"gc-recompensas-progresso-fill",style:`width: ${o}%`})}),d("div",{class:"gc-recompensas-progresso-text",children:[o.toFixed(0),"%"]})]})]}),d("div",{class:"gc-card gc-recompensas-card",children:[d("div",{class:"gc-recompensas-section-header",children:[d(u1,{size:24}),d("div",{class:"gc-recompensas-section-title",children:"Medalhas"}),d("div",{class:"gc-recompensas-section-subtitle",children:[a.length," de ",Object.keys(Jg).length," conquistadas"]})]}),d("div",{class:"gc-recompensas-medalhas-grid",children:Object.entries(Jg).map(([l,h])=>{const u=a.includes(l);return d("div",{class:`gc-recompensas-medalha ${u?"gc-recompensas-medalha-conquistada":"gc-recompensas-medalha-bloqueada"}`,children:[d("div",{class:"gc-recompensas-medalha-icone",children:h.icone}),d("div",{class:"gc-recompensas-medalha-nome",children:h.nome}),d("div",{class:"gc-recompensas-medalha-descricao",children:h.descricao}),u&&d("div",{class:"gc-recompensas-medalha-badge",children:"Conquistada"})]},l)})})]}),d("div",{class:"gc-card gc-recompensas-card",children:[d("div",{class:"gc-recompensas-section-header",children:[d(is,{size:24}),d("div",{class:"gc-recompensas-section-title",children:"Como Ganhar Pontos"})]}),d("div",{class:"gc-recompensas-pontos-lista",children:[d("div",{class:"gc-recompensas-ponto-item",children:[d("div",{class:"gc-recompensas-ponto-valor",children:"+5"}),d("div",{class:"gc-recompensas-ponto-descricao",children:"Ao abrir o app"})]}),d("div",{class:"gc-recompensas-ponto-item",children:[d("div",{class:"gc-recompensas-ponto-valor",children:"+10"}),d("div",{class:"gc-recompensas-ponto-descricao",children:"Ao processar um edital"})]}),d("div",{class:"gc-recompensas-ponto-item",children:[d("div",{class:"gc-recompensas-ponto-valor",children:"+3"}),d("div",{class:"gc-recompensas-ponto-descricao",children:"Ao abrir o Mapa Ttico"})]}),d("div",{class:"gc-recompensas-ponto-item",children:[d("div",{class:"gc-recompensas-ponto-valor",children:"+3"}),d("div",{class:"gc-recompensas-ponto-descricao",children:"Ao abrir o Cronograma"})]}),d("div",{class:"gc-recompensas-ponto-item",children:[d("div",{class:"gc-recompensas-ponto-valor",children:"+20"}),d("div",{class:"gc-recompensas-ponto-descricao",children:"Ao completar streak de 3 dias"})]}),d("div",{class:"gc-recompensas-ponto-item",children:[d("div",{class:"gc-recompensas-ponto-valor",children:"+50"}),d("div",{class:"gc-recompensas-ponto-descricao",children:"Ao assinar o Premium"})]})]})]})]})})})}const Nk=()=>{const{user:i,isPremium:t}=$t(),[e,s]=$([]),[n,r]=$(!0),[o,a]=$(0);return bt(()=>{if(!i||!t)return;(async()=>{r(!0);try{const l=await mP(i.uid),h=await bP(i.uid);s(l),a(h)}catch(l){console.error("[GC/Flashcards] Erro ao carregar disciplinas:",l)}finally{r(!1)}})()},[i,t]),t?d(lt,{title:"Flashcards",subtitle:"Memorizao acelerada atravs de repetio espaada",children:d("div",{class:"gc-home",children:[d(qn,{}),e.length>0&&d("div",{class:"gc-stats",children:[d("div",{class:"gc-card stat",children:[d("div",{class:"stat-label",children:"Total de Cards"}),d("div",{class:"stat-value",children:o})]}),d("div",{class:"gc-card stat",children:[d("div",{class:"stat-label",children:"Disciplinas"}),d("div",{class:"stat-value",children:e.length})]})]}),d("div",{class:"gc-list",children:n?d("div",{class:"gc-card empty",children:"Carregando flashcards..."}):e.length===0?d("div",{class:"gc-card empty",children:"Nenhum flashcard ainda. Crie seu primeiro flashcard a partir de um edital para comear a revisar de forma inteligente."}):e.map(c=>d("div",{class:"gc-card gc-edital",onClick:()=>Y(`/app/flashcards/${encodeURIComponent(c)}`,!0),children:d("div",{class:"gc-edital-row",children:[d("div",{class:"gc-edital-title",style:"display: flex; align-items: center; gap: 8px;",children:[d(iv,{size:18,style:"color: var(--gc-primary);"}),c]}),d(h1,{size:16,style:"color: var(--gc-text-muted);"})]})},c))})]})}):d(lt,{title:"Flashcards",subtitle:"Memorizao acelerada atravs de repetio espaada",children:d("div",{class:"gc-home",children:[d(qn,{}),d("div",{class:"gc-list",children:d("div",{class:"gc-card",children:d("div",{style:"display: flex; flex-direction: column; align-items: center; text-align: center; padding: 8px;",children:[d(Ca,{size:48,style:"color: var(--gc-text-muted); margin-bottom: 16px;"}),d("div",{class:"gc-edital-title",style:"margin-bottom: 12px;",children:"Flashcards so um recurso Premium"}),d("div",{style:"color: var(--gc-text-muted); font-size: 14px; margin-bottom: 20px; line-height: 1.6;",children:"Memorize melhor com repetio espaada e flashcards inteligentes."}),d("div",{class:"gc-edital-meta",style:"margin-bottom: 20px; width: 100%;",children:[d("div",{class:"gc-edital-info",children:d("span",{children:" Memorizao acelerada"})}),d("div",{class:"gc-edital-info",children:d("span",{children:" Repetio espaada inteligente"})}),d("div",{class:"gc-edital-info",children:d("span",{children:" Reviso otimizada por disciplina"})})]}),d("button",{class:"gc-btn-primary",style:"width: 100%;",onClick:()=>Y("/app/upgrade",!0),children:"Ver planos"})]})})})]})})};function Bs({children:i,fallback:t}){const{isPremium:e,loadingPlan:s,loadingProfile:n}=$t();return bt(()=>{!(s||n)&&!e&&Y("/app/planos",!0)},[e,s,n]),s||n?d("div",{class:"paywall-loading",children:d("div",{children:"Carregando..."})}):e?d(we,{children:i}):t?d(we,{children:t}):null}const Lk=({disciplina:i})=>{const{user:t}=$t(),[e,s]=$([]),[n,r]=$(!0),o=i?decodeURIComponent(i):"";bt(()=>{if(!t||!o)return;(async()=>{r(!0);try{const l=await gP(t.uid,o);s(l)}catch(l){console.error("[GC/Flashcards] Erro ao carregar flashcards:",l)}finally{r(!1)}})()},[t,o]);const a=e.filter(c=>new Date(c.proximaRevisao)<=new Date).length;return d(lt,{title:o,subtitle:`${e.length} flashcards  ${a} para revisar`,rightSlot:d("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[d("button",{class:"flashcards-back-btn",onClick:()=>Y("/app/flashcards",!0),children:[d(l1,{size:18}),"Voltar"]}),a>0&&d("button",{class:"flashcards-study-btn",onClick:()=>Y(`/app/flashcards/estudar/${encodeURIComponent(o)}`,!0),children:[d(w1,{size:18}),"Estudar Agora"]})]}),children:d(Bs,{children:d("div",{class:"flashcards-page",children:d("div",{class:"flashcards-container",children:n?d("div",{class:"flashcards-loading",children:"Carregando..."}):e.length===0?d("div",{class:"flashcards-empty",children:[d(iv,{size:48}),d("h2",{children:"Nenhum flashcard encontrado"}),d("p",{children:"Esta disciplina ainda no tem flashcards."})]}):d("div",{class:"flashcards-list",children:e.map(c=>d("div",{class:"flashcards-card-item",children:d("div",{class:"flashcards-card-content",children:[d("div",{class:"flashcards-card-topico",children:c.topico}),d("div",{class:"flashcards-card-pergunta",children:c.pergunta}),d("div",{class:"flashcards-card-stats",children:[d("span",{children:[" ",c.acertos]}),d("span",{children:[" ",c.erros]}),d("span",{class:"flashcards-card-revisao",children:["Prxima: ",new Date(c.proximaRevisao).toLocaleDateString("pt-BR")]})]})]})},c.id))})})})})})};function Ok({pergunta:i,resposta:t,topico:e,onFlip:s}){const[n,r]=$(!1);return d("div",{class:"flashcard-container",children:[d("div",{class:`flashcard ${n?"flipped":""}`,onClick:()=>{r(!n),s&&!n&&s()},children:d("div",{class:"flashcard-inner",children:[d("div",{class:"flashcard-front",children:d("div",{class:"flashcard-content",children:[e&&d("div",{class:"flashcard-topico",children:e}),d("div",{class:"flashcard-pergunta",children:i}),d("div",{class:"flashcard-hint",children:"Clique para ver a resposta"})]})}),d("div",{class:"flashcard-back",children:d("div",{class:"flashcard-content",children:[e&&d("div",{class:"flashcard-topico",children:e}),d("div",{class:"flashcard-resposta",children:t}),d("div",{class:"flashcard-hint",children:"Clique para voltar"})]})})]})}),n&&d("button",{class:"flashcard-reset-btn",onClick:a=>{a.stopPropagation(),r(!1)},title:"Voltar para a pergunta",children:d(E1,{size:18})})]})}const Fk=({disciplina:i})=>{const{user:t,isPremium:e}=$t(),[s,n]=$([]),[r,o]=$(0),[a,c]=$(!0),[l,h]=$(!1),[u,p]=$(0),[g,y]=$(!1),m=i?decodeURIComponent(i):"";bt(()=>{if(!t)return;(async()=>{c(!0);try{const x=await _P(t.uid,m||void 0,10);!e&&x.length>3?(n(x.slice(0,3)),y(!0)):(n(x),y(!1))}catch(x){console.error("[GC/Flashcards] Erro ao carregar flashcards:",x)}finally{c(!1)}})()},[t,m,e]);const v=async P=>{if(!t||s.length===0)return;const x=s[r];if(x)try{await yP(t.uid,x.id,P),await s1(t.uid),await tv(t.uid),await Ji(t.uid,2,{tipo:"flashcard_respondido"});const M=u+1;M===1?await ri(t.uid,"flashcards_iniciados"):M===50?await ri(t.uid,"50_respostas"):M===100&&await ri(t.uid,"100_respostas"),await ev(t.uid,{tipo:"flashcard_respondido",dados:{totalRespostas:M}}),p(M),r<s.length-1?o(r+1):(t&&u>=10&&await Ji(t.uid,5,{tipo:"sessao_flashcards_completa"}),h(!0))}catch(M){console.error("[GC/Flashcards] Erro ao registrar resposta:",M)}},w=()=>{Y("/app/flashcards",!0)};if(a)return d(lt,{title:"Estudar Flashcards",children:d(Bs,{children:d("div",{class:"flashcards-page",children:d("div",{class:"flashcards-loading",children:"Carregando..."})})})});if(s.length===0)return d(lt,{title:"Estudar Flashcards",children:d(Bs,{children:d("div",{class:"flashcards-page",children:d("div",{class:"flashcards-empty",children:[d("h2",{children:"Nenhum flashcard para revisar"}),d("p",{children:"Todos os flashcards esto em dia!"}),d("button",{class:"flashcards-action-btn",onClick:w,children:"Voltar"})]})})})});if(l)return d(lt,{title:"Sesso Completa",children:d(Bs,{children:d("div",{class:"flashcards-page",children:d("div",{class:"flashcards-session-complete",children:[d(ys,{size:64}),d("h2",{children:"Sesso de Estudo Completa!"}),d("p",{children:["Voc estudou ",u," flashcards."]}),u>=10&&d("p",{class:"flashcards-bonus",children:"+5 pontos por completar a sesso!"}),d("button",{class:"flashcards-action-btn",onClick:w,children:"Voltar"})]})})})});const E=s[r],A=(r+1)/s.length*100;return d(lt,{title:`Estudando: ${m}`,subtitle:`Card ${r+1} de ${s.length}`,children:d(Bs,{children:d("div",{class:"flashcards-page",children:d("div",{class:"flashcards-study-container",children:[g&&!e&&d("div",{class:"flashcards-teaser-banner",children:[d("p",{children:"Voc est no modo de demonstrao. Faa upgrade para estudar todos os flashcards!"}),d("button",{class:"flashcards-upgrade-btn-small",onClick:()=>Y("/app/upgrade",!0),children:"Fazer Upgrade"})]}),d("div",{class:"flashcards-study-header",children:[d("button",{class:"flashcards-close-btn",onClick:w,children:d(ov,{size:20})}),d("div",{class:"flashcards-progress",children:[d("div",{class:"flashcards-progress-bar",children:d("div",{class:"flashcards-progress-fill",style:{width:`${A}%`}})}),d("span",{class:"flashcards-progress-text",children:[r+1," / ",s.length]})]})]}),d("div",{class:"flashcards-study-content",children:[E&&d(Ok,{pergunta:E.pergunta,resposta:E.resposta,topico:E.topico}),d("div",{class:"flashcards-actions",children:[d("button",{class:"flashcards-action-btn-error",onClick:()=>v(0),children:[d(P1,{size:20}),"Errei"]}),d("button",{class:"flashcards-action-btn-success",onClick:()=>v(1),children:[d(ys,{size:20}),"Acertei"]}),d("button",{class:"flashcards-action-btn-easy",onClick:()=>v(2),children:[d(av,{size:20}),"Fcil"]})]})]})]})})})})},Vk=({href:i,label:t,icon:e,disabled:s=!1,active:n=!1,onClick:r})=>d("a",{href:i,onClick:a=>{a.preventDefault(),!s&&(r&&r(),i&&i!=="#"&&Y(i))},class:`gc-nav-item ${n?"active":""} ${s?"disabled":""}`,title:t,children:[d("span",{class:"gc-nav-icon",children:e}),d("span",{class:"gc-sidebar-label",children:t})]}),Bk=()=>d("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[d("path",{d:"M12 2L2 7L12 12L22 7L12 2Z",stroke:"#38b6ff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),d("path",{d:"M2 17L12 22L22 17",stroke:"#38b6ff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),d("path",{d:"M2 12L12 17L22 12",stroke:"#38b6ff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]}),Uk=({isMobileOpen:i,onMobileClose:t})=>{const[e,s]=$(window.location.pathname),[n,r]=$(!1);bt(()=>{const c=()=>{s(window.location.pathname)};window.addEventListener("popstate",c);const l=history.pushState;history.pushState=function(...u){l.apply(this,u),c()};const h=history.replaceState;return history.replaceState=function(...u){h.apply(this,u),c()},()=>{window.removeEventListener("popstate",c),history.pushState=l,history.replaceState=h}},[]);const o=c=>c==="/app"||c==="/app/"?e==="/app"||e==="/app/":e===c||e.startsWith(c+"/");return d(we,{children:[i&&d("div",{class:"gc-sidebar-overlay",onClick:t}),d("aside",{class:`gc-sidebar ${i?"mobile-open":""}`,children:[d("div",{class:"gc-sidebar-header",children:[d("div",{class:"gc-sidebar-logo",children:n?d(Bk,{}):d("img",{src:"/app/logo.svg",alt:"Guerreiro Concursos",style:"width:100%; height:100%;",onError:()=>r(!0)})}),d("span",{class:"gc-sidebar-logo-text",children:"Guerreiro Concursos"})]}),d("nav",{class:"gc-sidebar-nav",children:[{href:"/app",label:"Dashboard",icon:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("rect",{x:"3",y:"3",width:"7",height:"7"}),d("rect",{x:"14",y:"3",width:"7",height:"7"}),d("rect",{x:"14",y:"14",width:"7",height:"7"}),d("rect",{x:"3",y:"14",width:"7",height:"7"})]})},{href:"/app/profile/editais",label:"Meus Editais",icon:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),d("polyline",{points:"14 2 14 8 20 8"}),d("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),d("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),d("polyline",{points:"10 9 9 9 8 9"})]})},{href:"/app/upload",label:"Novo Edital",icon:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("circle",{cx:"12",cy:"12",r:"10"}),d("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),d("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]})},{href:"#",label:"Mapa Ttico IA",disabled:!0,icon:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("polygon",{points:"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"}),d("line",{x1:"8",y1:"2",x2:"8",y2:"18"}),d("line",{x1:"16",y1:"6",x2:"16",y2:"22"})]})},{href:"#",label:"Questes IA",disabled:!0,icon:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("circle",{cx:"12",cy:"12",r:"10"}),d("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),d("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})},{href:"/app/flashcards",label:"Flashcards",icon:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),d("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]})},{href:"/app/planos",label:"Meu Plano",icon:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:d("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})},{href:"/app/profile",label:"Perfil",icon:d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),d("circle",{cx:"12",cy:"7",r:"4"})]})}].map(c=>d(Vk,{...c,active:c.href!=="#"&&o(c.href),onClick:i?t:void 0},c.label))})]})]})},$k=({onToggleMobileSidebar:i})=>{const{user:t,profile:e,logout:s,isTester:n}=$t(),r=async()=>{try{await s()}catch(h){console.error("Logout failed:",h)}},o=e?.displayName||t?.displayName||"Aluno",a=e?.photoURL||t?.photoURL,l=(h=>{const u=h.trim().split(" ");return u.length>=2?(u[0][0]+u[1][0]).toUpperCase():h.slice(0,2).toUpperCase()})(o);return d("header",{class:"gc-topbar",children:[d("div",{class:"gc-topbar-left",children:[d("button",{class:"gc-hamburger",onClick:i,"aria-label":"Menu",children:d("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[d("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),d("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),d("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),n&&d("div",{class:"gc-topbar-tester",title:"Acesso liberado para testes fechados",children:[d("span",{class:"gc-topbar-tester-dot","aria-hidden":"true"}),d("span",{class:"gc-topbar-tester-text",children:"Testes fechados ativos"})]})]}),d("div",{class:"gc-topbar-right",children:[d("div",{class:"gc-user-profile",children:[d("div",{class:"gc-avatar",children:a?d("img",{src:a,alt:o,onError:h=>{h.target.style.display="none",h.target.parentElement.innerText=l}}):d("span",{children:l})}),d("span",{class:"gc-user-name",children:o})]}),d("div",{class:"gc-topbar-divider"}),d("button",{class:"gc-btn-logout",onClick:r,title:"Sair da conta",children:"Sair"})]})]})},zk=({children:i})=>{const[t,e]=$(!1);return d("div",{class:"gc-app-shell",children:[d(Uk,{isMobileOpen:t,onMobileClose:()=>{e(!1)}}),d("div",{class:"gc-app-main",children:[d($k,{onToggleMobileSidebar:()=>{e(!t)}}),d("div",{class:"gc-app-content",children:i})]})]})},jk=({children:i})=>d("div",{class:"gc-public-layout",children:d("div",{class:"gc-public-content",children:i})});function Zg({component:i,...t}){return d(jk,{children:d(i,{...t})})}function Ht({component:i,...t}){const{user:e,loading:s}=$t(),n=Gi(!1);return bt(()=>{!s&&!e&&!n.current&&(n.current=!0,Y("/app/login",!0))},[e,s]),bt(()=>{!s&&e&&(n.current=!1)},[e,s]),s?d("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:d("div",{children:"Carregando..."})}):e?d(zk,{children:d(i,{...t})}):null}function Hk(){return d(wm,{children:[d(Ot,{path:"/app",component:i=>d(Ht,{component:dg,...i})}),d(Ot,{path:"/app/",component:i=>d(Ht,{component:dg,...i})}),d(Ot,{path:"/app/upload",component:i=>d(Ht,{component:EP,...i})}),d(Ot,{path:"/app/processamento",component:i=>d(Ht,{component:Zx,...i})}),d(Ot,{path:"/app/edital/:id",component:i=>d(Ht,{component:tk,...i})}),d(Ot,{path:"/app/edital/:id/mapa",component:i=>d(Ht,{component:t=>d(Bs,{children:d(ik,{...t})}),...i})}),d(Ot,{path:"/app/edital/:id/cronograma",component:i=>d(Ht,{component:t=>d(Bs,{children:d(mk,{...t})}),...i})}),d(Ot,{path:"/app/planos",component:i=>d(Ht,{component:bk,...i})}),d(Ot,{path:"/app/upgrade",component:i=>d(Ht,{component:wk,...i})}),d(Ot,{path:"/app/premium-status",component:i=>d(Ht,{component:Ak,...i})}),d(Ot,{path:"/app/termos",component:i=>d(Ht,{component:Ek,...i})}),d(Ot,{path:"/app/privacidade",component:i=>d(Ht,{component:Tk,...i})}),d(Ot,{path:"/app/suporte",component:i=>d(Ht,{component:Sk,...i})}),d(Ot,{path:"/app/profile",component:i=>d(Ht,{component:Ik,...i})}),d(Ot,{path:"/app/profile/edit",component:i=>d(Ht,{component:Ck,...i})}),d(Ot,{path:"/app/profile/editais",component:i=>d(Ht,{component:Pk,...i})}),d(Ot,{path:"/app/analytics",component:i=>d(Ht,{component:Dk,...i})}),d(Ot,{path:"/app/recompensas",component:i=>d(Ht,{component:Mk,...i})}),d(Ot,{path:"/app/flashcards",component:i=>d(Ht,{component:Nk,...i})}),d(Ot,{path:"/app/flashcards/:disciplina",component:i=>d(Ht,{component:t=>d(Bs,{children:d(Lk,{disciplina:t.disciplina,...t})}),...i})}),d(Ot,{path:"/app/flashcards/estudar/:disciplina",component:i=>d(Ht,{component:t=>d(Bs,{children:d(Fk,{disciplina:t.disciplina,...t})}),...i})}),d(Ot,{path:"/app/login",component:i=>d(Zg,{component:wP,...i})}),d(Ot,{path:"/app/register",component:i=>d(Zg,{component:AP,...i})})]})}Fn(d(c1,{children:d(Hk,{})}),document.getElementById("app"));
